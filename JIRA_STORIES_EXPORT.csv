Issue Type,Summary,Description,Epic Link,Story Points,Acceptance Criteria,Component,Priority,Labels
Epic,Admin Configuration Foundation,"Build the foundational configuration tools that enable Business Admins to set up Fields Library, Criteria Library, and assemble Tender Document Templates from pre-seeded Blocks.

**Business Value:** Unblock business admins to begin template configuration and testing immediately. Establish data model foundation for all future features.

**Out of Scope (Later Sprints):**
- Block creation UI (blocks seeded in DB for MVP)
- Form Builder UI
- Tender authoring interface for Tender Authors
- CLM content management
- Policy & Rules Engine configuration UI",,,,Admin Configuration,High,"mvp,admin,configuration,foundation"
Story,Data Model - Complete eTendering Foundation,"**As a** System Architect
**I want to** implement comprehensive data models for Fields, Blocks, Templates, and Criteria
**So that** all configuration tools have solid database foundation

h3. Technical Notes
*Database:* PostgreSQL 14+ (for JSONB support and advanced features)
*Naming Convention:* snake_case for tables/columns, UPPER_CASE for enums
*JSONB Fields:* Use for flexible configuration (validation_rules, logic_parameters, layout_config) to avoid frequent schema changes
*Audit:* All configuration tables track created_by, created_at, and have status fields",Admin Configuration Foundation,8,"*AC1: Fields Library Tables*
- Create entities table with entity_id, entity_name, entity_type (CORE/CUSTOM), description, timestamps
- Create fields table with field_id, entity_id, field_name, display_name, data_type (TEXT/NUMERIC/DATE/LOV/BOOLEAN/TABLE/RICH_TEXT), field_tier (CORE_STANDARD/ENTITY_CUSTOM/UNSTRUCTURED), validation_rules (JSONB), lov_name, default_value, read_only_for, placeholder_text, help_text, timestamps, status
- Create list_of_values table with lov_id, lov_name, description, values (JSONB), is_system_defined, timestamps
- UNIQUE constraint on (entity_id, field_name)

*AC2: Criteria Library Tables*
- Create criteria_definitions table with criterion_id, criterion_code, criterion_name, source_field_id, associated_logic (BOOLEAN_YES_NO_CHECK/NUMERIC_THRESHOLD/LOV_SELECTION/DATE_COMPARISON/TEXT_MATCH), logic_parameters (JSONB), description, timestamps, status

*AC3: Blocks Library Tables*
- Create blocks table with block_id, block_code, block_name, block_type (PROVIDED_BY_PROCUREMENT/COLLECTED_FROM_VENDORS/HYBRID), visibility (PUBLIC/INTERNAL), description, layout_config (JSONB), is_reusable, timestamps, status
- Add CHECK constraint: COLLECTED and HYBRID blocks must be PUBLIC
- Create block_fields table with block_field_id, block_id, field_id, form_id, display_order, is_required_in_block, conditional_logic (JSONB), section_name
- Add CHECK constraint: Either field_id or form_id must be populated, not both
- Create block_nested_blocks table for nested block relationships

*AC4: Templates Library Tables*
- Create tender_document_templates table with template_id, template_code, template_name, solicitation_type, procurement_type, granular_category, description, timestamps, status (DRAFT/ACTIVE/DEPRECATED)
- Create template_blocks table with template_block_id, template_id, block_id, display_order, is_mandatory_in_template, section_group, timestamps
- UNIQUE constraints on (template_id, block_id) and (template_id, display_order)

*AC5: Forms Library Tables*
- Create forms table with form_id, form_code, form_name, form_purpose, timestamps, status
- Create form_fields table with form_field_id, form_id, field_id, display_order, is_required_in_form, timestamps

*AC6: Supporting Tables*
- Create attachments table with attachment_id, attached_to_type (BLOCK/TEMPLATE/TENDER_INSTANCE), attached_to_id, file details, visibility, upload info
- Create audit_log table with log_id, entity_type, entity_id, action, changed_by, changed_at, changes (JSONB), ip_address

*AC7: Seed Data Script*
- Create SQL script to seed core entities (Tender_Entity, Vendor_Entity, Pricing_Entity, Evaluation_Entity, Technical_Specification_Entity, Legal_and_Compliance_Entity)
- Seed core fields with proper validation rules
- Seed LOVs (e.g., ProcurementMethods)
- Seed 12+ known blocks for MVP

*AC8: Database Indexes*
- Create performance indexes on fields(entity_id), fields(field_tier), blocks(block_type), blocks(visibility), blocks(status), template_blocks(template_id), template_blocks(display_order), criteria_definitions(source_field_id)

*AC9: Data Validation*
- Foreign key constraints properly defined
- Check constraints for enums
- Unique constraints where appropriate
- NOT NULL constraints on required fields
- Cascading deletes configured

*AC10: Migration Scripts*
- Up migration creates all tables
- Down migration drops all tables with cascade
- Seed data script separate and idempotent
- Version controlled",Backend,High,"backend,database,data-model,foundation,mvp"
Story,Fields Library UI - Entity & Field Management,"**As a** Business Admin
**I want to** view and manage entities and fields in the Fields Library
**So that** I can configure the foundational data structure for the system

h3. Technical Notes
*API Endpoints:*
- GET /api/admin/entities
- GET /api/admin/entities/{entity_id}/fields
- GET /api/admin/fields (all fields)
- GET /api/admin/fields?entity_id=null (unstructured only)
- GET /api/admin/fields?search=tender

*Frontend Framework:* React or Vue.js with component library (Material-UI, Ant Design, or Chakra UI)
*State Management:* Redux or Context API for managing field/entity data",Admin Configuration Foundation,8,"*AC1: Fields Library Page Layout*
- Three-tab interface: Core Fields (default), Custom Entities, Custom Fields
- Header with title ""Fields Library"" and subtitle
- Action button ""+Add Field"" enabled based on current tab

*AC2: Core Fields Tab - Entity List Display*
- Display all entities where entity_type = 'CORE' and status = 'ACTIVE'
- Each entity shown as expandable card with icon (üìã Tender, üë§ Vendor, üí∞ Pricing, üìä Evaluation, üîß Technical, ‚öñÔ∏è Legal)
- ""Edit"" button opens entity editor
- Table of fields in entity: Field Name, Data Type, Validation Rules, Status
- Action button per field: ""‚öôÔ∏è Edit""

*AC3: Core Fields Tab - Fields Display*
- Field Name: Bold, left-aligned
- Data Type: Badge style (TEXT, NUMERIC, DATE, LOV, BOOLEAN)
- Validation: Abbreviated display
- Status: Green ""Active"" or Gray ""Deprecated"" badge
- Actions: Gear icon ""‚öôÔ∏è Edit""

*AC4: Custom Entities Tab*
- Display all entities where entity_type = 'CUSTOM'
- Empty state with ""Create Custom Entity"" button if none exist
- Same card format as Core Fields tab if entities exist

*AC5: Custom Fields Tab (Unstructured)*
- Display all fields where entity_id IS NULL
- Table: Field Name, Data Type, Validation Rules, Created Date, Status, Actions
- Alert message explaining unstructured fields purpose
- ""+Add Custom Field"" button

*AC6: Responsive Design*
- Minimum viewport: 1280px width
- Entity cards stack vertically
- Field tables horizontally scrollable if needed
- Fixed header on scroll

*AC7: Search & Filter*
- Global search across field names, entity names, descriptions
- Filter by status: All/Active/Deprecated
- Filter by data type: All/TEXT/NUMERIC/DATE/LOV/BOOLEAN

*AC8: Empty States*
- Display helpful message when no fields in entity
- ""Add Field to Entity"" button

*AC9: Loading States*
- Skeleton loaders while fetching data
- Spinner for actions
- Toast notifications for success/error

*AC10: Permissions*
- Only ADMIN or SYSTEM_CONFIGURATOR role can access",Frontend,High,"frontend,ui,fields-library,admin,mvp"
Story,Fields Library UI - Create/Edit Entity,"**As a** Business Admin
**I want to** create new custom entities and edit existing entities
**So that** I can organize fields into logical business groupings

h3. Technical Notes
*API:*
- POST /api/admin/entities
- PUT /api/admin/entities/{entity_id}
- DELETE /api/admin/entities/{entity_id}
- Validation: Check field count = 0 before delete",Admin Configuration Foundation,5,"*AC1: Create Custom Entity Modal*
- Opens from ""+Create Custom Entity"" button
- Entity Name field (required, max 100 chars)
- Description field (max 500 chars)
- Info message about adding fields after creation
- Cancel and Create Entity buttons

*AC2: Entity Name Validation*
- Required field
- Must be unique (case-insensitive)
- Must end with ""_Entity"" suffix (enforced or auto-appended)
- 100 character maximum
- No special characters except underscore
- Real-time validation with error messages

*AC3: Edit Existing Entity*
- Opens from ""Edit"" button on entity card
- Pre-filled with current values
- Entity name NOT editable if entity has fields
- Description editable
- Shows field count

*AC4: Delete Entity Protection*
- Cannot delete if entity has fields
- Cannot delete Core entities
- Delete button disabled with tooltip for protected entities
- Confirmation modal for deletable entities

*AC5: Success/Error Handling*
- Success toast on create/edit
- Auto-close modal
- Refresh entity list
- Scroll to newly created entity
- Inline validation errors
- API errors in toast notification",Frontend,Medium,"frontend,ui,fields-library,entity-management,admin"
Story,Fields Library UI - Create/Edit Field,"**As a** Business Admin
**I want to** create and configure fields with validation rules and properties
**So that** I can build the data collection components for the system

h3. Technical Notes
*API Endpoints:*
- GET /api/admin/fields?entity_id={id}
- GET /api/admin/fields?tier={tier}
- POST /api/admin/fields
- PUT /api/admin/fields/{field_id}
- DELETE /api/admin/fields/{field_id}
- GET /api/admin/fields/{field_id}/usage-check
- GET /api/admin/lov
- POST /api/admin/lov

*Validation:* Server-side validation mirrors client-side
*UX:* Auto-save draft every 30 seconds, restore on return",Admin Configuration Foundation,13,"*AC1: Create Field Form*
- Section 1: Basic Information (Field Name, Display Name, Description)
- Section 2: Classification (Entity assignment, Field Tier auto-set)
- Section 3: Data Type & Validation (Data Type dropdown with conditional validation rules)
- Section 4: Additional Properties (Default Value, Placeholder, Help Text, Read-Only Roles)
- Section 5: Live Preview showing field rendering

*AC2: Validation Rules Builder*
- Checkboxes for common rules: Mandatory, Character limit, Unique value, Pattern matching
- Conditional validation: Required if another field equals value

*AC3: LOV Management Integration*
- ""Create New LOV"" opens nested modal
- LOV form: Name, Values table (Value | Label), Add Value Row button
- Auto-selects created LOV in parent form

*AC4: Edit Existing Field*
- Form pre-populated with current values
- Field Name NOT editable if used in blocks
- All other properties editable
- ""Delete Field"" button if not in use

*AC5: Field Name Uniqueness*
- Check uniqueness within entity
- Global uniqueness for unstructured fields
- Real-time validation
- Clear error messages

*AC6: Dependency Checking Before Delete*
- Show usage count: blocks, forms, templates
- Delete disabled if in use
- Offer ""Deprecate Instead"" option
- Confirmation for unused fields

*AC7: Bulk Actions (Defer if needed)*
- Checkbox selection
- Bulk status change
- Bulk entity assignment
- Export to CSV/JSON

*AC8: Field Cloning*
- ""Clone"" button on existing fields
- Pre-fill form with source properties
- Auto-append ""_Copy"" to name",Frontend,High,"frontend,ui,fields-library,field-management,admin,mvp"
Story,Criteria Library UI - Criteria Management,"**As a** Business Admin
**I want to** create and manage criteria definitions that link fields to logic rules
**So that** Policy Engine and Workflow Engine can use these for decision-making

h3. Technical Notes
*API:*
- POST /api/admin/criteria
- PUT /api/admin/criteria/{criterion_id}
- DELETE /api/admin/criteria/{criterion_id}
- GET /api/admin/criteria/{criterion_id}/usage-check
- POST /api/admin/criteria/{criterion_id}/test

*Validation:* Ensure logic type compatibility with field data type",Admin Configuration Foundation,13,"*AC1: Criteria Library Page Layout*
- Title: ""Criteria Library""
- Subtitle explaining purpose
- ""+Add Criterion"" button

*AC2: Criteria Table Display*
- Columns: Criterion ID (code), Criterion Name, Source Field, Associated Logic, Status, Actions
- Monospace formatting for codes
- Badge styling for logic types

*AC3: Logic Type Info Panel*
- Explanatory panel below table
- Describes each logic type with examples:
  - BOOLEAN_YES_NO_CHECK
  - NUMERIC_THRESHOLD
  - LOV_SELECTION
  - DATE_COMPARISON
  - TEXT_MATCH

*AC4: Create Criterion Modal*
- Criterion Code (auto-generate option)
- Criterion Name
- Source Field (searchable dropdown)
- Associated Logic dropdown
- Dynamic Logic Parameters section
- Description field

*AC5: Source Field Selection*
- Searchable autocomplete
- Grouped by entity
- Shows field data type badge
- Filtered by compatible data types for selected logic

*AC6: Logic Type Constraints*
- Validation matrix for field type vs logic type compatibility
- Filter logic type dropdown based on field selection
- Clear error messages for incompatible combinations

*AC7: Logic Parameters Dynamic Form*
- Form changes based on selected logic type
- NUMERIC_THRESHOLD: Operator, Threshold
- LOV_SELECTION: Operator, Values
- BOOLEAN_YES_NO_CHECK: Expected value
- DATE_COMPARISON: Operator, Reference
- TEXT_MATCH: Match type, Pattern

*AC8: Criterion Code Auto-Generation*
- ""Auto-Generate"" button
- Converts name to UPPER_SNAKE_CASE
- Adds ""CRIT_"" prefix
- Checks uniqueness

*AC9: Edit Criterion*
- Pre-populated form
- Code NOT editable
- Warning if used in rules
- Can change logic if not in use

*AC10: Preview/Test Criterion*
- Test section with input field
- Shows evaluation result",Frontend,High,"frontend,ui,criteria-library,admin,rules-engine,mvp"
Story,Template Builder UI - Foundation,"**As a** Business Admin
**I want to** see Blocks Library and drag-drop canvas for template assembly
**So that** I can build Tender Document Templates visually

h3. Technical Notes
*API:*
- GET /api/admin/blocks?status=ACTIVE
- GET /api/admin/blocks?type={type}&visibility={visibility}

*Frontend:*
- React DnD or native HTML5 drag-drop
- State management for template being built
- Auto-save drafts every 60 seconds",Admin Configuration Foundation,8,"*AC1: Page Layout - Two Columns*
- Left sidebar (320px): Blocks Library header, search bar, categorized block list
- Right canvas: Template Canvas header, template name input, drag-drop zone

*AC2: Blocks Library Sidebar*
- Display all active blocks grouped by type:
  - Content Blocks (PROVIDED + PUBLIC)
  - Returnable Forms (COLLECTED)
  - Internal Blocks (PROVIDED + INTERNAL)
  - Special Components
- Collapsible categories

*AC3: Block Display in Sidebar*
- Icon based on category
- Block name
- Description on hover
- Drag handle indicator
- Badges: Block type, Visibility

*AC4: Search and Filter*
- Search bar filters by name
- Filter by Block Type: All/PROVIDED/COLLECTED/HYBRID
- Filter by Visibility: All/PUBLIC/INTERNAL
- Auto-collapse empty categories

*AC5: Empty Canvas State*
- Centered message
- Icon and instructions
- ""Drag blocks from the left to compose template""

*AC6: Drag and Drop Functionality*
- Blocks draggable from sidebar
- Canvas accepts drops
- Visual feedback during drag
- Drop zones highlighted
- Smooth animations

*AC7: Template Header*
- Template Name (required)
- Solicitation Type dropdown
- Procurement Type dropdown
- Granular Category dropdown
- Description textarea
- Save as Draft and Publish Template buttons

*AC8: Responsive Design*
- Minimum viewport: 1280px
- Sidebar collapsible
- Canvas scrollable
- Laptop screen compatible

*AC9: Loading and Error States*
- Skeleton loaders
- Empty state for no blocks
- Error state with retry

*AC10: Permissions*
- ADMIN or TEMPLATE_DESIGNER role only",Frontend,High,"frontend,ui,template-builder,drag-drop,admin,mvp"
Story,Template Builder - Assemble & Configure Template,"**As a** Business Admin
**I want to** drag blocks into canvas, arrange them, and mark as mandatory/discretionary
**So that** I can create complete Tender Document Templates

h3. Technical Notes
*API:*
- POST /api/admin/templates/{template_id}/blocks
- PUT /api/admin/templates/{template_id}/blocks/{block_id}
- DELETE /api/admin/templates/{template_id}/blocks/{block_id}
- PUT /api/admin/templates/{template_id}/blocks/reorder

*State Management:* Track template being built, auto-save every 60 seconds
*Drag-Drop:* HTML5 drag-drop API or React DnD",Admin Configuration Foundation,13,"*AC1: Drag Block to Canvas*
- Block appears as section on drop
- Positioned at bottom or drop location
- Displays: header, icon, name, collapsible content, controls

*AC2: Dropped Block Display*
- Expandable section format
- Shows fields in block
- Displays field count
- Controls: Mandatory toggle, Move up/down, Delete

*AC3: Mandatory/Discretionary Toggle*
- Toggle switch per block
- ON: Red border, ""MANDATORY"" badge, always included
- OFF: Blue border, ""DISCRETIONARY"" badge, optional
- Updates template_blocks.is_mandatory_in_template
- Immediate visual update

*AC4: Block Ordering*
- Arrow buttons: Move up/down
- Disabled at top/bottom
- Updates display_order
- Smooth animations
- Alternative: Drag-to-reorder within canvas

*AC5: Section Grouping (Optional)*
- Group blocks into sections
- Stored in section_group field
- Visual hierarchy

*AC6: Block Configuration Panel*
- Opens from block click
- Shows block details
- Configure: Mandatory status, Display order, Section group
- Read-only view of block contents
- Update and Cancel buttons

*AC7: Delete Block from Template*
- Trash icon removes block
- Confirmation modal
- Block still in library (not deleted)
- Can be re-added

*AC8: Duplicate Block Detection*
- Cannot add same block twice
- Visual feedback message
- Drop rejected

*AC9: Template Preview Mode*
- ""Preview Template"" button
- Read-only view of complete template
- Shows all blocks in order
- Mandatory indicators
- Field lists

*AC10: Block Count & Statistics*
- Display template stats:
  - Total Blocks
  - Mandatory count
  - Discretionary count
  - PUBLIC vs INTERNAL blocks",Frontend,High,"frontend,ui,template-builder,block-management,admin,mvp"
Story,Template Builder - Template CRUD Operations,"**As a** Business Admin
**I want to** create, save, edit, and manage tender document templates
**So that** I can build a library of reusable templates

h3. Technical Notes
*API:*
- GET /api/admin/templates
- GET /api/admin/templates/{template_id}
- POST /api/admin/templates
- PUT /api/admin/templates/{template_id}
- DELETE /api/admin/templates/{template_id}
- PUT /api/admin/templates/{template_id}/publish
- PUT /api/admin/templates/{template_id}/deprecate
- POST /api/admin/templates/{template_id}/clone
- GET /api/admin/templates/{template_id}/usage-stats

*Versioning:* Consider template versions for future",Admin Configuration Foundation,13,"*AC1: Create New Template*
- ""+Create Template"" button in toolbar
- Opens blank template builder
- Empty canvas, info form, action buttons

*AC2: Template Information Form*
- Required: Template Name (unique, 3-200 chars)
- Required: Solicitation Type dropdown
- Required: Procurement Type dropdown
- Optional: Granular Category dropdown
- Optional: Description (max 500 chars)

*AC3: Save as Draft*
- Validates: Name, Solicitation type, Procurement type
- Does NOT require blocks
- Sets status = 'DRAFT'
- Success message
- Assigns template_id
- Shows in list with DRAFT badge

*AC4: Publish Template*
- Validates: All required fields, at least 1 block, at least 1 mandatory block, at least 1 PUBLIC block
- Confirmation modal
- Sets status = 'ACTIVE'
- Success message
- Available for tender creation

*AC5: Templates List View*
- Table: Name, Solicitation Type, Procurement Type, Category, Blocks Count, Status, Last Modified, Actions
- Filters: Status, Solicitation Type, Procurement Type
- Actions: Edit, Clone, Deprecate, Delete

*AC6: Edit Existing Template*
- Loads template builder with all blocks
- Blocks in saved order
- Preserved configurations
- Pre-filled template info
- ""Update Template"" button

*AC7: Clone Template*
- Creates copy with all blocks
- Name: ""[Original] - Copy""
- Status: DRAFT
- All configurations copied

*AC8: Deprecate Template*
- Changes status to DEPRECATED
- No longer in tender creation
- Visible in admin with badge
- Existing tenders unaffected
- Can be reactivated

*AC9: Delete Template*
- Only if DRAFT or never used
- Delete disabled otherwise
- Tooltip explains restriction
- Confirmation for deletable templates

*AC10: Template Metadata*
- Shows: Created by, Created date, Last modified, Times used, Last used",Frontend,High,"frontend,ui,template-builder,crud,admin,mvp"
Story,Seed Initial Blocks in Database,"**As a** System Administrator
**I want to** have essential blocks pre-populated in database
**So that** Business Admins can immediately start building templates

h3. Technical Notes
*Seed Data Location:* database/seeds/02_blocks_seed.sql
*Execution:* Part of database migration/setup process
*Dependencies:* Requires Fields and Entities seeded first (Story 1)",Admin Configuration Foundation,5,"*AC1: Seed 15-20 Essential Blocks*
- General & Administrative: General Information, Project Details, Requisition Details, Timeline
- Technical: Technical Specifications, Scope of Work, BLOCK_CATALOGUE_ITEM, Technical Requirements with Response
- Evaluation & Commercial: Evaluation Criteria, Pricing Schedule, Financial Guarantees, Submission Requirements
- Legal: Contract Terms, Declarations
- Returnable Forms: Bidder Information, Technical Proposal, Commercial Proposal
- Internal: Evaluation Worksheet, Budget Analysis, Risk Assessment

*AC2: Block Configuration Complete*
- Unique block_id (UUID)
- Unique block_code
- block_name, block_type, visibility
- Description
- status = 'ACTIVE'

*AC3: Link Fields to Blocks*
- Seed block_fields entries
- Link appropriate fields to each block
- Set display_order, is_required_in_block, section_name

*AC4: Seed Forms*
- Seed 3-5 standard forms
- Bank Guarantee, Bid Security, JV Partner forms
- Link forms to unstructured fields

*AC5: Documentation*
- Create reference document
- List all seeded blocks with descriptions
- Document fields per block
- Explain use cases
- Note block type and visibility

*AC6: Seed Script Structure*
- Logical organization: Entities, Fields, LOVs, Forms, Blocks, Block-Field links
- Well-commented

*AC7: Idempotent Script*
- Can run multiple times safely
- Use INSERT ON CONFLICT DO NOTHING
- No data duplication
- Safe for dev resets

*AC8: Verification Queries*
- Query to check blocks without fields
- Query to verify COLLECTED/HYBRID blocks are PUBLIC
- Should return empty sets",Backend,Medium,"backend,database,seed-data,blocks,mvp"
Story,Block Details View (Read-Only),"**As a** Business Admin
**I want to** view complete block definitions and their field composition
**So that** I understand what each block contains before adding to templates",Admin Configuration Foundation,3,"*AC1: View Block Action*
- Info icon on each block in sidebar
- Opens block details modal/panel

*AC2: Block Details Modal*
- Block name and code
- Block type and visibility badges
- Description
- Complete field list with data types
- Field validation rules
- Section groupings
- Field count
- Close button

*AC3: Read-Only Display*
- All information display-only
- No edit capability (MVP scope)
- ""Edit Block"" button for future (disabled/hidden in MVP)

*AC4: Navigation*
- Link from template canvas blocks
- Link from blocks library
- Accessible from any block reference",Frontend,Low,"frontend,ui,block-details,read-only,admin"
