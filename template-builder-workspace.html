<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UNOPS PDJ ¬∑ Template Builder Workspace</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        /* Primary Colors - UNOPS Design System */
        --primary-400: #00669a;
        --primary-500: #005783;
        --primary-600: #00476c;
        --primary-50: #bfd9e6;
        --primary-100: #99c2d7;
        --primary-700: #003855;

        /* Surface Colors - Cold Neutral Palette */
        --surface-0: #ffffff;
        --surface-50: #f5f8fb;
        --surface-100: #ebf1f8;
        --surface-200: #dde8f2;
        --surface-300: #cfdfec;
        --surface-600: #95a7ba;
        --surface-800: #596170;
        --surface-900: #3b3e4a;

        /* Semantic Colors */
        --success-500: #4c9f38;
        --success-50: #d2e7cd;
        --info-400: #0092d1;
        --info-50: #bfe4f4;
        --warning-500: #e85c0e;
        --warning-50: #f9d6c3;
        --danger-500: #da291c;
        --danger-50: #f6cac6;

        /* Text Colors */
        --text-primary: var(--surface-900);
        --text-secondary: var(--surface-800);
        --text-muted: var(--surface-600);

        /* Spacing (8px base unit) */
        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 16px;
        --spacing-lg: 24px;
        --spacing-xl: 32px;
        --spacing-2xl: 48px;

        /* Border Radius */
        --radius-sm: 4px;
        --radius-md: 6px;
        --radius-lg: 8px;

        /* Shadows */
        --shadow-card: 0 2px 4px rgba(0, 0, 0, 0.2), 0 4px 5px rgba(0, 0, 0, 0.14),
          0 1px 10px rgba(0, 0, 0, 0.12);
        --shadow-modal: 0 11px 15px rgba(0, 0, 0, 0.2), 0 24px 38px rgba(0, 0, 0, 0.14),
          0 9px 46px rgba(0, 0, 0, 0.12);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: 'Noto Sans', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: var(--surface-50);
        color: var(--text-primary);
        line-height: 1.5;
        min-height: 100vh;
      }

      /* Top Bar */
      .top-bar {
        background: var(--surface-0);
        border-bottom: 1px solid var(--surface-200);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--spacing-md) var(--spacing-xl);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .top-bar__brand {
        display: flex;
        align-items: center;
        gap: var(--spacing-lg);
      }

      .logo {
        font-weight: 700;
        font-size: 18px;
        letter-spacing: 0.12em;
        color: var(--primary-400);
      }

      .top-bar__breadcrumbs {
        font-size: 14px;
        color: var(--text-muted);
        font-weight: 400;
      }

      .top-bar__title {
        font-size: 15px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 2px;
      }

      .top-bar__actions {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
      }

      /* Buttons */
      .btn {
        border-radius: var(--radius-sm);
        border: 1px solid transparent;
        padding: 10px 20px;
        font-size: 14px;
        font-weight: 500;
        font-family: inherit;
        cursor: pointer;
        transition: all 0.2s ease;
        height: 40px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .btn-ghost {
        background: transparent;
        border-color: var(--surface-200);
        color: var(--text-secondary);
      }

      .btn-ghost:hover {
        background: var(--primary-50);
        border-color: var(--primary-500);
        color: var(--primary-400);
      }

      .btn-primary {
        background: var(--primary-400);
        color: #fff;
        border-color: var(--primary-400);
      }

      .btn-primary:hover {
        background: var(--primary-500);
        border-color: var(--primary-500);
      }

      /* Workspace Layout */
      .workspace {
        display: flex;
        min-height: calc(100vh - 73px);
      }

      /* Left Rail Navigation */
      .rail {
        width: 64px;
        background: var(--primary-600);
        color: #b7cee1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-lg);
        padding: var(--spacing-lg) 0;
        transition: width 0.2s ease;
      }

      .rail:hover {
        width: 250px;
      }

      .rail button {
        width: 44px;
        height: 44px;
        border-radius: var(--radius-sm);
        border: none;
        background: transparent;
        color: inherit;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .rail:hover button {
        width: 100%;
        padding: 0 var(--spacing-md);
        justify-content: flex-start;
        gap: var(--spacing-md);
      }

      .rail button .rail-label {
        display: none;
        font-size: 14px;
        font-weight: 500;
        white-space: nowrap;
      }

      .rail:hover button .rail-label {
        display: block;
      }

      .rail button.active {
        background: rgba(255, 255, 255, 0.15);
        color: #fff;
      }

      .rail button:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      /* Main Content Area */
      .columns {
        flex: 1;
        display: grid;
        grid-template-columns: 320px minmax(0, 1fr) 340px;
        gap: var(--spacing-lg);
        padding: var(--spacing-xl);
        overflow: hidden;
      }

      /* Panel Styles */
      .panel {
        background: var(--surface-0);
        border: 1px solid var(--surface-200);
        border-radius: var(--radius-sm);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        box-shadow: var(--shadow-card);
      }

      .panel__header {
        padding: var(--spacing-md) var(--spacing-lg);
        border-bottom: 1px solid var(--surface-200);
        font-size: 13px;
        font-weight: 600;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        background: var(--surface-50);
      }

      .panel__body {
        padding: var(--spacing-lg);
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
      }

      /* Search Bar */
      .search-bar {
        margin-bottom: var(--spacing-md);
        position: relative;
      }

      .search-bar input {
        width: 100%;
        border-radius: var(--radius-sm);
        border: 1px solid var(--surface-200);
        padding: 8px 12px 8px 36px;
        font-family: inherit;
        font-size: 14px;
        background: var(--surface-0);
        color: var(--text-primary);
        transition: all 0.2s ease;
      }

      .search-bar input:focus {
        outline: none;
        border-color: var(--primary-400);
        box-shadow: 0 0 0 2px var(--primary-50);
      }

      .search-bar::before {
        content: 'üîç';
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 14px;
        pointer-events: none;
      }

      /* Scrollable Component Groups */
      .component-group {
        display: flex;
        flex-direction: column;
      }

      .component-group + .component-group {
        margin-top: var(--spacing-xl);
      }

      .component-group.scrollable {
        max-height: 300px;
        overflow-y: auto;
        padding-right: var(--spacing-sm);
      }

      .group-label {
        font-size: 12px;
        letter-spacing: 0.08em;
        color: var(--text-muted);
        text-transform: uppercase;
        margin-bottom: var(--spacing-md);
        font-weight: 600;
        position: sticky;
        top: 0;
        background: var(--surface-0);
        z-index: 1;
        padding-bottom: var(--spacing-xs);
      }

      .component-block {
        border: 1px dashed var(--surface-300);
        border-radius: var(--radius-sm);
        padding: var(--spacing-md);
        margin-bottom: var(--spacing-md);
        cursor: grab;
        transition: all 0.2s ease;
        background: var(--surface-50);
      }

      .component-block:hover {
        border-color: var(--primary-400);
        background: var(--primary-50);
        transform: translateY(-1px);
      }

      .component-block:active {
        cursor: grabbing;
      }

      .component-block.hidden {
        display: none;
      }

      .component-block-icon {
        font-size: 24px;
        margin-right: var(--spacing-sm);
        display: inline-block;
      }

      .component-block-content {
        display: flex;
        align-items: flex-start;
        gap: var(--spacing-sm);
      }

      .component-block strong {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--spacing-xs);
      }

      .component-block span {
        font-size: 12px;
        color: var(--text-muted);
        line-height: 1.4;
      }

      /* Block Sequence Tabs */
      .block-tabs {
        display: flex;
        gap: var(--spacing-xs);
        padding: var(--spacing-md) var(--spacing-lg);
        border-bottom: 1px solid var(--surface-200);
        background: var(--surface-50);
        overflow-x: auto;
        flex-wrap: nowrap;
      }

      .block-tab {
        padding: 8px 16px;
        border: 1px solid var(--surface-200);
        border-radius: var(--radius-sm) var(--radius-sm) 0 0;
        background: var(--surface-0);
        color: var(--text-secondary);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
        position: relative;
        border-bottom: none;
      }

      .block-tab:hover {
        background: var(--surface-50);
        color: var(--text-primary);
      }

      .block-tab.active {
        background: var(--surface-0);
        color: var(--primary-400);
        border-color: var(--primary-400);
        border-bottom-color: var(--surface-0);
        z-index: 1;
        margin-bottom: -1px;
      }

      .block-tab-number {
        display: inline-block;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--surface-200);
        color: var(--text-muted);
        font-size: 12px;
        font-weight: 600;
        line-height: 20px;
        text-align: center;
        margin-right: var(--spacing-xs);
      }

      .block-tab.active .block-tab-number {
        background: var(--primary-400);
        color: #fff;
      }

      /* Canvas Area */
      .canvas-container {
        display: flex;
        flex-direction: column;
        flex: 1;
        overflow: hidden;
      }

      .canvas {
        flex: 1;
        min-height: 400px;
        background: var(--surface-0);
        border: 2px dashed var(--surface-300);
        border-radius: var(--radius-sm);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
        padding: var(--spacing-xl);
        position: relative;
        overflow-y: auto;
      }

      .canvas-view {
        display: none;
      }

      .canvas-view.active {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
      }

      .canvas-empty {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 300px;
        text-align: center;
        color: var(--text-muted);
      }

      .canvas-empty-icon {
        font-size: 64px;
        margin-bottom: var(--spacing-md);
        opacity: 0.5;
      }

      .canvas-empty h2 {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--spacing-sm);
      }

      .canvas-empty p {
        font-size: 14px;
        color: var(--text-muted);
      }

      /* Dropped Sections */
      .dropped-section {
        background: var(--surface-0);
        border: 1px solid var(--surface-200);
        border-radius: var(--radius-sm);
        margin-bottom: var(--spacing-md);
        overflow: hidden;
        transition: all 0.2s ease;
      }

      .dropped-section:hover {
        border-color: var(--primary-400);
        box-shadow: var(--shadow-card);
      }

      .dropped-section.selected {
        border-color: var(--primary-400);
        border-width: 2px;
        box-shadow: 0 0 0 2px var(--primary-50);
      }

      .dropped-section.dragover {
        border-color: var(--success-500);
        background: var(--success-50);
      }

      .section-header {
        padding: var(--spacing-md) var(--spacing-lg);
        background: var(--surface-50);
        border-bottom: 1px solid var(--surface-200);
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: move;
      }

      .section-title-area {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        flex: 1;
      }

      .section-icon {
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: var(--primary-50);
        border-radius: var(--radius-sm);
      }

      .section-name {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
      }

      .section-controls {
        display: flex;
        gap: var(--spacing-sm);
      }

      .icon-btn {
        width: 32px;
        height: 32px;
        border: 1px solid var(--surface-200);
        background: var(--surface-0);
        border-radius: var(--radius-sm);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        color: var(--text-secondary);
        transition: all 0.2s ease;
      }

      .icon-btn:hover {
        background: var(--primary-50);
        border-color: var(--primary-400);
        color: var(--primary-400);
      }

      .section-body {
        padding: var(--spacing-lg);
      }

      .section-body.collapsed {
        display: none;
      }

      /* Collapsible Subsection */
      .subsection {
        border: 1px solid var(--surface-200);
        border-radius: var(--radius-sm);
        margin-bottom: var(--spacing-md);
        overflow: hidden;
        background: var(--surface-50);
      }

      .subsection-header {
        padding: var(--spacing-sm) var(--spacing-md);
        background: var(--surface-100);
        border-bottom: 1px solid var(--surface-200);
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .subsection-header:hover {
        background: var(--surface-200);
      }

      .subsection-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .subsection-toggle {
        font-size: 12px;
        color: var(--text-muted);
        transition: transform 0.2s ease;
      }

      .subsection.collapsed .subsection-toggle {
        transform: rotate(-90deg);
      }

      .subsection-body {
        padding: var(--spacing-md);
        display: block;
      }

      .subsection.collapsed .subsection-body {
        display: none;
      }

      /* Field Items */
      .field-item {
        padding: var(--spacing-md);
        background: var(--surface-0);
        border: 1px solid var(--surface-200);
        border-radius: var(--radius-sm);
        margin-bottom: var(--spacing-md);
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .field-item:hover {
        border-color: var(--primary-400);
        background: var(--primary-50);
      }

      .field-item.selected {
        border-color: var(--primary-400);
        border-width: 2px;
        box-shadow: 0 0 0 2px var(--primary-50);
      }

      .field-info {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xs);
        flex: 1;
      }

      .field-label {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
      }

      .field-badges {
        display: flex;
        gap: var(--spacing-xs);
        flex-wrap: wrap;
      }

      .field-badge {
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .badge-required {
        background: var(--danger-50);
        color: var(--danger-500);
      }

      .badge-conditional {
        background: var(--warning-50);
        color: var(--warning-500);
      }

      .badge-readonly {
        background: var(--surface-100);
        color: var(--text-muted);
      }

      .badge-mapped {
        background: var(--info-50);
        color: var(--info-400);
      }

      /* Drop Zone */
      .drop-zone {
        min-height: 100px;
        border: 2px dashed var(--surface-300);
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-muted);
        margin: var(--spacing-md) 0;
        transition: all 0.2s ease;
        background: var(--surface-50);
      }

      .drop-zone.active {
        border-color: var(--success-500);
        background: var(--success-50);
        color: var(--success-500);
      }

      .section-body.active,
      .subsection-body.active {
        background: var(--success-50);
        border: 2px dashed var(--success-500);
        border-radius: var(--radius-sm);
      }

      /* Properties Panel */
      .properties-form {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-lg);
      }

      .properties-form.hidden {
        display: none;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
      }

      .form-group label {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
      }

      .form-group label.required::after {
        content: ' *';
        color: var(--danger-500);
      }

      .form-group-subheading {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-secondary);
        margin-top: var(--spacing-sm);
        margin-bottom: var(--spacing-xs);
      }

      .input,
      .select,
      .textarea {
        border-radius: var(--radius-sm);
        border: 1px solid var(--surface-200);
        padding: 10px 12px;
        font-family: inherit;
        font-size: 14px;
        background: var(--surface-0);
        color: var(--text-primary);
        transition: all 0.2s ease;
        width: 100%;
      }

      .input:focus,
      .select:focus,
      .textarea:focus {
        outline: none;
        border-color: var(--primary-400);
        box-shadow: 0 0 0 2px var(--primary-50);
      }

      .input:hover,
      .select:hover,
      .textarea:hover {
        border-color: var(--surface-800);
      }

      .textarea {
        resize: vertical;
        min-height: 80px;
      }

      .checkbox-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .checkbox-item input[type='checkbox'] {
        width: 18px;
        height: 18px;
        border: 2px solid var(--surface-600);
        border-radius: 2px;
        cursor: pointer;
        appearance: none;
        position: relative;
        transition: all 0.2s ease;
      }

      .checkbox-item input[type='checkbox']:checked {
        background: var(--primary-400);
        border-color: var(--primary-400);
      }

      .checkbox-item input[type='checkbox']:checked::after {
        content: '‚úì';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 12px;
        font-weight: 600;
      }

      .checkbox-item input[type='checkbox']:hover {
        border-color: var(--primary-400);
      }

      .checkbox-item label {
        font-weight: 400;
        cursor: pointer;
      }

      /* Threshold Inputs */
      .threshold-inputs {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-md);
      }

      /* Help Text */
      .help-text {
        font-size: 12px;
        color: var(--text-muted);
        margin-top: var(--spacing-xs);
        line-height: 1.4;
      }

      /* Scrollbar Styling */
      .panel__body::-webkit-scrollbar,
      .canvas::-webkit-scrollbar,
      .component-group.scrollable::-webkit-scrollbar,
      .block-tabs::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      .panel__body::-webkit-scrollbar-track,
      .canvas::-webkit-scrollbar-track,
      .component-group.scrollable::-webkit-scrollbar-track,
      .block-tabs::-webkit-scrollbar-track {
        background: var(--surface-100);
      }

      .panel__body::-webkit-scrollbar-thumb,
      .canvas::-webkit-scrollbar-thumb,
      .component-group.scrollable::-webkit-scrollbar-thumb,
      .block-tabs::-webkit-scrollbar-thumb {
        background: var(--surface-300);
        border-radius: 4px;
      }

      .panel__body::-webkit-scrollbar-thumb:hover,
      .canvas::-webkit-scrollbar-thumb:hover,
      .component-group.scrollable::-webkit-scrollbar-thumb:hover,
      .block-tabs::-webkit-scrollbar-thumb:hover {
        background: var(--surface-600);
      }

      /* Responsive */
      @media (max-width: 1280px) {
        .columns {
          grid-template-columns: 1fr;
        }

        .rail {
          width: 64px;
        }

        .rail:hover {
          width: 64px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <!-- Top Bar -->
      <div class="top-bar">
        <div class="top-bar__brand">
          <div class="logo">UNOPS</div>
          <div>
            <div class="top-bar__title">Procurement Portal | Templates</div>
            <div class="top-bar__breadcrumbs">ITB ¬∑ Goods (Standard Procurement)</div>
          </div>
        </div>
        <div class="top-bar__actions">
          <button class="btn btn-ghost">Preview</button>
          <button class="btn btn-ghost">üíæ Save</button>
          <button class="btn btn-primary">Publish</button>
        </div>
      </div>

      <!-- Workspace -->
      <div class="workspace">
        <!-- Left Rail Navigation -->
        <nav class="rail" aria-label="Primary navigation">
          <button class="active" title="Template Builder">
            <span>üß±</span>
            <span class="rail-label">Template Builder</span>
          </button>
          <button title="Library" onclick="window.location.href='template-library.html'">
            <span>üìö</span>
            <span class="rail-label">Library</span>
          </button>
          <button title="Settings">
            <span>‚öôÔ∏è</span>
            <span class="rail-label">Settings</span>
          </button>
        </nav>

        <!-- Main Content Columns -->
        <div class="columns">
          <!-- Components Panel -->
          <section class="panel">
            <div class="panel__header">Components</div>
            <div class="panel__body">
              <!-- Blocks Section -->
              <div class="component-group scrollable">
                <p class="group-label">Blocks</p>
                <div class="component-block" draggable="true" data-type="section" data-section-type="scope" data-block-id="block-scope">
                  <div class="component-block-content">
                    <span class="component-block-icon">üéØ</span>
                    <div>
                      <strong>Scope &amp; Requirements</strong>
                      <span>Requisition &amp; items - Specifications</span>
                    </div>
                  </div>
                </div>
                <div class="component-block" draggable="true" data-type="section" data-section-type="timeline" data-block-id="block-timeline">
                  <div class="component-block-content">
                    <span class="component-block-icon">üìÖ</span>
                    <div>
                      <strong>Timeline &amp; Deadlines</strong>
                      <span>Key dates and Milestones</span>
                    </div>
                  </div>
                </div>
                <div class="component-block" draggable="true" data-type="section" data-section-type="evaluation" data-block-id="block-evaluation">
                  <div class="component-block-content">
                    <span class="component-block-icon">üìä</span>
                    <div>
                      <strong>Evaluation Criteria</strong>
                      <span>Requisition and items</span>
                    </div>
                  </div>
                </div>
                <div class="component-block" draggable="true" data-type="section" data-section-type="submission" data-block-id="block-submission">
                  <div class="component-block-content">
                    <span class="component-block-icon">üìù</span>
                    <div>
                      <strong>Submission Requirements</strong>
                      <span>Bidder requirements</span>
                    </div>
                  </div>
                </div>
                <div class="component-block" draggable="true" data-type="section" data-section-type="general" data-block-id="block-general">
                  <div class="component-block-content">
                    <span class="component-block-icon">üìã</span>
                    <div>
                      <strong>General Information</strong>
                      <span>Title, reference, type of requirement</span>
                    </div>
                  </div>
                </div>
                <div class="component-block" draggable="true" data-type="section" data-section-type="project" data-block-id="block-project">
                  <div class="component-block-content">
                    <span class="component-block-icon">üèóÔ∏è</span>
                    <div>
                      <strong>Project Details</strong>
                      <span>Work package, funding source, project name</span>
                    </div>
                  </div>
                </div>
                <div class="component-block" draggable="true" data-type="section" data-section-type="requisition" data-block-id="block-requisition">
                  <div class="component-block-content">
                    <span class="component-block-icon">üì¶</span>
                    <div>
                      <strong>Requisition Details</strong>
                      <span>Requisition ID, line items, product codes</span>
                    </div>
                  </div>
                </div>
                <div class="component-block" draggable="true" data-type="section" data-section-type="custom" data-block-id="block-custom">
                  <div class="component-block-content">
                    <span class="component-block-icon">üìã</span>
                    <div>
                      <strong>New Block</strong>
                      <span>Add Custom Block</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Forms & Documents Section -->
              <div class="component-group">
                <p class="group-label">Forms &amp; Documents</p>
                <div class="search-bar">
                  <input type="search" placeholder="Search forms..." id="search-forms" />
                </div>
                <div class="component-group scrollable" id="forms-list">
                  <div class="component-block" draggable="true" data-type="form" data-form-type="instructions" data-block-id="form-instructions">
                    <div>
                      <strong>Instructions to Bidders</strong>
                      <span>Standard format</span>
                    </div>
                  </div>
                  <div class="component-block" draggable="true" data-type="form" data-form-type="contracts" data-block-id="form-contracts">
                    <div>
                      <strong>Contracts forms</strong>
                      <span>Offer &amp; award</span>
                    </div>
                  </div>
                  <div class="component-block" draggable="true" data-type="form" data-form-type="bank-guarantee" data-block-id="form-bank-guarantee">
                    <div>
                      <strong>Bank Guarantee Form</strong>
                      <span>Security requirements</span>
                    </div>
                  </div>
                  <div class="component-block" draggable="true" data-type="form" data-form-type="bid-security" data-block-id="form-bid-security">
                    <div>
                      <strong>Bid Security Form</strong>
                      <span>Security requirements</span>
                    </div>
                  </div>
                  <div class="component-block" draggable="true" data-type="form" data-form-type="drive-questionnaire" data-block-id="form-drive-questionnaire">
                    <div>
                      <strong>DRiVE Questionnaire</strong>
                      <span>Risk assessment questionnaire</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Custom Fields Section -->
              <div class="component-group">
                <p class="group-label">Custom Fields</p>
                <div class="search-bar">
                  <input type="search" placeholder="Search fields..." id="search-fields" />
                </div>
                <div class="component-group scrollable" id="fields-list">
                  <div class="component-block" draggable="true" data-type="field" data-field-type="un-collab" data-block-id="field-un-collab">
                    <div>
                      <strong>UN Collaboration?</strong>
                      <span>Yes / No</span>
                    </div>
                  </div>
                  <div class="component-block" draggable="true" data-type="field" data-field-type="epp" data-block-id="field-epp">
                    <div>
                      <strong>EPP?</strong>
                      <span>Yes / No</span>
                    </div>
                  </div>
                  <div class="component-block" draggable="true" data-type="field" data-field-type="medicine" data-block-id="field-medicine">
                    <div>
                      <strong>Medicine/Medical equipment?</strong>
                      <span>Yes / No</span>
                    </div>
                  </div>
                  <div class="component-block" draggable="true" data-type="field" data-field-type="lease" data-block-id="field-lease">
                    <div>
                      <strong>Is this a lease?</strong>
                      <span>Yes / No</span>
                    </div>
                  </div>
                  <div class="component-block" draggable="true" data-type="field" data-field-type="custom" data-block-id="field-custom">
                    <div>
                      <strong>New Custom Field</strong>
                      <span>Add from library</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Canvas Panel -->
          <section class="panel">
            <div class="panel__header">Template Canvas</div>
            <div class="panel__body">
              <div class="canvas-container">
                <div class="block-tabs" id="block-tabs"></div>
                <div class="canvas" id="canvas">
                  <div class="canvas-empty">
                    <div class="canvas-empty-icon">üé®</div>
                    <h2>Start Building Your Template</h2>
                    <p>Drag and drop sections from the left sidebar to begin</p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Properties Panel -->
          <section class="panel">
            <div class="panel__header" id="properties-header">Properties ¬∑ Template</div>
            <div class="panel__body">
              <!-- Template Properties -->
              <form class="properties-form" id="template-properties">
                <div class="form-group">
                  <label for="template-name" class="required">Template Name</label>
                  <input type="text" id="template-name" class="input" placeholder="Enter template name" />
                </div>
                <div class="form-group">
                  <label for="event-type" class="required">Type of Event</label>
                  <select id="event-type" class="select">
                    <option>Select</option>
                    <option>Sourcing</option>
                    <option>Solicitation</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="method">Method</label>
                  <select id="method" class="select">
                    <option>Select‚Ä¶</option>
                    <option>ITB</option>
                    <option>RFP</option>
                    <option>RFQ</option>
                    <option>EOI</option>
                    <option>PQ</option>
                    <option>Ad-hoc shortlist</option>
                    <option>Solicit offers against LTA/BPA</option>
                    <option>Secondary bidding against LTA/BPA</option>
                    <option>Direct contracting/sole sourcing</option>
                    <option>e-reserve auctions</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="requirement">Type of Requirement</label>
                  <div class="checkbox-list">
                    <div class="checkbox-item">
                      <input type="checkbox" id="req-goods" />
                      <label for="req-goods">Goods</label>
                    </div>
                    <div class="checkbox-item">
                      <input type="checkbox" id="req-services" />
                      <label for="req-services">Services</label>
                    </div>
                    <div class="checkbox-item">
                      <input type="checkbox" id="req-works" />
                      <label for="req-works">Works</label>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Threshold USD</label>
                  <div class="threshold-inputs">
                    <input type="number" placeholder="From" class="input" />
                    <input type="number" placeholder="To" class="input" />
                  </div>
                </div>
              </form>

              <!-- Block Properties -->
              <form class="properties-form hidden" id="block-properties">
                <div class="form-group">
                  <label for="block-name" class="required">Section Name</label>
                  <input type="text" id="block-name" class="input" placeholder="Enter section name" />
                </div>
                <div class="form-group">
                  <label for="block-description">Description for Authors</label>
                  <textarea id="block-description" class="textarea" placeholder="Section description for authors"></textarea>
                  <span class="help-text">This description will be visible to template authors</span>
                </div>
                <div class="form-group">
                  <div class="checkbox-item">
                    <input type="checkbox" id="block-mandatory" />
                    <label for="block-mandatory">This block is mandatory</label>
                  </div>
                </div>
                <div class="form-group">
                  <div class="form-group-subheading">This block applies to</div>
                  <div class="checkbox-list">
                    <div class="checkbox-item">
                      <input type="checkbox" id="block-per-lot" />
                      <label for="block-per-lot">Per Lot</label>
                    </div>
                    <div class="checkbox-item">
                      <input type="checkbox" id="block-entire-tender" />
                      <label for="block-entire-tender">Entire Tender</label>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label for="block-order">Section Order</label>
                  <input type="number" id="block-order" class="input" value="1" min="1" />
                  <span class="help-text">Position in the template structure</span>
                </div>
                <div class="form-group">
                  <label for="block-source">Data Source</label>
                  <select id="block-source" class="select">
                    <option value="">Manual entry</option>
                    <option value="requisition">PDJ ¬∑ Requisition</option>
                    <option value="erp">ERP ¬∑ oU</option>
                    <option value="ungm">UNGM</option>
                    <option value="drive">DRiVE Module</option>
                    <option value="agora">UN Web Buy Plus (Agora)</option>
                  </select>
                  <span class="help-text">Link to external system data</span>
                </div>
                <div class="form-group">
                  <label for="block-field-path">Field Mapping</label>
                  <input type="text" id="block-field-path" class="input" placeholder="e.g., requisition.header.referenceCode" />
                  <span class="help-text">Specify the exact data field path</span>
                </div>
              </form>

              <!-- Component/Field Properties -->
              <form class="properties-form hidden" id="component-properties">
                <div class="form-group">
                  <label for="component-label" class="required">Field Label</label>
                  <input type="text" id="component-label" class="input" placeholder="Enter field label" />
                </div>
                <div class="form-group">
                  <label for="component-type">Field Type</label>
                  <select id="component-type" class="select">
                    <option value="text">Text</option>
                    <option value="number">Number</option>
                    <option value="date">Date</option>
                    <option value="dropdown">Dropdown</option>
                    <option value="checkbox">Checkbox</option>
                    <option value="radio">Radio Button</option>
                    <option value="textarea">Textarea</option>
                    <option value="file">File Upload</option>
                  </select>
                </div>
                <div class="form-group">
                  <div class="checkbox-item">
                    <input type="checkbox" id="component-required" />
                    <label for="component-required">Required Field</label>
                  </div>
                </div>
                <div class="form-group">
                  <div class="checkbox-item">
                    <input type="checkbox" id="component-readonly" />
                    <label for="component-readonly">Read-only</label>
                  </div>
                </div>
                <div class="form-group">
                  <div class="checkbox-item">
                    <input type="checkbox" id="component-mapped" />
                    <label for="component-mapped">Auto-mapped from data source</label>
                  </div>
                </div>
                <div class="form-group">
                  <label for="component-placeholder">Placeholder Text</label>
                  <input type="text" id="component-placeholder" class="input" placeholder="Enter placeholder text" />
                </div>
                <div class="form-group">
                  <label for="component-help">Help Text</label>
                  <textarea id="component-help" class="textarea" placeholder="Help text for users"></textarea>
                </div>
              </form>
            </div>
          </section>
        </div>
      </div>
    </div>

    <script>
      let draggedElement = null;
      let selectedElement = null;
      let selectedBlockType = null;
      let selectedFieldElement = null;
      let blocks = [];
      let activeBlockIndex = 0;

      // Search functionality
      function setupSearch(searchInputId, containerSelector) {
        const searchInput = document.getElementById(searchInputId);
        if (!searchInput) return;

        searchInput.addEventListener('input', (e) => {
          const searchTerm = e.target.value.toLowerCase();
          const container = document.querySelector(containerSelector);
          if (!container) return;

          const blocks = container.querySelectorAll('.component-block');
          blocks.forEach((block) => {
            const text = block.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
              block.classList.remove('hidden');
            } else {
              block.classList.add('hidden');
            }
          });
        });
      }

      // Initialize search bars
      setupSearch('search-forms', '#forms-list');
      setupSearch('search-fields', '#fields-list');

      // Block tabs management
      function updateBlockTabs() {
        const tabsContainer = document.getElementById('block-tabs');
        tabsContainer.innerHTML = '';

        if (blocks.length === 0) {
          tabsContainer.style.display = 'none';
          return;
        }

        tabsContainer.style.display = 'flex';

        blocks.forEach((block, index) => {
          const tab = document.createElement('button');
          tab.className = 'block-tab';
          if (index === activeBlockIndex) {
            tab.classList.add('active');
          }
          tab.innerHTML = `
            <span class="block-tab-number">${index + 1}</span>
            ${block.name}
          `;
          tab.addEventListener('click', () => {
            switchToBlock(index);
          });
          tabsContainer.appendChild(tab);
        });
      }

      function switchToBlock(index) {
        activeBlockIndex = index;
        updateBlockTabs();
        updateCanvasView();
      }

      function updateCanvasView() {
        const canvas = document.getElementById('canvas');
        const emptyState = canvas.querySelector('.canvas-empty');

        if (blocks.length === 0) {
          if (!emptyState) {
            canvas.innerHTML = `
              <div class="canvas-empty">
                <div class="canvas-empty-icon">üé®</div>
                <h2>Start Building Your Template</h2>
                <p>Drag and drop sections from the left sidebar to begin</p>
              </div>
            `;
          }
          return;
        }

        if (emptyState) {
          emptyState.remove();
        }

        // Remove all canvas views
        canvas.querySelectorAll('.canvas-view').forEach((view) => view.remove());

        // Create views for each block
        blocks.forEach((block, index) => {
          const view = document.createElement('div');
          view.className = 'canvas-view';
          if (index === activeBlockIndex) {
            view.classList.add('active');
          }
          view.dataset.blockIndex = index;
          view.appendChild(block.element);
          canvas.appendChild(view);
        });
      }

      // Drag and drop handlers
      function setupDragAndDrop() {
        document.querySelectorAll('.component-block').forEach((item) => {
          item.addEventListener('dragstart', (e) => {
            draggedElement = e.target.closest('.component-block');
            e.dataTransfer.effectAllowed = 'copy';
            e.dataTransfer.setData('text/html', draggedElement.innerHTML);
            e.dataTransfer.setData('component-type', draggedElement.dataset.type);
            e.dataTransfer.setData('section-type', draggedElement.dataset.sectionType || '');
            e.dataTransfer.setData('form-type', draggedElement.dataset.formType || '');
            e.dataTransfer.setData('field-type', draggedElement.dataset.fieldType || '');
            e.dataTransfer.setData('block-id', draggedElement.dataset.blockId || '');
            draggedElement.style.opacity = '0.5';
          });

          item.addEventListener('dragend', (e) => {
            if (draggedElement) {
              draggedElement.style.opacity = '1';
            }
          });
        });
      }

      setupDragAndDrop();

      const canvas = document.getElementById('canvas');

      // Setup drop zones for blocks
      function setupBlockDropZones() {
        document.querySelectorAll('.section-body, .subsection-body').forEach((dropZone) => {
          dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
            e.dataTransfer.dropEffect = 'copy';
            dropZone.classList.add('active');
          });

          dropZone.addEventListener('dragleave', (e) => {
            if (!dropZone.contains(e.relatedTarget)) {
              dropZone.classList.remove('active');
            }
          });

          dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove('active');

            const componentType = e.dataTransfer.getData('component-type');
            const formType = e.dataTransfer.getData('form-type');
            const fieldType = e.dataTransfer.getData('field-type');
            const blockId = e.dataTransfer.getData('block-id');

            // Remove from component list
            if (blockId && draggedElement) {
              draggedElement.remove();
              setupDragAndDrop();
            }

            if (componentType === 'form') {
              addFormToBlock(dropZone, formType);
            } else if (componentType === 'field') {
              addFieldToBlock(dropZone, fieldType);
            }

            draggedElement = null;
          });
        });
      }

      canvas.addEventListener('dragover', (e) => {
        // Only allow dropping sections on canvas, not forms/fields
        if (draggedElement && draggedElement.dataset.type === 'section') {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'copy';
        }
      });

      canvas.addEventListener('drop', (e) => {
        e.preventDefault();

        const componentType = e.dataTransfer.getData('component-type');
        const sectionType = e.dataTransfer.getData('section-type');
        const blockId = e.dataTransfer.getData('block-id');

        // Only handle sections on canvas
        if (componentType === 'section') {
          // Remove block from component list
          if (blockId && draggedElement) {
            draggedElement.remove();
            setupDragAndDrop();
          }

          addSectionToCanvas(sectionType);
        }

        draggedElement = null;
      });

      function addSectionToCanvas(type) {
        const sectionData = {
          scope: {
            icon: 'üéØ',
            name: 'Scope & Requirements',
            subsections: [
              {
                title: 'Scope and objectives',
                fields: ['Scope and objectives of sourcing or solicitation process'],
              },
              {
                title: 'Specific requirements',
                fields: ['Specific requirements, conditions and additional information'],
              },
              {
                title: 'Evaluation',
                fields: ['Evaluation of submissions'],
              },
            ],
          },
          timeline: {
            icon: 'üìÖ',
            name: 'Timeline & Deadlines',
            subsections: [
              {
                title: 'Key Dates',
                fields: ['Deadline', 'Deadline for clarifications', 'Expected Contract award date'],
              },
            ],
          },
          evaluation: {
            icon: 'üìä',
            name: 'Evaluation Criteria',
            subsections: [
              {
                title: 'Evaluation Method',
                fields: ['Evaluation method', 'Weightage of technical and financial proposals', 'Minimum Points for Technical compliance'],
              },
            ],
          },
          submission: {
            icon: 'üìù',
            name: 'Submission Requirements',
            subsections: [
              {
                title: 'Submission Details',
                fields: [
                  'Quotation/Bid/Proposal validity period in days',
                  'Quotation/Bid/Proposal currency(ies)',
                  'Languages of quotations/bids/proposals',
                ],
              },
            ],
          },
          general: {
            icon: 'üìã',
            name: 'General Information',
            subsections: [
              {
                title: 'Basic Information',
                fields: ['Title', 'Sourcing or solicitation?', 'Type of requirement', 'Description', 'Beneficiary country(ies)'],
              },
            ],
          },
          project: {
            icon: 'üèóÔ∏è',
            name: 'Project Details',
            subsections: [
              {
                title: 'Project Information',
                fields: ['Work package (GLA)', 'Donor/funding source (GLA)', 'Project name', 'Implementation end date'],
              },
            ],
          },
          requisition: {
            icon: 'üì¶',
            name: 'Requisition Details',
            subsections: [
              {
                title: 'Requisition Information',
                fields: [
                  'Requisition ID',
                  'Requisition line ID',
                  'Product & UNSPSC codes',
                  'Quantity',
                  'Currency',
                  'Amount/expected value of contract (USD)',
                ],
              },
            ],
          },
          custom: {
            icon: 'üìã',
            name: 'Custom Section',
            subsections: [
              {
                title: 'Custom Subsection',
                fields: [],
              },
            ],
          },
        };

        const data = sectionData[type] || sectionData.custom;

        const section = document.createElement('div');
        section.className = 'dropped-section';
        section.dataset.sectionType = type;
        section.dataset.blockId = `block-${Date.now()}`;

        const sectionBody = document.createElement('div');
        sectionBody.className = 'section-body';

        data.subsections.forEach((subsection) => {
          const subsectionEl = document.createElement('div');
          subsectionEl.className = 'subsection';
          subsectionEl.innerHTML = `
            <div class="subsection-header">
              <div class="subsection-title">
                <span class="subsection-toggle">‚ñº</span>
                ${subsection.title}
              </div>
            </div>
            <div class="subsection-body">
              ${subsection.fields
                .map(
                  (field) => `
                <div class="field-item" data-field-name="${field}" data-field-required="true">
                  <div class="field-info">
                    <span class="field-label">${field}</span>
                    <div class="field-badges">
                      <span class="field-badge badge-required">Required</span>
                      <span class="field-badge badge-mapped">Mapped</span>
                    </div>
                  </div>
                </div>
              `
                )
                .join('')}
              <div class="drop-zone">Drop fields here</div>
            </div>
          `;

          const header = subsectionEl.querySelector('.subsection-header');
          header.addEventListener('click', () => {
            subsectionEl.classList.toggle('collapsed');
          });

          // Add field click handlers
          subsectionEl.querySelectorAll('.field-item').forEach((fieldItem) => {
            // Remove delete button if field is required
            if (fieldItem.dataset.fieldRequired === 'true') {
              const controls = fieldItem.querySelector('.section-controls');
              if (controls) {
                controls.remove();
              }
            }

            fieldItem.addEventListener('click', (e) => {
              if (!e.target.closest('.icon-btn')) {
                selectField(fieldItem, fieldItem.dataset.fieldName);
              }
            });
          });

          sectionBody.appendChild(subsectionEl);
        });

        // Add a drop zone at the end of section body for adding new items
        const sectionDropZone = document.createElement('div');
        sectionDropZone.className = 'drop-zone';
        sectionDropZone.textContent = 'Drop forms, documents, or fields here';
        sectionBody.appendChild(sectionDropZone);

        // Create section header
        const sectionHeader = document.createElement('div');
        sectionHeader.className = 'section-header';
        sectionHeader.innerHTML = `
          <div class="section-title-area">
            <span class="section-icon">${data.icon}</span>
            <span class="section-name">${data.name}</span>
          </div>
          <div class="section-controls">
            <button class="icon-btn" onclick="moveUp(this)" title="Move Up">‚Üë</button>
            <button class="icon-btn" onclick="moveDown(this)" title="Move Down">‚Üì</button>
            <button class="icon-btn" onclick="toggleSection(this)" title="Collapse">‚àí</button>
            <button class="icon-btn" onclick="deleteSection(this)" title="Delete">‚úñ</button>
          </div>
        `;

        section.appendChild(sectionHeader);
        section.appendChild(sectionBody);

        // Add block to blocks array
        const blockIndex = blocks.length;
        blocks.push({
          name: data.name,
          element: section,
          type: type,
        });

        // Add click handler for block selection
        section.addEventListener('click', (e) => {
          if (!e.target.closest('.icon-btn') && !e.target.closest('.field-item') && !e.target.closest('.subsection-header')) {
            selectBlock(section, type, blockIndex);
          }
        });

        activeBlockIndex = blockIndex;
        updateBlockTabs();
        updateCanvasView();
        setupBlockDropZones();
      }

      function addFormToBlock(dropZone, type) {
        const formNames = {
          instructions: 'Instructions to Bidders',
          contracts: 'Contract Forms',
          'bank-guarantee': 'Bank Guarantee Form',
          'bid-security': 'Bid Security Form',
          'drive-questionnaire': 'DRiVE Questionnaire',
        };

        const formItem = document.createElement('div');
        formItem.className = 'field-item';
        formItem.dataset.formType = type;
        formItem.innerHTML = `
          <div class="field-info">
            <span class="field-label">${formNames[type] || 'Document Form'}</span>
            <div class="field-badges">
              <span class="field-badge badge-mapped">Document</span>
            </div>
          </div>
          <div class="section-controls">
            <button class="icon-btn" onclick="previewForm(this)" title="Preview">üëÅ</button>
            <button class="icon-btn" onclick="deleteField(this)" title="Delete">‚úñ</button>
          </div>
        `;

        formItem.addEventListener('click', (e) => {
          if (!e.target.closest('.icon-btn')) {
            selectField(formItem, formNames[type] || 'Document Form');
          }
        });

        // Insert before drop zone if it exists, otherwise append
        const existingDropZone = dropZone.querySelector('.drop-zone');
        if (existingDropZone) {
          dropZone.insertBefore(formItem, existingDropZone);
        } else {
          dropZone.appendChild(formItem);
        }
      }

      function addFormToCanvas(type) {
        // Forms should only be added to blocks, not canvas
        // If no blocks exist, create a default block first
        if (blocks.length === 0) {
          addSectionToCanvas('custom');
        }

        // Add to the active block
        if (blocks.length > 0 && activeBlockIndex < blocks.length) {
          const activeBlock = blocks[activeBlockIndex].element;
          const sectionBody = activeBlock.querySelector('.section-body');
          if (sectionBody) {
            addFormToBlock(sectionBody, type);
            return;
          }
        }
      }

      function addFieldToBlock(dropZone, type) {
        const fieldNames = {
          'un-collab': 'UN Collaboration?',
          epp: 'EPP?',
          medicine: 'Medicine/Medical equipment?',
          lease: 'Is this a lease?',
          custom: 'Custom Field',
        };

        const field = document.createElement('div');
        field.className = 'field-item';
        field.dataset.fieldType = type;
        field.dataset.fieldName = fieldNames[type] || 'Custom Field';
        field.dataset.fieldRequired = 'false'; // Custom fields are not required by default
        field.innerHTML = `
          <div class="field-info">
            <span class="field-label">${fieldNames[type] || 'Custom Field'}</span>
            <div class="field-badges">
              <span class="field-badge badge-conditional">Conditional</span>
            </div>
          </div>
          <div class="section-controls">
            <button class="icon-btn" onclick="deleteField(this)" title="Delete">‚úñ</button>
          </div>
        `;

        field.addEventListener('click', (e) => {
          if (!e.target.closest('.icon-btn')) {
            selectField(field, fieldNames[type] || 'Custom Field');
          }
        });

        // Insert before drop zone if it exists, otherwise append
        const existingDropZone = dropZone.querySelector('.drop-zone');
        if (existingDropZone) {
          dropZone.insertBefore(field, existingDropZone);
        } else {
          dropZone.appendChild(field);
        }
      }

      function addFieldToCanvas(type) {
        // Fields should only be added to blocks, not canvas
        // If no blocks exist, create a default block first
        if (blocks.length === 0) {
          addSectionToCanvas('custom');
        }

        // Add to the active block
        if (blocks.length > 0 && activeBlockIndex < blocks.length) {
          const activeBlock = blocks[activeBlockIndex].element;
          const sectionBody = activeBlock.querySelector('.section-body');
          if (sectionBody) {
            addFieldToBlock(sectionBody, type);
            return;
          }
        }
      }

      function selectBlock(element, type, blockIndex) {
        // Remove previous selections
        document.querySelectorAll('.dropped-section').forEach((el) => {
          el.classList.remove('selected');
        });
        document.querySelectorAll('.field-item').forEach((el) => {
          el.classList.remove('selected');
        });

        // Highlight selected block
        element.classList.add('selected');
        selectedElement = element;
        selectedBlockType = type;
        selectedFieldElement = null;

        // Switch to this block's tab
        activeBlockIndex = blockIndex;
        updateBlockTabs();
        updateCanvasView();

        // Switch properties panel
        const header = document.getElementById('properties-header');
        const templateProps = document.getElementById('template-properties');
        const blockProps = document.getElementById('block-properties');
        const componentProps = document.getElementById('component-properties');

        header.textContent = 'Properties ¬∑ Block';
        templateProps.classList.add('hidden');
        componentProps.classList.add('hidden');
        blockProps.classList.remove('hidden');

        // Populate block properties
        const sectionName = element.querySelector('.section-name')?.textContent || '';
        document.getElementById('block-name').value = sectionName;
      }

      function selectField(fieldElement, fieldName) {
        // Remove previous selections
        document.querySelectorAll('.dropped-section').forEach((el) => {
          el.classList.remove('selected');
        });
        document.querySelectorAll('.field-item').forEach((el) => {
          el.classList.remove('selected');
        });

        // Highlight selected field
        fieldElement.classList.add('selected');
        selectedFieldElement = fieldElement;
        selectedElement = null;

        // Switch properties panel
        const header = document.getElementById('properties-header');
        const templateProps = document.getElementById('template-properties');
        const blockProps = document.getElementById('block-properties');
        const componentProps = document.getElementById('component-properties');

        header.textContent = 'Properties ¬∑ Component';
        templateProps.classList.add('hidden');
        blockProps.classList.add('hidden');
        componentProps.classList.remove('hidden');

        // Populate component properties
        document.getElementById('component-label').value = fieldName;
      }

      function toggleSection(btn) {
        const section = btn.closest('.dropped-section');
        const body = section.querySelector('.section-body');
        body.classList.toggle('collapsed');
        btn.textContent = body.classList.contains('collapsed') ? '+' : '‚àí';
      }

      function moveUp(btn) {
        const section = btn.closest('.dropped-section');
        const blockIndex = Array.from(blocks).findIndex((b) => b.element === section);
        if (blockIndex > 0) {
          const temp = blocks[blockIndex];
          blocks[blockIndex] = blocks[blockIndex - 1];
          blocks[blockIndex - 1] = temp;
          updateBlockTabs();
          updateCanvasView();
        }
      }

      function moveDown(btn) {
        const section = btn.closest('.dropped-section');
        const blockIndex = Array.from(blocks).findIndex((b) => b.element === section);
        if (blockIndex < blocks.length - 1) {
          const temp = blocks[blockIndex];
          blocks[blockIndex] = blocks[blockIndex + 1];
          blocks[blockIndex + 1] = temp;
          updateBlockTabs();
          updateCanvasView();
        }
      }

      function deleteSection(btn) {
        if (confirm('Delete this section?')) {
          const section = btn.closest('.dropped-section');
          const blockIndex = blocks.findIndex((b) => b.element === section);

          if (blockIndex !== -1) {
            blocks.splice(blockIndex, 1);
            if (activeBlockIndex >= blocks.length) {
              activeBlockIndex = Math.max(0, blocks.length - 1);
            }
            updateBlockTabs();
            updateCanvasView();
          }

          // Reset properties panel if deleted section was selected
          if (selectedElement === section || selectedFieldElement) {
            const header = document.getElementById('properties-header');
            const templateProps = document.getElementById('template-properties');
            const blockProps = document.getElementById('block-properties');
            const componentProps = document.getElementById('component-properties');
            header.textContent = 'Properties ¬∑ Template';
            templateProps.classList.remove('hidden');
            blockProps.classList.add('hidden');
            componentProps.classList.add('hidden');
            selectedElement = null;
            selectedFieldElement = null;
          }
        }
      }

      function previewForm(btn) {
        const formItem = btn.closest('.field-item');
        const formType = formItem.dataset.formType;
        const formNames = {
          instructions: 'Instructions to Bidders',
          contracts: 'Contract Forms',
          'bank-guarantee': 'Bank Guarantee Form',
          'bid-security': 'Bid Security Form',
          'drive-questionnaire': 'DRiVE Questionnaire',
        };
        const formName = formNames[formType] || 'Document Form';
        alert(`Preview: ${formName}\n\nThis would open a preview modal or new window showing the form/document template.`);
      }

      function deleteField(btn) {
        if (confirm('Delete this field?')) {
          const fieldItem = btn.closest('.field-item');
          fieldItem.remove();

          // Reset properties if deleted field was selected
          if (selectedFieldElement === fieldItem) {
            const header = document.getElementById('properties-header');
            const templateProps = document.getElementById('template-properties');
            const blockProps = document.getElementById('block-properties');
            const componentProps = document.getElementById('component-properties');
            header.textContent = 'Properties ¬∑ Template';
            templateProps.classList.remove('hidden');
            blockProps.classList.add('hidden');
            componentProps.classList.add('hidden');
            selectedFieldElement = null;
          }
        }
      }
    </script>
  </body>
</html>
