<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNOPS Procurement | eTendering</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/primeicons@6.0.1/primeicons.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* UNOPS Preset Primary Colors */
            --primary-50: #e6f7ff;
            --primary-100: #bae7ff;
            --primary-200: #7dd3fc;
            --primary-300: #38bdf8;
            --primary-400: #0ea5e9;
            --primary-500: #0092D1;
            --primary-600: #0284c7;
            --primary-700: #0369a1;
            --surface-0: #ffffff;
            --surface-50: #f5f8fb;
            --surface-100: #ebf1f8;
            --surface-200: #dde8f2;
            --surface-300: #cfdfec;
            --surface-600: #95a7ba;
            --surface-800: #596170;
            --surface-900: #3b3e4a;
            --success-500: #4c9f38;
            --success-50: #d2e7cd;
            --info-400: #0092d1;
            --info-50: #bfe4f4;
            --warning-500: #e85c0e;
            --warning-50: #f9d6c3;
            --danger-500: #da291c;
            --danger-50: #f6cac6;
            --text-primary: var(--surface-900);
            --text-secondary: var(--surface-800);
            --text-muted: var(--surface-600);
            --spacing-xs: 6px;
            --spacing-sm: 12px;
            --spacing-md: 20px;
            --spacing-lg: 28px;
            --spacing-xl: 36px;
            --spacing-2xl: 48px;
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        /* Action Menu Styles */
        .tender-table-row:hover {
            background: var(--primary-50) !important;
        }
        .action-menu-btn:hover {
            background: var(--surface-100) !important;
            border-color: var(--surface-300) !important;
        }
        .action-menu-btn:hover i {
            color: var(--text-primary) !important;
        }
        .action-menu-item:hover {
            background: var(--surface-50) !important;
        }
        .action-menu-dropdown {
            animation: fadeIn 0.15s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-4px); }
            to { opacity: 1; transform: translateY(0); }
        }

        body {
            font-family: 'Lato', 'Noto Sans', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--surface-50);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--surface-0);
            border-bottom: 1px solid var(--surface-200);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md) var(--spacing-xl);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .logo {
            font-weight: 700;
            font-size: 20px;
            letter-spacing: 0.12em;
            color: var(--primary-400);
        }

        .portal-badge {
            background: var(--primary-400);
            color: white;
            font-size: 12px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .user-info {
            text-align: right;
        }

        .user-company {
            font-size: 12px;
            color: var(--text-muted);
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary-100);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--primary-600);
            cursor: pointer;
        }

        /* Layout */
        .app-container {
            display: flex;
            flex-direction: row;
            min-height: calc(100vh - 65px);
            width: 100%;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            min-width: 280px;
            max-width: 280px;
            background-color: #0192D1;
            color: white;
            display: flex;
            flex-direction: column;
            border-right: none;
            transition: width 0.3s ease, min-width 0.3s ease, max-width 0.3s ease;
            position: relative;
            flex-shrink: 0;
        }

        .sidebar.collapsed {
            width: 60px;
            min-width: 60px;
            max-width: 60px;
        }

        .sidebar-toggle {
            position: absolute;
            top: 10px;
            right: -15px;
            width: 30px;
            height: 30px;
            background: var(--primary-400);
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            color: white;
            font-size: 14px;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed .sidebar-toggle {
            transform: rotate(180deg);
        }

        .sidebar.collapsed .menu-section-title,
        .sidebar.collapsed .menu-item span:not(.menu-icon) {
            display: none;
        }

        .sidebar.collapsed .menu-group-header span,
        .sidebar.collapsed .menu-group-header i:last-child,
        .sidebar.collapsed .menu-divider {
            display: none;
        }

        .sidebar.collapsed .menu-group-header {
            padding: 10px;
            justify-content: center;
        }

        .sidebar.collapsed .menu-group-items .menu-item {
            padding: 10px;
            justify-content: center;
        }

        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
        }

        .menu-section {
            margin-bottom: var(--spacing-lg);
        }

        .menu-section-title {
            padding: 10px 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: rgba(255, 255, 255, 0.7);
            font-family: 'Lato', sans-serif;
            margin-bottom: var(--spacing-xs);
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            font-size: 16px;
            font-weight: normal;
            font-family: 'Lato', sans-serif;
            transition: background-color 0.2s ease;
            border-left: none;
            cursor: pointer;
            margin: 0 10px;
            border-radius: 5px;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .menu-item.active {
            background-color: #006599;
            color: white;
        }

        .menu-icon {
            font-size: 18px;
            width: 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .menu-badge {
            margin-left: auto;
            padding: 2px 8px;
            background: var(--danger-500);
            color: white;
            font-size: 11px;
            font-weight: 600;
            border-radius: 999px;
        }

        /* Menu Groups - Collapsible */
        .menu-group {
            margin: 0 10px var(--spacing-xs) 10px;
        }

        .menu-group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.2s ease;
        }

        .menu-group-header:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-group-header span {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-group-header i:last-child {
            font-size: 12px;
            transition: transform 0.2s ease;
        }

        .menu-group.collapsed .menu-group-header i:last-child {
            transform: rotate(-90deg);
        }

        .menu-group-items {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .menu-group.collapsed .menu-group-items {
            max-height: 0;
        }

        .menu-group-items .menu-item {
            padding: 10px 20px 10px 36px;
            font-size: 14px;
            margin: 2px 0;
        }

        .menu-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .menu-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.15);
            margin: var(--spacing-md) 20px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: var(--spacing-xl);
            overflow-y: auto;
            min-width: 0; /* Prevent flex child from overflowing */
            position: relative;
        }
        
        /* Ensure all view sections are properly positioned within main content */
        .main-content > .view-section {
            width: 100%;
            max-width: 100%;
        }

        .page-header {
            margin-bottom: var(--spacing-xl);
        }

        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Pending Tasks Section */
        .pending-tasks-section {
            margin-bottom: var(--spacing-xl);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .section-title i {
            color: var(--primary-500);
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }

        .task-item {
            background: var(--surface-0);
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-md);
            padding: var(--spacing-md) var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .task-item:hover {
            border-color: var(--primary-400);
            box-shadow: var(--shadow-sm);
            transform: translateY(-2px);
        }

        .task-badge {
            background: var(--primary-500);
            color: white;
            font-size: 16px;
            font-weight: 700;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .task-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            flex: 1;
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .task-icon-inline {
            font-size: 16px;
            color: var(--primary-500);
        }

        /* Filter Bar */
        .filter-bar {
            background: white;
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--surface-200);
            margin-bottom: 24px;
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: var(--shadow-card);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-muted);
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-sm);
            font-size: 13px;
            background: white;
            cursor: pointer;
            min-width: 150px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-400);
        }

        /* Tender Cards */
        .tender-grid {
            display: grid;
            gap: 20px;
        }

        .tender-card {
            background: white;
            border-radius: var(--radius-lg);
            border: 1px solid var(--surface-200);
            padding: 24px;
            transition: all 0.2s;
            cursor: pointer;
            box-shadow: var(--shadow-card);
        }

        .tender-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-400);
        }

        .tender-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .tender-title-section {
            flex: 1;
        }

        .tender-id {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
            margin-bottom: 4px;
        }

        .tender-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.active {
            background: var(--info-50);
            color: var(--info-400);
        }

        .status-badge.draft {
            background: var(--surface-200);
            color: var(--text-secondary);
        }

        .status-badge.review {
            background: var(--warning-50);
            color: var(--warning-500);
        }

        .status-badge.closed {
            background: var(--success-50);
            color: var(--success-500);
        }

        .tender-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--surface-200);
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .meta-label {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .meta-value {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .tender-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Buttons */
        .btn {
            border-radius: var(--radius-sm);
            border: 1px solid transparent;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-400);
            color: #fff;
            border-color: var(--primary-400);
        }

        .btn-primary:hover {
            background: var(--primary-500);
            border-color: var(--primary-500);
        }

        .btn-secondary {
            background: transparent;
            border-color: var(--primary-400);
            color: var(--primary-400);
        }

        .btn-secondary:hover {
            background: var(--primary-50);
        }

        .btn-ghost {
            background: transparent;
            border-color: var(--surface-200);
            color: var(--text-secondary);
        }

        .btn-ghost:hover {
            background: var(--surface-100);
            border-color: var(--surface-300);
        }

        .btn-danger {
            background: var(--danger-500);
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-success {
            background: var(--success-500);
            color: white;
        }

        .btn-success:hover {
            background: #3d7f2e;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
        }

        /* Sidebar Panel */
        .sidebar-panel {
            position: fixed;
            right: 0;
            top: 0;
            width: 600px;
            height: 100vh;
            background: var(--surface-0);
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 110;
            overflow-y: auto;
        }

        .sidebar-panel.open {
            transform: translateX(0);
        }

        .sidebar-panel-header {
            padding: var(--spacing-lg);
            background: var(--primary-600);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .sidebar-panel-title {
            font-size: 18px;
            font-weight: 600;
        }

        .sidebar-panel-body {
            padding: var(--spacing-xl);
        }

        .collapsible-section-compact {
            border-bottom: 1px solid var(--surface-200);
            margin-bottom: var(--spacing-sm);
        }

        .collapsible-header-compact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
        }

        .collapsible-header-compact:hover {
            background: var(--surface-50);
        }

        .collapsible-content-compact {
            padding: 0 var(--spacing-md) var(--spacing-md);
            display: none;
        }

        .collapsible-icon {
            transition: transform 0.3s;
            font-size: 12px;
        }

        .collapsible-icon.rotated {
            transform: rotate(-90deg);
        }

        .info-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: var(--spacing-md);
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--surface-100);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .info-value {
            color: var(--text-primary);
            font-size: 14px;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--surface-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-muted);
            padding: 4px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .modal-close:hover {
            background: var(--surface-100);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--surface-200);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 32px;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--surface-300);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .step-number.active {
            background: var(--primary-400);
        }

        .step-number.completed {
            background: var(--success-500);
        }

        .step-label {
            font-size: 14px;
            color: var(--text-muted);
        }

        .step-label.active {
            color: var(--text-primary);
            font-weight: 600;
        }

        .step-connector {
            width: 40px;
            height: 2px;
            background: var(--surface-300);
        }

        /* Amendment Steps */
        .amendment-step {
            display: none;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-label.required::after {
            content: ' *';
            color: var(--danger-500);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-400);
            box-shadow: 0 0 0 3px var(--primary-50);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .help-text {
            display: block;
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Alert */
        .alert {
            padding: 16px;
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            align-items: start;
        }

        .alert-info {
            background: var(--info-50);
            border-left: 4px solid var(--info-400);
            color: var(--text-secondary);
        }

        .alert-warning {
            background: var(--warning-50);
            border-left: 4px solid var(--warning-500);
            color: #92400e;
        }

        .alert-danger {
            background: var(--danger-50);
            border-left: 4px solid var(--danger-500);
            color: #991b1b;
        }

        .alert-success {
            background: var(--success-50);
            border-left: 4px solid var(--success-500);
            color: #166534;
        }

        /* Category Grid */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .category-option {
            position: relative;
        }

        .category-checkbox {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .category-label {
            display: flex;
            flex-direction: column;
            padding: 12px;
            border: 2px solid var(--surface-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .category-checkbox:checked + .category-label {
            border-color: var(--primary-400);
            background: var(--primary-50);
        }

        .category-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tier-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .tier-badge.tier-1 {
            background: var(--success-50);
            color: #15803d;
        }

        .tier-badge.tier-2 {
            background: var(--warning-50);
            color: #92400e;
        }

        .category-description {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Workflow Preview */
        .workflow-preview {
            background: var(--surface-50);
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 20px;
        }

        .workflow-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .workflow-steps {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .workflow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .workflow-step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-400);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .workflow-step-label {
            font-size: 11px;
            color: var(--text-muted);
            text-align: center;
            max-width: 100px;
        }

        .workflow-arrow {
            font-size: 20px;
            color: var(--text-muted);
        }

        /* Deadline Review */
        .deadline-review {
            background: var(--warning-50);
            border: 2px solid var(--warning-500);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 20px;
        }

        .deadline-review-title {
            font-size: 16px;
            font-weight: 600;
            color: #92400e;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .deadline-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .info-box {
            padding: var(--spacing-md);
            background: var(--info-50);
            border-left: 4px solid var(--info-400);
            border-radius: var(--radius-sm);
            margin-bottom: var(--spacing-lg);
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Tender Details View */
        .view-section {
            display: none;
            position: relative;
            width: 100%;
        }

        .view-section.active {
            display: block;
        }
        
        /* Specific rules for each view section to ensure proper display */
        .main-content #view-cpc-dashboard,
        .main-content #view-dashboard,
        .main-content #view-tender-details,
        .main-content #view-evaluation,
        .main-content #view-evaluation-report,
        .main-content #view-bid-opening,
        .main-content #view-cpc-case {
            display: none;
        }
        
        .main-content #view-cpc-dashboard.active,
        .main-content #view-dashboard.active,
        .main-content #view-tender-details.active,
        .main-content #view-evaluation.active,
        .main-content #view-evaluation-report.active,
        .main-content #view-bid-opening.active,
        .main-content #view-cpc-case.active {
            display: block;
            width: 100%;
        }

        .tender-info-banner {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-400) 100%);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            color: white;
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-card);
        }

        .tender-banner-ref {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: var(--spacing-sm);
        }

        .tender-banner-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: var(--spacing-md);
        }

        .tender-banner-meta {
            display: flex;
            gap: var(--spacing-xl);
            flex-wrap: wrap;
        }

        .banner-meta-item {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .banner-meta-label {
            font-size: 12px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .banner-meta-value {
            font-size: 16px;
            font-weight: 600;
        }

        .overview-section {
            background: var(--surface-0);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-card);
            border: 1px solid var(--surface-200);
            margin-bottom: var(--spacing-lg);
        }

        .overview-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .overview-section-icon {
            font-size: 24px;
        }

        .collapsible-item-card {
            background: var(--surface-50);
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            overflow: hidden;
            transition: all 0.3s;
        }

        .collapsible-item-card:hover {
            box-shadow: var(--shadow-sm);
        }

        .collapsible-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            cursor: pointer;
            background: var(--surface-50);
            transition: all 0.2s;
            user-select: none;
        }

        .collapsible-item-header:hover {
            background: var(--surface-100);
            transform: translateX(2px);
        }

        .collapsible-arrow {
            font-size: 14px;
            color: var(--primary-400);
            transition: transform 0.3s ease;
            margin-left: var(--spacing-md);
            font-weight: bold;
            display: inline-block;
        }

        .collapsible-arrow.rotated {
            transform: rotate(180deg);
            color: var(--primary-600);
        }

        .collapsible-item-content {
            max-height: 0;
            overflow: hidden;
            padding: 0 var(--spacing-lg);
            background: var(--surface-0);
            transition: max-height 0.4s ease, padding 0.4s ease;
        }

        .collapsible-item-content.expanded {
            max-height: 1000px;
            padding: 0 var(--spacing-lg) var(--spacing-lg);
        }

        .spec-detail-row {
            display: flex;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--surface-100);
        }

        .spec-detail-row:last-child {
            border-bottom: none;
        }

        .spec-detail-label {
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 140px;
            font-size: 13px;
        }

        .spec-detail-value {
            color: var(--text-primary);
            flex: 1;
            font-size: 13px;
            line-height: 1.5;
        }

        .deadline-warning {
            background: var(--warning-50);
            border-left: 4px solid var(--warning-500);
            border-radius: var(--radius-sm);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .deadline-icon {
            font-size: 24px;
        }

        .deadline-text {
            flex: 1;
        }

        .tender-overview-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .overview-main {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .overview-sidebar-section {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .timeline {
            position: relative;
            padding-left: var(--spacing-xl);
        }

        .timeline-item {
            position: relative;
            padding-bottom: var(--spacing-lg);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-400);
            border: 3px solid var(--surface-0);
            box-shadow: 0 0 0 2px var(--primary-400);
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: -19px;
            top: 20px;
            width: 2px;
            height: calc(100% - 8px);
            background: var(--surface-200);
        }

        .timeline-item:last-child::after {
            display: none;
        }

        .timeline-date {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .timeline-content {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Evaluation Styles */
        .vendor-eval-tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-muted);
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .vendor-eval-tab.active {
            color: var(--primary-400);
            border-bottom-color: var(--primary-400);
        }

        .vendor-eval-tab:hover {
            color: var(--primary-400);
            background: var(--surface-50);
        }

        .eval-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid var(--surface-200);
            background: white;
        }

        .eval-table th {
            background: var(--surface-100);
            color: var(--text-primary);
            padding: 14px 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-right: 1px solid var(--surface-200);
            border-bottom: 2px solid var(--surface-300);
        }

        .eval-table td {
            padding: 14px 12px;
            border-bottom: 1px solid var(--surface-100);
            border-right: 1px solid var(--surface-100);
            vertical-align: top;
            font-size: 13px;
            background: white;
        }

        .eval-table tbody tr:hover {
            background: var(--surface-50);
        }

        .view-toggle {
            display: flex;
            gap: 0;
            background: var(--surface-100);
            border-radius: var(--radius-md);
            padding: 4px;
            width: fit-content;
        }

        .view-toggle-btn {
            padding: 8px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
        }

        .view-toggle-btn.active {
            background: white;
            color: var(--primary-400);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .lot-section-header {
            background: var(--primary-50);
            padding: var(--spacing-md);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--primary-400);
            font-weight: 600;
            color: var(--primary-600);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .lot-section-header:hover {
            background: var(--primary-100);
        }

        .lot-info {
            display: flex;
            gap: var(--spacing-xl);
            font-size: 13px;
        }

        .lot-tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-muted);
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .lot-tab.active {
            color: var(--primary-400);
            border-bottom-color: var(--primary-400);
        }

        .lot-tab:hover {
            color: var(--primary-400);
            background: var(--surface-50);
        }

        .lot-summary-card {
            background: white;
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .lot-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-md);
        }

        .lot-summary-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .lot-summary-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .lot-summary-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .unspsc-collapsible {
            margin-bottom: var(--spacing-md);
        }

        .unspsc-header {
            background: var(--surface-50);
            padding: var(--spacing-md);
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--surface-200);
            transition: all 0.2s ease;
        }

        .unspsc-header:hover {
            background: var(--surface-100);
        }

        .unspsc-content {
            margin-top: var(--spacing-sm);
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .unspsc-content.collapsed {
            display: none;
        }

        .eval-team-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            background: var(--primary-50);
            color: var(--primary-600);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            border: 1px solid var(--primary-200);
        }

        /* Collapsible Overview Sections */
        .overview-section-collapsible {
            background: var(--surface-0);
            border-radius: var(--radius-md);
            border: 1px solid var(--surface-200);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
        }

        .overview-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md) var(--spacing-lg);
            cursor: pointer;
            background: var(--surface-50);
            border-bottom: 1px solid var(--surface-200);
            transition: background 0.2s ease;
        }

        .overview-section-header:hover {
            background: var(--surface-100);
        }

        .overview-section-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .overview-section-body {
            padding: var(--spacing-lg);
            transition: max-height 0.3s ease;
        }

        .overview-section-body.collapsed {
            display: none;
        }

        .section-toggle-icon {
            font-size: 12px;
            transition: transform 0.3s ease;
            color: var(--text-muted);
        }

        .section-toggle-icon.collapsed {
            transform: rotate(-90deg);
        }

        /* Clarification visibility badges */
        .visibility-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
            gap: 4px;
        }

        .visibility-badge.public {
            background: var(--info-50);
            color: var(--info-500);
        }

        .visibility-badge.private {
            background: var(--warning-50);
            color: var(--warning-600);
        }

        .question-group-badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 8px;
            background: var(--primary-50);
            color: var(--primary-500);
            border-radius: var(--radius-xs);
            font-size: 10px;
            font-weight: 600;
        }

        .req-id-badge {
            font-weight: 700;
            color: var(--primary-400);
            font-size: 14px;
        }

        .eval-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
        }

        .eval-status-badge.pass {
            background: var(--success-50);
            color: var(--success-500);
        }

        .eval-status-badge.fail {
            background: var(--danger-50);
            color: var(--danger-500);
        }

        .eval-status-badge.clarification {
            background: var(--warning-50);
            color: var(--warning-500);
        }

        .eval-status-badge.pending {
            background: var(--info-50);
            color: var(--info-400);
        }

        .eval-status-badge.not_evaluated {
            background: var(--surface-200);
            color: var(--text-muted);
        }

        .eval-select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--surface-200);
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 600;
            font-family: inherit;
        }

        .eval-select.pass {
            border-color: var(--success-500);
            color: var(--success-500);
        }

        .eval-select.fail {
            border-color: var(--danger-500);
            color: var(--danger-500);
        }

        .eval-select.clarification {
            border-color: var(--warning-500);
            color: var(--warning-500);
        }

        .eval-comment-field {
            width: 100%;
            padding: 8px;
            border: 2px solid var(--surface-200);
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }

        .eval-comment-field:focus {
            outline: none;
            border-color: var(--primary-400);
        }

        .doc-badge {
            display: inline-block;
            background: var(--primary-400);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .doc-list {
            max-height: 150px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .doc-item {
            margin-bottom: 6px;
            padding: 8px;
            background: var(--surface-50);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--primary-400);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
        }

        .doc-item:hover {
            background: var(--info-50);
            border-left-color: var(--primary-600);
            transform: translateX(2px);
        }

        .doc-name {
            font-weight: 600;
            color: var(--primary-400);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .doc-meta {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .deviation-badge {
            background: var(--warning-50);
            border-left: 3px solid var(--warning-500);
            padding: 6px 10px;
            margin-top: 8px;
            border-radius: var(--radius-sm);
            font-size: 12px;
        }

        .mandatory-flag {
            display: inline-block;
            background: var(--danger-500);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 5px;
        }

        .optional-flag {
            display: inline-block;
            background: var(--info-400);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 5px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .tender-overview-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 60px;
            }
            .menu-section-title {
                display: none;
            }
            .menu-item span:not(.menu-icon) {
                display: none;
            }
            .sidebar:hover {
                width: 280px;
            }
            .sidebar:hover .menu-section-title,
            .sidebar:hover .menu-item span:not(.menu-icon) {
                display: block;
            }
            .sidebar-panel {
                width: 100%;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .category-grid {
                grid-template-columns: 1fr;
            }
            .tender-banner-meta {
                flex-direction: column;
                gap: var(--spacing-md);
            }
        }

        /* ==================== HEADER ACTIONS ==================== */
        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-left: auto;
            margin-right: var(--spacing-lg);
        }

        .header-action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            font-size: 13px;
        }

        .header-action-btn:hover {
            background: var(--surface-100);
            transform: scale(1.1);
        }

        .header-action-btn:focus {
            outline: 2px solid var(--primary-400);
            outline-offset: 2px;
        }

        .header-action-btn i {
            font-size: 20px;
            color: var(--text-muted);
            transition: color 0.2s ease;
        }

        .header-action-btn:hover i {
            color: var(--primary-500);
        }

        .header-action-label {
            display: none;
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--danger-500);
            color: white;
            font-size: 10px;
            font-weight: 700;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .ai-assistant-btn {
            background: transparent;
        }

        .ai-assistant-btn:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        .ai-assistant-btn:hover .ai-icon-wrapper {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
        }

        .ai-icon-wrapper {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-icon-wrapper i {
            font-size: 11px;
            color: white;
        }

        .ai-badge {
            font-size: 8px;
            background: var(--success-500);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 700;
            margin-left: 4px;
        }

        .language-selector {
            min-width: auto;
        }

        .lang-flag {
            font-size: 16px;
        }

        .notification-btn i {
            color: var(--text-muted);
        }

        .notification-btn:hover i {
            color: var(--primary-500);
        }

        /* ==================== COLLABORATIVE WHITEBOARD PANEL ==================== */
        .collab-whiteboard-btn {
            position: fixed;
            right: 0;
            top: 35%;
            transform: translateY(-50%);
            width: 60px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: var(--radius-lg) 0 0 var(--radius-lg);
            padding: 12px 8px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            border: 2px solid #34d399;
            border-right: none;
        }

        .collab-whiteboard-btn:hover {
            width: 70px;
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.4);
        }

        .collab-whiteboard-btn:focus {
            outline: 3px solid var(--warning-400);
            outline-offset: 2px;
        }

        .collab-btn-icon {
            width: 36px;
            height: 36px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .collab-btn-icon i {
            font-size: 18px;
            color: #10b981;
        }

        .collab-btn-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: var(--danger-500);
            color: white;
            font-size: 9px;
            font-weight: 700;
            min-width: 16px;
            height: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }

        .collab-btn-label {
            font-size: 9px;
            color: white;
            text-align: center;
            font-weight: 600;
            line-height: 1.2;
        }

        .collab-whiteboard-panel {
            position: fixed;
            right: -420px;
            top: 0;
            bottom: 0;
            width: 400px;
            background: var(--surface-0);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            display: flex;
            flex-direction: column;
            transition: right 0.3s ease;
        }

        .collab-whiteboard-panel.open {
            right: 0;
        }

        .collab-panel-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: var(--spacing-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .collab-tab {
            flex: 1;
            padding: 10px 8px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: 11px;
            color: var(--text-muted);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .collab-tab:hover {
            background: var(--surface-50);
            color: var(--text-primary);
        }

        .collab-tab.active {
            color: #10b981;
            border-bottom-color: #10b981;
            font-weight: 600;
        }

        .collab-tab-badge {
            background: var(--danger-500);
            color: white;
            font-size: 9px;
            padding: 1px 5px;
            border-radius: 8px;
        }

        .collab-panel-content {
            flex: 1;
            overflow-y: auto;
        }

        .collab-tab-content {
            display: none;
            padding: var(--spacing-md);
        }

        .collab-tab-content.active {
            display: block;
        }

        .collab-message-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .collab-message {
            display: flex;
            gap: var(--spacing-sm);
        }

        .collab-message.system-message {
            background: var(--surface-50);
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            color: var(--text-muted);
            align-items: center;
            gap: var(--spacing-sm);
        }

        .collab-message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .collab-message-content {
            flex: 1;
            background: var(--surface-50);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
        }

        .collab-message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .collab-message-author {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .collab-message-time {
            font-size: 10px;
            color: var(--text-muted);
        }

        .collab-message-text {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .collab-question-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .collab-question-item {
            background: var(--surface-50);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            border-left: 3px solid var(--surface-300);
        }

        .collab-question-item.pending {
            border-left-color: var(--warning-400);
            background: var(--warning-50);
        }

        .collab-question-item.answered {
            border-left-color: var(--success-400);
        }

        .collab-question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .collab-question-badge {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: var(--radius-xs);
            font-weight: 600;
        }

        .collab-question-badge.pending {
            background: var(--warning-100);
            color: var(--warning-600);
        }

        .collab-question-badge.answered {
            background: var(--success-100);
            color: var(--success-600);
        }

        .collab-question-from {
            font-size: 11px;
            color: var(--text-muted);
        }

        .collab-question-text {
            font-size: 13px;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .collab-question-answer {
            background: var(--success-50);
            padding: var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 12px;
            color: var(--success-700);
            margin-bottom: 8px;
        }

        .collab-question-meta {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .collab-question-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        .collab-notes-area {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .collab-note-item {
            background: var(--surface-50);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            border: 1px solid var(--surface-200);
        }

        .collab-note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .collab-note-author {
            font-size: 10px;
            color: var(--text-muted);
            background: var(--surface-200);
            padding: 2px 6px;
            border-radius: var(--radius-xs);
        }

        .collab-note-text {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .collab-note-time {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 8px;
        }

        .collab-decisions-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .collab-decision-item {
            display: flex;
            gap: var(--spacing-md);
            background: var(--surface-50);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
        }

        .collab-decision-status {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            height: fit-content;
            white-space: nowrap;
        }

        .collab-decision-status.approved {
            background: var(--success-100);
            color: var(--success-600);
        }

        .collab-decision-status.pending {
            background: var(--warning-100);
            color: var(--warning-600);
        }

        .collab-decision-content {
            flex: 1;
        }

        .collab-decision-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .collab-decision-votes {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 11px;
            margin-bottom: 8px;
        }

        .vote-yes {
            color: var(--success-600);
        }

        .vote-pending {
            color: var(--text-muted);
        }

        .collab-decision-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        .collab-panel-footer {
            padding: var(--spacing-md);
            border-top: 1px solid var(--surface-200);
            background: var(--surface-50);
        }

        /* ==================== FLOATING SUPPLIER DOCS PANEL ==================== */
        .supplier-docs-floating-btn {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-400) 100%);
            border-radius: var(--radius-lg) 0 0 var(--radius-lg);
            padding: 12px 8px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            border: 2px solid var(--primary-300);
            border-right: none;
        }

        .supplier-docs-floating-btn:hover {
            width: 70px;
            box-shadow: 0 8px 30px rgba(0, 86, 179, 0.4);
        }

        .supplier-docs-floating-btn:focus {
            outline: 3px solid var(--warning-400);
            outline-offset: 2px;
        }

        .floating-btn-icon {
            width: 36px;
            height: 36px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .floating-btn-icon i {
            font-size: 18px;
            color: var(--primary-500);
        }

        .floating-btn-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: var(--danger-500);
            color: white;
            font-size: 9px;
            font-weight: 700;
            min-width: 16px;
            height: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }

        .floating-btn-label {
            font-size: 9px;
            color: white;
            text-align: center;
            font-weight: 600;
            line-height: 1.2;
        }

        .supplier-docs-panel {
            position: fixed;
            right: -400px;
            top: 0;
            bottom: 0;
            width: 380px;
            background: var(--surface-0);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            display: flex;
            flex-direction: column;
            transition: right 0.3s ease;
        }

        .supplier-docs-panel.open {
            right: 0;
        }

        .supplier-docs-panel-header {
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-400) 100%);
            color: white;
            padding: var(--spacing-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .supplier-docs-panel-header button {
            color: white;
            opacity: 0.8;
        }

        .supplier-docs-panel-header button:hover {
            opacity: 1;
        }

        .supplier-docs-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-md);
        }

        .supplier-docs-section {
            background: var(--surface-50);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            overflow: hidden;
            border: 1px solid var(--surface-200);
        }

        .supplier-docs-section-header {
            padding: var(--spacing-md);
            background: var(--surface-100);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 600;
            font-size: 13px;
            color: var(--text-primary);
            transition: background 0.2s;
        }

        .supplier-docs-section-header:hover {
            background: var(--surface-200);
        }

        .supplier-docs-section-header:focus {
            outline: 2px solid var(--primary-400);
            outline-offset: -2px;
        }

        .supplier-docs-section-header i:first-child {
            color: var(--primary-500);
        }

        .docs-count-badge {
            background: var(--primary-100);
            color: var(--primary-600);
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: auto;
        }

        .docs-section-icon {
            color: var(--text-muted);
            font-size: 12px;
            transition: transform 0.2s;
        }

        .supplier-docs-section-content {
            padding: var(--spacing-sm);
        }

        .supplier-docs-section-content.collapsed {
            display: none;
        }

        .supplier-doc-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            background: white;
            border-radius: var(--radius-sm);
            margin-bottom: var(--spacing-xs);
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .supplier-doc-item:hover {
            background: var(--primary-50);
            border-color: var(--primary-200);
        }

        .supplier-doc-item:focus {
            outline: 2px solid var(--primary-400);
            outline-offset: 1px;
        }

        .doc-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .doc-icon.pdf {
            background: #fee2e2;
            color: #dc2626;
        }

        .doc-icon.excel {
            background: #dcfce7;
            color: #16a34a;
        }

        .doc-icon.zip {
            background: #fef3c7;
            color: #d97706;
        }

        .doc-info {
            flex: 1;
            min-width: 0;
        }

        .doc-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .doc-meta {
            font-size: 10px;
            color: var(--text-muted);
        }

        .doc-action-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--surface-100);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .doc-action-btn:hover {
            background: var(--primary-100);
            color: var(--primary-600);
        }

        .doc-action-btn i {
            font-size: 12px;
        }

        .supplier-docs-panel-footer {
            padding: var(--spacing-md);
            border-top: 1px solid var(--surface-200);
            background: var(--surface-50);
        }

        /* ==================== ACCESSIBILITY FEATURES ==================== */
        /* High Contrast Mode */
        body.high-contrast {
            --surface-0: #000000;
            --surface-50: #1a1a1a;
            --surface-100: #333333;
            --surface-200: #4d4d4d;
            --surface-300: #666666;
            --text-primary: #ffffff;
            --text-secondary: #e0e0e0;
            --text-muted: #b0b0b0;
            --primary-500: #00aaff;
            --primary-400: #33bbff;
            --success-500: #00ff00;
            --danger-500: #ff0000;
            --warning-500: #ffff00;
        }

        body.high-contrast .header {
            background: #000000;
            border-bottom: 3px solid #00aaff;
        }

        body.high-contrast .tender-card,
        body.high-contrast .view-section {
            border: 2px solid #666666;
        }

        /* Large Text Mode */
        body.large-text {
            font-size: 18px;
        }

        body.large-text .tender-title,
        body.large-text h1, body.large-text h2, body.large-text h3 {
            font-size: 1.5em;
        }

        body.large-text .btn {
            font-size: 16px;
            padding: 12px 20px;
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        body.reduced-motion *, 
        body.reduced-motion *::before, 
        body.reduced-motion *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }

        /* Focus Indicators for Keyboard Navigation */
        *:focus-visible {
            outline: 3px solid var(--warning-400);
            outline-offset: 2px;
        }

        /* Skip to Main Content Link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary-500);
            color: white;
            padding: 8px 16px;
            z-index: 10000;
            text-decoration: none;
            font-weight: 600;
        }

        .skip-link:focus {
            top: 0;
        }

        /* Color Blind Friendly Indicators */
        body.colorblind-mode .status-badge,
        body.colorblind-mode .eval-status-badge {
            border: 2px solid currentColor;
            font-weight: 700;
        }

        body.colorblind-mode .status-badge::before,
        body.colorblind-mode .eval-status-badge::before {
            margin-right: 4px;
        }

        body.colorblind-mode [class*="success"],
        body.colorblind-mode .pass {
            background-image: repeating-linear-gradient(45deg, transparent, transparent 2px, currentColor 2px, currentColor 4px);
            background-size: 6px 6px;
        }

        body.colorblind-mode [class*="danger"],
        body.colorblind-mode .fail {
            background-image: repeating-linear-gradient(-45deg, transparent, transparent 2px, currentColor 2px, currentColor 4px);
            background-size: 6px 6px;
        }

        body.colorblind-mode [class*="warning"],
        body.colorblind-mode .clarification {
            background-image: repeating-linear-gradient(90deg, transparent, transparent 2px, currentColor 2px, currentColor 4px);
            background-size: 6px 6px;
        }

        /* Screen Reader Only Content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Accessibility Panel Styles */
        .accessibility-panel {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 320px;
            background: var(--surface-0);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            display: none;
            border: 1px solid var(--surface-200);
        }

        .accessibility-panel.open {
            display: block;
        }

        .accessibility-panel-header {
            padding: var(--spacing-lg);
            background: var(--surface-50);
            border-bottom: 1px solid var(--surface-200);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .accessibility-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--surface-100);
        }

        .accessibility-option:last-child {
            border-bottom: none;
        }

        .accessibility-toggle {
            width: 44px;
            height: 24px;
            background: var(--surface-300);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }

        .accessibility-toggle.active {
            background: var(--primary-500);
        }

        .accessibility-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .accessibility-toggle.active::after {
            transform: translateX(20px);
        }

        @media (max-width: 768px) {
            .header-actions {
                gap: 4px;
            }
            .header-action-label {
                display: none;
            }
            .header-action-btn {
                padding: 8px;
            }
            .supplier-docs-panel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-top">
            <div class="logo-container">
                <div class="logo">UNOPS</div>
                <span class="portal-badge">Procurement</span>
                <span style="color: var(--surface-400); margin: 0 8px; font-size: 18px;">|</span>
                <span style="color: var(--primary-500); font-weight: 600; font-size: 14px;">eTendering</span>
            </div>
            
            <!-- Header Actions: Notifications, Help, AI, Accessibility -->
            <div class="header-actions">
                <!-- Accessibility Button -->
                <div class="header-action-btn" onclick="openAccessibilityPanel()" title="Accessibility Options" aria-label="Accessibility Options">
                    <i class="pi pi-eye" aria-hidden="true"></i>
                    <span class="header-action-label">Accessibility</span>
                </div>
                
                <!-- Language Selector -->
                <div class="header-action-btn language-selector" onclick="openLanguageSelector()" title="Change Language" aria-label="Change Language">
                    <span class="lang-flag"></span>
                    <span class="header-action-label" id="currentLang">EN</span>
                    <i class="pi pi-chevron-down" style="font-size: 10px; margin-left: 2px;" aria-hidden="true"></i>
                </div>

                <!-- AI Assistant -->
                <div class="header-action-btn ai-assistant-btn" onclick="openAIAssistant()" title="AI Assistant" aria-label="AI Procurement Assistant">
                    <div class="ai-icon-wrapper">
                        <i class="pi pi-bolt" aria-hidden="true"></i>
                    </div>
                    <span class="header-action-label">AI Help</span>
                    <span class="ai-badge">NEW</span>
                </div>

                <!-- Help/Questions -->
                <div class="header-action-btn" onclick="openHelpCenter()" title="Help Center" aria-label="Help Center and Documentation">
                    <i class="pi pi-question-circle" aria-hidden="true"></i>
                    <span class="header-action-label">Help</span>
                </div>

                <!-- Notifications -->
                <div class="header-action-btn notification-btn" onclick="openNotificationsPanel()" title="Notifications" aria-label="View Notifications">
                    <i class="pi pi-bell" aria-hidden="true"></i>
                    <span class="notification-badge" id="notificationCount">7</span>
                </div>
            </div>

            <div class="user-menu">
                <div class="user-info">
                    <div class="user-company">UNOPS Internal</div>
                    <div class="user-name">Jane Doe</div>
                </div>
                <div class="user-avatar" aria-label="User menu">JD</div>
            </div>
        </div>
    </header>

    <!-- App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="mainSidebar">
            <div class="sidebar-toggle" onclick="toggleSidebar()">
                <i class="pi pi-chevron-left"></i>
            </div>
            <nav class="sidebar-menu">
                <!-- Administrative Applications -->
                <div class="menu-section">
                    <div class="menu-section-title">Administrative Applications</div>
                    
                    <!-- System Settings -->
                    <div class="menu-group collapsed">
                        <div class="menu-group-header" onclick="toggleMenuGroup(this)">
                            <span><i class="pi pi-cog"></i> System Settings</span>
                            <i class="pi pi-chevron-down"></i>
                        </div>
                        <div class="menu-group-items">
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-users"></i></span><span>User Role Management</span></a>
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-id-card"></i></span><span>Role Management</span></a>
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-sliders-h"></i></span><span>Attribute Management</span></a>
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-database"></i></span><span>Data Management</span></a>
                            <a class="menu-item" href="translation-management.html"><span class="menu-icon"><i class="pi pi-language"></i></span><span>Translations</span></a>
                        </div>
                    </div>
                    
                    <!-- Components -->
                    <div class="menu-group collapsed">
                        <div class="menu-group-header" onclick="toggleMenuGroup(this)">
                            <span><i class="pi pi-box"></i> Components</span>
                            <i class="pi pi-chevron-down"></i>
                        </div>
                        <div class="menu-group-items">
                            <a class="menu-item" id="menu-criteria" href="https://valentinar11.github.io/ValentinaRo/components-library.html"><span class="menu-icon"><i class="pi pi-list"></i></span><span>Evaluation Criteria Library</span></a>
                            <a class="menu-item" id="menu-specifications" onclick="switchView('specifications')"><span class="menu-icon"><i class="pi pi-cog"></i></span><span>Specifications Library</span></a>
                        </div>
                    </div>
                    
                    <!-- Forms -->
                    <div class="menu-group collapsed">
                        <div class="menu-group-header" onclick="toggleMenuGroup(this)">
                            <span><i class="pi pi-file-edit"></i> Forms</span>
                            <i class="pi pi-chevron-down"></i>
                        </div>
                        <div class="menu-group-items">
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-folder"></i></span><span>Forms Library</span></a>
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-pencil"></i></span><span>Form Builder</span></a>
                        </div>
                    </div>
                    
                    <!-- Processes -->
                    <div class="menu-group collapsed">
                        <div class="menu-group-header" onclick="toggleMenuGroup(this)">
                            <span><i class="pi pi-sitemap"></i> Processes</span>
                            <i class="pi pi-chevron-down"></i>
                        </div>
                        <div class="menu-group-items">
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-list"></i></span><span>Process Library</span></a>
                        </div>
                    </div>
                    
                    <!-- Templates -->
                    <div class="menu-group collapsed">
                        <div class="menu-group-header" onclick="toggleMenuGroup(this)">
                            <span><i class="pi pi-copy"></i> Templates</span>
                            <i class="pi pi-chevron-down"></i>
                        </div>
                        <div class="menu-group-items">
                            <a class="menu-item" href="template-library.html"><span class="menu-icon"><i class="pi pi-folder"></i></span><span>Templates Library</span></a>
                            <a class="menu-item" href="template-builder-workspace.html"><span class="menu-icon"><i class="pi pi-pencil"></i></span><span>Template Builder</span></a>
                        </div>
                    </div>
                </div>
                
                <div class="menu-divider"></div>
                
                <!-- Business Applications -->
                <div class="menu-section">
                    <div class="menu-section-title">Business Applications</div>
                    
                    <!-- eTendering -->
                    <div class="menu-group">
                        <div class="menu-group-header" onclick="toggleMenuGroup(this)">
                            <span><i class="pi pi-briefcase"></i> eTendering</span>
                            <i class="pi pi-chevron-down"></i>
                        </div>
                        <div class="menu-group-items">
                            <a class="menu-item active" id="menu-tendering-overview" href="javascript:void(0)" onclick="showDashboard(this); return false;"><span class="menu-icon"><i class="pi pi-chart-bar"></i></span><span>Overview</span></a>
                            <a class="menu-item" id="menu-tendering-tenders" href="javascript:void(0)" onclick="showTendersList(this); return false;"><span class="menu-icon"><i class="pi pi-folder-open"></i></span><span>Tenders</span><span class="menu-badge">13</span></a>
                            <a class="menu-item" href="tender-authoring.html"><span class="menu-icon"><i class="pi pi-plus"></i></span><span>Create Tender</span></a>
                        </div>
                    </div>
                    
                    <!-- Award & Review (CPC) -->
                    <div class="menu-group collapsed">
                        <div class="menu-group-header" onclick="toggleMenuGroup(this)">
                            <span><i class="pi pi-check-square"></i> Award & Review</span>
                            <i class="pi pi-chevron-down"></i>
                        </div>
                        <div class="menu-group-items">
                            <a class="menu-item" id="menu-cpc-overview" href="https://valentinar11.github.io/ValentinaRo/CPC.html"><span class="menu-icon"><i class="pi pi-chart-bar"></i></span><span>Overview</span><span class="menu-badge" style="background: #f59e0b;">3</span></a>
                            <a class="menu-item" id="menu-cpc-cases" href="javascript:void(0)" onclick="showCPCCases(this); return false;"><span class="menu-icon"><i class="pi pi-folder"></i></span><span>Cases</span></a>
                            <a class="menu-item" id="menu-cpc-meetings" href="javascript:void(0)" onclick="showCPCMeetings(this); return false;"><span class="menu-icon"><i class="pi pi-calendar"></i></span><span>Meetings</span></a>
                            <a class="menu-item" id="menu-cpc-pool" href="javascript:void(0)" onclick="showCPCPoolManagement(this); return false;"><span class="menu-icon"><i class="pi pi-users"></i></span><span>Pool Management</span></a>
                            <a class="menu-item" id="menu-cpc-qa" href="javascript:void(0)" onclick="showCPCQA(this); return false;"><span class="menu-icon"><i class="pi pi-comments"></i></span><span>Q&A</span><span class="menu-badge" style="background: #ef4444;">5</span></a>
                        </div>
                    </div>
                    
                    <!-- DRiVE -->
                    <div class="menu-group collapsed">
                        <div class="menu-group-header" onclick="toggleMenuGroup(this)">
                            <span><i class="pi pi-shield"></i> DRiVE</span>
                            <i class="pi pi-chevron-down"></i>
                        </div>
                        <div class="menu-group-items">
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-chart-bar"></i></span><span>Overview</span></a>
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-inbox"></i></span><span>Response Library</span></a>
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-check-circle"></i></span><span>Verification</span></a>
                            <a class="menu-item" href="capa-interactive-mockup.html"><span class="menu-icon"><i class="pi pi-exclamation-triangle"></i></span><span>CAPA</span></a>
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-question-circle"></i></span><span>Questionnaire Management</span></a>
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-chart-line"></i></span><span>Risk Management</span></a>
                        </div>
                    </div>
                    
                    <!-- Contracts -->
                    <div class="menu-group collapsed">
                        <div class="menu-group-header" onclick="toggleMenuGroup(this)">
                            <span><i class="pi pi-file"></i> Contracts</span>
                            <i class="pi pi-chevron-down"></i>
                        </div>
                        <div class="menu-group-items">
                            <a class="menu-item disabled"><span class="menu-icon"><i class="pi pi-list"></i></span><span>Contract Management</span></a>
                        </div>
                    </div>
                    
                    <!-- Supplier Management -->
                    <div class="menu-group collapsed">
                        <div class="menu-group-header" onclick="toggleMenuGroup(this)">
                            <span><i class="pi pi-truck"></i> Supplier Management</span>
                            <i class="pi pi-chevron-down"></i>
                        </div>
                        <div class="menu-group-items">
                            <a class="menu-item" href="supplier-management-procurement.html"><span class="menu-icon"><i class="pi pi-building"></i></span><span>Suppliers</span></a>
                        </div>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="main-content" role="main">
            <!-- Tendering Overview View -->
            <div class="view-section active" id="view-dashboard" style="display: block;">
                <!-- Page Header -->
                <div class="page-header" style="margin-bottom: var(--spacing-xl);">
                    <h1 class="page-title">Tendering Overview</h1>
                    <p class="page-subtitle">Manage and monitor your procurement tenders</p>
                </div>

            <!-- My Pending Tasks -->
            <div class="pending-tasks-section" style="margin-bottom: var(--spacing-xl);">
                <h2 class="section-title">
                    <i class="pi pi-check-square" style="color: var(--primary-500);"></i> My Pending Tasks
                </h2>
                <div class="tasks-grid">
                    <div class="task-item" onclick="filterTenders('pre-clearance')">
                        <div class="task-badge">2</div>
                        <div class="task-content">
                            <i class="pi pi-eye task-icon-inline"></i>
                            <span>Pre-clearance Review</span>
                        </div>
                    </div>
                    <div class="task-item" onclick="filterTenders('approval')">
                        <div class="task-badge">3</div>
                        <div class="task-content">
                            <i class="pi pi-check-circle task-icon-inline"></i>
                            <span>Pending Approval</span>
                        </div>
                    </div>
                    <div class="task-item" onclick="filterTenders('clarifications')">
                        <div class="task-badge">8</div>
                        <div class="task-content">
                            <i class="pi pi-comment task-icon-inline"></i>
                            <span>Clarifications to Answer</span>
                        </div>
                    </div>
                    <div class="task-item" onclick="filterTenders('evaluation')">
                        <div class="task-badge">2</div>
                        <div class="task-content">
                            <i class="pi pi-chart-bar task-icon-inline"></i>
                            <span>Evaluations in Progress</span>
                        </div>
                    </div>
                    <div class="task-item" onclick="filterTenders('closed')">
                        <div class="task-badge">2</div>
                        <div class="task-content">
                            <i class="pi pi-envelope-open task-icon-inline"></i>
                            <span>Bid Opening Required</span>
                        </div>
                    </div>
                    <div class="task-item" onclick="filterTenders('signing')">
                        <div class="task-badge">1</div>
                        <div class="task-content">
                            <i class="pi pi-file-edit task-icon-inline"></i>
                            <span>Reports to Sign</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Required -->
            <div class="action-required-section" style="margin-bottom: var(--spacing-xl);">
                <h2 class="section-title">
                    <i class="pi pi-bell"></i> Action Required
                    <span style="margin-left: auto; font-size: 12px; font-weight: 500; color: var(--text-muted);">4 items</span>
                </h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--spacing-sm);">
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm) var(--spacing-md); background: var(--surface-0); border: 1px solid var(--surface-200); border-left: 3px solid var(--warning-500); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s;" onclick="showTenderDetails({id: 'ITB/2024/089', title: 'Laboratory Equipment Procurement', status: 'Pre-Clearance', statusKey: 'pre-clearance'})">
                        <i class="pi pi-check-square" style="color: var(--warning-500); font-size: 16px;"></i>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: 600; font-size: 13px; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ITB/2024/089 - Approval Required</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Laboratory Equipment  Due Today</div>
                        </div>
                        <span style="padding: 2px 8px; background: var(--warning-100); color: var(--warning-700); border-radius: 10px; font-size: 10px; font-weight: 600;">Urgent</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm) var(--spacing-md); background: var(--surface-0); border: 1px solid var(--surface-200); border-left: 3px solid var(--info-500); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s;" onclick="openClarificationsModal('RFQ/2024/001', 'Supply of Medical Equipment')">
                        <i class="pi pi-comments" style="color: var(--info-500); font-size: 16px;"></i>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: 600; font-size: 13px; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">RFQ/2024/001 - 5 Clarifications</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Medical Equipment  Respond</div>
                        </div>
                        <span style="padding: 2px 8px; background: var(--info-100); color: var(--info-700); border-radius: 10px; font-size: 10px; font-weight: 600;">5 new</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm) var(--spacing-md); background: var(--surface-0); border: 1px solid var(--surface-200); border-left: 3px solid var(--success-500); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s;" onclick="openBidOpeningFromDashboard('ITB/2024/067')">
                        <i class="pi pi-envelope-open" style="color: var(--success-500); font-size: 16px;"></i>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: 600; font-size: 13px; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ITB/2024/067 - Bid Opening</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Construction Materials  8 bids</div>
                        </div>
                        <span style="padding: 2px 8px; background: var(--success-100); color: var(--success-700); border-radius: 10px; font-size: 10px; font-weight: 600;">Ready</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm) var(--spacing-md); background: var(--surface-0); border: 1px solid var(--surface-200); border-left: 3px solid var(--primary-500); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s;" onclick="continueEvaluation('RFP/2024/045')">
                        <i class="pi pi-chart-line" style="color: var(--primary-500); font-size: 16px;"></i>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: 600; font-size: 13px; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">RFP/2024/045 - Evaluation</div>
                            <div style="font-size: 11px; color: var(--text-muted);">IT Infrastructure  65% done</div>
                        </div>
                        <span style="padding: 2px 8px; background: var(--primary-100); color: var(--primary-700); border-radius: 10px; font-size: 10px; font-weight: 600;">65%</span>
                    </div>
                </div>
            </div>

            <!-- My Tenders Section -->
            <div class="my-tenders-section" style="margin-bottom: var(--spacing-md);">
                <h2 class="section-title" style="margin-bottom: var(--spacing-md);">
                    <i class="pi pi-folder-open"></i> My Tenders
                    <span style="margin-left: auto; font-size: 12px; font-weight: 500; color: var(--text-muted);">13 tenders</span>
                </h2>
            </div>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="filter-group">
                    <i class="pi pi-filter" style="color: var(--text-muted); font-size: 14px;"></i>
                    <span class="filter-label">Status:</span>
                    <select class="filter-select" onchange="filterTenders()">
                        <option value="all">All Statuses</option>
                        <option value="draft">Draft</option>
                        <option value="pre-clearance">Pre-Clearance</option>
                        <option value="approval">Pending Approval</option>
                        <option value="tme-signed">TME Signed</option>
                        <option value="active">Posted/Active</option>
                        <option value="closed">Closed</option>
                        <option value="bid-opening">Bid Opening</option>
                        <option value="evaluation">Evaluation</option>
                        <option value="award">Award Recommendation</option>
                        <option value="finalized">Finalized</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="filter-group">
                    <i class="pi pi-sort-alt" style="color: var(--text-muted); font-size: 14px;"></i>
                    <span class="filter-label">Sort by:</span>
                    <select class="filter-select">
                        <option value="recent">Most Recent</option>
                        <option value="deadline">Deadline</option>
                        <option value="value">Value</option>
                    </select>
                </div>
                <div style="flex: 1;"></div>
                <div class="filter-group">
                    <i class="pi pi-search" style="color: var(--text-muted); font-size: 14px;"></i>
                    <input type="text" placeholder="Search tenders..." class="filter-select" style="width: 200px;">
                </div>
                <button class="btn btn-primary">
                    <i class="pi pi-plus"></i>
                    Create New Tender
                </button>
            </div>

            <!-- Tender Listing Table -->
            <div class="tender-listing" id="tenderGrid" style="background: var(--surface-0); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-sm);">
                <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                    <thead>
                        <tr style="background: linear-gradient(to bottom, var(--surface-50), var(--surface-100)); border-bottom: 1px solid var(--surface-200);">
                            <th style="padding: 14px 20px; text-align: left; font-weight: 600; color: var(--text-secondary); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Reference</th>
                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: var(--text-secondary); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Title</th>
                            <th style="padding: 14px 16px; text-align: center; font-weight: 600; color: var(--text-secondary); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Status</th>
                            <th style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-secondary); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Value</th>
                            <th style="padding: 14px 16px; text-align: center; font-weight: 600; color: var(--text-secondary); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Deadline</th>
                            <th style="padding: 14px 20px; text-align: center; font-weight: 600; color: var(--text-secondary); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; width: 60px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Row 1: Active -->
                        <tr data-status="active" class="tender-table-row" style="border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--primary-600); font-size: 13px;">RFQ/2024/001</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-primary);">Supply of Medical Equipment</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge active">Active</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">$250,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-secondary);">15 Dec 2024</td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'RFQ/2024/001', title: 'Supply of Medical Equipment', status: 'Posted', statusKey: 'active'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div onclick="viewTenderPreview('RFQ/2024/001', 'Supply of Medical Equipment')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-file" style="color: var(--text-muted);"></i> Quick Preview</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div onclick="openAmendModal('RFQ/2024/001', 'Supply of Medical Equipment')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-pencil" style="color: var(--warning-500);"></i> Amend Tender</div>
                                        <div onclick="openClarificationsModal('RFQ/2024/001', 'Supply of Medical Equipment')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-comments" style="color: var(--info-500);"></i> Clarifications <span style="margin-left: auto; background: var(--danger-500); color: white; padding: 1px 6px; border-radius: 10px; font-size: 10px; font-weight: 600;">5</span></div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div onclick="openCancelModal('RFQ/2024/001', 'Supply of Medical Equipment')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--danger-500); transition: background 0.15s;"><i class="pi pi-times-circle"></i> Cancel Tender</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 2: Active -->
                        <tr data-status="active" class="tender-table-row" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--primary-600); font-size: 13px;">ITB/2024/045</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-primary);">Construction of Office Building</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge active">Active</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">$1,500,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-secondary);">10 Jan 2025</td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'ITB/2024/045', title: 'Construction of Office Building', status: 'Posted', statusKey: 'active'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div onclick="viewTenderPreview('ITB/2024/045', 'Construction of Office Building')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-file" style="color: var(--text-muted);"></i> Quick Preview</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div onclick="openAmendModal('ITB/2024/045', 'Construction of Office Building')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-pencil" style="color: var(--warning-500);"></i> Amend Tender</div>
                                        <div onclick="openClarificationsModal('ITB/2024/045', 'Construction of Office Building')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-comments" style="color: var(--info-500);"></i> Clarifications <span style="margin-left: auto; background: var(--danger-500); color: white; padding: 1px 6px; border-radius: 10px; font-size: 10px; font-weight: 600;">12</span></div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div onclick="openCancelModal('ITB/2024/045', 'Construction of Office Building')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--danger-500); transition: background 0.15s;"><i class="pi pi-times-circle"></i> Cancel Tender</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 3: Pending Approval -->
                        <tr data-status="approval" class="tender-table-row" style="border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--primary-600); font-size: 13px;">RFP/2024/078</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-primary);">IT Infrastructure Services</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge review">Pending Approval</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">$500,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-muted);"></td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'RFP/2024/078', title: 'IT Infrastructure Services', status: 'Pending Approval', statusKey: 'approval'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div onclick="viewTenderPreview('RFP/2024/078', 'IT Infrastructure Services')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-file" style="color: var(--text-muted);"></i> Quick Preview</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-pencil" style="color: var(--warning-500);"></i> Edit Draft</div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-history" style="color: var(--text-muted);"></i> View Comments</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 4: Active -->
                        <tr data-status="active" class="tender-table-row" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--primary-600); font-size: 13px;">RFQ/2024/102</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-primary);">Vehicle Fleet Procurement</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge active">Active</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">$850,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-secondary);">20 Dec 2024</td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'RFQ/2024/102', title: 'Vehicle Fleet Procurement', status: 'Posted', statusKey: 'active'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div onclick="openAmendModal('RFQ/2024/102', 'Vehicle Fleet Procurement')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-pencil" style="color: var(--warning-500);"></i> Amend Tender</div>
                                        <div onclick="openClarificationsModal('RFQ/2024/102', 'Vehicle Fleet Procurement')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-comments" style="color: var(--info-500);"></i> Clarifications <span style="margin-left: auto; background: var(--info-500); color: white; padding: 1px 6px; border-radius: 10px; font-size: 10px; font-weight: 600;">2</span></div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div onclick="openCancelModal('RFQ/2024/102', 'Vehicle Fleet Procurement')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--danger-500); transition: background 0.15s;"><i class="pi pi-times-circle"></i> Cancel Tender</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 5: Draft -->
                        <tr data-status="draft" class="tender-table-row" style="border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--text-muted); font-size: 13px;">DRAFT-2024-156</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-secondary);">Consulting Services - HR Management</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge draft">Draft</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-secondary);">$120,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-muted);"></td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--primary-600); font-weight: 500; transition: background 0.15s;"><i class="pi pi-pencil" style="color: var(--primary-500);"></i> Continue Editing</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-copy" style="color: var(--text-muted);"></i> Duplicate</div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--danger-500); transition: background 0.15s;"><i class="pi pi-trash"></i> Delete Draft</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 6: Pre-Clearance -->
                        <tr data-status="pre-clearance" class="tender-table-row" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--primary-600); font-size: 13px;">ITB/2024/089</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-primary);">Laboratory Equipment Procurement</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge" style="background: var(--info-50); color: var(--info-500);">Pre-Clearance</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">$350,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-muted);"></td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'ITB/2024/089', title: 'Laboratory Equipment Procurement', status: 'Pre-Clearance', statusKey: 'pre-clearance'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div onclick="viewTenderPreview('ITB/2024/089', 'Laboratory Equipment Procurement')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-file" style="color: var(--text-muted);"></i> Quick Preview</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-history" style="color: var(--text-muted);"></i> View Comments</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 7: TME Signed -->
                        <tr data-status="tme-signed" class="tender-table-row" style="border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--primary-600); font-size: 13px;">RFQ/2024/115</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-primary);">Furniture and Office Supplies</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge" style="background: var(--success-50); color: var(--success-500);">TME Signed</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">$180,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-muted);"></td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'RFQ/2024/115', title: 'Furniture and Office Supplies', status: 'TME Signed', statusKey: 'tme-signed'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div onclick="viewTenderPreview('RFQ/2024/115', 'Furniture and Office Supplies')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-file" style="color: var(--text-muted);"></i> Quick Preview</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--success-600); font-weight: 500; transition: background 0.15s;"><i class="pi pi-send" style="color: var(--success-500);"></i> Publish Tender</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 8: Closed -->
                        <tr data-status="closed" class="tender-table-row" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--primary-600); font-size: 13px;">ITB/2024/034</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-primary);">Water Infrastructure Development</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge closed">Closed</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">$2,500,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-secondary);">25 Nov 2024</td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'ITB/2024/034', title: 'Water Infrastructure Development', status: 'Closed', statusKey: 'closed'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div onclick="showBidOpening('ITB/2024/034', 'Water Infrastructure Development', 'ITB')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--success-600); font-weight: 500; transition: background 0.15s;"><i class="pi pi-envelope-open" style="color: var(--success-500);"></i> Start Bid Opening</div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-users" style="color: var(--text-muted);"></i> View Bidders <span style="margin-left: auto; background: var(--primary-500); color: white; padding: 1px 6px; border-radius: 10px; font-size: 10px; font-weight: 600;">9</span></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 9: Bid Opening -->
                        <tr data-status="bid-opening" class="tender-table-row" style="border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--primary-600); font-size: 13px;">RFP/2024/067</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-primary);">Security Services Contract</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge" style="background: #fff3cd; color: #856404;">Bid Opening</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">$650,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-secondary);">20 Nov 2024</td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'RFP/2024/067', title: 'Security Services Contract', status: 'Bid Opening', statusKey: 'bid-opening', type: 'RFP'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div onclick="showBidOpening('RFP/2024/067', 'Security Services Contract', 'RFP')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--success-600); font-weight: 500; transition: background 0.15s;"><i class="pi pi-folder-open" style="color: var(--success-500);"></i> Continue Opening</div>
                                        <div onclick="downloadBidOpeningReport('pdf')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-file-pdf" style="color: var(--danger-500);"></i> Opening Report</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 10: Evaluation -->
                        <tr data-status="evaluation" class="tender-table-row" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--primary-600); font-size: 13px;">ITB/2024/023</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-primary);">Medical Supplies - Emergency Response</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge" style="background: #e3f2fd; color: #1565c0;">Evaluation</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">$420,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-secondary);">15 Nov 2024</td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'ITB/2024/023', title: 'Medical Supplies - Emergency Response', status: 'Evaluation', statusKey: 'evaluation'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div onclick="showEvaluation('ITB/2024/023', 'Medical Supplies - Emergency Response', 'evaluator')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--success-600); font-weight: 500; transition: background 0.15s;"><i class="pi pi-chart-bar" style="color: var(--success-500);"></i> Continue Evaluation</div>
                                        <div onclick="showEvaluation('ITB/2024/023', 'Medical Supplies - Emergency Response', 'comparison')" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-table" style="color: var(--text-muted);"></i> Comparison View</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 11: Award -->
                        <tr data-status="award" class="tender-table-row" style="border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--primary-600); font-size: 13px;">RFQ/2024/055</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-primary);">IT Equipment and Software Licenses</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge" style="background: #f3e5f5; color: #6a1b9a;">Award</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">$285,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-secondary);">18 Nov 2024</td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'RFQ/2024/055', title: 'IT Equipment and Software Licenses', status: 'Award Recommendation', statusKey: 'award'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--success-600); font-weight: 500; transition: background 0.15s;"><i class="pi pi-file-edit" style="color: var(--success-500);"></i> Sign Report</div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-file-pdf" style="color: var(--danger-500);"></i> Award Report</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 12: Finalized -->
                        <tr data-status="finalized" class="tender-table-row" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100); transition: background 0.15s;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--primary-600); font-size: 13px;">ITB/2024/012</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-primary);">Construction - School Building</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge" style="background: #c8e6c9; color: #2e7d32;">Finalized</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">$3,200,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-secondary);">10 Nov 2024</td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'ITB/2024/012', title: 'Construction - School Building', status: 'Finalized', statusKey: 'finalized'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-file" style="color: var(--text-muted);"></i> View Contract</div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-history" style="color: var(--text-muted);"></i> Tender History</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- Row 13: Cancelled -->
                        <tr data-status="cancelled" class="tender-table-row" style="border-bottom: 1px solid var(--surface-100); transition: background 0.15s; opacity: 0.7;">
                            <td style="padding: 14px 20px;"><span style="font-weight: 600; color: var(--text-muted); font-size: 13px;">RFP/2024/091</span></td>
                            <td style="padding: 14px 16px;"><span style="font-weight: 500; color: var(--text-muted);">Training Services - Capacity Building</span></td>
                            <td style="padding: 14px 16px; text-align: center;"><span class="status-badge" style="background: var(--danger-50); color: var(--danger-500);">Cancelled</span></td>
                            <td style="padding: 14px 16px; text-align: right; font-weight: 600; color: var(--text-muted);">$95,000</td>
                            <td style="padding: 14px 16px; text-align: center; color: var(--text-muted);"></td>
                            <td style="padding: 14px 20px; text-align: center;">
                                <div class="action-menu-container" style="position: relative;">
                                    <button class="action-menu-btn" onclick="toggleActionMenu(this)" style="background: none; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s;">
                                        <i class="pi pi-ellipsis-v" style="color: var(--text-muted); font-size: 14px;"></i>
                                    </button>
                                    <div class="action-menu-dropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: 100;">
                                        <div onclick="showTenderDetails({id: 'RFP/2024/091', title: 'Training Services - Capacity Building', status: 'Cancelled', statusKey: 'cancelled'})" class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-eye" style="color: var(--primary-500);"></i> View Details</div>
                                        <div style="border-top: 1px solid var(--surface-100); margin: 4px 0;"></div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-info-circle" style="color: var(--text-muted);"></i> Cancellation Details</div>
                                        <div class="action-menu-item" style="padding: 10px 14px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-primary); transition: background 0.15s;"><i class="pi pi-copy" style="color: var(--primary-500);"></i> Clone / Reopen</div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            </div>
            <!-- End Dashboard View -->

            <!-- Tenders List View -->
            <div class="view-section" id="view-tenders-list" style="display: none;">
                <div class="page-header" style="margin-bottom: var(--spacing-xl);">
                    <h1 class="page-title">Tenders</h1>
                    <p class="page-subtitle">View and manage all procurement tenders</p>
                </div>

                <!-- Tenders Filter Bar -->
                <div class="filter-bar">
                    <div class="filter-group">
                        <span class="filter-label">Status:</span>
                        <select class="filter-select" id="tenders-list-status-filter" onchange="filterTendersListTable()">
                            <option value="all">All Statuses</option>
                            <option value="draft">Draft</option>
                            <option value="pre-clearance">Pre-Clearance</option>
                            <option value="approval">Pending Approval</option>
                            <option value="tme-signed">TME Signed</option>
                            <option value="active">Posted/Active</option>
                            <option value="closed">Closed</option>
                            <option value="bid-opening">Bid Opening</option>
                            <option value="evaluation">Evaluation</option>
                            <option value="award">Award Recommendation</option>
                            <option value="finalized">Finalized</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">Type:</span>
                        <select class="filter-select" id="tenders-list-type-filter" onchange="filterTendersListTable()">
                            <option value="all">All Types</option>
                            <option value="ITB">ITB</option>
                            <option value="RFQ">RFQ</option>
                            <option value="RFP">RFP</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">Sort by:</span>
                        <select class="filter-select" id="tenders-list-sort" onchange="sortTendersListTable()">
                            <option value="recent">Most Recent</option>
                            <option value="deadline">Deadline</option>
                            <option value="value-desc">Value (High to Low)</option>
                            <option value="value-asc">Value (Low to High)</option>
                            <option value="reference">Reference</option>
                        </select>
                    </div>
                    <div style="flex: 1;"></div>
                    <input type="text" id="tenders-list-search" placeholder="Search tenders..." class="filter-select" style="width: 250px;" onkeyup="filterTendersListTable()">
                    <button class="btn btn-primary" onclick="document.getElementById('menu-tendering-create').click()">
                        <i class="pi pi-plus"></i>
                        Create New Tender
                    </button>
                </div>

                <!-- Summary Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-xl);">
                    <div style="background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--primary-500);">13</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Total Tenders</div>
                    </div>
                    <div style="background: var(--info-50); border: 1px solid var(--info-200); border-radius: var(--radius-md); padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--info-500);">4</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Active</div>
                    </div>
                    <div style="background: var(--warning-50); border: 1px solid var(--warning-200); border-radius: var(--radius-md); padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--warning-500);">3</div>
                        <div style="font-size: 12px; color: var(--text-muted);">In Review</div>
                    </div>
                    <div style="background: var(--success-50); border: 1px solid var(--success-200); border-radius: var(--radius-md); padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--success-500);">2</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Finalized</div>
                    </div>
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-md); text-align: center;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--text-secondary);">1</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Draft</div>
                    </div>
                </div>

                <!-- Tenders Table -->
                <div style="background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-lg); overflow: hidden;">
                    <table id="tenders-list-table" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: var(--surface-50); border-bottom: 2px solid var(--surface-200);">
                                <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: var(--text-primary);">Reference</th>
                                <th style="padding: 12px 16px; text-align: left; font-weight: 600; color: var(--text-primary);">Title</th>
                                <th style="padding: 12px 16px; text-align: center; font-weight: 600; color: var(--text-primary);">Type</th>
                                <th style="padding: 12px 16px; text-align: center; font-weight: 600; color: var(--text-primary);">Status</th>
                                <th style="padding: 12px 16px; text-align: right; font-weight: 600; color: var(--text-primary);">Est. Value</th>
                                <th style="padding: 12px 16px; text-align: center; font-weight: 600; color: var(--text-primary);">Deadline</th>
                                <th style="padding: 12px 16px; text-align: center; font-weight: 600; color: var(--text-primary);">Bids</th>
                                <th style="padding: 12px 16px; text-align: center; font-weight: 600; color: var(--text-primary);">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tenders-list-tbody">
                            <!-- Row 1: Active -->
                            <tr class="tender-row" data-status="active" data-type="RFQ" data-value="250000" data-deadline="2024-12-15" style="border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--primary-500);">RFQ/2024/001</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">Supply of Medical Equipment</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Posted: 15 Nov 2024</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--primary-50); color: var(--primary-500); border-radius: 4px; font-size: 11px; font-weight: 600;">RFQ</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge active">Active</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$250,000</td>
                                <td style="padding: 12px 16px; text-align: center;">15 Dec 2024</td>
                                <td style="padding: 12px 16px; text-align: center;">3 / 12</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-secondary btn-sm" onclick="showTenderDetails({id: 'RFQ/2024/001', title: 'Supply of Medical Equipment', status: 'Posted', statusKey: 'active'})" style="padding: 4px 8px;">
                                        <i class="pi pi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 2: Active -->
                            <tr class="tender-row" data-status="active" data-type="ITB" data-value="1500000" data-deadline="2025-01-10" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--primary-500);">ITB/2024/045</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">Construction of Office Building</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Posted: 10 Nov 2024</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--success-50); color: var(--success-500); border-radius: 4px; font-size: 11px; font-weight: 600;">ITB</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge active">Active</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$1,500,000</td>
                                <td style="padding: 12px 16px; text-align: center;">10 Jan 2025</td>
                                <td style="padding: 12px 16px; text-align: center;">7 / 25</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-secondary btn-sm" onclick="showTenderDetails({id: 'ITB/2024/045', title: 'Construction of Office Building', status: 'Posted', statusKey: 'active'})" style="padding: 4px 8px;">
                                        <i class="pi pi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 3: Pending Approval -->
                            <tr class="tender-row" data-status="approval" data-type="RFP" data-value="500000" data-deadline="" style="border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--primary-500);">RFP/2024/078</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">IT Infrastructure Services</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Submitted: 28 Nov 2024</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--warning-50); color: var(--warning-500); border-radius: 4px; font-size: 11px; font-weight: 600;">RFP</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge review">Pending Approval</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$500,000</td>
                                <td style="padding: 12px 16px; text-align: center; color: var(--text-muted);">-</td>
                                <td style="padding: 12px 16px; text-align: center; color: var(--text-muted);">-</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-secondary btn-sm" onclick="showTenderDetails({id: 'RFP/2024/078', title: 'IT Infrastructure Services', status: 'Pending Approval', statusKey: 'approval'})" style="padding: 4px 8px;">
                                        <i class="pi pi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 4: Active -->
                            <tr class="tender-row" data-status="active" data-type="RFQ" data-value="850000" data-deadline="2024-12-20" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--primary-500);">RFQ/2024/102</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">Vehicle Fleet Procurement</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Posted: 20 Nov 2024</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--primary-50); color: var(--primary-500); border-radius: 4px; font-size: 11px; font-weight: 600;">RFQ</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge active">Active</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$850,000</td>
                                <td style="padding: 12px 16px; text-align: center;">20 Dec 2024</td>
                                <td style="padding: 12px 16px; text-align: center;">1 / 8</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-secondary btn-sm" onclick="showTenderDetails({id: 'RFQ/2024/102', title: 'Vehicle Fleet Procurement', status: 'Posted', statusKey: 'active'})" style="padding: 4px 8px;">
                                        <i class="pi pi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 5: Draft -->
                            <tr class="tender-row" data-status="draft" data-type="RFP" data-value="120000" data-deadline="" style="border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--text-muted);">DRAFT-2024-156</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">Consulting Services - HR Management</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Created: 25 Nov 2024  75% complete</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--warning-50); color: var(--warning-500); border-radius: 4px; font-size: 11px; font-weight: 600;">RFP</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge draft">Draft</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$120,000</td>
                                <td style="padding: 12px 16px; text-align: center; color: var(--text-muted);">-</td>
                                <td style="padding: 12px 16px; text-align: center; color: var(--text-muted);">-</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-primary btn-sm" style="padding: 4px 8px;">
                                        <i class="pi pi-pencil"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 6: Pre-Clearance -->
                            <tr class="tender-row" data-status="pre-clearance" data-type="ITB" data-value="350000" data-deadline="" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--primary-500);">ITB/2024/089</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">Laboratory Equipment Procurement</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Submitted: 29 Nov 2024</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--success-50); color: var(--success-500); border-radius: 4px; font-size: 11px; font-weight: 600;">ITB</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge" style="background: var(--info-50); color: var(--info-400);">Pre-Clearance</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$350,000</td>
                                <td style="padding: 12px 16px; text-align: center; color: var(--text-muted);">-</td>
                                <td style="padding: 12px 16px; text-align: center; color: var(--text-muted);">-</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-secondary btn-sm" onclick="showTenderDetails({id: 'ITB/2024/089', title: 'Laboratory Equipment Procurement', status: 'Pre-Clearance', statusKey: 'pre-clearance'})" style="padding: 4px 8px;">
                                        <i class="pi pi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 7: TME Signed -->
                            <tr class="tender-row" data-status="tme-signed" data-type="RFQ" data-value="180000" data-deadline="" style="border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--primary-500);">RFQ/2024/115</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">Furniture and Office Supplies</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">TME Signed: 27 Nov 2024</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--primary-50); color: var(--primary-500); border-radius: 4px; font-size: 11px; font-weight: 600;">RFQ</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge" style="background: var(--success-50); color: var(--success-500);">TME Signed</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$180,000</td>
                                <td style="padding: 12px 16px; text-align: center; color: var(--text-muted);">-</td>
                                <td style="padding: 12px 16px; text-align: center; color: var(--text-muted);">-</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-success btn-sm" style="padding: 4px 8px;">
                                        <i class="pi pi-send"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 8: Closed -->
                            <tr class="tender-row" data-status="closed" data-type="ITB" data-value="2500000" data-deadline="2024-11-25" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--primary-500);">ITB/2024/034</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">Water Infrastructure Development</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Closed: 25 Nov 2024</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--success-50); color: var(--success-500); border-radius: 4px; font-size: 11px; font-weight: 600;">ITB</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge closed">Closed</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$2,500,000</td>
                                <td style="padding: 12px 16px; text-align: center;">25 Nov 2024</td>
                                <td style="padding: 12px 16px; text-align: center;">9</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-secondary btn-sm" onclick="showTenderDetails({id: 'ITB/2024/034', title: 'Water Infrastructure Development', status: 'Closed', statusKey: 'closed'})" style="padding: 4px 8px;">
                                        <i class="pi pi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 9: Bid Opening -->
                            <tr class="tender-row" data-status="bid-opening" data-type="RFP" data-value="650000" data-deadline="2024-11-20" style="border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--primary-500);">RFP/2024/067</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">Security Services Contract</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Opening Started: 22 Nov 2024</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--warning-50); color: var(--warning-500); border-radius: 4px; font-size: 11px; font-weight: 600;">RFP</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge" style="background: #fff3cd; color: #856404;">Bid Opening</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$650,000</td>
                                <td style="padding: 12px 16px; text-align: center;">20 Nov 2024</td>
                                <td style="padding: 12px 16px; text-align: center;">6</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-secondary btn-sm" onclick="showBidOpening('RFP/2024/067', 'Security Services Contract', 'RFP')" style="padding: 4px 8px;">
                                        <i class="pi pi-folder-open"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 10: Evaluation -->
                            <tr class="tender-row" data-status="evaluation" data-type="ITB" data-value="480000" data-deadline="2024-11-10" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--primary-500);">ITB/2024/023</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">Medical Supplies - Emergency Response</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Evaluation: 65% complete</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--success-50); color: var(--success-500); border-radius: 4px; font-size: 11px; font-weight: 600;">ITB</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge" style="background: #e3f2fd; color: #1565c0;">Evaluation</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$480,000</td>
                                <td style="padding: 12px 16px; text-align: center;">10 Nov 2024</td>
                                <td style="padding: 12px 16px; text-align: center;">5</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-secondary btn-sm" onclick="showTenderDetails({id: 'ITB/2024/023', title: 'Medical Supplies - Emergency Response', status: 'Evaluation', statusKey: 'evaluation'})" style="padding: 4px 8px;">
                                        <i class="pi pi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 11: Award Recommendation -->
                            <tr class="tender-row" data-status="award" data-type="RFQ" data-value="310000" data-deadline="2024-10-25" style="border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--primary-500);">RFQ/2024/055</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">IT Equipment and Software Licenses</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Pending Signature</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--primary-50); color: var(--primary-500); border-radius: 4px; font-size: 11px; font-weight: 600;">RFQ</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge" style="background: #f3e5f5; color: #7b1fa2;">Award</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$310,000</td>
                                <td style="padding: 12px 16px; text-align: center;">25 Oct 2024</td>
                                <td style="padding: 12px 16px; text-align: center;">4</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-secondary btn-sm" onclick="showTenderDetails({id: 'RFQ/2024/055', title: 'IT Equipment and Software Licenses', status: 'Award Recommendation', statusKey: 'award'})" style="padding: 4px 8px;">
                                        <i class="pi pi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 12: Finalized -->
                            <tr class="tender-row" data-status="finalized" data-type="ITB" data-value="3200000" data-deadline="2024-09-30" style="background: var(--surface-50); border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--primary-500);">ITB/2024/012</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500;">Construction - School Building</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Awarded to: BuildCo International</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--success-50); color: var(--success-500); border-radius: 4px; font-size: 11px; font-weight: 600;">ITB</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge" style="background: #c8e6c9; color: #2e7d32;">Finalized</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500;">$3,200,000</td>
                                <td style="padding: 12px 16px; text-align: center;">30 Sep 2024</td>
                                <td style="padding: 12px 16px; text-align: center;">6</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-secondary btn-sm" onclick="showTenderDetails({id: 'ITB/2024/012', title: 'Construction - School Building', status: 'Finalized', statusKey: 'finalized'})" style="padding: 4px 8px;">
                                        <i class="pi pi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- Row 13: Cancelled -->
                            <tr class="tender-row" data-status="cancelled" data-type="RFP" data-value="95000" data-deadline="" style="border-bottom: 1px solid var(--surface-100);">
                                <td style="padding: 12px 16px; font-weight: 600; color: var(--text-muted);">RFP/2024/091</td>
                                <td style="padding: 12px 16px;">
                                    <div style="font-weight: 500; color: var(--text-muted);">Training Services - Capacity Building</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Cancelled: Budget Constraints</div>
                                </td>
                                <td style="padding: 12px 16px; text-align: center;"><span style="padding: 2px 8px; background: var(--warning-50); color: var(--warning-500); border-radius: 4px; font-size: 11px; font-weight: 600;">RFP</span></td>
                                <td style="padding: 12px 16px; text-align: center;"><span class="status-badge" style="background: var(--danger-50); color: var(--danger-500);">Cancelled</span></td>
                                <td style="padding: 12px 16px; text-align: right; font-weight: 500; color: var(--text-muted);">$95,000</td>
                                <td style="padding: 12px 16px; text-align: center; color: var(--text-muted);">-</td>
                                <td style="padding: 12px 16px; text-align: center; color: var(--text-muted);">14 interested</td>
                                <td style="padding: 12px 16px; text-align: center;">
                                    <button class="btn btn-secondary btn-sm" onclick="showTenderDetails({id: 'RFP/2024/091', title: 'Training Services - Capacity Building', status: 'Cancelled', statusKey: 'cancelled'})" style="padding: 4px 8px;">
                                        <i class="pi pi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--spacing-lg); padding: var(--spacing-md); background: var(--surface-0); border: 1px solid var(--surface-200); border-radius: var(--radius-md);">
                    <div style="font-size: 13px; color: var(--text-muted);">
                        Showing <strong>1-13</strong> of <strong>13</strong> tenders
                    </div>
                    <div style="display: flex; gap: var(--spacing-xs);">
                        <button class="btn btn-ghost btn-sm" disabled style="padding: 6px 12px;">Previous</button>
                        <button class="btn btn-primary btn-sm" style="padding: 6px 12px;">1</button>
                        <button class="btn btn-ghost btn-sm" disabled style="padding: 6px 12px;">Next</button>
                    </div>
                </div>
            </div>
            <!-- End Tenders List View -->

            <!-- Tender Details View -->
            <div class="view-section" id="view-tender-details">
                <!-- Tender Info Banner -->
                <div class="tender-info-banner">
                    <div class="tender-banner-ref" id="details-tender-id">Reference: RFQ/2024/001</div>
                    <h2 class="tender-banner-title" id="details-tender-title">Supply and Delivery of Medical Equipment and Supplies</h2>
                    <div class="tender-banner-meta">
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Type</span>
                            <span class="banner-meta-value">ITB</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Category</span>
                            <span class="banner-meta-value">Goods</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Value</span>
                            <span class="banner-meta-value">$250,000 USD</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Deadline</span>
                            <span class="banner-meta-value">15 Jan 2025</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Status</span>
                            <span class="banner-meta-value" id="details-tender-status">Open</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-xl); flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="showDashboard()">
                        <i class="pi pi-arrow-left"></i> Back to Dashboard
                    </button>
                    <div style="flex: 1;"></div>
                    <div id="tender-details-actions" style="display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="openAmendModalFromDetails()">
                            <i class="pi pi-pencil"></i> Amend Tender
                        </button>
                        <button class="btn btn-danger" onclick="openCancelModalFromDetails()">
                            <i class="pi pi-times-circle"></i> Cancel Tender
                        </button>
                        <button class="btn btn-secondary" onclick="openClarificationsFromDetails()">
                            <i class="pi pi-comment"></i> Manage Clarifications (5)
                        </button>
                    </div>
                </div>

                <div class="deadline-warning">
                    <div class="deadline-icon"></div>
                    <div class="deadline-text">
                        <strong>5 days, 14 hours remaining</strong> until bid submission deadline.
                    </div>
                </div>

                <div class="tender-overview-grid">
                    <div class="overview-main">
                        <!-- General Information - Collapsible -->
                        <div class="overview-section-collapsible">
                            <div class="overview-section-header" onclick="toggleOverviewSection(this)">
                                <h3>
                                    <span class="overview-section-icon"></span>
                                    General Information
                                </h3>
                                <span class="section-toggle-icon"></span>
                            </div>
                            <div class="overview-section-body">
                                <div class="info-row">
                                    <div class="info-label">Method</div>
                                    <div class="info-value">ITB - Invitation to Bid</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">Category</div>
                                    <div class="info-value">Goods</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">Countries</div>
                                    <div class="info-value">Afghanistan, Bangladesh, Ethiopia</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">Bid Validity</div>
                                    <div class="info-value">90 days</div>
                                </div>
                            </div>
                        </div>

                        <!-- Scope & Objectives - Collapsible -->
                        <div class="overview-section-collapsible">
                            <div class="overview-section-header" onclick="toggleOverviewSection(this)">
                                <h3>
                                    <span class="overview-section-icon"></span>
                                    Scope & Objectives
                                </h3>
                                <span class="section-toggle-icon"></span>
                            </div>
                            <div class="overview-section-body">
                                <p style="line-height: 1.6; color: var(--text-secondary); margin: 0;">
                                    UNOPS requires the supply and delivery of medical equipment for healthcare facilities. Equipment must meet international standards and include installation and training services.
                                </p>
                            </div>
                        </div>

                        <!-- Items & Specifications - Collapsible -->
                        <div class="overview-section-collapsible">
                            <div class="overview-section-header" onclick="toggleOverviewSection(this)">
                                <h3>
                                    <span class="overview-section-icon"></span>
                                    Items & Specifications
                                    <span style="font-size: 12px; color: var(--text-muted); font-weight: 400; margin-left: var(--spacing-sm);">4 items</span>
                                </h3>
                                <span class="section-toggle-icon"></span>
                            </div>
                            <div class="overview-section-body">
                            <p style="line-height: 1.6; color: var(--text-muted); margin-bottom: var(--spacing-md); font-size: 14px;">
                                The following items are being procured. Click on each item to view detailed specifications.
                            </p>

                            <!-- Item 1: Ultrasound Machines -->
                            <div class="collapsible-item-card">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">Ultrasound Machines</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">UNSPSC: 42182104  Quantity: 5 Units</div>
                                    </div>
                                    <span class="collapsible-arrow"></span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Type:</span>
                                        <span class="spec-detail-value">Portable Ultrasound System</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Display:</span>
                                        <span class="spec-detail-value">Color Doppler with minimum 15" LED monitor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Probes:</span>
                                        <span class="spec-detail-value">Minimum 3 probes (Convex, Linear, Phased Array)</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Features:</span>
                                        <span class="spec-detail-value">3D/4D imaging capability, DICOM compatible, battery backup</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Warranty:</span>
                                        <span class="spec-detail-value">Minimum 2 years parts and labor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Delivery:</span>
                                        <span class="spec-detail-value">Within 90 days of contract signing</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Item 2: Patient Monitors -->
                            <div class="collapsible-item-card">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">Patient Monitors</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">UNSPSC: 42182108  Quantity: 20 Units</div>
                                    </div>
                                    <span class="collapsible-arrow"></span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Type:</span>
                                        <span class="spec-detail-value">Multi-Parameter Patient Monitor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Display:</span>
                                        <span class="spec-detail-value">Minimum 12" TFT color LCD touchscreen</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Parameters:</span>
                                        <span class="spec-detail-value">ECG (3/5/12 lead), SpO2, NIBP, Temperature, Respiration Rate, IBP (optional)</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Battery:</span>
                                        <span class="spec-detail-value">Built-in rechargeable, minimum 4 hours runtime</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Alarms:</span>
                                        <span class="spec-detail-value">Visual and audible with adjustable limits</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Warranty:</span>
                                        <span class="spec-detail-value">Minimum 2 years parts and labor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Delivery:</span>
                                        <span class="spec-detail-value">Within 60 days of contract signing</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Item 3: Surgical Lights -->
                            <div class="collapsible-item-card">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">Surgical Lights</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">UNSPSC: 42192201  Quantity: 8 Units</div>
                                    </div>
                                    <span class="collapsible-arrow"></span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Type:</span>
                                        <span class="spec-detail-value">LED Surgical Operating Light, Mobile</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Illumination:</span>
                                        <span class="spec-detail-value">Minimum 120,000 lux at 1m distance</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Color Temperature:</span>
                                        <span class="spec-detail-value">4000-5000K, adjustable</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">LED Lifespan:</span>
                                        <span class="spec-detail-value">Minimum 50,000 hours</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Mobility:</span>
                                        <span class="spec-detail-value">Floor mounted with wheels, brake system, 360 rotation</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Warranty:</span>
                                        <span class="spec-detail-value">Minimum 3 years parts and labor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Delivery:</span>
                                        <span class="spec-detail-value">Within 75 days of contract signing</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Item 4: Anesthesia Machines -->
                            <div class="collapsible-item-card">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">Anesthesia Machines</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">UNSPSC: 42182101  Quantity: 3 Units</div>
                                    </div>
                                    <span class="collapsible-arrow"></span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Type:</span>
                                        <span class="spec-detail-value">Advanced Anesthesia Workstation</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Ventilator:</span>
                                        <span class="spec-detail-value">Integrated with volume and pressure control modes</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Vaporizers:</span>
                                        <span class="spec-detail-value">Minimum 2 agent-specific vaporizers (Sevoflurane, Isoflurane)</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Monitoring:</span>
                                        <span class="spec-detail-value">Integrated patient monitoring (O2, CO2, agent concentration, pressure, flow)</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Display:</span>
                                        <span class="spec-detail-value">15" color touchscreen with waveform display</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Standards:</span>
                                        <span class="spec-detail-value">ISO 80601-2-13 compliant</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Warranty:</span>
                                        <span class="spec-detail-value">Minimum 2 years parts and labor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Delivery:</span>
                                        <span class="spec-detail-value">Within 120 days of contract signing</span>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>

                        <!-- Tender Particulars - Collapsible -->
                        <div class="overview-section-collapsible">
                            <div class="overview-section-header" onclick="toggleOverviewSection(this)">
                                <h3>
                                    <span class="overview-section-icon"></span>
                                    Tender Particulars
                                </h3>
                                <span class="section-toggle-icon"></span>
                            </div>
                            <div class="overview-section-body">
                            <div class="info-row">
                                <div class="info-label">Bid Security</div>
                                <div class="info-value">Required - $5,000 USD</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Performance Security</div>
                                <div class="info-value">10% of contract value</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Advance Payment</div>
                                <div class="info-value">Allowed - Up to 20%</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Advance Payment Security</div>
                                <div class="info-value">Required - Bank guarantee for full amount</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Liquidated Damages</div>
                                <div class="info-value">0.5% per week of delay, maximum 10%</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Alternative Offers</div>
                                <div class="info-value">Allowed</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Site Visit</div>
                                <div class="info-value">Not required</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Pre-Bid Meeting</div>
                                <div class="info-value">Optional - 20 December 2024, 10:00 AM UTC (Virtual)</div>
                            </div>
                            </div>
                        </div>

                        <!-- Evaluation Criteria - Collapsible -->
                        <div class="overview-section-collapsible">
                            <div class="overview-section-header" onclick="toggleOverviewSection(this)">
                                <h3>
                                    <span class="overview-section-icon"></span>
                                    Evaluation Criteria
                                </h3>
                                <span class="section-toggle-icon"></span>
                            </div>
                            <div class="overview-section-body">
                            <div class="info-box">
                                <strong>Method:</strong> Lowest Evaluated Substantially Responsive Bid
                            </div>
                            <p style="margin-top: var(--spacing-md); line-height: 1.6; color: var(--text-secondary); margin-bottom: 0;">
                                Technical evaluation (pass/fail) followed by financial comparison of compliant bids.
                            </p>
                            </div>
                        </div>

                        <!-- Clarifications - Collapsible -->
                        <div class="overview-section-collapsible">
                            <div class="overview-section-header" onclick="toggleOverviewSection(this)">
                                <h3>
                                    <span class="overview-section-icon"></span>
                                    Clarifications
                                    <span style="font-size: 12px; color: var(--text-muted); font-weight: 400; margin-left: var(--spacing-sm);">5 questions</span>
                                </h3>
                                <span class="section-toggle-icon"></span>
                            </div>
                            <div class="overview-section-body">
                                <!-- Clarification Stats -->
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                    <div style="background: var(--success-50); padding: var(--spacing-md); border-radius: var(--radius-sm); text-align: center;">
                                        <div style="font-size: 20px; font-weight: 700; color: var(--success-500);">3</div>
                                        <div style="font-size: 11px; color: var(--text-muted);">Answered</div>
                                    </div>
                                    <div style="background: var(--warning-50); padding: var(--spacing-md); border-radius: var(--radius-sm); text-align: center;">
                                        <div style="font-size: 20px; font-weight: 700; color: var(--warning-500);">2</div>
                                        <div style="font-size: 11px; color: var(--text-muted);">Pending</div>
                                    </div>
                                    <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); text-align: center;">
                                        <div style="font-size: 20px; font-weight: 700; color: var(--info-500);">1</div>
                                        <div style="font-size: 11px; color: var(--text-muted);">Groups</div>
                                    </div>
                                </div>

                                <!-- Recent Clarifications -->
                                <div style="margin-bottom: var(--spacing-md);">
                                    <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--spacing-sm);">
                                        Recent Questions
                                    </div>
                                    
                                    <!-- Question 1 -->
                                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm); border-left: 3px solid var(--success-500);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-xs);">
                                            <span style="font-weight: 600; font-size: 13px;">Q#001</span>
                                            <div style="display: flex; gap: var(--spacing-xs);">
                                                <span class="visibility-badge public"> Public</span>
                                                <span class="status-badge" style="background: var(--success-50); color: var(--success-500); font-size: 10px;">Answered</span>
                                            </div>
                                        </div>
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: var(--spacing-xs);">
                                            Can alternative brands be proposed for ultrasound probes?
                                        </div>
                                        <div style="font-size: 10px; color: var(--text-muted);">Supplier A  5 Dec 2024</div>
                                    </div>
                                    
                                    <!-- Question 2 - Grouped -->
                                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm); border-left: 3px solid var(--success-500);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-xs);">
                                            <div style="display: flex; align-items: center; gap: var(--spacing-xs);">
                                                <span style="font-weight: 600; font-size: 13px;">Q#002, Q#003</span>
                                                <span class="question-group-badge"> Grouped</span>
                                            </div>
                                            <div style="display: flex; gap: var(--spacing-xs);">
                                                <span class="visibility-badge public"> Public</span>
                                                <span class="status-badge" style="background: var(--success-50); color: var(--success-500); font-size: 10px;">Answered</span>
                                            </div>
                                        </div>
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: var(--spacing-xs);">
                                            Questions about delivery timeline and partial delivery options...
                                        </div>
                                        <div style="font-size: 10px; color: var(--text-muted);">Supplier B, Supplier C  6-7 Dec 2024</div>
                                    </div>
                                    
                                    <!-- Question 4 - Private/Evaluation -->
                                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm); border-left: 3px solid var(--warning-500);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-xs);">
                                            <span style="font-weight: 600; font-size: 13px;">Q#004</span>
                                            <div style="display: flex; gap: var(--spacing-xs);">
                                                <span class="visibility-badge private"> Private</span>
                                                <span class="status-badge" style="background: var(--warning-50); color: var(--warning-500); font-size: 10px;">Pending</span>
                                            </div>
                                        </div>
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: var(--spacing-xs);">
                                            Clarification on technical specifications deviation...
                                        </div>
                                        <div style="font-size: 10px; color: var(--text-muted);">Supplier A  10 Dec 2024  Evaluation Phase</div>
                                    </div>
                                    
                                    <!-- Question 5 - Pending -->
                                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm); border-left: 3px solid var(--warning-500);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-xs);">
                                            <span style="font-weight: 600; font-size: 13px;">Q#005</span>
                                            <div style="display: flex; gap: var(--spacing-xs);">
                                                <span class="visibility-badge public"> Public</span>
                                                <span class="status-badge" style="background: var(--warning-50); color: var(--warning-500); font-size: 10px;">Pending</span>
                                            </div>
                                        </div>
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: var(--spacing-xs);">
                                            What is the warranty requirement for anesthesia machines?
                                        </div>
                                        <div style="font-size: 10px; color: var(--text-muted);">Supplier D  11 Dec 2024</div>
                                    </div>
                                </div>

                                <button class="btn btn-primary" style="width: 100%;" onclick="openClarificationsModalAdvanced()">
                                    <i class="pi pi-comments"></i> Manage All Clarifications
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div class="overview-sidebar-section">
                        <!-- Key Dates -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon"></span>
                                Key Dates
                            </h3>
                            <div class="timeline">
                                <div class="timeline-item">
                                    <div class="timeline-date">5 Dec 2024</div>
                                    <div class="timeline-content">Published</div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-date">10 Jan 2025</div>
                                    <div class="timeline-content">Clarification Deadline</div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-date">15 Jan 2025</div>
                                    <div class="timeline-content">Submission Deadline</div>
                                </div>
                            </div>
                        </div>

                        <!-- Statistics -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon"></span>
                                Tender Statistics
                            </h3>
                            <div class="info-row">
                                <div class="info-label">Suppliers Interested</div>
                                <div class="info-value">12</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Bids Submitted</div>
                                <div class="info-value">3</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Clarifications</div>
                                <div class="info-value">5 questions</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Documents</div>
                                <div class="info-value">8 files</div>
                            </div>
                        </div>

                        <!-- Team - Collapsible -->
                        <div class="overview-section-collapsible">
                            <div class="overview-section-header" onclick="toggleOverviewSection(this)">
                                <h3>
                                    <span class="overview-section-icon"></span>
                                    Team & Evaluation Assignment
                                </h3>
                                <span class="section-toggle-icon"></span>
                            </div>
                            <div class="overview-section-body">
                                <!-- Team Members Subsection -->
                                <div style="margin-bottom: var(--spacing-lg);">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-sm);">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--text-primary);">Team Members</div>
                                    </div>
                            
                                    <!-- Team Member 1: Tender Author -->
                                    <div class="collapsible-item-card" style="margin-bottom: var(--spacing-sm);">
                                        <div class="collapsible-item-header" onclick="toggleItemCard(this, event)" style="padding: var(--spacing-sm);">
                                            <div style="flex: 1;">
                                                <div style="font-weight: 600; font-size: 13px; margin-bottom: 2px;">Jane Doe</div>
                                                <div style="font-size: 11px; color: var(--text-muted);">Tender Author</div>
                                            </div>
                                            <span class="collapsible-arrow"></span>
                                        </div>
                                        <div class="collapsible-item-content">
                                            <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.6;">
                                                <div style="margin-bottom: var(--spacing-xs);"><strong>Email:</strong> jane.doe@unops.org</div>
                                                <div style="margin-bottom: var(--spacing-xs);"><strong>Unit:</strong> Procurement Services</div>
                                                <div><strong>Status:</strong> <span style="color: var(--success-500);"> Active</span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Team Member 2: TME -->
                                    <div class="collapsible-item-card" style="margin-bottom: var(--spacing-sm);">
                                        <div class="collapsible-item-header" onclick="toggleItemCard(this, event)" style="padding: var(--spacing-sm);">
                                            <div style="flex: 1;">
                                                <div style="font-weight: 600; font-size: 13px; margin-bottom: 2px;">Michael Chen</div>
                                                <div style="font-size: 11px; color: var(--text-muted);">TME</div>
                                            </div>
                                            <span class="collapsible-arrow"></span>
                                        </div>
                                        <div class="collapsible-item-content">
                                            <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.6;">
                                                <div style="margin-bottom: var(--spacing-xs);"><strong>Email:</strong> michael.chen@unops.org</div>
                                                <div style="margin-bottom: var(--spacing-xs);"><strong>Unit:</strong> Technical Advisory</div>
                                                <div><strong>Status:</strong> <span style="color: var(--success-500);"> Active</span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Team Member 3: PR -->
                                    <div class="collapsible-item-card" style="margin-bottom: var(--spacing-sm);">
                                        <div class="collapsible-item-header" onclick="toggleItemCard(this, event)" style="padding: var(--spacing-sm);">
                                            <div style="flex: 1;">
                                                <div style="font-weight: 600; font-size: 13px; margin-bottom: 2px;">Sarah Williams</div>
                                                <div style="font-size: 11px; color: var(--text-muted);">Procurement Reviewer</div>
                                            </div>
                                            <span class="collapsible-arrow"></span>
                                        </div>
                                        <div class="collapsible-item-content">
                                            <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.6;">
                                                <div style="margin-bottom: var(--spacing-xs);"><strong>Email:</strong> sarah.williams@unops.org</div>
                                                <div style="margin-bottom: var(--spacing-xs);"><strong>Unit:</strong> Procurement Review</div>
                                                <div><strong>Status:</strong> <span style="color: var(--success-500);"> Active</span></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Team Member 4: PA -->
                                    <div class="collapsible-item-card">
                                        <div class="collapsible-item-header" onclick="toggleItemCard(this, event)" style="padding: var(--spacing-sm);">
                                            <div style="flex: 1;">
                                                <div style="font-weight: 600; font-size: 13px; margin-bottom: 2px;">David Martinez</div>
                                                <div style="font-size: 11px; color: var(--text-muted);">Procurement Authority</div>
                                            </div>
                                            <span class="collapsible-arrow"></span>
                                        </div>
                                        <div class="collapsible-item-content">
                                            <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.6;">
                                                <div style="margin-bottom: var(--spacing-xs);"><strong>Email:</strong> david.martinez@unops.org</div>
                                                <div style="margin-bottom: var(--spacing-xs);"><strong>Unit:</strong> Procurement Authority</div>
                                                <div><strong>Status:</strong> <span style="color: var(--success-500);"> Active</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Evaluation Assignment Subsection -->
                                <div style="border-top: 1px solid var(--surface-200); padding-top: var(--spacing-lg);">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                                        <div style="font-size: 13px; font-weight: 600; color: var(--text-primary);"> Evaluation Assignment</div>
                                        <div style="display: flex; gap: var(--spacing-xs);">
                                            <button class="btn btn-secondary btn-sm" onclick="openAssignmentConfigModal()" style="font-size: 10px; padding: 4px 8px;">
                                                 Configure
                                            </button>
                                            <button class="btn btn-primary btn-sm" onclick="openEvaluationTeamModal()" style="font-size: 10px; padding: 4px 8px;">
                                                <i class="pi pi-plus"></i> Manage
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Assignment Mode Indicator -->
                                    <div style="background: var(--info-50); padding: var(--spacing-sm); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md); border-left: 3px solid var(--info-400);">
                                        <div style="font-size: 11px; color: var(--info-600);">
                                            <strong>Assignment Mode:</strong> Split by Lot
                                        </div>
                                    </div>

                                    <!-- Stage Assignments Summary -->
                                    <div style="margin-bottom: var(--spacing-md);">
                                        <div style="font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--spacing-xs);">
                                            Stage Assignments
                                        </div>
                                        
                                        <div style="display: grid; gap: var(--spacing-xs);">
                                            <div style="background: var(--surface-50); padding: var(--spacing-xs) var(--spacing-sm); border-radius: var(--radius-xs); border-left: 3px solid var(--success-500); display: flex; justify-content: space-between; align-items: center;">
                                                <span style="font-size: 11px;"> Eligibility & Formal</span>
                                                <span style="font-size: 10px; color: var(--text-muted);">2 assigned</span>
                                            </div>
                                            <div style="background: var(--surface-50); padding: var(--spacing-xs) var(--spacing-sm); border-radius: var(--radius-xs); border-left: 3px solid var(--success-500); display: flex; justify-content: space-between; align-items: center;">
                                                <span style="font-size: 11px;"> Qualification</span>
                                                <span style="font-size: 10px; color: var(--text-muted);">2 assigned</span>
                                            </div>
                                            <div style="background: var(--surface-50); padding: var(--spacing-xs) var(--spacing-sm); border-radius: var(--radius-xs); border-left: 3px solid var(--primary-400); display: flex; justify-content: space-between; align-items: center;">
                                                <span style="font-size: 11px;"> Technical</span>
                                                <span style="font-size: 10px; color: var(--text-muted);">By Lot</span>
                                            </div>
                                            <div style="background: var(--surface-50); padding: var(--spacing-xs) var(--spacing-sm); border-radius: var(--radius-xs); border-left: 3px solid var(--surface-300); display: flex; justify-content: space-between; align-items: center;">
                                                <span style="font-size: 11px;"> Financial</span>
                                                <span style="font-size: 10px; color: var(--text-muted);">Not assigned</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Lot/Supplier Assignments -->
                                    <div style="font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--spacing-xs);">
                                        Lot Assignments
                                    </div>
                                    <div style="display: grid; gap: var(--spacing-xs);">
                                        <div style="background: var(--surface-50); padding: var(--spacing-sm); border-radius: var(--radius-xs);">
                                            <div style="font-weight: 600; font-size: 11px; margin-bottom: 2px;"> Lot 1: PPE</div>
                                            <div style="font-size: 10px; color: var(--text-muted);">John Smith, Maria Garcia</div>
                                        </div>
                                        <div style="background: var(--surface-50); padding: var(--spacing-sm); border-radius: var(--radius-xs);">
                                            <div style="font-weight: 600; font-size: 11px; margin-bottom: 2px;"> Lot 2: Medical Consumables</div>
                                            <div style="font-size: 10px; color: var(--text-muted);">Sarah Johnson, David Lee</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon"></span>
                                Quick Actions
                            </h3>
                            <button class="btn btn-secondary" style="width: 100%; margin-bottom: var(--spacing-sm);">
                                <i class="pi pi-download"></i> Download Package
                            </button>
                            <button class="btn btn-secondary" style="width: 100%; margin-bottom: var(--spacing-sm);">
                                <i class="pi pi-users"></i> View Participants
                            </button>
                            <button class="btn btn-secondary" style="width: 100%;">
                                <i class="pi pi-history"></i> View History
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Tender Details View -->

            <!-- Bid Opening View -->
            <div class="view-section" id="view-bid-opening">
                <!-- Bid Opening Header -->
                <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-xl); box-shadow: var(--shadow-card); border: 1px solid var(--surface-200); margin-bottom: var(--spacing-xl);">
                    <button class="btn btn-secondary" onclick="showDashboard()" style="margin-bottom: var(--spacing-md);">
                        <i class="pi pi-arrow-left"></i> Back to Dashboard
                    </button>
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: var(--spacing-md);">
                        <div>
                            <h1 style="font-size: 24px; font-weight: 600; color: var(--primary-400); margin-bottom: var(--spacing-sm);" id="bid-opening-tender-title">
                                Tender Bid Opening
                            </h1>
                            <div style="display: flex; align-items: center; gap: var(--spacing-md); flex-wrap: wrap;">
                                <span id="bid-opening-tender-ref" style="font-size: 13px; color: var(--text-muted);">Reference: ITB/2024/089</span>
                                <span style="padding: 4px 12px; background: var(--warning-100); color: var(--warning-600); border-radius: var(--radius-sm); font-size: 11px; font-weight: 600;" id="bid-opening-status">
                                     Opening in Progress
                                </span>
                                <span id="bid-opening-type-badge" style="padding: 4px 12px; background: var(--primary-50); color: var(--primary-500); border-radius: var(--radius-sm); font-size: 11px; font-weight: 600;">
                                    ITB - Single Report
                                </span>
                            </div>
                        </div>
                        <div style="display: flex; gap: var(--spacing-sm);">
                            <button class="btn btn-secondary" onclick="showBidOpeningSettings()">
                                <i class="pi pi-cog"></i> Settings
                            </button>
                            <button class="btn btn-secondary" onclick="downloadBidOpeningReport('pdf')">
                                <i class="pi pi-file-pdf"></i> Download PDF
                            </button>
                            <button class="btn btn-secondary" onclick="downloadBidOpeningReport('excel')">
                                <i class="pi pi-file-excel"></i> Download Excel
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bid Opening Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-xl);">
                    <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-lg); box-shadow: var(--shadow-card); border-left: 4px solid var(--primary-400);">
                        <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Total Submissions</div>
                        <div id="bid-opening-total-bids" style="font-size: 28px; font-weight: 700; color: var(--primary-500);">6</div>
                    </div>
                    <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-lg); box-shadow: var(--shadow-card); border-left: 4px solid var(--success-400);">
                        <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Lowest Offer</div>
                        <div id="bid-opening-lowest-offer" style="font-size: 20px; font-weight: 700; color: var(--success-500);">$115,200</div>
                        <div style="font-size: 10px; color: var(--text-muted);">HealthCare Corp.</div>
                    </div>
                    <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-lg); box-shadow: var(--shadow-card); border-left: 4px solid var(--info-400);">
                        <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Budget Estimate</div>
                        <div id="bid-opening-budget" style="font-size: 20px; font-weight: 700; color: var(--info-500);">$150,000</div>
                        <div style="font-size: 10px; color: var(--text-muted);">Reference budget</div>
                    </div>
                    <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-lg); box-shadow: var(--shadow-card); border-left: 4px solid var(--warning-400);">
                        <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Bid Opening Panel</div>
                        <div id="bid-opening-panel-status" style="font-size: 16px; font-weight: 600; color: var(--warning-500);">Not Required</div>
                        <button class="btn btn-secondary btn-sm" onclick="setupBidOpeningPanel()" style="margin-top: 8px; font-size: 10px;">
                            <i class="pi pi-users"></i> Setup Panel
                        </button>
                    </div>
                </div>

                <!-- Bid Opening Info Banner -->
                <div id="bid-opening-info-banner" style="background: linear-gradient(135deg, var(--info-50) 0%, var(--primary-50) 100%); border: 1px solid var(--info-200); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-xl); display: flex; align-items: center; gap: var(--spacing-md);">
                    <div style="width: 50px; height: 50px; background: var(--info-100); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="pi pi-info-circle" style="font-size: 24px; color: var(--info-500);"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">Virtual Bid Opening</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            All bids have been securely received and are now available for opening. Once finalized, the Bid Opening Report will be automatically shared with all bidders who submitted offers.
                            The evaluation team will gain access to bid details only after this process is finalized.
                        </div>
                    </div>
                </div>

                <!-- Confidentiality Settings Panel (Collapsible) -->
                <div style="background: var(--surface-0); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); margin-bottom: var(--spacing-xl); overflow: hidden;">
                    <div onclick="toggleBidOpeningSection('confidentiality')" style="padding: var(--spacing-lg); background: var(--surface-50); cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                        <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                            <i class="pi pi-lock" style="color: var(--warning-500);"></i>
                            <span style="font-weight: 600; color: var(--text-primary);">Pricing Confidentiality Settings</span>
                            <span style="font-size: 10px; padding: 2px 8px; background: var(--warning-100); color: var(--warning-600); border-radius: var(--radius-xs);">Configure before finalizing</span>
                        </div>
                        <i id="confidentiality-icon" class="pi pi-chevron-down" style="color: var(--text-muted); transition: transform 0.2s;"></i>
                    </div>
                    <div id="confidentiality-content" style="padding: var(--spacing-lg); display: none;">
                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
                            Configure which information will be visible to bidders in the external Bid Opening Report. Hidden fields require justification and will be included in the Evaluation Report.
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-md);">
                            <label style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); cursor: pointer;">
                                <input type="checkbox" id="show-financial-offer" checked style="accent-color: var(--primary-500);">
                                <span style="font-size: 13px;">Show Total Financial Offer</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); cursor: pointer;">
                                <input type="checkbox" id="show-bidder-name" checked style="accent-color: var(--primary-500);">
                                <span style="font-size: 13px;">Show Bidder Name</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); cursor: pointer;">
                                <input type="checkbox" id="show-ungm-number" checked style="accent-color: var(--primary-500);">
                                <span style="font-size: 13px;">Show UNGM Number</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); cursor: pointer;">
                                <input type="checkbox" id="show-discounts" checked style="accent-color: var(--primary-500);">
                                <span style="font-size: 13px;">Show Discounts</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); cursor: pointer;">
                                <input type="checkbox" id="show-bidder-comments" checked style="accent-color: var(--primary-500);">
                                <span style="font-size: 13px;">Show Bidder Comments</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); cursor: pointer;">
                                <input type="checkbox" id="show-budget-estimate" style="accent-color: var(--primary-500);">
                                <span style="font-size: 13px;">Show Budget Estimate</span>
                            </label>
                        </div>
                        <div style="margin-top: var(--spacing-lg);">
                            <label style="font-size: 12px; font-weight: 500; color: var(--text-primary); display: block; margin-bottom: var(--spacing-xs);">
                                Justification for hidden fields (required if any field is hidden):
                            </label>
                            <textarea id="confidentiality-justification" placeholder="Provide justification for hiding any pricing or identity information from bidders..." style="width: 100%; padding: var(--spacing-sm); border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 12px; resize: vertical; min-height: 60px;"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Bid Opening Panel Section (Collapsible) -->
                <div id="bid-opening-panel-section" style="background: var(--surface-0); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); margin-bottom: var(--spacing-xl); overflow: hidden; display: none;">
                    <div onclick="toggleBidOpeningSection('panel')" style="padding: var(--spacing-lg); background: var(--surface-50); cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                        <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                            <i class="pi pi-users" style="color: var(--primary-500);"></i>
                            <span style="font-weight: 600; color: var(--text-primary);">Bid Opening Panel</span>
                            <span id="panel-members-count" style="font-size: 10px; padding: 2px 8px; background: var(--primary-100); color: var(--primary-600); border-radius: var(--radius-xs);">3 Members</span>
                        </div>
                        <i id="panel-icon" class="pi pi-chevron-down" style="color: var(--text-muted); transition: transform 0.2s;"></i>
                    </div>
                    <div id="panel-content" style="padding: var(--spacing-lg); display: none;">
                        <div id="panel-members-list" style="display: grid; gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                            <!-- Panel members will be rendered here -->
                        </div>
                        <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                            <label style="font-size: 12px; font-weight: 500; color: var(--text-primary); display: block; margin-bottom: var(--spacing-xs);">
                                Panel Remarks (visible in final report):
                            </label>
                            <textarea id="panel-remarks" placeholder="Add remarks about the bid opening process..." style="width: 100%; padding: var(--spacing-sm); border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 12px; resize: vertical; min-height: 80px;"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Bid Opening Report Table -->
                <div style="background: var(--surface-0); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); overflow: hidden;">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--surface-200); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-md);">
                        <div>
                            <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: var(--text-primary);"> Bid Opening Report</h3>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                                Bids ranked from lowest to highest based on total financial offer
                            </div>
                        </div>
                        <div style="display: flex; gap: var(--spacing-sm); align-items: center;">
                            <span style="font-size: 11px; color: var(--text-muted);">Tender closed:</span>
                            <span id="bid-opening-close-date" style="font-size: 11px; font-weight: 600; color: var(--text-primary);">Dec 1, 2024, 14:00 UTC</span>
                        </div>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table id="bid-opening-table" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: var(--surface-50);">
                                    <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--surface-200); width: 50px;">Rank</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--surface-200);">Vendor</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--surface-200); width: 100px;">UNGM #</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--surface-200); width: 100px;">Country</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--surface-200); width: 80px;">Women Owned</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--surface-200); width: 80px;">JV/Consortia</th>
                                    <th style="padding: 12px; text-align: right; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--surface-200); width: 130px;">Total Offer</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--surface-200); width: 70px;">Currency</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--surface-200); width: 140px;">Submitted</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--surface-200); width: 90px;">Sanction</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--surface-200); width: 80px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bid-opening-table-body">
                                <!-- Bid rows will be rendered here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Bidder Comments Section -->
                    <div style="padding: var(--spacing-lg); border-top: 1px solid var(--surface-200);">
                        <h4 style="margin: 0 0 var(--spacing-md) 0; font-size: 14px; font-weight: 600; color: var(--text-primary);"> Bidder Comments</h4>
                        <div id="bidder-comments-list" style="display: grid; gap: var(--spacing-sm);">
                            <!-- Bidder comments will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Finalization Actions -->
                <div style="background: var(--surface-0); border-radius: var(--radius-lg); box-shadow: var(--shadow-card); padding: var(--spacing-xl); margin-top: var(--spacing-xl); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-md);">
                    <div>
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">Ready to finalize?</div>
                        <div style="font-size: 12px; color: var(--text-muted);">
                            Once finalized, the Bid Opening Report will be shared with all bidders and the evaluation team will gain access to submissions.
                        </div>
                    </div>
                    <div style="display: flex; gap: var(--spacing-sm);">
                        <button class="btn btn-secondary" onclick="saveBidOpeningDraft()">
                            <i class="pi pi-save"></i> Save Draft
                        </button>
                        <button class="btn btn-success" onclick="finalizeBidOpening()" style="background: linear-gradient(135deg, var(--success-500) 0%, var(--success-400) 100%);">
                            <i class="pi pi-check-circle"></i> Finalize Bid Opening
                        </button>
                    </div>
                </div>
            </div>
            <!-- End Bid Opening View -->

            <!-- Evaluation View -->
            <div class="view-section" id="view-evaluation">
                <!-- Floating Collaborative Whiteboard Panel -->
                <div id="collabWhiteboardBtn" class="collab-whiteboard-btn" onclick="toggleCollabWhiteboard()" title="Team Collaboration Board" aria-label="Open Team Collaboration Board">
                    <div class="collab-btn-icon">
                        <i class="pi pi-users"></i>
                    </div>
                    <div class="collab-btn-badge" id="collabNotificationBadge">3</div>
                    <div class="collab-btn-label">Team<br>Board</div>
                </div>

                <div id="collabWhiteboardPanel" class="collab-whiteboard-panel">
                    <div class="collab-panel-header">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <div style="width: 36px; height: 36px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="pi pi-users" style="color: white; font-size: 16px;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 14px; color: white;">Team Collaboration</div>
                                <div style="font-size: 11px; color: rgba(255,255,255,0.8);">Evaluation Panel Discussion</div>
                            </div>
                        </div>
                        <button onclick="toggleCollabWhiteboard()" style="background: none; border: none; cursor: pointer; padding: 4px;" aria-label="Close panel">
                            <i class="pi pi-times" style="color: rgba(255,255,255,0.8); font-size: 16px;"></i>
                        </button>
                    </div>
                    
                    <!-- Online Team Members -->
                    <div style="padding: var(--spacing-md); background: var(--surface-50); border-bottom: 1px solid var(--surface-200);">
                        <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 8px;">Team Members Online:</div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 6px; padding: 4px 10px; background: white; border-radius: 20px; border: 1px solid var(--surface-200);">
                                <div style="width: 8px; height: 8px; background: var(--success-500); border-radius: 50%;"></div>
                                <span style="font-size: 11px; font-weight: 500;">Jane Doe (You)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px; padding: 4px 10px; background: white; border-radius: 20px; border: 1px solid var(--surface-200);">
                                <div style="width: 8px; height: 8px; background: var(--success-500); border-radius: 50%;"></div>
                                <span style="font-size: 11px;">Sarah Chen</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px; padding: 4px 10px; background: white; border-radius: 20px; border: 1px solid var(--surface-200);">
                                <div style="width: 8px; height: 8px; background: var(--text-muted); border-radius: 50%;"></div>
                                <span style="font-size: 11px; color: var(--text-muted);">Ahmed H.</span>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Navigation -->
                    <div style="display: flex; border-bottom: 1px solid var(--surface-200); background: var(--surface-0);">
                        <button class="collab-tab active" onclick="switchCollabTab('discussion')" id="tab-discussion">
                             Discussion
                        </button>
                        <button class="collab-tab" onclick="switchCollabTab('questions')" id="tab-questions">
                             Questions <span class="collab-tab-badge">2</span>
                        </button>
                        <button class="collab-tab" onclick="switchCollabTab('notes')" id="tab-notes">
                             Notes
                        </button>
                        <button class="collab-tab" onclick="switchCollabTab('decisions')" id="tab-decisions">
                             Decisions
                        </button>
                    </div>
                    
                    <div class="collab-panel-content">
                        <!-- Discussion Tab -->
                        <div id="collab-discussion" class="collab-tab-content active">
                            <div class="collab-message-list" id="collabMessageList">
                                <div class="collab-message">
                                    <div class="collab-message-avatar" style="background: var(--info-100); color: var(--info-600);">SC</div>
                                    <div class="collab-message-content">
                                        <div class="collab-message-header">
                                            <span class="collab-message-author">Sarah Chen</span>
                                            <span class="collab-message-time">10:32 AM</span>
                                        </div>
                                        <div class="collab-message-text">Has anyone reviewed the ISO certificates from MedSupply? The expiry date seems close.</div>
                                    </div>
                                </div>
                                <div class="collab-message">
                                    <div class="collab-message-avatar" style="background: var(--success-100); color: var(--success-600);">JD</div>
                                    <div class="collab-message-content">
                                        <div class="collab-message-header">
                                            <span class="collab-message-author">Jane Doe</span>
                                            <span class="collab-message-time">10:35 AM</span>
                                        </div>
                                        <div class="collab-message-text">Yes, I checked - it's valid until March 2026. We're good. </div>
                                    </div>
                                </div>
                                <div class="collab-message">
                                    <div class="collab-message-avatar" style="background: var(--warning-100); color: var(--warning-600);">SC</div>
                                    <div class="collab-message-content">
                                        <div class="collab-message-header">
                                            <span class="collab-message-author">Sarah Chen</span>
                                            <span class="collab-message-time">10:38 AM</span>
                                        </div>
                                        <div class="collab-message-text">Great! Also, HealthCare Corp's pricing seems significantly lower. Should we flag for detailed review?</div>
                                    </div>
                                </div>
                                <div class="collab-message system-message">
                                    <i class="pi pi-info-circle"></i>
                                    <span>Ahmed Hassan joined the evaluation panel</span>
                                    <span class="collab-message-time">11:00 AM</span>
                                </div>
                            </div>
                        </div>

                        <!-- Questions Tab -->
                        <div id="collab-questions" class="collab-tab-content">
                            <div class="collab-question-list">
                                <div class="collab-question-item pending">
                                    <div class="collab-question-header">
                                        <span class="collab-question-badge pending"> Pending</span>
                                        <span class="collab-question-from">From: Jane Doe</span>
                                    </div>
                                    <div class="collab-question-text">
                                        @Sarah - Can you verify the manufacturer authorization for MedTech Inc.? Form D looks incomplete.
                                    </div>
                                    <div class="collab-question-meta">
                                        <span>Re: Qualification Criteria  Supplier: MedTech Inc.</span>
                                        <span>2 hours ago</span>
                                    </div>
                                    <div class="collab-question-actions">
                                        <button class="btn btn-sm btn-primary" onclick="respondToQuestion(1)">Respond</button>
                                        <button class="btn btn-sm btn-secondary" onclick="viewQuestionContext(1)">View Context</button>
                                    </div>
                                </div>
                                <div class="collab-question-item answered">
                                    <div class="collab-question-header">
                                        <span class="collab-question-badge answered"> Answered</span>
                                        <span class="collab-question-from">From: Sarah Chen</span>
                                    </div>
                                    <div class="collab-question-text">
                                        @Team - What's the consensus on the pricing deviation from HealthCare Corp? 15% below estimate.
                                    </div>
                                    <div class="collab-question-answer">
                                        <strong>Answer (Jane Doe):</strong> Price is justified by their manufacturing location. Recommend proceeding but flagging for price reasonableness check in financial evaluation.
                                    </div>
                                    <div class="collab-question-meta">
                                        <span>Re: Technical Evaluation  General</span>
                                        <span>Yesterday</span>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="createNewQuestion()" style="width: 100%; margin-top: var(--spacing-md);">
                                <i class="pi pi-plus"></i> Ask New Question
                            </button>
                        </div>

                        <!-- Notes Tab -->
                        <div id="collab-notes" class="collab-tab-content">
                            <div class="collab-notes-area">
                                <div class="collab-note-item">
                                    <div class="collab-note-header">
                                        <span style="font-weight: 600;"> Key Observations</span>
                                        <span class="collab-note-author">Jane Doe</span>
                                    </div>
                                    <div class="collab-note-text">
                                         MedSupply - Strong technical compliance, all certs valid<br>
                                         HealthCare Corp - Lowest price, need price justification<br>
                                         MedTech - Premium quality, higher price point
                                    </div>
                                    <div class="collab-note-time">Updated 30 min ago</div>
                                </div>
                                <div class="collab-note-item">
                                    <div class="collab-note-header">
                                        <span style="font-weight: 600;"> Flags for Discussion</span>
                                        <span class="collab-note-author">Sarah Chen</span>
                                    </div>
                                    <div class="collab-note-text">
                                        1. Global Medical Solutions JV structure - verify all partners<br>
                                        2. EuroMed currency (EUR) - confirm exchange rate date<br>
                                        3. MediCare sanction check pending
                                    </div>
                                    <div class="collab-note-time">Updated 1 hour ago</div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="addCollabNote()" style="width: 100%; margin-top: var(--spacing-md);">
                                <i class="pi pi-plus"></i> Add Note
                            </button>
                        </div>

                        <!-- Decisions Tab -->
                        <div id="collab-decisions" class="collab-tab-content">
                            <div class="collab-decisions-list">
                                <div class="collab-decision-item">
                                    <div class="collab-decision-status approved"> Agreed</div>
                                    <div class="collab-decision-content">
                                        <div class="collab-decision-title">MedSupply Ltd. passes Eligibility & Formal</div>
                                        <div class="collab-decision-votes">
                                            <span class="vote-yes"> Jane, Sarah</span>
                                            <span class="vote-pending"> Ahmed (pending)</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="collab-decision-item">
                                    <div class="collab-decision-status approved"> Agreed</div>
                                    <div class="collab-decision-content">
                                        <div class="collab-decision-title">HealthCare Corp. pricing requires justification memo</div>
                                        <div class="collab-decision-votes">
                                            <span class="vote-yes"> Jane, Sarah, Ahmed</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="collab-decision-item">
                                    <div class="collab-decision-status pending"> Voting</div>
                                    <div class="collab-decision-content">
                                        <div class="collab-decision-title">Request clarification from MedTech on Form D</div>
                                        <div class="collab-decision-votes">
                                            <span class="vote-yes"> Jane</span>
                                            <span class="vote-pending"> Sarah, Ahmed</span>
                                        </div>
                                        <div class="collab-decision-actions">
                                            <button class="btn btn-sm btn-success" onclick="voteDecision(3, 'yes')"> Agree</button>
                                            <button class="btn btn-sm btn-danger" onclick="voteDecision(3, 'no')"> Disagree</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="proposeDecision()" style="width: 100%; margin-top: var(--spacing-md);">
                                <i class="pi pi-plus"></i> Propose Decision
                            </button>
                        </div>
                    </div>

                    <!-- Message Input -->
                    <div class="collab-panel-footer">
                        <div style="display: flex; gap: var(--spacing-sm);">
                            <input type="text" id="collabMessageInput" placeholder="Type a message to the team..." style="flex: 1; padding: 10px 12px; border: 1px solid var(--surface-300); border-radius: var(--radius-md); font-size: 13px;" aria-label="Team message">
                            <button onclick="sendCollabMessage()" style="background: var(--primary-500); color: white; border: none; padding: 10px 16px; border-radius: var(--radius-md); cursor: pointer;">
                                <i class="pi pi-send"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Floating Supplier Submission Panel -->
                <div id="supplierDocsFloatingBtn" class="supplier-docs-floating-btn" onclick="toggleSupplierDocsPanel()" title="View Supplier Submission" aria-label="View Supplier Submission">
                    <div class="floating-btn-icon">
                        <i class="pi pi-folder-open"></i>
                    </div>
                    <div class="floating-btn-badge" id="supplierDocsBadge">12</div>
                    <div class="floating-btn-label">Supplier<br>Submission</div>
                </div>

                <div id="supplierDocsPanel" class="supplier-docs-panel">
                    <div class="supplier-docs-panel-header">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <div style="width: 36px; height: 36px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="pi pi-folder-open" style="color: white; font-size: 16px;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 14px; color: white;">Supplier Submission</div>
                                <div style="font-size: 11px; color: rgba(255,255,255,0.8);" id="supplierDocsPanelVendor">MedSupply Ltd.</div>
                            </div>
                        </div>
                        <button onclick="toggleSupplierDocsPanel()" style="background: none; border: none; cursor: pointer; padding: 4px;" aria-label="Close panel">
                            <i class="pi pi-times" style="color: rgba(255,255,255,0.8); font-size: 16px;"></i>
                        </button>
                    </div>
                    
                    <!-- Supplier Selector Filter -->
                    <div style="padding: var(--spacing-md); background: var(--surface-50); border-bottom: 1px solid var(--surface-200);">
                        <label style="font-size: 11px; color: var(--text-muted); display: block; margin-bottom: 6px;">Select Supplier:</label>
                        <select id="supplierDocsSelector" onchange="switchSupplierDocs(this.value)" style="width: 100%; padding: 10px 12px; border: 1px solid var(--surface-300); border-radius: var(--radius-md); font-size: 13px; background: white; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 12 12\"><path fill=\"%23666\" d=\"M6 8L1 3h10z\"/></svg>'); background-repeat: no-repeat; background-position: right 12px center;">
                            <option value="vendor1" selected> MedSupply Ltd. (UNGM: 309663)</option>
                            <option value="vendor2"> HealthCare Corp. (UNGM: 301245)</option>
                            <option value="vendor3"> MedTech Inc. (UNGM: 315789)</option>
                            <option value="vendor4"> Global Medical Solutions (UNGM: 298456)</option>
                            <option value="vendor5"> EuroMed Supplies (UNGM: 312890)</option>
                            <option value="vendor6"> MediCare International (UNGM: 305672)</option>
                        </select>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                            <span style="font-size: 10px; color: var(--text-muted);" id="supplierSubmissionDate">Submitted: Dec 1, 2024, 12:30 UTC</span>
                            <span style="font-size: 10px; padding: 2px 8px; background: var(--success-100); color: var(--success-600); border-radius: var(--radius-xs);"> Complete</span>
                        </div>
                    </div>
                    
                    <div class="supplier-docs-panel-content">
                        <!-- Forms Section -->
                        <div class="supplier-docs-section">
                            <div class="supplier-docs-section-header" onclick="toggleDocsSection('forms')">
                                <span><i class="pi pi-file-edit"></i> Submission Forms</span>
                                <span class="docs-count-badge" id="formsCount">5</span>
                                <i class="pi pi-chevron-down docs-section-icon" id="forms-icon"></i>
                            </div>
                            <div class="supplier-docs-section-content" id="forms-content">
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('Form_A_Bid_Submission.pdf')">
                                    <div class="doc-icon pdf"><i class="pi pi-file-pdf"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">Form A - Bid Submission</div>
                                        <div class="doc-meta">PDF  245 KB  Dec 1, 2024</div>
                                    </div>
                                    <button class="doc-action-btn" title="Preview"><i class="pi pi-eye"></i></button>
                                </div>
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('Form_B_Pricing.xlsx')">
                                    <div class="doc-icon excel"><i class="pi pi-file-excel"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">Form B - Pricing Schedule</div>
                                        <div class="doc-meta">Excel  156 KB  Dec 1, 2024</div>
                                    </div>
                                    <button class="doc-action-btn" title="Preview"><i class="pi pi-eye"></i></button>
                                </div>
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('Form_C_Technical.pdf')">
                                    <div class="doc-icon pdf"><i class="pi pi-file-pdf"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">Form C - Technical Specifications</div>
                                        <div class="doc-meta">PDF  1.2 MB  Dec 1, 2024</div>
                                    </div>
                                    <button class="doc-action-btn" title="Preview"><i class="pi pi-eye"></i></button>
                                </div>
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('Form_D_Manufacturer_Auth.pdf')">
                                    <div class="doc-icon pdf"><i class="pi pi-file-pdf"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">Form D - Manufacturer Authorization</div>
                                        <div class="doc-meta">PDF  89 KB  Dec 1, 2024</div>
                                    </div>
                                    <button class="doc-action-btn" title="Preview"><i class="pi pi-eye"></i></button>
                                </div>
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('Form_E_Experience.pdf')">
                                    <div class="doc-icon pdf"><i class="pi pi-file-pdf"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">Form E - Business Experience</div>
                                        <div class="doc-meta">PDF  312 KB  Dec 1, 2024</div>
                                    </div>
                                    <button class="doc-action-btn" title="Preview"><i class="pi pi-eye"></i></button>
                                </div>
                            </div>
                        </div>

                        <!-- Certificates Section -->
                        <div class="supplier-docs-section">
                            <div class="supplier-docs-section-header" onclick="toggleDocsSection('certificates')">
                                <span><i class="pi pi-verified"></i> Certificates & Licenses</span>
                                <span class="docs-count-badge" id="certificatesCount">4</span>
                                <i class="pi pi-chevron-down docs-section-icon" id="certificates-icon"></i>
                            </div>
                            <div class="supplier-docs-section-content collapsed" id="certificates-content">
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('ISO_13485_Certificate.pdf')">
                                    <div class="doc-icon pdf"><i class="pi pi-file-pdf"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">ISO 13485 Certificate</div>
                                        <div class="doc-meta">PDF  567 KB  Valid until 2026</div>
                                    </div>
                                    <button class="doc-action-btn" title="Preview"><i class="pi pi-eye"></i></button>
                                </div>
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('CE_Marking.pdf')">
                                    <div class="doc-icon pdf"><i class="pi pi-file-pdf"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">CE Marking Declaration</div>
                                        <div class="doc-meta">PDF  234 KB  Dec 1, 2024</div>
                                    </div>
                                    <button class="doc-action-btn" title="Preview"><i class="pi pi-eye"></i></button>
                                </div>
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('Business_License.pdf')">
                                    <div class="doc-icon pdf"><i class="pi pi-file-pdf"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">Business Registration License</div>
                                        <div class="doc-meta">PDF  178 KB  Valid until 2025</div>
                                    </div>
                                    <button class="doc-action-btn" title="Preview"><i class="pi pi-eye"></i></button>
                                </div>
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('GMP_Certificate.pdf')">
                                    <div class="doc-icon pdf"><i class="pi pi-file-pdf"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">GMP Certificate</div>
                                        <div class="doc-meta">PDF  445 KB  Valid until 2025</div>
                                    </div>
                                    <button class="doc-action-btn" title="Preview"><i class="pi pi-eye"></i></button>
                                </div>
                            </div>
                        </div>

                        <!-- Technical Documents Section -->
                        <div class="supplier-docs-section">
                            <div class="supplier-docs-section-header" onclick="toggleDocsSection('technical')">
                                <span><i class="pi pi-cog"></i> Technical Documents</span>
                                <span class="docs-count-badge" id="technicalCount">3</span>
                                <i class="pi pi-chevron-down docs-section-icon" id="technical-icon"></i>
                            </div>
                            <div class="supplier-docs-section-content collapsed" id="technical-content">
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('Product_Catalog.pdf')">
                                    <div class="doc-icon pdf"><i class="pi pi-file-pdf"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">Product Catalog 2024</div>
                                        <div class="doc-meta">PDF  8.5 MB  Dec 1, 2024</div>
                                    </div>
                                    <button class="doc-action-btn" title="Preview"><i class="pi pi-eye"></i></button>
                                </div>
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('Test_Reports.pdf')">
                                    <div class="doc-icon pdf"><i class="pi pi-file-pdf"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">Laboratory Test Reports</div>
                                        <div class="doc-meta">PDF  2.3 MB  Nov 2024</div>
                                    </div>
                                    <button class="doc-action-btn" title="Preview"><i class="pi pi-eye"></i></button>
                                </div>
                                <div class="supplier-doc-item" onclick="previewDocumentOnline('Spec_Sheets.zip')">
                                    <div class="doc-icon zip"><i class="pi pi-file"></i></div>
                                    <div class="doc-info">
                                        <div class="doc-name">Product Specification Sheets</div>
                                        <div class="doc-meta">ZIP  4.7 MB  Dec 1, 2024</div>
                                    </div>
                                    <button class="doc-action-btn" title="Download"><i class="pi pi-download"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="supplier-docs-panel-footer">
                        <button class="btn btn-secondary btn-sm" onclick="downloadAllSupplierDocs()" style="width: 100%;">
                            <i class="pi pi-download"></i> Download All Documents
                        </button>
                    </div>
                </div>

                <!-- Evaluation Header -->
                <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-xl); box-shadow: var(--shadow-card); border: 1px solid var(--surface-200); margin-bottom: var(--spacing-xl);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md); flex-wrap: wrap; gap: var(--spacing-sm);">
                        <button class="btn btn-secondary" onclick="showDashboard()">
                            <i class="pi pi-arrow-left"></i> Back to Dashboard
                        </button>
                        <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="downloadEvaluationExcel('all', 'all')">
                                <i class="pi pi-download"></i> Download Excel
                            </button>
                            <button class="btn" onclick="showEvaluationReport()" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); border: none; color: white; padding: 10px 18px; font-weight: 600; border-radius: var(--radius-sm); cursor: pointer;">
                                <i class="pi pi-check-circle"></i> Finish Evaluation & Generate Report
                            </button>
                        </div>
                    </div>
                    <h1 style="font-size: 24px; font-weight: 600; color: var(--primary-400); margin-bottom: var(--spacing-sm);" id="eval-tender-title">
                        ITB/2024/023: Medical Supplies - Emergency Response
                    </h1>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-lg); margin-top: var(--spacing-lg);">
                        <div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-xs);">Evaluation Stage</div>
                            <div style="font-weight: 600; color: var(--text-primary);">Technical Evaluation</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-xs);">Bids Received</div>
                            <div style="font-weight: 600; color: var(--text-primary);">6 Bidders</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-xs);">Your Role</div>
                            <div style="font-weight: 600; color: var(--text-primary);" id="eval-user-role">Evaluator</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-xs);">Progress</div>
                            <div style="font-weight: 600; color: var(--text-primary);">3 of 6 evaluated</div>
                        </div>
                    </div>
                </div>

                <!-- Role Selector for Demo -->
                <div id="role-selector-section" style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-lg); box-shadow: var(--shadow-card); border: 1px solid var(--surface-200); margin-bottom: var(--spacing-xl);">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: var(--spacing-md);"> Switch View Mode</h3>
                    <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                        <button class="btn btn-secondary" id="role-evaluator-btn" onclick="switchEvaluationRole('evaluator')">
                             Evaluator View
                        </button>
                        <button class="btn btn-secondary" id="role-po-btn" onclick="switchEvaluationRole('po')">
                             PO View
                        </button>
                        <button class="btn btn-secondary" id="role-comparison-btn" onclick="switchEvaluationRole('comparison')">
                             Overview Dashboard
                        </button>
                    </div>
                    <p style="font-size: 11px; color: var(--text-muted); margin-top: var(--spacing-sm); margin-bottom: 0;">
                        <strong>Evaluator:</strong> Individual evaluation input | <strong>PO:</strong> Review all evaluators | <strong>Overview:</strong> Complete dashboard with all stages, suppliers & evaluators
                    </p>
                </div>

                <!-- Evaluation Steps Progress -->
                <div id="evaluation-steps-section" style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-xl); box-shadow: var(--shadow-card); border: 1px solid var(--surface-200); margin-bottom: var(--spacing-xl);">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: var(--spacing-lg);">Evaluation Steps</h3>
                    <div style="display: flex; justify-content: space-between; position: relative;">
                        <div style="position: absolute; top: 15px; left: 0; right: 0; height: 2px; background: var(--surface-200); z-index: 0;"></div>
                        
                        <div class="eval-step completed" data-step="1" onclick="switchEvaluationStep(1)">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--success-500); border: 2px solid var(--success-500); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; z-index: 1; position: relative; margin: 0 auto; cursor: pointer;"></div>
                            <div style="font-size: 12px; text-align: center; margin-top: var(--spacing-sm); font-weight: 500; color: var(--success-500);">Eligibility & Formal</div>
                        </div>
                        
                        <div class="eval-step completed" data-step="2" onclick="switchEvaluationStep(2)">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--success-500); border: 2px solid var(--success-500); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; z-index: 1; position: relative; margin: 0 auto; cursor: pointer;"></div>
                            <div style="font-size: 12px; text-align: center; margin-top: var(--spacing-sm); font-weight: 500; color: var(--success-500);">Qualification</div>
                        </div>
                        
                        <div class="eval-step active" data-step="3" onclick="switchEvaluationStep(3)">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary-400); border: 2px solid var(--primary-400); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; z-index: 1; position: relative; margin: 0 auto; cursor: pointer;">3</div>
                            <div style="font-size: 12px; text-align: center; margin-top: var(--spacing-sm); font-weight: 600; color: var(--primary-400);">Technical</div>
                        </div>
                        
                        <div class="eval-step" data-step="4" onclick="switchEvaluationStep(4)">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--surface-0); border: 2px solid var(--surface-200); color: var(--text-muted); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; z-index: 1; position: relative; margin: 0 auto; cursor: pointer;">4</div>
                            <div style="font-size: 12px; text-align: center; margin-top: var(--spacing-sm); font-weight: 500; color: var(--text-muted);">Financial</div>
                        </div>
                    </div>
                </div>

                <!-- View Toggle and Vendor/Lot Tabs -->
                <div style="background: var(--surface-0); padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-lg) var(--radius-lg) 0 0; box-shadow: var(--shadow-card); border: 1px solid var(--surface-200); border-bottom: none; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-md);">
                    <div style="display: flex; gap: var(--spacing-sm); flex: 1;" id="evalTabsContainer">
                        <button class="vendor-eval-tab active" onclick="switchVendorEval('vendor1')">Supplier 1 - MedSupply Ltd.</button>
                        <button class="vendor-eval-tab" onclick="switchVendorEval('vendor2')">Supplier 2 - HealthCare Corp.</button>
                        <button class="vendor-eval-tab" onclick="switchVendorEval('vendor3')">Supplier 3 - MedTech Inc.</button>
                    </div>
                    <div class="view-toggle" id="viewToggle" style="display: none;">
                        <button class="view-toggle-btn active" onclick="switchEvalView('supplier')">
                             Supplier View
                        </button>
                        <button class="view-toggle-btn" onclick="switchEvalView('lot')">
                             Lot View
                        </button>
                    </div>
                </div>

                <!-- Evaluation Content -->
                <div style="background: var(--surface-0); padding: var(--spacing-xl); border-radius: 0 0 var(--radius-lg) var(--radius-lg); box-shadow: var(--shadow-card); border: 1px solid var(--surface-200);" id="evaluation-content-area">
                    <!-- Vendor Info Bar -->
                    <div id="vendor-info-bar" style="background: linear-gradient(135deg, var(--info-50) 0%, var(--primary-50) 100%); padding: var(--spacing-lg); border-radius: var(--radius-md); margin-bottom: var(--spacing-xl); display: flex; gap: var(--spacing-xl); flex-wrap: wrap;">
                        <div>
                            <div style="font-size: 12px; font-weight: 600; color: var(--primary-400); margin-bottom: 2px;">Company Name</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--primary-600);" id="vendor-eval-name">MedSupply Ltd.</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; font-weight: 600; color: var(--primary-400); margin-bottom: 2px;">UNGM Number</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--primary-600);">309663</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; font-weight: 600; color: var(--primary-400); margin-bottom: 2px;">Country</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--primary-600);">Germany</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; font-weight: 600; color: var(--primary-400); margin-bottom: 2px;">Total Bid Price</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--primary-600);">$234,500 USD</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; font-weight: 600; color: var(--primary-400); margin-bottom: 2px;">Price Rank</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--primary-600);">2 of 6</div>
                        </div>
                    </div>

                    <!-- Evaluation Table -->
                    <div style="overflow-x: auto;" id="evaluation-table-container">
                        <!-- Table will be rendered by JavaScript -->
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-xl); padding-top: var(--spacing-lg); border-top: 2px solid var(--surface-200); justify-content: flex-end;">
                        <button class="btn btn-secondary" onclick="saveEvaluationDraft()">
                            <i class="pi pi-save"></i> Save Draft
                        </button>
                        <button class="btn btn-primary" onclick="submitEvaluation()">
                            <i class="pi pi-check"></i> Submit Evaluation
                        </button>
                    </div>
                </div>
            </div>
            <!-- End Evaluation View -->

            <!-- Evaluation Report View -->
            <div class="view-section" id="view-evaluation-report">
                <!-- Report Header Banner - Same style as View Full Details -->
                <div class="tender-info-banner">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: var(--spacing-md);">
                        <div>
                            <div style="font-size: 12px; opacity: 0.8; margin-bottom: 4px;">Reference: ITB/2024/023</div>
                            <h2 style="font-size: 22px; font-weight: 700; margin: 0 0 var(--spacing-sm) 0; display: flex; align-items: center; gap: var(--spacing-sm);">
                                 Evaluation Report
                                <span id="reportStatusBadge" style="padding: 4px 12px; background: rgba(251,191,36,0.3); color: #fcd34d; border-radius: 20px; font-size: 11px; font-weight: 600;">Draft</span>
                            </h2>
                            <p style="opacity: 0.9; font-size: 14px; margin: 0;">Medical Supplies - Emergency Response</p>
                        </div>
                        <div style="display: flex; gap: var(--spacing-sm);">
                            <button onclick="showEvaluation()" style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 14px; border-radius: var(--radius-sm); cursor: pointer; font-size: 13px;">
                                <i class="pi pi-arrow-left"></i> Back
                            </button>
                            <button onclick="saveReportDraft()" style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 14px; border-radius: var(--radius-sm); cursor: pointer; font-size: 13px;">
                                <i class="pi pi-save"></i> Save
                            </button>
                            <button onclick="exportReportPDF()" style="background: white; border: none; color: var(--primary-600); padding: 8px 14px; border-radius: var(--radius-sm); cursor: pointer; font-size: 13px; font-weight: 600;">
                                <i class="pi pi-file-pdf"></i> Export PDF
                            </button>
                        </div>
                    </div>
                    <!-- Quick Summary Bar -->
                    <div class="tender-banner-meta" style="margin-top: var(--spacing-md); padding-top: var(--spacing-md); border-top: 1px solid rgba(255,255,255,0.2);">
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Award Value</span>
                            <span class="banner-meta-value">$362,400</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Lots</span>
                            <span class="banner-meta-value">2</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Awarded Vendors</span>
                            <span class="banner-meta-value">2 of 6</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Business Unit</span>
                            <span class="banner-meta-value">Europe & CIS</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Review Body</span>
                            <span class="banner-meta-value">CPC</span>
                        </div>
                    </div>
                </div>
                
                <!-- Collapse/Expand All Controls -->
                <div style="display: flex; justify-content: flex-end; gap: var(--spacing-sm); margin-bottom: var(--spacing-md);">
                    <button onclick="expandAllReportSections()" style="background: var(--surface-100); border: 1px solid var(--surface-300); color: var(--text-primary); padding: 6px 12px; border-radius: var(--radius-sm); cursor: pointer; font-size: 12px;">
                        <i class="pi pi-angle-double-down"></i> Expand All
                    </button>
                    <button onclick="collapseAllReportSections()" style="background: var(--surface-100); border: 1px solid var(--surface-300); color: var(--text-primary); padding: 6px 12px; border-radius: var(--radius-sm); cursor: pointer; font-size: 12px;">
                        <i class="pi pi-angle-double-up"></i> Collapse All
                    </button>
                </div>

                    <!-- Section 1: Tender and Project Summary -->
                    <div class="report-section-card" style="background: var(--surface-0); border-radius: var(--radius-lg); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); overflow: hidden;">
                        <div class="report-section-header" onclick="toggleReportSection('section-tender-summary')" style="background: var(--surface-50); padding: var(--spacing-md); cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                            <h2 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">1. Tender and Project Summary</h2>
                            <i class="pi pi-chevron-down" id="section-tender-summary-icon" style="transition: transform 0.3s; color: var(--text-muted);"></i>
                        </div>
                        <div id="section-tender-summary" class="report-section-content" style="padding: var(--spacing-xl);">
                            <!-- 1.1 Project Summary -->
                            <h3 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-lg); padding-bottom: var(--spacing-sm); border-bottom: 2px solid var(--primary-100);">1.1 Project Summary</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Project Number(s)</label>
                                    <a href="#" style="font-weight: 600; color: var(--primary-500); text-decoration: none;" id="report-project-number">GEO-PRO-2024</a>
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Project Name(s)</label>
                                    <input type="text" value="Emergency Medical Response Initiative" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-weight: 600;" id="report-project-name">
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Project Impl. End Date(s)</label>
                                    <input type="date" value="2026-06-30" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);" id="report-impl-end">
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Funding Source(s)</label>
                                    <input type="text" value="European Union (EU), SIDA (20%)" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);" id="report-funding">
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">GLA Number(s) from requisition</label>
                                    <a href="#" style="font-weight: 600; color: var(--primary-500); text-decoration: none;" id="report-gla-req">1001-2005A</a>
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">GLA Number(s) for contract(s) - if different</label>
                                    <input type="text" class="form-input" id="report-gla-contract" placeholder="Enter GLA if different..." style="width: 100%; padding: 8px 12px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);">
                                </div>
                            </div>
                            
                            <div style="margin-bottom: var(--spacing-xl);">
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Funding Source(s) Comment</label>
                                <textarea class="form-textarea" rows="2" placeholder="Add any comments regarding funding sources..." style="width: 100%; padding: 10px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);"></textarea>
                            </div>

                            <!-- UNOPS Management Question -->
                            <div style="background: var(--surface-50); padding: var(--spacing-lg); border-radius: var(--radius-md); margin-bottom: var(--spacing-xl);">
                                <label style="font-size: 14px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-md);">Is UNOPS signing and managing the contract?</label>
                                <div style="display: flex; gap: var(--spacing-xl);">
                                    <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                        <input type="radio" name="unopsManagement" value="yes" checked onchange="toggleFundsCheckReport(true)">
                                        <span style="font-weight: 500; color: var(--success-600);">Yes</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                        <input type="radio" name="unopsManagement" value="no" onchange="toggleFundsCheckReport(false)">
                                        <span style="font-weight: 500; color: var(--danger-600);">No</span>
                                    </label>
                                </div>
                                
                                <div id="fundsCheckReportBlock" style="margin-top: var(--spacing-lg); display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg);">
                                    <div id="fundsStatusReportContainer" style="padding: var(--spacing-md); background: var(--success-50); border: 1px solid var(--success-200); border-radius: var(--radius-md); cursor: pointer;" onclick="toggleFundsStatusReport()">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                                <span style="color: var(--success-500); font-size: 18px;"></span>
                                                <span style="font-weight: 500; color: var(--text-primary);">Funds Check Status:</span>
                                            </div>
                                            <span style="font-weight: 700; color: var(--success-600);" id="fundsValueReportDisplay">$386,627.20 USD</span>
                                        </div>
                                        <p style="font-size: 11px; color: var(--text-muted); margin: 4px 0 0 0;">Recommended Total Value (incl. contingency)</p>
                                    </div>
                                    <div id="fundsJustificationReportBlock" style="display: none;">
                                        <label style="font-size: 12px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">Funds Justification *</label>
                                        <textarea rows="3" placeholder="Insufficient funds check is not a stopper, provide justification..." style="width: 100%; padding: 8px; border: 1px solid var(--danger-300); border-radius: var(--radius-sm);"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- 1.2 Tender Summary -->
                            <h3 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-lg); padding-bottom: var(--spacing-sm); border-bottom: 2px solid var(--primary-100);">1.2 Tender Summary</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Tender Reference</label>
                                    <a href="#" style="font-weight: 600; color: var(--primary-500); text-decoration: none;" id="report-tender-ref">ITB/2024/023</a>
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Business Unit</label>
                                    <input type="text" value="Europe & CIS" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);" id="report-business-unit">
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Re-tender?</label>
                                    <label style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                        <input type="checkbox" id="report-retender" onchange="toggleRetenderLessons()">
                                        <span style="font-size: 13px; color: var(--text-primary);">Yes, this is a re-tender</span>
                                    </label>
                                </div>
                                <div id="retenderLessonsBlock" style="display: none;">
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Re-tender lessons learned</label>
                                    <textarea rows="2" placeholder="Lessons learned from previous tender..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);"></textarea>
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Expected Award Date</label>
                                    <input type="date" class="form-input" id="report-award-date" value="2025-05-15" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);" readonly>
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Updated Expected Award Date</label>
                                    <input type="date" class="form-input" id="report-updated-award-date" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);">
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Type of Requirement</label>
                                    <select id="report-requirement-type" onchange="toggleIncotermsReport()" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);">
                                        <option value="goods" selected>Goods</option>
                                        <option value="services">Services</option>
                                        <option value="works">Works</option>
                                        <option value="goods_services">Goods and Services</option>
                                    </select>
                                </div>
                                <div id="incotermsReportBlock">
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Incoterms (2020)</label>
                                    <select id="report-incoterms" onchange="toggleLgApprovalReport()" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);">
                                        <option value="exw">EXW</option>
                                        <option value="fca" selected>FCA</option>
                                        <option value="cpt">CPT</option>
                                        <option value="cip">CIP</option>
                                        <option value="dap">DAP</option>
                                        <option value="dpu">DPU</option>
                                        <option value="ddp">DDP</option>
                                        <option value="fas">FAS</option>
                                        <option value="fob">FOB</option>
                                        <option value="cfr">CFR</option>
                                        <option value="cif">CIF</option>
                                    </select>
                                </div>
                                <div id="lgApprovalReportBlock" style="display: none;">
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">LG Approval (Jira Link)</label>
                                    <input type="text" placeholder="Enter Jira link..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);">
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Contract Vehicle</label>
                                    <select id="report-contract-vehicle" onchange="toggleLtaBusinessCaseReport()" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);">
                                        <option value="po_contract">PO/Contract</option>
                                        <option value="lta">LTA</option>
                                        <option value="lta_po_contract">LTA & Contract</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Linked Cases</label>
                                    <input type="text" value="RFQ/2023/122344" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);">
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Linked Contracts</label>
                                    <a href="#" style="font-weight: 600; color: var(--primary-500); text-decoration: none;">1006083</a>
                                </div>
                            </div>

                            <!-- LTA Business Case -->
                            <div id="ltaBusinessCaseReportBlock" style="display: none; background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg);">
                                <label style="font-size: 12px; font-weight: 600; color: var(--info-700); display: block; margin-bottom: 4px;">LTA Business Case (Jira)</label>
                                <input type="text" placeholder="Enter Jira ticket reference..." style="width: 100%; padding: 8px; border: 1px solid var(--info-200); border-radius: var(--radius-sm);">
                            </div>

                            <!-- Compliance Checks (From Authoring) -->
                            <div style="background: var(--info-50); border: 1px solid var(--info-200); border-radius: var(--radius-md); padding: var(--spacing-sm) var(--spacing-md); margin-bottom: var(--spacing-md);">
                                <p style="font-size: 11px; color: var(--info-600); margin: 0;"><i class="pi pi-info-circle"></i> The following flags are pre-populated from tender authoring</p>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid var(--surface-200);">
                                <div>
                                    <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer; font-weight: 600;">
                                        <input type="checkbox" id="report-epp" onchange="toggleEppFieldsReport(this.checked)">
                                        <span>Tender is under EPP</span>
                                    </label>
                                    <div id="eppFieldsReport" style="display: none; margin-top: var(--spacing-sm); padding-left: var(--spacing-lg); border-left: 2px solid var(--purple-200);">
                                        <div style="margin-bottom: var(--spacing-sm);">
                                            <label style="font-size: 11px; color: var(--purple-600);">Auth (Jira):</label>
                                            <input type="text" style="width: 100%; padding: 4px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 12px;">
                                        </div>
                                        <div>
                                            <label style="font-size: 11px; color: var(--purple-600);">Auth. End Date:</label>
                                            <input type="date" style="width: 100%; padding: 4px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 12px;">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer; font-weight: 600;">
                                        <input type="checkbox" id="report-medical" onchange="toggleMedicalWaiverReport()">
                                        <span>Medical Procurement</span>
                                    </label>
                                    <div id="medicalWaiverReportBlock" style="display: none; margin-top: var(--spacing-sm); padding-left: var(--spacing-lg); border-left: 2px solid var(--teal-200);">
                                        <label style="display: flex; align-items: center; gap: var(--spacing-sm); font-size: 12px;">
                                            <input type="checkbox" id="report-medical-waiver" onchange="toggleWaiverJiraReport()">
                                            <span>Waiver to Annex 2?</span>
                                        </label>
                                        <div id="medicalJiraReportBlock" style="display: none; margin-top: var(--spacing-xs);">
                                            <label style="font-size: 11px; color: var(--orange-600);">Waiver Jira:</label>
                                            <input type="text" style="width: 100%; padding: 4px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 12px;">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer; font-weight: 600;">
                                        <input type="checkbox" id="report-lease" onchange="toggleLeaseDetailsReport()">
                                        <span>Lease</span>
                                    </label>
                                    <div id="leaseDetailsReport" style="display: none; margin-top: var(--spacing-sm); padding-left: var(--spacing-lg); border-left: 2px solid var(--primary-200);">
                                        <div style="margin-bottom: var(--spacing-sm);">
                                            <label style="font-size: 11px; color: var(--text-muted);">SRM Notes:</label>
                                            <textarea rows="1" style="width: 100%; padding: 4px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 12px;"></textarea>
                                        </div>
                                        <div>
                                            <label style="font-size: 11px; color: var(--text-muted);">Attach SRM:</label>
                                            <input type="file" style="font-size: 11px;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Comments -->
                            <div style="margin-top: var(--spacing-xl); background: var(--surface-50); padding: var(--spacing-lg); border-radius: var(--radius-md);">
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-muted); display: block; margin-bottom: var(--spacing-sm);">Additional comments to tender summary:</label>
                                <textarea rows="3" placeholder="Add any specific information related to linked cases, linked contracts or other information..." style="width: 100%; padding: 10px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Section 2: Award Recommendation -->
                    <div class="report-section-card" style="background: var(--surface-0); border-radius: var(--radius-lg); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); overflow: hidden;">
                        <div class="report-section-header" onclick="toggleReportSection('section-award')" style="background: var(--surface-50); padding: var(--spacing-md); cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                            <h2 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">2. Award Recommendation</h2>
                            <i class="pi pi-chevron-down" id="section-award-icon" style="transition: transform 0.3s; color: var(--text-muted);"></i>
                        </div>
                        <div id="section-award" class="report-section-content" style="padding: var(--spacing-lg);">
                            <p style="font-size: 13px; color: var(--text-muted); margin: 0 0 var(--spacing-md) 0;">
                                Project End Date: <strong style="color: var(--text-primary);" id="report-project-end-ref">30/06/2026</strong>
                            </p>
                            
                            <!-- Contract End Date Validation Warning -->
                            <div id="contractEndDateWarning" style="display: none; background: var(--danger-50); border: 1px solid var(--danger-200); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                <p style="font-weight: 600; color: var(--danger-700); margin: 0 0 var(--spacing-sm) 0;"> Estimated contract end date is after project end date:</p>
                                <textarea rows="2" placeholder="Provide justification..." style="width: 100%; padding: 8px; border: 1px solid var(--danger-300); border-radius: var(--radius-sm);"></textarea>
                            </div>
                            
                            <!-- DNP Period Justification -->
                            <div id="dnpJustificationWarning" style="display: none; background: var(--warning-50); border: 1px solid var(--warning-200); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                <p style="font-weight: 600; color: var(--warning-700); margin: 0 0 var(--spacing-sm) 0;"> Justification for reduced DNP period (< 365 days):</p>
                                <textarea rows="2" placeholder="Provide justification for reduced DNP period..." style="width: 100%; padding: 8px; border: 1px solid var(--warning-300); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm);"></textarea>
                                <div>
                                    <label style="font-size: 11px; color: var(--warning-700); display: block; margin-bottom: 4px;">HEA Approval Link:</label>
                                    <input type="text" placeholder="Enter HEA Approval Jira Link..." style="width: 100%; padding: 8px; border: 1px solid var(--warning-300); border-radius: var(--radius-sm);">
                                </div>
                            </div>
                            
                            <!-- Award Table -->
                            <div style="overflow-x: auto; margin-bottom: var(--spacing-lg);">
                                <table class="eval-table" style="min-width: 100%;">
                                    <thead>
                                        <tr style="background: var(--indigo-50);">
                                            <th style="text-align: left; width: 25%;">Vendor Information</th>
                                            <th style="text-align: left; width: 45%;">Lot Details & Timeline</th>
                                            <th style="text-align: right; width: 30%;">Summary Financials</th>
                                        </tr>
                                    </thead>
                                    <tbody id="awardReportTableBody">
                                        <!-- Vendor 1 -->
                                        <tr style="border-bottom: 1px solid var(--surface-200);">
                                            <td style="padding: var(--spacing-md); vertical-align: top; border-right: 1px solid var(--indigo-100);">
                                                <div style="font-weight: 700; font-size: 14px;">MedSupply Ltd.</div>
                                                <div style="font-size: 11px; color: var(--text-muted); font-family: monospace;">UNGM: 309663</div>
                                                <div style="font-size: 11px; color: var(--text-muted);"> Germany</div>
                                            </td>
                                            <td style="padding: var(--spacing-md); vertical-align: top; background: var(--surface-50);">
                                                <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); padding: var(--spacing-md); margin-bottom: var(--spacing-sm);">
                                                    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-100); padding-bottom: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                                                        <span style="font-weight: 600; color: var(--indigo-600);">Lot 1: Personal Protective Equipment</span>
                                                        <span style="font-size: 11px; background: var(--surface-100); padding: 2px 8px; border-radius: var(--radius-xs);">Contract for Goods</span>
                                                    </div>
                                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-sm); font-size: 11px;">
                                                        <div><span style="color: var(--text-muted);">Start:</span><br><strong>01/04/2025</strong></div>
                                                        <div><span style="color: var(--text-muted);">End:</span><br><strong>01/10/2026</strong></div>
                                                        <div><span style="color: var(--text-muted);">Duration:</span><br><strong>548 days</strong></div>
                                                        <div><span style="color: var(--text-muted);">DNP:</span><br><span style="color: var(--text-muted);">N/A</span></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td style="padding: var(--spacing-md); vertical-align: top;">
                                                <div style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-sm); border-bottom: 1px solid var(--surface-100);">
                                                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Total Award</div>
                                                    <div style="font-weight: 700; font-size: 16px;">$118,500.00 <span style="font-size: 11px; color: var(--text-muted);">USD</span></div>
                                                    <div style="font-size: 12px; color: var(--text-muted);">108,500 EUR</div>
                                                </div>
                                                <div>
                                                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Contingency</div>
                                                    <div style="font-weight: 600; font-size: 14px;">$5,000.00 <span style="font-size: 11px; color: var(--text-muted);">USD</span></div>
                                                </div>
                                            </td>
                                        </tr>
                                        <!-- Vendor 2 -->
                                        <tr style="border-bottom: 1px solid var(--surface-200);">
                                            <td style="padding: var(--spacing-md); vertical-align: top; border-right: 1px solid var(--indigo-100);">
                                                <div style="font-weight: 700; font-size: 14px;">HealthCare Corp.</div>
                                                <div style="font-size: 11px; color: var(--text-muted); font-family: monospace;">UNGM: 301245</div>
                                                <div style="font-size: 11px; color: var(--text-muted);"> USA</div>
                                            </td>
                                            <td style="padding: var(--spacing-md); vertical-align: top; background: var(--surface-50);">
                                                <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-sm); padding: var(--spacing-md);">
                                                    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-100); padding-bottom: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                                                        <span style="font-weight: 600; color: var(--indigo-600);">Lot 2: Medical Diagnostic Equipment</span>
                                                        <span style="font-size: 11px; background: var(--surface-100); padding: 2px 8px; border-radius: var(--radius-xs);">Contract for Goods</span>
                                                    </div>
                                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-sm); font-size: 11px;">
                                                        <div><span style="color: var(--text-muted);">Start:</span><br><strong>01/05/2025</strong></div>
                                                        <div><span style="color: var(--text-muted);">End:</span><br><strong>01/05/2026</strong></div>
                                                        <div><span style="color: var(--text-muted);">Duration:</span><br><strong>365 days</strong></div>
                                                        <div><span style="color: var(--text-muted);">DNP:</span><br><span style="color: var(--text-muted);">N/A</span></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td style="padding: var(--spacing-md); vertical-align: top;">
                                                <div style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-sm); border-bottom: 1px solid var(--surface-100);">
                                                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Total Award</div>
                                                    <div style="font-weight: 700; font-size: 16px;">$228,900.00 <span style="font-size: 11px; color: var(--text-muted);">USD</span></div>
                                                    <div style="font-size: 12px; color: var(--text-muted);">210,200 EUR</div>
                                                </div>
                                                <div>
                                                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Contingency</div>
                                                    <div style="font-weight: 600; font-size: 14px;">$10,000.00 <span style="font-size: 11px; color: var(--text-muted);">USD</span></div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr style="background: var(--indigo-100);">
                                            <td colspan="2" style="padding: var(--spacing-md); text-align: right; font-weight: 700; font-size: 14px;">GRAND TOTAL (USD):</td>
                                            <td style="padding: var(--spacing-md); text-align: right; font-weight: 700; font-size: 18px; color: var(--success-600);" id="grandTotalReportAward">$362,400.00</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            
                            <!-- Additional Information -->
                            <div style="background: var(--surface-50); padding: var(--spacing-lg); border-radius: var(--radius-md);">
                                <label style="font-size: 13px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Additional information regarding the recommended award</label>
                                <p style="font-size: 11px; color: var(--text-muted); margin-bottom: var(--spacing-sm);">Include any additional information relevant to the award, such as other relevant costs (reimbursable costs) or any information on quantity changes.</p>
                                <textarea rows="3" placeholder="Add any relevant information..." style="width: 100%; padding: 10px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm);"></textarea>
                                <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                    <label style="font-size: 12px; color: var(--text-muted);">Attach supportive documentation:</label>
                                    <input type="file" style="font-size: 11px;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 3: Competition Analysis -->
                    <div class="report-section-card" style="background: var(--surface-0); border-radius: var(--radius-lg); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); overflow: hidden;">
                        <div class="report-section-header" onclick="toggleReportSection('section-competition')" style="background: var(--surface-50); padding: var(--spacing-md); cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                            <h2 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">3. Competition Analysis</h2>
                            <i class="pi pi-chevron-down" id="section-competition-icon" style="transition: transform 0.3s; color: var(--text-muted);"></i>
                        </div>
                        <div id="section-competition" class="report-section-content" style="padding: var(--spacing-lg);">
                            <div style="display: flex; align-items: center; gap: var(--spacing-md); margin-bottom: var(--spacing-md); flex-wrap: wrap;">
                                <span id="competitionTypeBadge" style="padding: 6px 14px; background: var(--success-100); color: var(--success-700); border-radius: 20px; font-size: 12px; font-weight: 600;">Open Competition</span>
                                <span style="font-size: 12px; color: var(--text-primary);">Solicitation Period: <strong id="report-solicitation-days">21 Days</strong></span>
                            </div>
                            
                            <!-- Reduced Solicitation Warning -->
                            <div id="reducedSolicitationWarning" style="display: none; background: var(--danger-50); border: 1px solid var(--danger-200); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                <p style="font-size: 12px; font-weight: 600; color: var(--danger-700); margin: 0 0 var(--spacing-sm) 0;"> Reduced Solicitation Period (< 15 days)</p>
                                <label style="font-size: 11px; color: var(--danger-600); display: block; margin-bottom: 4px;">Justification (from authoring):</label>
                                <textarea rows="2" style="width: 100%; padding: 8px; border: 1px solid var(--danger-300); border-radius: var(--radius-sm); background: var(--surface-50);" readonly>Urgent medical supplies required due to emergency response needs.</textarea>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Details of market research</label>
                                    <textarea rows="3" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);">Information from tender authoring field - editable</textarea>
                                </div>
                                <div>
                                    <label style="font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 4px;">Justification for Limited Competition</label>
                                    <textarea rows="3" placeholder="If applicable..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);"></textarea>
                                </div>
                            </div>

                            <!-- Invited Bidders Table -->
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: var(--spacing-md); color: var(--text-primary);">Invited Bidders (5)</h4>
                            <div style="overflow-x: auto; margin-bottom: var(--spacing-xl);">
                                <table class="eval-table" style="font-size: 12px;">
                                    <thead>
                                        <tr style="background: var(--surface-50);">
                                            <th style="text-align: left;">Company Name</th>
                                            <th style="text-align: left;">UNGM / Email</th>
                                            <th style="text-align: center;">Participated?</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td>MedSupply Ltd.</td><td>309663</td><td style="text-align: center; color: var(--success-500);"></td></tr>
                                        <tr><td>HealthCare Corp.</td><td>301245</td><td style="text-align: center; color: var(--success-500);"></td></tr>
                                        <tr><td>MedTech Inc.</td><td>315789</td><td style="text-align: center; color: var(--success-500);"></td></tr>
                                        <tr><td>Global Medical Supplies</td><td>998877</td><td style="text-align: center; color: var(--text-muted);">-</td></tr>
                                        <tr><td>PharmaCare Solutions</td><td>info@pharmacare.com</td><td style="text-align: center; color: var(--text-muted);">-</td></tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Lot Bids Summary -->
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: var(--spacing-md); color: var(--text-primary);">Lot Bids Summary</h4>
                            <table class="eval-table" style="margin-bottom: var(--spacing-lg);">
                                <thead>
                                    <tr style="background: var(--purple-50);">
                                        <th style="text-align: left;">Lot # & Name</th>
                                        <th style="text-align: center;">Bids Received</th>
                                        <th style="text-align: center;">Tech. Compliant Bids</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="font-weight: 600; color: var(--text-primary);">1 - Personal Protective Equipment</td>
                                        <td style="text-align: center;">6</td>
                                        <td style="text-align: center;">4</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600; color: var(--text-primary);">2 - Medical Diagnostic Equipment</td>
                                        <td style="text-align: center;">5</td>
                                        <td style="text-align: center;">3</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div>
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">How was effective competition achieved?</label>
                                <textarea rows="3" placeholder="Narrative field describing how effective competition was achieved..." style="width: 100%; padding: 10px; border: 1px solid var(--purple-200); border-radius: var(--radius-sm);"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Section 4: Detailed Evaluation Results -->
                    <div class="report-section-card" style="background: var(--surface-0); border-radius: var(--radius-lg); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); overflow: hidden;">
                        <div class="report-section-header" onclick="toggleReportSection('section-evaluation')" style="background: var(--surface-50); padding: var(--spacing-md); cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                            <h2 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">4. Detailed Evaluation Results</h2>
                            <i class="pi pi-chevron-down" id="section-evaluation-icon" style="transition: transform 0.3s; color: var(--text-muted);"></i>
                        </div>
                        <div id="section-evaluation" class="report-section-content" style="padding: var(--spacing-md);">
                            
                            <!-- Lot 1: Lowest Priced Method -->
                            <div style="border: 2px solid var(--surface-200); border-radius: var(--radius-md); margin-bottom: var(--spacing-md); overflow: hidden;">
                                <div style="background: var(--primary-50); padding: var(--spacing-sm) var(--spacing-md); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                                    <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                        <span style="font-weight: 700; color: var(--text-primary);"> Lot 1: Personal Protective Equipment</span>
                                        <span style="padding: 2px 8px; background: var(--info-100); color: var(--info-700); border-radius: var(--radius-xs); font-size: 10px; font-weight: 600;">LOWEST PRICED</span>
                                    </div>
                                    <span style="font-size: 11px; color: var(--text-muted);">3 Bidders</span>
                                </div>
                                <div style="padding: var(--spacing-sm); overflow-x: auto;">
                                    <table class="eval-table" style="font-size: 11px; margin: 0;">
                                        <thead>
                                            <tr style="background: var(--surface-100);">
                                                <th style="padding: 6px 8px;">Vendor</th>
                                                <th style="padding: 6px 8px;">UNGM</th>
                                                <th style="padding: 6px 8px;">Country</th>
                                                <th style="text-align: center; padding: 6px 8px;">Rank</th>
                                                <th style="text-align: right; padding: 6px 8px;">Bid Amount</th>
                                                <th style="text-align: right; padding: 6px 8px;">Final Amount</th>
                                                <th style="text-align: center; padding: 6px 8px;">Prelim</th>
                                                <th style="text-align: center; padding: 6px 8px;">Technical</th>
                                                <th style="text-align: center; padding: 6px 8px;">Selected</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr style="background: var(--success-50); border-left: 3px solid var(--success-500);">
                                                <td style="padding: 6px 8px; font-weight: 700;">MedSupply Ltd.</td>
                                                <td style="padding: 6px 8px;">309663</td>
                                                <td style="padding: 6px 8px;"> Germany</td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--success-100); color: var(--success-700); padding: 2px 8px; border-radius: 10px; font-weight: 700;">1</span></td>
                                                <td style="text-align: right; padding: 6px 8px;">$118,500</td>
                                                <td style="text-align: right; padding: 6px 8px; font-weight: 700;">$118,500</td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--success-100); color: var(--success-700); padding: 2px 6px; border-radius: var(--radius-xs); font-size: 10px; font-weight: 600;">PASS</span></td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--success-100); color: var(--success-700); padding: 2px 6px; border-radius: var(--radius-xs); font-size: 10px; font-weight: 600;">PASS</span></td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--success-500); color: white; padding: 2px 8px; border-radius: var(--radius-xs); font-size: 10px; font-weight: 700;"> AWARDED</span></td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 6px 8px;">HealthCare Corp.</td>
                                                <td style="padding: 6px 8px;">301245</td>
                                                <td style="padding: 6px 8px;"> USA</td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--surface-200); padding: 2px 8px; border-radius: 10px;">2</span></td>
                                                <td style="text-align: right; padding: 6px 8px;">$125,200</td>
                                                <td style="text-align: right; padding: 6px 8px;">$125,200</td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--success-100); color: var(--success-700); padding: 2px 6px; border-radius: var(--radius-xs); font-size: 10px; font-weight: 600;">PASS</span></td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--success-100); color: var(--success-700); padding: 2px 6px; border-radius: var(--radius-xs); font-size: 10px; font-weight: 600;">PASS</span></td>
                                                <td style="text-align: center; padding: 6px 8px; color: var(--text-muted);">-</td>
                                            </tr>
                                            <tr style="background: var(--danger-50);">
                                                <td style="padding: 6px 8px;">MedTech Inc.</td>
                                                <td style="padding: 6px 8px;">315789</td>
                                                <td style="padding: 6px 8px;"> Japan</td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--surface-200); padding: 2px 8px; border-radius: 10px;">3</span></td>
                                                <td style="text-align: right; padding: 6px 8px;">$132,800</td>
                                                <td style="text-align: right; padding: 6px 8px;">$132,800</td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--success-100); color: var(--success-700); padding: 2px 6px; border-radius: var(--radius-xs); font-size: 10px; font-weight: 600;">PASS</span></td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--danger-100); color: var(--danger-700); padding: 2px 6px; border-radius: var(--radius-xs); font-size: 10px; font-weight: 600;">FAIL</span></td>
                                                <td style="text-align: center; padding: 6px 8px; color: var(--text-muted);">-</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Lot 2: Weighted Criteria Method -->
                            <div style="border: 2px solid var(--surface-200); border-radius: var(--radius-md); margin-bottom: var(--spacing-md); overflow: hidden;">
                                <div style="background: var(--purple-50); padding: var(--spacing-sm) var(--spacing-md); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                                    <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                        <span style="font-weight: 700; color: var(--text-primary);"> Lot 2: Medical Diagnostic Equipment</span>
                                        <span style="padding: 2px 8px; background: var(--purple-100); color: var(--purple-700); border-radius: var(--radius-xs); font-size: 10px; font-weight: 600;">WEIGHTED CRITERIA</span>
                                    </div>
                                    <span style="font-size: 11px; color: var(--text-muted);">Tech 70% / Price 30%</span>
                                </div>
                                <div style="padding: var(--spacing-sm); overflow-x: auto;">
                                    <table class="eval-table" style="font-size: 11px; margin: 0;">
                                        <thead>
                                            <tr style="background: var(--surface-100);">
                                                <th style="padding: 6px 8px;">Vendor</th>
                                                <th style="padding: 6px 8px;">UNGM</th>
                                                <th style="padding: 6px 8px;">Country</th>
                                                <th style="text-align: center; padding: 6px 8px;">Tech Score</th>
                                                <th style="text-align: center; padding: 6px 8px;">Price Score</th>
                                                <th style="text-align: center; padding: 6px 8px; font-weight: 700; background: var(--warning-100);">Combined</th>
                                                <th style="text-align: center; padding: 6px 8px;">Rank</th>
                                                <th style="text-align: right; padding: 6px 8px;">Final Price</th>
                                                <th style="text-align: center; padding: 6px 8px;">Selected</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr style="background: var(--success-50); border-left: 3px solid var(--success-500);">
                                                <td style="padding: 6px 8px; font-weight: 700;">HealthCare Corp.</td>
                                                <td style="padding: 6px 8px;">301245</td>
                                                <td style="padding: 6px 8px;"> USA</td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--success-100); color: var(--success-700); padding: 2px 6px; border-radius: var(--radius-xs); font-weight: 600;">92/100</span></td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--info-100); color: var(--info-700); padding: 2px 6px; border-radius: var(--radius-xs); font-weight: 600;">88/100</span></td>
                                                <td style="text-align: center; padding: 6px 8px; font-weight: 700; background: var(--warning-50);"><span style="background: var(--success-500); color: white; padding: 2px 8px; border-radius: var(--radius-sm); font-weight: 700;">90.8</span></td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--success-100); color: var(--success-700); padding: 2px 8px; border-radius: 10px; font-weight: 700;">1</span></td>
                                                <td style="text-align: right; padding: 6px 8px; font-weight: 700;">$228,900</td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--success-500); color: white; padding: 2px 8px; border-radius: var(--radius-xs); font-size: 10px; font-weight: 700;"> AWARDED</span></td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 6px 8px;">MedSupply Ltd.</td>
                                                <td style="padding: 6px 8px;">309663</td>
                                                <td style="padding: 6px 8px;"> Germany</td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--info-100); color: var(--info-700); padding: 2px 6px; border-radius: var(--radius-xs); font-weight: 600;">85/100</span></td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--success-100); color: var(--success-700); padding: 2px 6px; border-radius: var(--radius-xs); font-weight: 600;">95/100</span></td>
                                                <td style="text-align: center; padding: 6px 8px; font-weight: 700; background: var(--warning-50);"><span style="background: var(--surface-300); padding: 2px 8px; border-radius: var(--radius-sm); font-weight: 700;">88.0</span></td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--surface-200); padding: 2px 8px; border-radius: 10px;">2</span></td>
                                                <td style="text-align: right; padding: 6px 8px;">$215,400</td>
                                                <td style="text-align: center; padding: 6px 8px; color: var(--text-muted);">-</td>
                                            </tr>
                                            <tr style="background: var(--danger-50);">
                                                <td style="padding: 6px 8px;">MedTech Inc.</td>
                                                <td style="padding: 6px 8px;">315789</td>
                                                <td style="padding: 6px 8px;"> Japan</td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--danger-100); color: var(--danger-700); padding: 2px 6px; border-radius: var(--radius-xs); font-weight: 600;">68/100</span></td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--info-100); color: var(--info-700); padding: 2px 6px; border-radius: var(--radius-xs); font-weight: 600;">82/100</span></td>
                                                <td style="text-align: center; padding: 6px 8px; font-weight: 700; background: var(--warning-50);"><span style="background: var(--danger-200); color: var(--danger-700); padding: 2px 8px; border-radius: var(--radius-sm); font-weight: 700;">72.2</span></td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--surface-200); padding: 2px 8px; border-radius: 10px;">3</span></td>
                                                <td style="text-align: right; padding: 6px 8px;">$198,500</td>
                                                <td style="text-align: center; padding: 6px 8px;"><span style="background: var(--danger-100); color: var(--danger-700); padding: 2px 6px; border-radius: var(--radius-xs); font-size: 10px; font-weight: 600;">Below Min.</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div style="background: var(--surface-50); padding: var(--spacing-sm); border-radius: var(--radius-sm);">
                                <label style="font-size: 11px; font-weight: 600; color: var(--text-muted); display: block; margin-bottom: 4px;">Fair & Transparent Evaluation Achieved:</label>
                                <textarea rows="2" placeholder="Describe how fairness and transparency was ensured..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 12px;"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Section 5: Value for Money Analysis -->
                    <div class="report-section-card" style="background: var(--surface-0); border-radius: var(--radius-lg); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); overflow: hidden;">
                        <div class="report-section-header" onclick="toggleReportSection('section-vfm')" style="background: var(--surface-50); padding: var(--spacing-md); cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                            <h2 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">5. Value for Money (VFM) Analysis</h2>
                            <i class="pi pi-chevron-down" id="section-vfm-icon" style="transition: transform 0.3s; color: var(--text-muted);"></i>
                        </div>
                        <div id="section-vfm" class="report-section-content" style="padding: var(--spacing-lg);">
                            <div style="overflow-x: auto; margin-bottom: var(--spacing-lg);">
                                <table class="eval-table" style="font-size: 12px;">
                                    <thead>
                                        <tr style="background: var(--orange-50);">
                                            <th>Lot#</th>
                                            <th>Company</th>
                                            <th>UNGM</th>
                                            <th>Country</th>
                                            <th style="text-align: center;">Lowest Price (Y/N)</th>
                                            <th style="text-align: center;">Negotiation (Y/N)</th>
                                            <th style="text-align: right;">Final Price (USD)</th>
                                            <th style="text-align: center;">Comparator Price</th>
                                            <th style="text-align: center;">Price Var %</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>MedSupply Ltd.</td>
                                            <td>309663</td>
                                            <td>Germany</td>
                                            <td style="text-align: center; color: var(--success-600); font-weight: 600;">Yes</td>
                                            <td style="text-align: center;">No</td>
                                            <td style="text-align: right;">$118,500.00</td>
                                            <td style="text-align: center;">HealthCare ($125,200)</td>
                                            <td style="text-align: center; color: var(--success-600);">-5.4%</td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td>HealthCare Corp.</td>
                                            <td>301245</td>
                                            <td>USA</td>
                                            <td style="text-align: center; color: var(--success-600); font-weight: 600;">Yes</td>
                                            <td style="text-align: center; color: var(--warning-600);">Yes</td>
                                            <td style="text-align: right;">$228,900.00</td>
                                            <td style="text-align: center;"><input type="text" placeholder="Market Price" style="width: 100px; padding: 4px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px;"></td>
                                            <td style="text-align: center;">N/A</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="margin-bottom: var(--spacing-lg);">
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Additional information regarding market price used as comparator:</label>
                                <textarea rows="2" placeholder="Provide details/justification for market price used..." style="width: 100%; padding: 8px; border: 1px solid var(--orange-200); border-radius: var(--radius-sm);"></textarea>
                            </div>
                            
                            <div>
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Cause for negotiation (if applicable):</label>
                                <textarea rows="2" placeholder="Enter cause for negotiation..." style="width: 100%; padding: 8px; border: 1px solid var(--orange-200); border-radius: var(--radius-sm);"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Section 6: Capacity & QA -->
                    <div class="report-section-card" style="background: var(--surface-0); border-radius: var(--radius-lg); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); overflow: hidden;">
                        <div class="report-section-header" onclick="toggleReportSection('section-capacity')" style="background: var(--surface-50); padding: var(--spacing-md); cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                            <h2 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">6. Capacity & Quality Assurance</h2>
                            <i class="pi pi-chevron-down" id="section-capacity-icon" style="transition: transform 0.3s; color: var(--text-muted);"></i>
                        </div>
                        <div id="section-capacity" class="report-section-content" style="padding: var(--spacing-lg);">
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: var(--spacing-md); color: var(--text-primary);">Background Checks Summary</h4>
                            <div style="overflow-x: auto; margin-bottom: var(--spacing-lg);">
                                <table class="eval-table" style="font-size: 11px;">
                                    <thead>
                                        <tr style="background: var(--surface-50);">
                                            <th>Vendor</th>
                                            <th>UNGM ID</th>
                                            <th>Country</th>
                                            <th>Awarded Lots</th>
                                            <th>Award Value</th>
                                            <th style="text-align: center;">UNGM Elig.</th>
                                            <th style="text-align: center;">Exists</th>
                                            <th style="text-align: center;">Incorp.</th>
                                            <th style="text-align: center;">Claims Log</th>
                                            <th style="text-align: center;">Adv. Pay?</th>
                                            <th style="text-align: center;">Adv. Pay Security?</th>
                                            <th style="text-align: center;">Currently Bidding?</th>
                                            <th style="text-align: center;">DRIVE Risk</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="font-weight: 600; color: var(--text-primary);">MedSupply Ltd.</td>
                                            <td>309663</td>
                                            <td>Germany</td>
                                            <td>Lot 1</td>
                                            <td>$118,500 USD</td>
                                            <td style="text-align: center; color: var(--success-600); font-weight: 600;"> ELIGIBLE</td>
                                            <td style="text-align: center; color: var(--success-500);"></td>
                                            <td style="text-align: center; color: var(--success-500);"></td>
                                            <td style="text-align: center; color: var(--success-500);"></td>
                                            <td style="text-align: center;">No</td>
                                            <td style="text-align: center; color: var(--text-muted);">-</td>
                                            <td style="text-align: center;">No</td>
                                            <td style="text-align: center; color: var(--success-500);"></td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600; color: var(--text-primary);">HealthCare Corp.</td>
                                            <td>301245</td>
                                            <td>USA</td>
                                            <td>Lot 2</td>
                                            <td>$228,900 USD</td>
                                            <td style="text-align: center; color: var(--warning-600); font-weight: 600;"> CENSURE</td>
                                            <td style="text-align: center; color: var(--success-500);"></td>
                                            <td style="text-align: center; color: var(--success-500);"></td>
                                            <td style="text-align: center; color: var(--success-500);"></td>
                                            <td style="text-align: center; color: var(--danger-600); font-weight: 600;">Yes</td>
                                            <td style="text-align: center; color: var(--danger-600); font-weight: 600;">No</td>
                                            <td style="text-align: center; color: var(--danger-600);">Yes (ITB/2024/99)</td>
                                            <td style="text-align: center; font-size: 16px;"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- DRIVE Risk Info -->
                            <div style="background: var(--warning-50); border: 1px solid var(--warning-200); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                <label style="font-size: 12px; font-weight: 600; color: var(--warning-700); display: block; margin-bottom: var(--spacing-sm);">DRiVE Risk Information</label>
                                <textarea rows="2" placeholder="DRiVE risk details if flagged..." style="width: 100%; padding: 8px; border: 1px solid var(--warning-300); border-radius: var(--radius-sm);"></textarea>
                            </div>
                            
                            <!-- Advance Payment Justification -->
                            <div id="advPayJustificationBlock" style="background: var(--danger-50); border: 1px solid var(--danger-200); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                <label style="font-size: 12px; font-weight: 600; color: var(--danger-700); display: block; margin-bottom: var(--spacing-sm);">Advance payment security not requested - justification:</label>
                                <textarea rows="2" placeholder="Justification from tender authoring..." style="width: 100%; padding: 8px; border: 1px solid var(--danger-300); border-radius: var(--radius-sm);"></textarea>
                            </div>
                            
                            <!-- Claims Log Verification -->
                            <div style="margin-bottom: var(--spacing-lg);">
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Attach UNOPS Claims Log Verification:</label>
                                <input type="file" style="font-size: 11px;">
                            </div>

                            <!-- Contract History - MedSupply -->
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: var(--spacing-md); color: var(--text-primary);">Contract History: MedSupply Ltd.</h4>
                            <div style="overflow-x: auto; margin-bottom: var(--spacing-lg);">
                                <table class="eval-table" style="font-size: 11px;">
                                    <thead>
                                        <tr style="background: var(--surface-100);">
                                            <th>Lot</th>
                                            <th>Office</th>
                                            <th>Contract #</th>
                                            <th>Name</th>
                                            <th>End Date</th>
                                            <th>Process Ref</th>
                                            <th style="text-align: center;">Contract Status</th>
                                            <th style="text-align: center;">CPC Review</th>
                                            <th style="text-align: center;">Performance</th>
                                            <th style="text-align: right;">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="font-weight: 600;">Lot 1</td>
                                            <td>Europe & CIS</td>
                                            <td>1006083</td>
                                            <td>Medical Supplies</td>
                                            <td>04/01/2024</td>
                                            <td>ITB/2023/089</td>
                                            <td style="text-align: center;"><span style="padding: 2px 6px; background: var(--success-100); color: var(--success-700); border-radius: var(--radius-xs); font-size: 10px;">Completed</span></td>
                                            <td style="text-align: center;"><a href="#" style="color: var(--primary-500);">Yes</a></td>
                                            <td style="text-align: center; color: var(--success-600);">Satisfactory</td>
                                            <td style="text-align: right;">$215,000 USD</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600;">Lot 2</td>
                                            <td>Ukraine</td>
                                            <td>1006074</td>
                                            <td>Support Svcs</td>
                                            <td>04/01/2023</td>
                                            <td>ITB/2022/42</td>
                                            <td style="text-align: center;"><span style="padding: 2px 6px; background: var(--warning-100); color: var(--warning-700); border-radius: var(--radius-xs); font-size: 10px;">Active</span></td>
                                            <td style="text-align: center;"><a href="#" style="color: var(--primary-500);">Yes</a></td>
                                            <td style="text-align: center; color: var(--danger-600); font-weight: 600;">Unsatisfactory</td>
                                            <td style="text-align: right;">$521,000 USD</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Contract History - HealthCare Corp -->
                            <h4 style="font-size: 14px; font-weight: 600; margin-bottom: var(--spacing-md); color: var(--text-primary);">Contract History: HealthCare Corp.</h4>
                            <div style="overflow-x: auto; margin-bottom: var(--spacing-lg);">
                                <table class="eval-table" style="font-size: 11px;">
                                    <thead>
                                        <tr style="background: var(--surface-100);">
                                            <th>Lot</th>
                                            <th>Office</th>
                                            <th>Contract #</th>
                                            <th>Name</th>
                                            <th>End Date</th>
                                            <th>Process Ref</th>
                                            <th style="text-align: center;">Contract Status</th>
                                            <th style="text-align: center;">CPC Review</th>
                                            <th style="text-align: center;">Performance</th>
                                            <th style="text-align: right;">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="font-weight: 600;">Lot 1</td>
                                            <td>Denmark</td>
                                            <td>1005873</td>
                                            <td>Implementation</td>
                                            <td>12/12/2024</td>
                                            <td>RFP/2024/01</td>
                                            <td style="text-align: center;"><span style="padding: 2px 6px; background: var(--info-100); color: var(--info-700); border-radius: var(--radius-xs); font-size: 10px;">In Progress</span></td>
                                            <td style="text-align: center;">No</td>
                                            <td style="text-align: center; color: var(--success-600);">Satisfactory</td>
                                            <td style="text-align: right;">$124,000 USD</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Advanced Background Checks -->
                            <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                                    <h4 style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin: 0;">Advanced Background Checks</h4>
                                    <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                        <input type="checkbox" id="advancedChecksRequired" onchange="toggleAdvancedChecks()">
                                        <span style="font-size: 12px;">Required for this case</span>
                                    </label>
                                </div>
                                <div id="advancedChecksContent" style="display: none;">
                                    <div style="display: grid; gap: var(--spacing-md);">
                                        <div style="border-bottom: 1px solid var(--surface-200); padding-bottom: var(--spacing-md);">
                                            <label style="font-size: 11px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">i) Check against corporate registries</label>
                                            <textarea rows="2" placeholder="Comments..." style="width: 100%; padding: 6px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px; margin-bottom: 4px;"></textarea>
                                            <input type="file" style="font-size: 10px;">
                                        </div>
                                        <div style="border-bottom: 1px solid var(--surface-200); padding-bottom: var(--spacing-md);">
                                            <label style="font-size: 11px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">ii) Authenticity of bid/proposal security issuer check</label>
                                            <textarea rows="2" placeholder="Comments..." style="width: 100%; padding: 6px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px; margin-bottom: 4px;"></textarea>
                                            <input type="file" style="font-size: 10px;">
                                        </div>
                                        <div style="border-bottom: 1px solid var(--surface-200); padding-bottom: var(--spacing-md);">
                                            <label style="font-size: 11px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">iii) Independence of bidder's owners and management</label>
                                            <textarea rows="2" placeholder="Comments..." style="width: 100%; padding: 6px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px; margin-bottom: 4px;"></textarea>
                                            <input type="file" style="font-size: 10px;">
                                        </div>
                                        <div style="border-bottom: 1px solid var(--surface-200); padding-bottom: var(--spacing-md);">
                                            <label style="font-size: 11px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">iv) Verification of Manufacturer's Authorization</label>
                                            <textarea rows="2" placeholder="Comments..." style="width: 100%; padding: 6px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px; margin-bottom: 4px;"></textarea>
                                            <input type="file" style="font-size: 10px;">
                                        </div>
                                        <div style="border-bottom: 1px solid var(--surface-200); padding-bottom: var(--spacing-md);">
                                            <label style="font-size: 11px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">v) Verification of other documents</label>
                                            <textarea rows="2" placeholder="Comments..." style="width: 100%; padding: 6px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px; margin-bottom: 4px;"></textarea>
                                            <input type="file" style="font-size: 10px;">
                                        </div>
                                        <div style="border-bottom: 1px solid var(--surface-200); padding-bottom: var(--spacing-md);">
                                            <label style="font-size: 11px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">vi) Verification of financial statements</label>
                                            <textarea rows="2" placeholder="Comments..." style="width: 100%; padding: 6px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px; margin-bottom: 4px;"></textarea>
                                            <input type="file" style="font-size: 10px;">
                                        </div>
                                        <div style="border-bottom: 1px solid var(--surface-200); padding-bottom: var(--spacing-md);">
                                            <label style="font-size: 11px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">vii) Verification of financial soundness</label>
                                            <textarea rows="2" placeholder="Comments..." style="width: 100%; padding: 6px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px; margin-bottom: 4px;"></textarea>
                                            <input type="file" style="font-size: 10px;">
                                        </div>
                                        <div style="border-bottom: 1px solid var(--surface-200); padding-bottom: var(--spacing-md);">
                                            <label style="font-size: 11px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">viii) Verification of ethical reputation</label>
                                            <textarea rows="2" placeholder="Comments..." style="width: 100%; padding: 6px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px; margin-bottom: 4px;"></textarea>
                                            <input type="file" style="font-size: 10px;">
                                        </div>
                                        <div style="border-bottom: 1px solid var(--surface-200); padding-bottom: var(--spacing-md);">
                                            <label style="font-size: 11px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">ix) Site visit confirming existence of stated material and capacity</label>
                                            <textarea rows="2" placeholder="Comments..." style="width: 100%; padding: 6px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px; margin-bottom: 4px;"></textarea>
                                            <input type="file" style="font-size: 10px;">
                                        </div>
                                        <div style="border-bottom: 1px solid var(--surface-200); padding-bottom: var(--spacing-md);">
                                            <label style="font-size: 11px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">x) Litigation history</label>
                                            <textarea rows="2" placeholder="Comments..." style="width: 100%; padding: 6px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px; margin-bottom: 4px;"></textarea>
                                            <input type="file" style="font-size: 10px;">
                                        </div>
                                        <div>
                                            <label style="font-size: 11px; font-weight: 600; color: var(--danger-600); display: block; margin-bottom: 4px;">xi) WOB or other statement checks</label>
                                            <textarea rows="2" placeholder="Comments..." style="width: 100%; padding: 6px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs); font-size: 11px; margin-bottom: 4px;"></textarea>
                                            <input type="file" style="font-size: 10px;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Conclusion Fields -->
                            <div style="border-top: 1px solid var(--surface-200); padding-top: var(--spacing-lg);">
                                <div style="margin-bottom: var(--spacing-lg);">
                                    <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Overall comments on capacity of recommended vendors</label>
                                    <textarea rows="3" placeholder="Provide summary remarks..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);"></textarea>
                                    <input type="file" style="font-size: 11px; margin-top: 4px;">
                                </div>
                                <div style="margin-bottom: var(--spacing-lg);">
                                    <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Comments on financial/staff resources (Works)</label>
                                    <textarea rows="2" placeholder="Required for Works contracts..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);"></textarea>
                                    <input type="file" style="font-size: 11px; margin-top: 4px;">
                                </div>
                                <div id="annexDeviationBlock" style="margin-bottom: var(--spacing-lg);">
                                    <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Comments on any deviation from Annex 2 (Medicines)</label>
                                    <textarea rows="2" placeholder="If applicable for medical procurement..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);"></textarea>
                                    <input type="file" style="font-size: 11px; margin-top: 4px;">
                                </div>
                                <div>
                                    <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Risk mitigation measures</label>
                                    <textarea rows="3" placeholder="Describe mitigation strategies..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 7: Panel Sign-Off -->
                    <div class="report-section-card" style="background: var(--surface-0); border-radius: var(--radius-lg); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); overflow: hidden;">
                        <div class="report-section-header" onclick="toggleReportSection('section-signoff')" style="background: var(--surface-50); padding: var(--spacing-md); cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                            <h2 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">7. Evaluation Panel Sign-Off</h2>
                            <i class="pi pi-chevron-down" id="section-signoff-icon" style="transition: transform 0.3s; color: var(--text-muted);"></i>
                        </div>
                        <div id="section-signoff" class="report-section-content" style="padding: var(--spacing-lg);">
                            <!-- PA Approval of Panel -->
                            <div style="background: var(--info-50); border: 1px solid var(--info-200); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-sm);">
                                    <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                                        <input type="checkbox" id="paApprovalPanel" checked>
                                        <span style="font-weight: 600; font-size: 13px; color: var(--info-700);">PA Approval of the Panel</span>
                                    </label>
                                    <span style="font-size: 11px; color: var(--info-600);"> Approved: 01/03/2025 14:30</span>
                                </div>
                            </div>
                            
                            <!-- Info Banner - Affidavits already signed -->
                            <div style="background: var(--success-50); border: 1px solid var(--success-200); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                <p style="font-size: 12px; color: var(--success-700); margin: 0;"><i class="pi pi-check-circle"></i> <strong>Affidavits completed:</strong> All panel members signed their affidavits before evaluation started. Only Evaluation Report signature is required below.</p>
                            </div>
                            
                            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: var(--spacing-lg);" id="panelSignatureStatusMsg">Waiting for panel members to sign and approve the Evaluation Report.</p>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-lg);" id="panel-signatures-report">
                                <!-- Panel Member 1: Procurement Officer (Already signed) -->
                                <div class="panel-member-card" data-signed="true" style="padding: var(--spacing-lg); border: 1px solid var(--success-200); border-radius: var(--radius-md); background: var(--success-50);">
                                    <p style="font-weight: 600; font-size: 14px; margin: 0 0 2px 0; color: var(--text-primary);">Procurement Official</p>
                                    <p style="font-size: 12px; color: var(--text-muted); margin: 0 0 var(--spacing-md) 0;">John Smith</p>
                                    <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-sm); background: var(--success-100); border-radius: var(--radius-sm);">
                                        <div style="display: flex; align-items: center; gap: var(--spacing-xs); font-size: 11px; color: var(--success-700);">
                                            <i class="pi pi-check-circle"></i>
                                            <span>Affidavit Signed</span>
                                        </div>
                                        <div style="font-size: 10px; color: var(--success-600); margin-top: 2px;"> 01/12/2024 09:00 (before evaluation)</div>
                                    </div>
                                    <button disabled style="width: 100%; padding: 6px; background: var(--success-100); color: var(--success-700); border: 1px solid var(--success-300); border-radius: var(--radius-sm); font-size: 11px; cursor: not-allowed;"> Report Signed</button>
                                    <div style="font-size: 10px; color: var(--success-600); text-align: center; margin-top: 4px;"> Signed: 05/03/2025 09:05</div>
                                </div>

                                <!-- Panel Member 2: Chair -->
                                <div class="panel-member-card" data-signed="false" style="padding: var(--spacing-lg); border: 1px solid var(--surface-200); border-radius: var(--radius-md); background: var(--surface-0);">
                                    <p style="font-weight: 600; font-size: 14px; margin: 0 0 2px 0; color: var(--text-primary);">Chair</p>
                                    <p style="font-size: 12px; color: var(--text-muted); margin: 0 0 var(--spacing-md) 0;">Alice Johnson</p>
                                    <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-sm); background: var(--success-100); border-radius: var(--radius-sm);">
                                        <div style="display: flex; align-items: center; gap: var(--spacing-xs); font-size: 11px; color: var(--success-700);">
                                            <i class="pi pi-check-circle"></i>
                                            <span>Affidavit Signed</span>
                                        </div>
                                        <div style="font-size: 10px; color: var(--success-600); margin-top: 2px;"> 01/12/2024 10:15 (before evaluation)</div>
                                    </div>
                                    <button class="btn-sign-report" onclick="signOffReport(this)" style="width: 100%; padding: 6px; background: var(--primary-500); color: white; border: none; border-radius: var(--radius-sm); font-size: 11px; cursor: pointer;">Sign Evaluation Report</button>
                                    <div class="report-ts" style="font-size: 10px; color: var(--success-600); text-align: center; margin-top: 4px; display: none;"></div>
                                </div>

                                <!-- Panel Member 3: Evaluator -->
                                <div class="panel-member-card" data-signed="false" style="padding: var(--spacing-lg); border: 1px solid var(--surface-200); border-radius: var(--radius-md); background: var(--surface-0);">
                                    <p style="font-weight: 600; font-size: 14px; margin: 0 0 2px 0; color: var(--text-primary);">Evaluator</p>
                                    <p style="font-size: 12px; color: var(--text-muted); margin: 0 0 var(--spacing-md) 0;">Jane Doe</p>
                                    <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-sm); background: var(--success-100); border-radius: var(--radius-sm);">
                                        <div style="display: flex; align-items: center; gap: var(--spacing-xs); font-size: 11px; color: var(--success-700);">
                                            <i class="pi pi-check-circle"></i>
                                            <span>Affidavit Signed</span>
                                        </div>
                                        <div style="font-size: 10px; color: var(--success-600); margin-top: 2px;"> 01/12/2024 11:30 (before evaluation)</div>
                                    </div>
                                    <button class="btn-sign-report" onclick="signOffReport(this)" style="width: 100%; padding: 6px; background: var(--primary-500); color: white; border: none; border-radius: var(--radius-sm); font-size: 11px; cursor: pointer;">Sign Evaluation Report</button>
                                    <div class="report-ts" style="font-size: 10px; color: var(--success-600); text-align: center; margin-top: 4px; display: none;"></div>
                                </div>

                                <!-- Panel Member 4: Observer -->
                                <div class="panel-member-card" data-signed="false" style="padding: var(--spacing-lg); border: 1px solid var(--surface-200); border-radius: var(--radius-md); background: var(--surface-0);">
                                    <p style="font-weight: 600; font-size: 14px; margin: 0 0 2px 0; color: var(--text-primary);">Observer</p>
                                    <p style="font-size: 12px; color: var(--text-muted); margin: 0 0 var(--spacing-md) 0;">Robert Lee</p>
                                    <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-sm); background: var(--success-100); border-radius: var(--radius-sm);">
                                        <div style="display: flex; align-items: center; gap: var(--spacing-xs); font-size: 11px; color: var(--success-700);">
                                            <i class="pi pi-check-circle"></i>
                                            <span>Affidavit Signed</span>
                                        </div>
                                        <div style="font-size: 10px; color: var(--success-600); margin-top: 2px;"> 02/12/2024 08:45 (before evaluation)</div>
                                    </div>
                                    <button class="btn-sign-report" onclick="signOffReport(this)" style="width: 100%; padding: 6px; background: var(--primary-500); color: white; border: none; border-radius: var(--radius-sm); font-size: 11px; cursor: pointer;">Sign Evaluation Report</button>
                                    <div class="report-ts" style="font-size: 10px; color: var(--success-600); text-align: center; margin-top: 4px; display: none;"></div>
                                </div>
                            </div>

                            <div id="panelStatusReport" style="margin-top: var(--spacing-xl); padding: var(--spacing-md); background: var(--warning-50); border: 1px solid var(--warning-200); border-radius: var(--radius-md); color: var(--warning-700); font-size: 13px;">
                                 Waiting for 3 more members to sign the Evaluation Report.
                            </div>
                        </div>
                    </div>

                    <!-- Section 8: Review and Award (Hidden until signatures complete) -->
                    <div id="section-review-award" class="report-section-card" style="display: none; background: var(--surface-0); border-radius: var(--radius-lg); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); overflow: hidden;">
                        <div class="report-section-header" onclick="toggleReportSection('section-review-content')" style="background: var(--surface-50); padding: var(--spacing-md); cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--surface-200);">
                            <h2 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;">8. Review and Award Recommendation</h2>
                            <i class="pi pi-chevron-down" id="section-review-content-icon" style="transition: transform 0.3s; color: var(--text-muted);"></i>
                        </div>
                        <div id="section-review-content" class="report-section-content" style="padding: var(--spacing-lg);">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                <div>
                                    <label style="font-size: 12px; font-weight: 600; display: block; margin-bottom: var(--spacing-xs); color: var(--text-muted);">Review Body</label>
                                    <select id="reportReviewBody" onchange="updateReportRecommendation()" style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); color: var(--text-primary);">
                                        <option value="cpc">CPC</option>
                                        <option value="reviewer">Reviewer</option>
                                    </select>
                                </div>
                                <div id="submittingOfficerReportBlock">
                                    <label style="font-size: 12px; font-weight: 600; display: block; margin-bottom: var(--spacing-xs); color: var(--text-muted);">Designated Officer</label>
                                    <select style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); color: var(--text-primary);">
                                        <option>Jane Doe</option>
                                        <option>Michael Scott</option>
                                    </select>
                                </div>
                            </div>

                            <button onclick="submitFinalRecommendation()" style="width: 100%; padding: var(--spacing-md); background: var(--primary-500); color: white; border: none; border-radius: var(--radius-sm); font-weight: 600; font-size: 14px; cursor: pointer;">
                                <i class="pi pi-send"></i> Submit Final Recommendation
                            </button>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-xl); background: var(--surface-50); border-radius: var(--radius-lg); border: 1px solid var(--surface-200);">
                        <button class="btn btn-secondary" onclick="showEvaluation()">
                            <i class="pi pi-arrow-left"></i> Back to Evaluation
                        </button>
                        <div style="display: flex; gap: var(--spacing-md);">
                            <button class="btn btn-secondary" onclick="saveReportDraft()">
                                <i class="pi pi-save"></i> Save Draft
                            </button>
                            <button class="btn btn-primary" onclick="exportReportPDF()">
                                <i class="pi pi-file-pdf"></i> Export PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Evaluation Report View -->

            <!-- Award & Review Overview View -->
            <div class="view-section" id="view-cpc-dashboard">
                <!-- Page Header with Banner similar to Tendering -->
                <div style="background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); color: white;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: var(--spacing-md);">
                        <div>
                            <h1 style="font-size: 24px; font-weight: 700; margin: 0 0 var(--spacing-xs) 0;"> Award & Review Overview</h1>
                            <p style="opacity: 0.9; font-size: 14px; margin: 0;">CPC cases, meetings and approvals</p>
                        </div>
                    </div>
                    <!-- Quick Stats Bar -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--spacing-md); margin-top: var(--spacing-md); padding-top: var(--spacing-md); border-top: 1px solid rgba(255,255,255,0.2);">
                        <div>
                            <div style="font-size: 10px; opacity: 0.7; text-transform: uppercase;">Pending Cases</div>
                            <div style="font-size: 20px; font-weight: 700;">7</div>
                        </div>
                        <div>
                            <div style="font-size: 10px; opacity: 0.7; text-transform: uppercase;">My Reviews</div>
                            <div style="font-size: 20px; font-weight: 700;">3</div>
                        </div>
                        <div>
                            <div style="font-size: 10px; opacity: 0.7; text-transform: uppercase;">Q&A Pending</div>
                            <div style="font-size: 20px; font-weight: 700;">2</div>
                        </div>
                        <div>
                            <div style="font-size: 10px; opacity: 0.7; text-transform: uppercase;">This Month</div>
                            <div style="font-size: 20px; font-weight: 700;">12</div>
                        </div>
                    </div>
                </div>

                <!-- My Pending Tasks - Grid Cards -->
                <div class="pending-tasks-section">
                    <h2 class="section-title">
                        <i class="pi pi-list-check"></i> My Pending Tasks
                    </h2>
                    <div class="tasks-grid">
                        <div class="task-item" onclick="filterCPCCases('pending-review')">
                            <div class="task-badge">3</div>
                            <div class="task-content">
                                <i class="pi pi-eye task-icon-inline"></i>
                                <span>Pending Review</span>
                            </div>
                        </div>
                        <div class="task-item" onclick="filterCPCCases('qa-pending')">
                            <div class="task-badge">2</div>
                            <div class="task-content">
                                <i class="pi pi-comments task-icon-inline"></i>
                                <span>Q&A Pending</span>
                            </div>
                        </div>
                        <div class="task-item" onclick="filterCPCCases('deliberation')">
                            <div class="task-badge">1</div>
                            <div class="task-content">
                                <i class="pi pi-users task-icon-inline"></i>
                                <span>Under Deliberation</span>
                            </div>
                        </div>
                        <div class="task-item" onclick="filterCPCCases('voting')">
                            <div class="task-badge">2</div>
                            <div class="task-content">
                                <i class="pi pi-check-square task-icon-inline"></i>
                                <span>Awaiting Vote</span>
                            </div>
                        </div>
                        <div class="task-item" onclick="filterCPCCases('pa-approval')">
                            <div class="task-badge">1</div>
                            <div class="task-content">
                                <i class="pi pi-verified task-icon-inline"></i>
                                <span>PA Approval</span>
                            </div>
                        </div>
                        <div class="task-item" onclick="viewMeetingDetails('upcoming')">
                            <div class="task-badge">2</div>
                            <div class="task-content">
                                <i class="pi pi-calendar task-icon-inline"></i>
                                <span>Upcoming Meetings</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Task List Items -->
                <div class="tasks-list-section" style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-xl); border: 1px solid var(--surface-200);">
                    <h2 class="section-title" style="margin-bottom: var(--spacing-lg);">
                        <i class="pi pi-bell"></i> Action Required
                    </h2>
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-md); background: var(--warning-50); border-left: 4px solid var(--warning-500); border-radius: 0 var(--radius-sm) var(--radius-sm) 0;">
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Case CPC-2025-0042 - Review Required</div>
                                <div style="font-size: 12px; color: var(--text-muted);">ITB/2024/023 - Medical Supplies | Submitted by: John Smith, Europe & CIS</div>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm);">
                                <span style="padding: 4px 10px; background: var(--warning-100); color: var(--warning-700); border-radius: var(--radius-sm); font-size: 11px; font-weight: 600;">Due: 2 days</span>
                                <button class="btn btn-primary btn-sm" onclick="openCPCCase('CPC-2025-0042')">Review</button>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-md); background: var(--info-50); border-left: 4px solid var(--info-500); border-radius: 0 var(--radius-sm) var(--radius-sm) 0;">
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Case CPC-2025-0039 - Q&A Response Needed</div>
                                <div style="font-size: 12px; color: var(--text-muted);">RFP/2024/089 - IT Services | 2 questions pending from CPC Member</div>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm);">
                                <span style="padding: 4px 10px; background: var(--info-100); color: var(--info-700); border-radius: var(--radius-sm); font-size: 11px; font-weight: 600;">Q&A</span>
                                <button class="btn btn-secondary btn-sm" onclick="openCPCQA('CPC-2025-0039')">Respond</button>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-md); background: var(--purple-50); border-left: 4px solid var(--purple-500); border-radius: 0 var(--radius-sm) var(--radius-sm) 0;">
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Meeting: CPC Panel Review - Europe Region</div>
                                <div style="font-size: 12px; color: var(--text-muted);">Tomorrow 10:00 AM | 4 cases to discuss</div>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm);">
                                <span style="padding: 4px 10px; background: var(--purple-100); color: var(--purple-700); border-radius: var(--radius-sm); font-size: 11px; font-weight: 600;">Meeting</span>
                                <button class="btn btn-secondary btn-sm" onclick="viewMeetingDetails('MTG-2025-012')">View Agenda</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <div class="filter-group">
                        <span class="filter-label">Status:</span>
                        <select class="filter-select" onchange="filterCPCCases()">
                            <option value="all">All Statuses</option>
                            <option value="pending-review">Pending Review</option>
                            <option value="qa-pending">Under Q&A</option>
                            <option value="deliberation">Deliberation</option>
                            <option value="voting">Awaiting Vote</option>
                            <option value="pa-approval">PA Approval</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">Region:</span>
                        <select class="filter-select">
                            <option value="all">All Regions</option>
                            <option value="europe">Europe & CIS</option>
                            <option value="asia">Asia Pacific</option>
                            <option value="africa">Africa</option>
                            <option value="americas">Americas</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">Sort by:</span>
                        <select class="filter-select">
                            <option value="recent">Most Recent</option>
                            <option value="value">Value</option>
                            <option value="deadline">Due Date</option>
                        </select>
                    </div>
                    <div style="flex: 1;"></div>
                    <input type="text" placeholder="Search cases..." class="filter-select" style="width: 200px;">
                </div>

                <!-- Cases Grid (Card Layout) -->
                <div class="tender-grid" id="cpcCasesGrid">
                    <!-- Case Card 1 -->
                    <div class="tender-card" data-status="pending-review">
                        <div class="tender-header">
                            <div class="tender-title-section">
                                <div class="tender-id">CPC-2025-0042</div>
                                <div class="tender-title">Medical Supplies - Emergency Response</div>
                            </div>
                            <span class="status-badge" style="background: var(--warning-50); color: var(--warning-600);">Pending Review</span>
                        </div>
                        <div class="tender-meta">
                            <div class="meta-item">
                                <span class="meta-label">Tender Ref</span>
                                <span class="meta-value">ITB/2024/023</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Submitting Office</span>
                                <span class="meta-value">Europe & CIS</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Award Value</span>
                                <span class="meta-value">$362,400</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Type</span>
                                <span class="meta-value">Formal</span>
                            </div>
                        </div>
                        <div class="tender-actions">
                            <button class="btn btn-primary btn-sm" onclick="openCPCCase('CPC-2025-0042')">
                                <i class="pi pi-eye"></i> Open Case
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="viewCPCCasePreview('CPC-2025-0042')">
                                <i class="pi pi-file-o"></i> Quick Preview
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="openCPCQA('CPC-2025-0042')">
                                <i class="pi pi-comments"></i> Q&A (2)
                            </button>
                        </div>
                    </div>

                    <!-- Case Card 2 -->
                    <div class="tender-card" data-status="qa-pending">
                        <div class="tender-header">
                            <div class="tender-title-section">
                                <div class="tender-id">CPC-2025-0041</div>
                                <div class="tender-title">IT Infrastructure Services</div>
                            </div>
                            <span class="status-badge" style="background: var(--info-50); color: var(--info-600);">Under Q&A</span>
                        </div>
                        <div class="tender-meta">
                            <div class="meta-item">
                                <span class="meta-label">Tender Ref</span>
                                <span class="meta-value">RFP/2024/089</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Submitting Office</span>
                                <span class="meta-value">Asia Pacific</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Award Value</span>
                                <span class="meta-value">$1,250,000</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Type</span>
                                <span class="meta-value">LTA</span>
                            </div>
                        </div>
                        <div class="tender-actions">
                            <button class="btn btn-primary btn-sm" onclick="openCPCCase('CPC-2025-0041')">
                                <i class="pi pi-eye"></i> Open Case
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="viewCPCCasePreview('CPC-2025-0041')">
                                <i class="pi pi-file-o"></i> Quick Preview
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="openCPCQA('CPC-2025-0041')">
                                <i class="pi pi-comments"></i> Q&A (3)
                            </button>
                        </div>
                    </div>

                    <!-- Case Card 3 -->
                    <div class="tender-card" data-status="deliberation">
                        <div class="tender-header">
                            <div class="tender-title-section">
                                <div class="tender-id">CPC-2025-0040</div>
                                <div class="tender-title">Construction Equipment</div>
                            </div>
                            <span class="status-badge" style="background: var(--purple-50); color: var(--purple-600);">Deliberation</span>
                        </div>
                        <div class="tender-meta">
                            <div class="meta-item">
                                <span class="meta-label">Tender Ref</span>
                                <span class="meta-value">ITB/2024/078</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Submitting Office</span>
                                <span class="meta-value">Africa</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Award Value</span>
                                <span class="meta-value">$485,000</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Type</span>
                                <span class="meta-value">Formal</span>
                            </div>
                        </div>
                        <div class="tender-actions">
                            <button class="btn btn-primary btn-sm" onclick="openCPCCase('CPC-2025-0040')">
                                <i class="pi pi-eye"></i> Open Case
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="viewCPCCasePreview('CPC-2025-0040')">
                                <i class="pi pi-file-o"></i> Quick Preview
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="joinCPCDeliberation('CPC-2025-0040')">
                                <i class="pi pi-video"></i> Join Meeting
                            </button>
                        </div>
                    </div>

                    <!-- Case Card 4 -->
                    <div class="tender-card" data-status="completed">
                        <div class="tender-header">
                            <div class="tender-title-section">
                                <div class="tender-id">CPC-2025-0039</div>
                                <div class="tender-title">Office Supplies</div>
                            </div>
                            <span class="status-badge" style="background: var(--success-50); color: var(--success-600);">PA Approved</span>
                        </div>
                        <div class="tender-meta">
                            <div class="meta-item">
                                <span class="meta-label">Tender Ref</span>
                                <span class="meta-value">RFQ/2024/156</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Submitting Office</span>
                                <span class="meta-value">Europe & CIS</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Award Value</span>
                                <span class="meta-value">$89,500</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Type</span>
                                <span class="meta-value">Direct</span>
                            </div>
                        </div>
                        <div class="tender-actions">
                            <button class="btn btn-primary btn-sm" onclick="openCPCCase('CPC-2025-0039')">
                                <i class="pi pi-eye"></i> View Case
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="downloadCPCReport('CPC-2025-0039')">
                                <i class="pi pi-download"></i> Download Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End CPC Dashboard View -->

            <!-- CPC Case Detail View -->
            <div class="view-section" id="view-cpc-case">
                <div style="max-width: 1400px; margin: 0 auto;">
                    <!-- Case Header -->
                    <div style="background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%); border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-xl); color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: var(--spacing-md);">
                            <div>
                                <div style="display: flex; align-items: center; gap: var(--spacing-md); margin-bottom: var(--spacing-sm);">
                                    <h1 style="font-size: 28px; font-weight: 700; margin: 0;" id="cpc-case-id">CPC-2025-0042</h1>
                                    <span id="cpc-case-status-badge" style="padding: 6px 14px; background: rgba(251,191,36,0.3); border-radius: 20px; font-size: 12px; font-weight: 600;">
                                        Pending Review
                                    </span>
                                </div>
                                <p style="opacity: 0.9; font-size: 14px; margin: 0;" id="cpc-case-tender-ref">ITB/2024/023 - Medical Supplies - Emergency Response</p>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm);">
                                <button class="btn" onclick="showCPCDashboard()" style="background: var(--surface-100); border: 1px solid var(--surface-300); color: var(--text-primary); padding: 8px 16px; border-radius: var(--radius-sm); cursor: pointer;">
                                    <i class="pi pi-arrow-left"></i> Back to Dashboard
                                </button>
                            </div>
                        </div>
                        <!-- Case Summary Bar -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--spacing-lg); margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid rgba(255,255,255,0.2);">
                            <div>
                                <div style="font-size: 11px; opacity: 0.7;">Submitting Office</div>
                                <div style="font-weight: 600;">Europe & CIS</div>
                            </div>
                            <div>
                                <div style="font-size: 11px; opacity: 0.7;">Submitting Officer</div>
                                <div style="font-weight: 600;">John Smith</div>
                            </div>
                            <div>
                                <div style="font-size: 11px; opacity: 0.7;">Award Value</div>
                                <div style="font-weight: 600;">$362,400 USD</div>
                            </div>
                            <div>
                                <div style="font-size: 11px; opacity: 0.7;">Submission Type</div>
                                <div style="font-weight: 600;">Formal Review</div>
                            </div>
                            <div>
                                <div style="font-size: 11px; opacity: 0.7;">Submitted</div>
                                <div style="font-weight: 600;">Dec 10, 2025</div>
                            </div>
                        </div>
                    </div>

                    <!-- Case Progress -->
                    <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-xl); border: 1px solid var(--surface-200);">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-lg);">Case Progress</h3>
                        <div style="display: flex; justify-content: space-between; position: relative;">
                            <div style="position: absolute; top: 15px; left: 0; right: 0; height: 2px; background: var(--surface-200); z-index: 0;"></div>
                            
                            <div style="text-align: center; z-index: 1;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--success-500); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; margin: 0 auto;"></div>
                                <div style="font-size: 11px; margin-top: var(--spacing-xs); color: var(--success-600); font-weight: 500;">Submitted</div>
                            </div>
                            <div style="text-align: center; z-index: 1;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--success-500); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; margin: 0 auto;"></div>
                                <div style="font-size: 11px; margin-top: var(--spacing-xs); color: var(--success-600); font-weight: 500;">Cleared</div>
                            </div>
                            <div style="text-align: center; z-index: 1;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--warning-500); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; margin: 0 auto;">3</div>
                                <div style="font-size: 11px; margin-top: var(--spacing-xs); color: var(--warning-600); font-weight: 500;">CPC Review</div>
                            </div>
                            <div style="text-align: center; z-index: 1;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--surface-300); color: var(--text-muted); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; margin: 0 auto;">4</div>
                                <div style="font-size: 11px; margin-top: var(--spacing-xs); color: var(--text-muted);">Voting</div>
                            </div>
                            <div style="text-align: center; z-index: 1;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--surface-300); color: var(--text-muted); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; margin: 0 auto;">5</div>
                                <div style="font-size: 11px; margin-top: var(--spacing-xs); color: var(--text-muted);">PA Approval</div>
                            </div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--spacing-xl);">
                        <!-- Main Content Column -->
                        <div>
                            <!-- Evaluation Report Summary -->
                            <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-xl); border: 1px solid var(--surface-200);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
                                    <h3 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0;"> Evaluation Report Summary</h3>
                                    <button class="btn btn-secondary btn-sm" onclick="viewFullEvaluationReport()">View Full Report</button>
                                </div>
                                
                                <!-- Four Principles Assessment -->
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                    <div style="padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); border-left: 4px solid var(--success-500);">
                                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">Competition</div>
                                        <div style="font-size: 12px; color: var(--success-600);"> Open Competition - 6 bidders</div>
                                    </div>
                                    <div style="padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); border-left: 4px solid var(--success-500);">
                                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">Evaluation</div>
                                        <div style="font-size: 12px; color: var(--success-600);"> Fair & Transparent</div>
                                    </div>
                                    <div style="padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); border-left: 4px solid var(--success-500);">
                                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">Value for Money</div>
                                        <div style="font-size: 12px; color: var(--success-600);"> Lowest compliant bid</div>
                                    </div>
                                    <div style="padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); border-left: 4px solid var(--warning-500);">
                                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">Capacity</div>
                                        <div style="font-size: 12px; color: var(--warning-600);"> Minor concerns noted</div>
                                    </div>
                                </div>
                                
                                <!-- Recommended Vendors -->
                                <h4 style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-md);">Recommended Vendors</h4>
                                <table class="eval-table" style="font-size: 12px;">
                                    <thead>
                                        <tr style="background: var(--surface-50);">
                                            <th>Vendor</th>
                                            <th>Lot</th>
                                            <th style="text-align: right;">Award Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="font-weight: 600;">MedSupply Ltd.</td>
                                            <td>Lot 1: PPE</td>
                                            <td style="text-align: right;">$118,500</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: 600;">HealthCare Corp.</td>
                                            <td>Lot 2: Diagnostic Equipment</td>
                                            <td style="text-align: right;">$228,900</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- CPC Deliberation -->
                            <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-xl); border: 1px solid var(--surface-200);">
                                <h3 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-lg);"> CPC Deliberation</h3>
                                
                                <div style="margin-bottom: var(--spacing-lg);">
                                    <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Competition Assessment</label>
                                    <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-sm);">
                                        <label style="display: flex; align-items: center; gap: var(--spacing-xs); cursor: pointer;">
                                            <input type="radio" name="competition-assessment" value="satisfactory" checked>
                                            <span style="font-size: 13px; color: var(--text-primary);">Satisfactory</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: var(--spacing-xs); cursor: pointer;">
                                            <input type="radio" name="competition-assessment" value="comments">
                                            <span style="font-size: 13px; color: var(--text-primary);">Comments</span>
                                        </label>
                                    </div>
                                    <textarea rows="2" placeholder="Add remarks on competition..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 12px;"></textarea>
                                </div>
                                
                                <div style="margin-bottom: var(--spacing-lg);">
                                    <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Evaluation Assessment</label>
                                    <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-sm);">
                                        <label style="display: flex; align-items: center; gap: var(--spacing-xs); cursor: pointer;">
                                            <input type="radio" name="evaluation-assessment" value="satisfactory" checked>
                                            <span style="font-size: 13px; color: var(--text-primary);">Satisfactory</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: var(--spacing-xs); cursor: pointer;">
                                            <input type="radio" name="evaluation-assessment" value="comments">
                                            <span style="font-size: 13px; color: var(--text-primary);">Comments</span>
                                        </label>
                                    </div>
                                    <textarea rows="2" placeholder="Add remarks on evaluation..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 12px;"></textarea>
                                </div>
                                
                                <div style="margin-bottom: var(--spacing-lg);">
                                    <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">VFM Assessment</label>
                                    <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-sm);">
                                        <label style="display: flex; align-items: center; gap: var(--spacing-xs); cursor: pointer;">
                                            <input type="radio" name="vfm-assessment" value="satisfactory" checked>
                                            <span style="font-size: 13px; color: var(--text-primary);">Satisfactory</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: var(--spacing-xs); cursor: pointer;">
                                            <input type="radio" name="vfm-assessment" value="comments">
                                            <span style="font-size: 13px; color: var(--text-primary);">Comments</span>
                                        </label>
                                    </div>
                                    <textarea rows="2" placeholder="Add remarks on value for money..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 12px;"></textarea>
                                </div>
                                
                                <div style="margin-bottom: var(--spacing-lg);">
                                    <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Capacity Assessment</label>
                                    <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-sm);">
                                        <label style="display: flex; align-items: center; gap: var(--spacing-xs); cursor: pointer;">
                                            <input type="radio" name="capacity-assessment" value="satisfactory">
                                            <span style="font-size: 13px; color: var(--text-primary);">Satisfactory</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: var(--spacing-xs); cursor: pointer;">
                                            <input type="radio" name="capacity-assessment" value="comments" checked>
                                            <span style="font-size: 13px; color: var(--text-primary);">Comments</span>
                                        </label>
                                    </div>
                                    <textarea rows="2" placeholder="Add remarks on capacity..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 12px;">Minor concerns regarding HealthCare Corp's previous unsatisfactory performance require monitoring.</textarea>
                                </div>
                            </div>

                            <!-- CPC Recommendation -->
                            <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-xl); border: 1px solid var(--surface-200);">
                                <h3 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-lg);"> CPC Recommendation</h3>
                                
                                <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                    <label style="flex: 1; padding: var(--spacing-md); border: 2px solid var(--success-300); border-radius: var(--radius-md); cursor: pointer; background: var(--success-50);">
                                        <input type="radio" name="cpc-recommendation" value="approve" checked style="margin-right: var(--spacing-sm);">
                                        <span style="font-weight: 600; color: var(--success-700);">Approve</span>
                                    </label>
                                    <label style="flex: 1; padding: var(--spacing-md); border: 2px solid var(--surface-300); border-radius: var(--radius-md); cursor: pointer;">
                                        <input type="radio" name="cpc-recommendation" value="approve-conditions" style="margin-right: var(--spacing-sm);">
                                        <span style="font-weight: 600; color: var(--text-primary);">Approve with Conditions</span>
                                    </label>
                                    <label style="flex: 1; padding: var(--spacing-md); border: 2px solid var(--surface-300); border-radius: var(--radius-md); cursor: pointer;">
                                        <input type="radio" name="cpc-recommendation" value="reject" style="margin-right: var(--spacing-sm);">
                                        <span style="font-weight: 600; color: var(--text-primary);">Reject</span>
                                    </label>
                                </div>
                                
                                <div id="conditionsBlock" style="display: none; margin-bottom: var(--spacing-lg);">
                                    <label style="font-size: 12px; font-weight: 600; color: var(--text-primary); display: block; margin-bottom: var(--spacing-sm);">Conditions</label>
                                    <textarea rows="3" placeholder="Specify conditions that must be met..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);"></textarea>
                                </div>
                                
                                <div style="display: flex; gap: var(--spacing-md);">
                                    <button class="btn btn-secondary" style="flex: 1;" onclick="saveCPCDraft()">Save Draft</button>
                                    <button class="btn btn-primary" style="flex: 1;" onclick="submitCPCRecommendation()">Submit for Voting</button>
                                </div>
                            </div>
                        </div>

                        <!-- Sidebar Column -->
                        <div>
                            <!-- Case Team -->
                            <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); border: 1px solid var(--surface-200);">
                                <h4 style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-md);"> Review Team</h4>
                                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm);">
                                        <div style="width: 32px; height: 32px; background: var(--primary-100); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; color: var(--primary-600);">JS</div>
                                        <div>
                                            <div style="font-weight: 600; font-size: 12px; color: var(--text-primary);">Jane Smith</div>
                                            <div style="font-size: 11px; color: var(--text-muted);">CPC Chair</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm);">
                                        <div style="width: 32px; height: 32px; background: var(--info-100); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; color: var(--info-600);">MB</div>
                                        <div>
                                            <div style="font-weight: 600; font-size: 12px; color: var(--text-primary);">Michael Brown</div>
                                            <div style="font-size: 11px; color: var(--text-muted);">CPC Associate</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm);">
                                        <div style="width: 32px; height: 32px; background: var(--purple-100); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; color: var(--purple-600);">AL</div>
                                        <div>
                                            <div style="font-weight: 600; font-size: 12px; color: var(--text-primary);">Alice Lee</div>
                                            <div style="font-size: 11px; color: var(--text-muted);">CPC Member</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Q&A Section -->
                            <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); border: 1px solid var(--surface-200);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                                    <h4 style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin: 0;"> Q&A (2)</h4>
                                    <button class="btn btn-secondary btn-sm" onclick="openCPCNewQuestion()">+ Question</button>
                                </div>
                                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                                    <div style="padding: var(--spacing-sm); background: var(--info-50); border-radius: var(--radius-sm); border-left: 3px solid var(--info-500);">
                                        <div style="font-size: 11px; color: var(--info-600); font-weight: 600;">Question from CPC Chair</div>
                                        <div style="font-size: 12px; color: var(--text-primary); margin-top: 2px;">Please clarify the vendor's capacity concerns...</div>
                                        <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">Awaiting response</div>
                                    </div>
                                    <div style="padding: var(--spacing-sm); background: var(--success-50); border-radius: var(--radius-sm); border-left: 3px solid var(--success-500);">
                                        <div style="font-size: 11px; color: var(--success-600); font-weight: 600;">Answered</div>
                                        <div style="font-size: 12px; color: var(--text-primary); margin-top: 2px;">What is the delivery timeline?</div>
                                        <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">Answered Dec 11</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Case Documents -->
                            <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); border: 1px solid var(--surface-200);">
                                <h4 style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-md);"> Documents</h4>
                                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                                    <a href="#" style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); text-decoration: none; color: var(--text-primary);">
                                        <span style="font-size: 16px;"></span>
                                        <span style="font-size: 12px;">Evaluation Report</span>
                                    </a>
                                    <a href="#" style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); text-decoration: none; color: var(--text-primary);">
                                        <span style="font-size: 16px;"></span>
                                        <span style="font-size: 12px;">Bid Opening Report</span>
                                    </a>
                                    <a href="#" style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); text-decoration: none; color: var(--text-primary);">
                                        <span style="font-size: 16px;"></span>
                                        <span style="font-size: 12px;">Technical Evaluation</span>
                                    </a>
                                </div>
                            </div>

                            <!-- Activity Log -->
                            <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-lg); border: 1px solid var(--surface-200);">
                                <h4 style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-md);"> Activity Log</h4>
                                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm); font-size: 11px;">
                                    <div style="padding: var(--spacing-sm); border-left: 2px solid var(--surface-300);">
                                        <div style="color: var(--text-muted);">Dec 11, 14:30</div>
                                        <div style="color: var(--text-primary);">Q&A question submitted by Jane Smith</div>
                                    </div>
                                    <div style="padding: var(--spacing-sm); border-left: 2px solid var(--surface-300);">
                                        <div style="color: var(--text-muted);">Dec 10, 16:00</div>
                                        <div style="color: var(--text-primary);">Case cleared by Clearing Authority</div>
                                    </div>
                                    <div style="padding: var(--spacing-sm); border-left: 2px solid var(--surface-300);">
                                        <div style="color: var(--text-muted);">Dec 10, 10:00</div>
                                        <div style="color: var(--text-primary);">Case submitted by John Smith</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End CPC Case Detail View -->

        </main>
    </div>

    <!-- Tender Preview Sidebar -->
    <div class="sidebar-panel" id="tender-preview-sidebar">
        <div class="sidebar-panel-header">
            <div>
                <div class="sidebar-panel-title">Tender Details</div>
                <div style="font-size: 13px; opacity: 0.9;" id="preview-tender-id">RFQ/2024/001</div>
            </div>
            <button class="modal-close" style="color: white;" onclick="closeTenderPreview()"></button>
        </div>
        <div class="sidebar-panel-body">
            <!-- Title -->
            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: var(--spacing-lg); color: var(--text-primary);" id="preview-tender-title">
                Supply of Medical Equipment
            </h3>

            <!-- Quick Actions -->
            <div style="display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-md);">
                <button class="btn btn-primary btn-sm" style="flex: 1;" onclick="closeTenderPreview(); openAmendModalFromPreview()">
                    <i class="pi pi-pencil"></i> Amend
                </button>
                <button class="btn btn-danger btn-sm" style="flex: 1;" onclick="closeTenderPreview(); openCancelModalFromPreview()">
                    <i class="pi pi-times-circle"></i> Cancel
                </button>
            </div>

            <button class="btn btn-secondary btn-sm" style="width: 100%; margin-bottom: var(--spacing-xl);" onclick="closeTenderPreview(); openClarificationsModal(currentTenderId, currentTenderTitle)">
                <i class="pi pi-comment"></i> Manage Clarifications (5)
            </button>

            <!-- General Information -->
            <div class="collapsible-section-compact">
                <div class="collapsible-header-compact" onclick="toggleCollapseSidebar(this)">
                    <span><strong> General Information</strong></span>
                    <span class="collapsible-icon"></span>
                </div>
                <div class="collapsible-content-compact" style="display: block;">
                    <div class="info-row">
                        <div class="info-label">Method</div>
                        <div class="info-value">ITB - Invitation to Bid</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Category</div>
                        <div class="info-value">Goods</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Value</div>
                        <div class="info-value">$250,000 USD</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Deadline</div>
                        <div class="info-value">15 Jan 2025, 23:59 UTC</div>
                    </div>
                </div>
            </div>

            <!-- Scope -->
            <div class="collapsible-section-compact">
                <div class="collapsible-header-compact" onclick="toggleCollapseSidebar(this)">
                    <span><strong> Scope & Description</strong></span>
                    <span class="collapsible-icon"></span>
                </div>
                <div class="collapsible-content-compact" style="display: block;">
                    <p style="font-size: 13px; line-height: 1.6; color: var(--text-secondary);">
                        Supply and delivery of medical equipment and supplies for healthcare facilities in multiple locations. Equipment must meet international standards and include installation and training services.
                    </p>
                </div>
            </div>

            <!-- Key Dates -->
            <div class="collapsible-section-compact">
                <div class="collapsible-header-compact" onclick="toggleCollapseSidebar(this)">
                    <span><strong> Key Dates</strong></span>
                    <span class="collapsible-icon"></span>
                </div>
                <div class="collapsible-content-compact">
                    <div class="info-row">
                        <div class="info-label">Published</div>
                        <div class="info-value">5 Dec 2024</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Clarification Deadline</div>
                        <div class="info-value">10 Jan 2025</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Submission Deadline</div>
                        <div class="info-value">15 Jan 2025, 23:59 UTC</div>
                    </div>
                </div>
            </div>

            <!-- Particulars -->
            <div class="collapsible-section-compact">
                <div class="collapsible-header-compact" onclick="toggleCollapseSidebar(this)">
                    <span><strong> Tender Particulars</strong></span>
                    <span class="collapsible-icon"></span>
                </div>
                <div class="collapsible-content-compact">
                    <div class="info-row">
                        <div class="info-label">Bid Security</div>
                        <div class="info-value">Required - $5,000</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Performance Security</div>
                        <div class="info-value">10% of contract value</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Alternative Offers</div>
                        <div class="info-value">Allowed</div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" style="width: 100%; margin-top: var(--spacing-lg);" onclick="closeTenderPreview(); showTenderDetails()">
                <i class="pi pi-external-link"></i> View Full Tender Details
            </button>
        </div>
    </div>

    <!-- Amendment Modal -->
    <div class="modal-overlay" id="amendModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-pencil"></i>
                    <span>Amend Tender: <span id="amendTenderTitle"></span></span>
                </h2>
                <button class="modal-close" onclick="closeAmendModal()"></button>
            </div>

            <div class="modal-body">
                <!-- Progress Steps -->
                <div class="progress-steps">
                    <div class="progress-step">
                        <span class="step-number active" id="step1-number">1</span>
                        <span class="step-label active" id="step1-label">Category</span>
                    </div>
                    <div class="step-connector"></div>
                    <div class="progress-step">
                        <span class="step-number" id="step2-number">2</span>
                        <span class="step-label" id="step2-label">Details</span>
                    </div>
                    <div class="step-connector"></div>
                    <div class="progress-step">
                        <span class="step-number" id="step3-number">3</span>
                        <span class="step-label" id="step3-label">Review</span>
                    </div>
                </div>

                <!-- Step 1: Category Selection -->
                <div id="amendment-step-1" class="amendment-step" style="display: block;">
                    <div class="alert alert-info">
                        <i class="pi pi-info-circle" style="font-size: 20px;"></i>
                        <div>
                            <strong>Select Amendment Category</strong>
                            <p style="margin-top: 4px; font-size: 13px;">
                                Choose categories that describe your amendment. Multiple selections allowed - the highest tier determines the approval workflow.
                            </p>
                        </div>
                    </div>

                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #15803d;">
                        Tier 1 Amendments - Author Posts Directly
                    </h3>
                    <div class="category-grid">
                        <div class="category-option">
                            <input type="checkbox" id="cat-deadline-extension" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-deadline-extension" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-1">Tier 1</span>
                                    Deadline Extension
                                </span>
                                <span class="category-description">Extend submission deadline</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-clarification-extension" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-clarification-extension" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-1">Tier 1</span>
                                    Clarification Extension
                                </span>
                                <span class="category-description">Extend clarifications deadline</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-award-date" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-award-date" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-1">Tier 1</span>
                                    Expected Award Date
                                </span>
                                <span class="category-description">Update expected contract award date</span>
                            </label>
                        </div>
                    </div>

                    <h3 style="font-size: 16px; font-weight: 600; margin: 24px 0 12px 0; color: #92400e;">
                        Tier 2 Amendments - Requires TME & PR Review
                    </h3>
                    <div class="category-grid">
                        <div class="category-option">
                            <input type="checkbox" id="cat-deadline-shortened" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-deadline-shortened" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Deadline Shortened
                                </span>
                                <span class="category-description">Shorten submission deadline</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-prebid-minutes" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-prebid-minutes" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Pre-bid Minutes
                                </span>
                                <span class="category-description">Upload pre-bid meeting documentation</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-document-revision" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-document-revision" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Document Revision
                                </span>
                                <span class="category-description">Add or revise tender documents</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-scope-change" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-scope-change" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Scope/Quantity Change
                                </span>
                                <span class="category-description">Modify tender scope or quantities</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-terms-conditions" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-terms-conditions" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Terms & Criteria
                                </span>
                                <span class="category-description">Update terms or evaluation criteria</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-price-adjustment" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-price-adjustment" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Price Adjustment
                                </span>
                                <span class="category-description">Modify pricing or financial terms</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-error-correction" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-error-correction" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Error Correction
                                </span>
                                <span class="category-description">Correct errors in documentation</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-other" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-other" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Other
                                </span>
                                <span class="category-description">Other amendments requiring review</span>
                            </label>
                        </div>
                    </div>

                    <!-- Workflow Preview -->
                    <div class="workflow-preview" id="workflow-preview" style="display: none;">
                        <div class="workflow-title">
                            <i class="pi pi-sitemap"></i> Amendment Workflow
                        </div>
                        <div id="workflow-display"></div>
                    </div>
                </div>

                <!-- Step 2: Amendment Details -->
                <div id="amendment-step-2" class="amendment-step">
                    <div class="alert alert-warning">
                        <i class="pi pi-exclamation-triangle" style="font-size: 20px;"></i>
                        <div>
                            <strong>Review & Confirm Deadlines</strong>
                            <p style="margin-top: 4px; font-size: 13px;">
                                System requires deadline review for all amendments. Update dates if changes warrant an extension.
                            </p>
                        </div>
                    </div>

                    <!-- Deadline Review -->
                    <div class="deadline-review">
                        <div class="deadline-review-title">
                            <i class="pi pi-calendar"></i> Review Tender Deadlines
                        </div>
                        <div class="deadline-fields">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Submission Deadline</label>
                                <input type="datetime-local" class="form-input" value="2024-12-15T23:59" id="submission-deadline">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Clarifications Deadline</label>
                                <input type="datetime-local" class="form-input" value="2024-12-08T23:59" id="clarification-deadline">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Expected Award Date</label>
                                <input type="date" class="form-input" value="2025-01-15" id="award-date">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Amendment Description</label>
                        <textarea class="form-textarea" id="amendment-description" placeholder="Provide a clear description of the changes being made..."></textarea>
                        <span class="help-text">This will be published to all suppliers</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Justification/Instructions to Bidders</label>
                        <textarea class="form-textarea" id="amendment-justification" placeholder="Explain the rationale for this amendment..."></textarea>
                        <span class="help-text">Provide context for suppliers about why this amendment is being made</span>
                    </div>

                    <div class="alert alert-danger">
                        <i class="pi pi-exclamation-triangle" style="font-size: 20px;"></i>
                        <div>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 0;">
                                <input type="checkbox" id="impacts-mandatory" onchange="toggleMandatoryImpact()">
                                <strong>This amendment impacts mandatory requirements</strong>
                            </label>
                            <p style="margin-top: 8px; font-size: 13px;">
                                All existing bid submissions will be invalidated and suppliers must resubmit
                            </p>
                        </div>
                    </div>

                    <div id="mandatory-impact-notice" style="display: none;">
                        <div class="alert alert-warning">
                            <i class="pi pi-info-circle" style="font-size: 20px;"></i>
                            <div>
                                <strong>Bid Invalidation Notice</strong>
                                <p style="margin-top: 4px; font-size: 13px;">
                                    All submitted bids will be invalidated. Suppliers will receive high-priority notification requiring bid review and resubmission.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Review & Submit -->
                <div id="amendment-step-3" class="amendment-step">
                    <div class="alert alert-success">
                        <i class="pi pi-check-circle" style="font-size: 20px;"></i>
                        <div>
                            <strong>Review Amendment Details</strong>
                            <p style="margin-top: 4px; font-size: 13px;">
                                Review all details before submitting. Amendment will follow the workflow displayed below.
                            </p>
                        </div>
                    </div>

                    <!-- Summary -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: 20px; margin-bottom: 20px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Amendment Summary</h3>
                        
                        <div style="display: grid; gap: 16px;">
                            <div>
                                <strong style="font-size: 13px; color: var(--text-muted);">Categories Selected:</strong>
                                <div id="review-categories" style="margin-top: 8px;"></div>
                            </div>
                            
                            <div>
                                <strong style="font-size: 13px; color: var(--text-muted);">Workflow Tier:</strong>
                                <div id="review-tier" style="margin-top: 8px;"></div>
                            </div>

                            <div>
                                <strong style="font-size: 13px; color: var(--text-muted);">Description:</strong>
                                <div id="review-description" style="margin-top: 8px; font-size: 14px;"></div>
                            </div>

                            <div>
                                <strong style="font-size: 13px; color: var(--text-muted);">Mandatory Requirements Impact:</strong>
                                <div id="review-mandatory" style="margin-top: 8px;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Final Workflow -->
                    <div class="workflow-preview">
                        <div class="workflow-title">
                            <i class="pi pi-sitemap"></i> Amendment Approval Workflow
                        </div>
                        <div id="final-workflow-display"></div>
                    </div>

                    <div class="alert alert-info">
                        <i class="pi pi-megaphone" style="font-size: 20px;"></i>
                        <div>
                            <strong>Upon Approval & Publication:</strong>
                            <ul style="margin: 8px 0 0 20px; font-size: 13px;">
                                <li>Amendment published to Agora and UNGM</li>
                                <li>All interested suppliers receive high-priority notifications</li>
                                <li>Summary of changes generated automatically</li>
                                <li>All changes logged in audit trail</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeAmendModal()">Cancel</button>
                <button class="btn btn-secondary" id="amendment-back-btn" onclick="previousAmendmentStep()" style="display: none;">
                    <i class="pi pi-arrow-left"></i> Back
                </button>
                <button class="btn btn-primary" id="amendment-next-btn" onclick="nextAmendmentStep()">
                    Next <i class="pi pi-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Clarifications Modal -->
    <div class="modal-overlay" id="clarificationsModal">
        <div class="modal" style="max-width: 1000px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-comment"></i>
                    <span>Manage Clarifications: <span id="clarificationsTenderTitle"></span></span>
                </h2>
                <button class="modal-close" onclick="closeClarificationsModal()"></button>
            </div>

            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="pi pi-info-circle" style="font-size: 20px;"></i>
                    <div>
                        <strong>Clarification Management</strong>
                        <p style="margin-top: 4px; font-size: 13px;">
                            View all supplier questions and provide responses. Questions are anonymized and responses are visible to all suppliers.
                        </p>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                    <select class="filter-select" style="flex: 1;">
                        <option value="all">All Questions</option>
                        <option value="pending">Pending Response</option>
                        <option value="answered">Answered</option>
                    </select>
                    <select class="filter-select" style="flex: 1;">
                        <option value="all">All Sections</option>
                        <option value="general">General Information</option>
                        <option value="technical">Technical Specifications</option>
                        <option value="pricing">Pricing</option>
                    </select>
                </div>

                <!-- Clarifications List -->
                <div style="max-height: 500px; overflow-y: auto;">
                    <!-- Question 1 - Answered -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
                            <div>
                                <span style="font-weight: 600; color: var(--primary-400);">Question #001</span>
                                <span style="margin-left: var(--spacing-md); font-size: 12px; color: var(--text-muted);">5 Dec 2024  General Information</span>
                            </div>
                            <span class="status-badge" style="background: var(--success-50); color: var(--success-500);">Answered</span>
                        </div>
                        
                        <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">QUESTION</div>
                            <p style="font-size: 14px; color: var(--text-primary);">What are the warranty requirements for the medical equipment?</p>
                        </div>
                        
                        <div style="background: var(--success-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">YOUR ANSWER</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Minimum 2 years parts and labor for all equipment. Warranty must be provided by the manufacturer or authorized distributor.</p>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: var(--spacing-sm);">Answered by: Jane Doe  6 Dec 2024</div>
                        </div>
                    </div>

                    <!-- Question 2 - Pending -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
                            <div>
                                <span style="font-weight: 600; color: var(--primary-400);">Question #002</span>
                                <span style="margin-left: var(--spacing-md); font-size: 12px; color: var(--text-muted);">8 Dec 2024  Technical Specifications</span>
                            </div>
                            <span class="status-badge" style="background: var(--warning-50); color: var(--warning-500);">Pending</span>
                        </div>
                        
                        <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">QUESTION</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Can we propose alternative UNSPSC codes if our products meet the specifications but have different classification?</p>
                        </div>
                        
                        <div style="background: var(--surface-100); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                            <textarea class="form-textarea" placeholder="Type your response here..." style="min-height: 100px;"></textarea>
                            <div style="display: flex; justify-content: flex-end; gap: var(--spacing-sm); margin-top: var(--spacing-sm);">
                                <button class="btn btn-secondary btn-sm">Save Draft</button>
                                <button class="btn btn-primary btn-sm">
                                    <i class="pi pi-send"></i> Publish Response
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Question 3 - Answered -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
                            <div>
                                <span style="font-weight: 600; color: var(--primary-400);">Question #003</span>
                                <span style="margin-left: var(--spacing-md); font-size: 12px; color: var(--text-muted);">9 Dec 2024  Technical Specifications</span>
                            </div>
                            <span class="status-badge" style="background: var(--success-50); color: var(--success-500);">Answered</span>
                        </div>
                        
                        <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">QUESTION</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Can ultrasound machines be from different manufacturers?</p>
                        </div>
                        
                        <div style="background: var(--success-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">YOUR ANSWER</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Yes, machines can be from different manufacturers as long as they meet the minimum specifications outlined in the tender documents and ISO standards.</p>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: var(--spacing-sm);">Answered by: Jane Doe  10 Dec 2024</div>
                        </div>
                    </div>

                    <!-- Question 4 - Pending -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
                            <div>
                                <span style="font-weight: 600; color: var(--primary-400);">Question #004</span>
                                <span style="margin-left: var(--spacing-md); font-size: 12px; color: var(--text-muted);">10 Dec 2024  Pricing</span>
                            </div>
                            <span class="status-badge" style="background: var(--warning-50); color: var(--warning-500);">Pending</span>
                        </div>
                        
                        <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">QUESTION</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Are shipping costs to be included in the unit price or quoted separately?</p>
                        </div>
                        
                        <div style="background: var(--surface-100); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                            <textarea class="form-textarea" placeholder="Type your response here..." style="min-height: 100px;"></textarea>
                            <div style="display: flex; justify-content: flex-end; gap: var(--spacing-sm); margin-top: var(--spacing-sm);">
                                <button class="btn btn-secondary btn-sm">Save Draft</button>
                                <button class="btn btn-primary btn-sm">
                                    <i class="pi pi-send"></i> Publish Response
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Question 5 - Answered -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
                            <div>
                                <span style="font-weight: 600; color: var(--primary-400);">Question #005</span>
                                <span style="margin-left: var(--spacing-md); font-size: 12px; color: var(--text-muted);">11 Dec 2024  General Information</span>
                            </div>
                            <span class="status-badge" style="background: var(--success-50); color: var(--success-500);">Answered</span>
                        </div>
                        
                        <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">QUESTION</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Is the pre-bid meeting mandatory for all bidders?</p>
                        </div>
                        
                        <div style="background: var(--success-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">YOUR ANSWER</div>
                            <p style="font-size: 14px; color: var(--text-primary);">No, the pre-bid meeting is optional. However, attendance is recommended to better understand the requirements. Minutes will be shared with all bidders after the meeting.</p>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: var(--spacing-sm);">Answered by: Jane Doe  11 Dec 2024</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeClarificationsModal()">Close</button>
                <button class="btn btn-secondary">
                    <i class="pi pi-download"></i> Export All Clarifications
                </button>
            </div>
        </div>
    </div>

    <!-- Cancel Modal -->
    <div class="modal-overlay" id="cancelModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-times-circle"></i>
                    <span>Cancel Tender: <span id="cancelTenderTitle"></span></span>
                </h2>
                <button class="modal-close" onclick="closeCancelModal()"></button>
            </div>

            <div class="modal-body">
                <div class="alert alert-danger">
                    <i class="pi pi-exclamation-triangle" style="font-size: 20px;"></i>
                    <div>
                        <strong>Warning: This action cannot be undone</strong>
                        <p style="margin-top: 4px; font-size: 13px;">
                            All participating suppliers will be notified and requisition lines will be released in ERP.
                        </p>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label required">Cancellation Reason (Internal)</label>
                    <select class="form-select" id="cancel-reason">
                        <option value="">Select a reason...</option>
                        <option value="lack-funds">Lack of Funds</option>
                        <option value="budget-reallocation">Budget Reallocation</option>
                        <option value="non-viable-pricing">Non-viable Pricing</option>
                        <option value="priority-change">Change in Organization Priority</option>
                        <option value="scope-modification">Project Scope Modification</option>
                        <option value="project-cancellation">Project Cancellation</option>
                        <option value="requirements-revision">Material Revision of Requirements</option>
                        <option value="restrictive-specs">Restrictive Specifications</option>
                        <option value="lack-compliant">Lack of Compliant Bids</option>
                        <option value="insufficient-competition">Insufficient Competition</option>
                        <option value="proscribed-practices">Suspicion/Evidence of Proscribed Practices</option>
                        <option value="poor-quality">Poor Quality of Bids</option>
                        <option value="procedural-issues">Procedural Irregularities</option>
                        <option value="conflict-interest">Conflict of Interest</option>
                        <option value="legal-changes">Legal or Regulatory Changes</option>
                    </select>
                    <span class="help-text">For internal analysis and audit purposes</span>
                </div>

                <div class="form-group">
                    <label class="form-label required">Internal Explanation</label>
                    <textarea class="form-textarea" id="cancel-internal-explanation" placeholder="Detailed explanation for internal records..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label required">Public Justification</label>
                    <textarea class="form-textarea" id="cancel-public-justification" placeholder="Justification to be shared with suppliers..."></textarea>
                    <span class="help-text">This will be published to all participating suppliers</span>
                </div>

                <div class="alert alert-info">
                    <i class="pi pi-info-circle" style="font-size: 20px;"></i>
                    <div>
                        <strong>After Cancellation:</strong>
                        <ul style="margin: 8px 0 0 20px; font-size: 13px;">
                            <li>All interested suppliers notified immediately</li>
                            <li>Submitted bids archived</li>
                            <li>Requisition lines released in ERP</li>
                            <li>Tender marked as "Cancelled" on Agora and UNGM</li>
                            <li>All details logged in audit trail</li>
                        </ul>
                    </div>
                </div>

                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-top: 20px;">
                    <input type="checkbox" id="confirm-cancellation">
                    <strong>I confirm that I want to cancel this tender</strong>
                </label>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeCancelModal()">Close</button>
                <button class="btn btn-danger" id="confirm-cancel-btn" onclick="submitCancellation()" disabled>
                    <i class="pi pi-times-circle"></i> Confirm Cancellation
                </button>
            </div>
        </div>
    </div>

    <!-- Document Viewer Modal -->
    <div class="modal-overlay" id="documentViewerModal">
        <div class="modal" style="max-width: 1200px; max-height: 90vh;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-file"></i>
                    <span id="docViewerTitle">Document Viewer</span>
                </h2>
                <button class="modal-close" onclick="closeDocumentViewer()"></button>
            </div>

            <div class="modal-body" style="padding: 0; max-height: calc(90vh - 200px); overflow: hidden;">
                <div style="background: var(--surface-50); padding: var(--spacing-md); border-bottom: 1px solid var(--surface-200); display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: var(--spacing-md); align-items: center;">
                        <span style="font-size: 14px; color: var(--text-secondary);" id="docViewerMeta">PDF Document</span>
                    </div>
                    <div style="display: flex; gap: var(--spacing-sm);">
                        <button class="btn btn-secondary btn-sm" onclick="downloadDocument()">
                            <i class="pi pi-download"></i> Download
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="printDocument()">
                            <i class="pi pi-print"></i> Print
                        </button>
                    </div>
                </div>
                <div style="height: calc(90vh - 250px); background: var(--surface-100); display: flex; align-items: center; justify-content: center; overflow: auto;">
                    <div style="background: white; padding: var(--spacing-2xl); box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-height: 600px; width: 100%; max-width: 850px;">
                        <div style="text-align: center; color: var(--text-muted); padding: var(--spacing-2xl);" id="docViewerContent">
                            <i class="pi pi-file-pdf" style="font-size: 64px; color: var(--primary-400); margin-bottom: var(--spacing-lg);"></i>
                            <h3 style="margin-bottom: var(--spacing-md); color: var(--text-primary);">Document Preview</h3>
                            <p style="margin-bottom: var(--spacing-lg);">This is a simulated document viewer.</p>
                            <div style="text-align: left; max-width: 700px; margin: 0 auto; line-height: 1.8; color: var(--text-secondary);">
                                <p style="margin-bottom: var(--spacing-md);"><strong>Document Information:</strong></p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li style="margin-bottom: var(--spacing-sm);"> <strong>Type:</strong> Technical Specification</li>
                                    <li style="margin-bottom: var(--spacing-sm);"> <strong>Size:</strong> 2.4 MB</li>
                                    <li style="margin-bottom: var(--spacing-sm);"> <strong>Date:</strong> 2024-11-12</li>
                                    <li style="margin-bottom: var(--spacing-sm);"> <strong>Status:</strong> Verified</li>
                                </ul>
                                <div style="margin-top: var(--spacing-xl); padding: var(--spacing-lg); background: var(--info-50); border-radius: var(--radius-sm); border-left: 4px solid var(--info-400);">
                                    <p style="font-size: 13px; color: var(--info-400);">
                                        <strong> Note:</strong> In production, this would display the actual PDF document with full viewing capabilities (zoom, pan, print, download).
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeDocumentViewer()">Close</button>
            </div>
        </div>
    </div>

    <!-- Assignment Configuration Modal -->
    <div class="modal-overlay" id="assignmentConfigModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-cog"></i>
                    <span>Assignment Configuration</span>
                </h2>
                <button class="modal-close" onclick="closeAssignmentConfigModal()"></button>
            </div>

            <div class="modal-body">
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
                    Choose how to split evaluation assignments for Technical and Financial stages.
                </p>

                <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                    <label style="display: flex; gap: var(--spacing-md); padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); cursor: pointer; border: 2px solid var(--primary-400);">
                        <input type="radio" name="assignmentMode" value="lot" checked style="margin-top: 3px;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;"> Split by Lot</div>
                            <div style="font-size: 12px; color: var(--text-muted);">
                                Assign evaluators to specific lots. Each evaluator evaluates all suppliers within their assigned lots.
                            </div>
                        </div>
                    </label>

                    <label style="display: flex; gap: var(--spacing-md); padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); cursor: pointer; border: 2px solid transparent;">
                        <input type="radio" name="assignmentMode" value="supplier" style="margin-top: 3px;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;"> Split by Supplier</div>
                            <div style="font-size: 12px; color: var(--text-muted);">
                                Assign evaluators to specific suppliers. Each evaluator evaluates all lots for their assigned suppliers.
                            </div>
                        </div>
                    </label>
                </div>

                <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-top: var(--spacing-lg); border-left: 4px solid var(--info-400);">
                    <strong style="font-size: 12px; color: var(--info-600);"> Note:</strong>
                    <p style="font-size: 12px; color: var(--text-secondary); margin-top: var(--spacing-xs); margin-bottom: 0;">
                        Eligibility and Qualification stages always evaluate at the bid level and are not split.
                    </p>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeAssignmentConfigModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveAssignmentConfig()">
                    <i class="pi pi-check"></i> Save Configuration
                </button>
            </div>
        </div>
    </div>

    <!-- Advanced Clarifications Modal -->
    <div class="modal-overlay" id="clarificationsAdvancedModal">
        <div class="modal" style="max-width: 1000px; max-height: 90vh;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-comments"></i>
                    <span>Manage Clarifications: <span id="clarificationsAdvTenderTitle"></span></span>
                </h2>
                <button class="modal-close" onclick="closeClarificationsAdvancedModal()"></button>
            </div>

            <div class="modal-body" style="max-height: calc(90vh - 200px); overflow-y: auto;">
                <!-- Actions Bar -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md);">
                    <div style="display: flex; gap: var(--spacing-sm);">
                        <button class="btn btn-secondary btn-sm" onclick="groupSelectedQuestions()">
                             Group Selected
                        </button>
                    </div>
                    <div style="display: flex; gap: var(--spacing-md); align-items: center;">
                        <select class="filter-select" style="padding: 6px 12px; font-size: 12px;">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="answered">Answered</option>
                        </select>
                        <select class="filter-select" style="padding: 6px 12px; font-size: 12px;">
                            <option value="all">All Visibility</option>
                            <option value="public">Public</option>
                            <option value="private">Private</option>
                        </select>
                    </div>
                </div>

                <!-- Questions List -->
                <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                    <!-- Question 1 - Answered, Public -->
                    <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg);">
                        <div style="display: flex; gap: var(--spacing-md); align-items: start;">
                            <input type="checkbox" class="question-checkbox" style="margin-top: 4px;">
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-sm);">
                                    <div>
                                        <span style="font-weight: 600; color: var(--primary-400);">Q#001</span>
                                        <span style="margin-left: var(--spacing-sm); font-size: 12px; color: var(--text-muted);">5 Dec 2024  General Information</span>
                                    </div>
                                    <div style="display: flex; gap: var(--spacing-xs);">
                                        <span class="visibility-badge public"> Public</span>
                                        <span class="status-badge" style="background: var(--success-50); color: var(--success-500);">Answered</span>
                                    </div>
                                </div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-sm);">
                                    From: <strong>Supplier A (MedSupply Ltd.)</strong>
                                </div>
                                <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                                    <strong style="font-size: 12px;">Question:</strong>
                                    <p style="margin: var(--spacing-xs) 0 0 0; font-size: 13px;">Can alternative brands be proposed for ultrasound probes as long as they meet the specifications?</p>
                                </div>
                                <div style="background: var(--success-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                    <strong style="font-size: 12px; color: var(--success-600);">Answer:</strong>
                                    <p style="margin: var(--spacing-xs) 0 0 0; font-size: 13px;">Yes, alternative brands are acceptable provided they meet or exceed all specified technical requirements.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Question 2 & 3 - Grouped, Answered -->
                    <div style="background: white; border: 2px solid var(--primary-200); border-radius: var(--radius-md); padding: var(--spacing-lg);">
                        <div style="display: flex; gap: var(--spacing-md); align-items: start;">
                            <input type="checkbox" class="question-checkbox" style="margin-top: 4px;">
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-sm);">
                                    <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                        <span style="font-weight: 600; color: var(--primary-400);">Q#002, Q#003</span>
                                        <span class="question-group-badge"> Grouped</span>
                                    </div>
                                    <div style="display: flex; gap: var(--spacing-xs);">
                                        <span class="visibility-badge public"> Public</span>
                                        <span class="status-badge" style="background: var(--success-50); color: var(--success-500);">Answered</span>
                                    </div>
                                </div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-sm);">
                                    From: <strong>Supplier B, Supplier C</strong>  6-7 Dec 2024
                                </div>
                                <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm);">
                                    <strong style="font-size: 12px;">Question (Q#002):</strong>
                                    <p style="margin: var(--spacing-xs) 0 0 0; font-size: 13px;">Is partial delivery acceptable for different equipment types?</p>
                                </div>
                                <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                                    <strong style="font-size: 12px;">Question (Q#003):</strong>
                                    <p style="margin: var(--spacing-xs) 0 0 0; font-size: 13px;">Can delivery be split across multiple shipments within the 90-day window?</p>
                                </div>
                                <div style="background: var(--success-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                    <strong style="font-size: 12px; color: var(--success-600);">Combined Answer:</strong>
                                    <p style="margin: var(--spacing-xs) 0 0 0; font-size: 13px;">Yes, partial deliveries are acceptable. Equipment may be delivered in multiple shipments as long as all items arrive within the specified delivery period for each category.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Question 4 - Private (Evaluation Phase), Pending -->
                    <div style="background: white; border: 1px solid var(--warning-300); border-radius: var(--radius-md); padding: var(--spacing-lg);">
                        <div style="display: flex; gap: var(--spacing-md); align-items: start;">
                            <input type="checkbox" class="question-checkbox" style="margin-top: 4px;">
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-sm);">
                                    <div>
                                        <span style="font-weight: 600; color: var(--primary-400);">Q#004</span>
                                        <span style="margin-left: var(--spacing-sm); font-size: 12px; color: var(--text-muted);">10 Dec 2024  Technical Specifications</span>
                                    </div>
                                    <div style="display: flex; gap: var(--spacing-xs);">
                                        <span class="visibility-badge private"> Private</span>
                                        <span class="status-badge" style="background: var(--warning-50); color: var(--warning-500);">Pending</span>
                                    </div>
                                </div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-sm);">
                                    From: <strong>Supplier A (MedSupply Ltd.)</strong>  <span style="color: var(--warning-500);">Evaluation Phase</span>
                                </div>
                                <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                                    <strong style="font-size: 12px;">Question:</strong>
                                    <p style="margin: var(--spacing-xs) 0 0 0; font-size: 13px;">We noticed our submitted specifications deviate slightly from requirement T-003. Can we provide clarification on why our solution still meets the functional requirements?</p>
                                </div>
                                
                                <!-- Response Area -->
                                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-sm);">
                                        <strong style="font-size: 12px;">Your Response:</strong>
                                        <div style="display: flex; gap: var(--spacing-xs);">
                                            <select style="padding: 4px 8px; font-size: 11px; border-radius: var(--radius-xs);" onchange="setQuestionVisibility('Q004', this.value)">
                                                <option value="private" selected> Private</option>
                                                <option value="public"> Public</option>
                                            </select>
                                            <button class="btn btn-secondary btn-sm" style="font-size: 10px; padding: 4px 8px;" onclick="referToPreviousAnswer('Q004')">
                                                 Refer to Previous
                                            </button>
                                        </div>
                                    </div>
                                    <textarea class="eval-comment-field" rows="3" placeholder="Enter your response..."></textarea>
                                    <div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-sm);">
                                        <button class="btn btn-ghost btn-sm" onclick="saveDraftAnswer('Q004')">Save Draft</button>
                                        <button class="btn btn-primary btn-sm" onclick="publishAnswer('Q004')">Publish Response</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Question 5 - Public, Pending -->
                    <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg);">
                        <div style="display: flex; gap: var(--spacing-md); align-items: start;">
                            <input type="checkbox" class="question-checkbox" style="margin-top: 4px;">
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-sm);">
                                    <div>
                                        <span style="font-weight: 600; color: var(--primary-400);">Q#005</span>
                                        <span style="margin-left: var(--spacing-sm); font-size: 12px; color: var(--text-muted);">11 Dec 2024  General Information</span>
                                    </div>
                                    <div style="display: flex; gap: var(--spacing-xs);">
                                        <span class="visibility-badge public"> Public</span>
                                        <span class="status-badge" style="background: var(--warning-50); color: var(--warning-500);">Pending</span>
                                    </div>
                                </div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-sm);">
                                    From: <strong>Supplier D (MedTech Inc.)</strong>
                                </div>
                                <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                                    <strong style="font-size: 12px;">Question:</strong>
                                    <p style="margin: var(--spacing-xs) 0 0 0; font-size: 13px;">What is the minimum warranty requirement for anesthesia machines? The tender document mentions "minimum 2 years" but the specs say "2-3 years".</p>
                                </div>
                                
                                <!-- Response Area -->
                                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-sm);">
                                        <strong style="font-size: 12px;">Your Response:</strong>
                                        <div style="display: flex; gap: var(--spacing-xs);">
                                            <select style="padding: 4px 8px; font-size: 11px; border-radius: var(--radius-xs);" onchange="setQuestionVisibility('Q005', this.value)">
                                                <option value="public" selected> Public</option>
                                                <option value="private"> Private</option>
                                            </select>
                                            <button class="btn btn-secondary btn-sm" style="font-size: 10px; padding: 4px 8px;" onclick="referToPreviousAnswer('Q005')">
                                                 Refer to Previous
                                            </button>
                                        </div>
                                    </div>
                                    <textarea class="eval-comment-field" rows="3" placeholder="Enter your response..."></textarea>
                                    <div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-sm);">
                                        <button class="btn btn-ghost btn-sm" onclick="saveDraftAnswer('Q005')">Save Draft</button>
                                        <button class="btn btn-primary btn-sm" onclick="publishAnswer('Q005')">Publish Response</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeClarificationsAdvancedModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Refer to Previous Answer Modal -->
    <div class="modal-overlay" id="referAnswerModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-link"></i>
                    <span>Refer to Previous Answer</span>
                </h2>
                <button class="modal-close" onclick="closeReferAnswerModal()"></button>
            </div>

            <div class="modal-body">
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
                    Select a previous answer to link this question to, or use as a template for your response.
                </p>

                <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                    <label style="display: flex; gap: var(--spacing-md); padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); cursor: pointer; border: 2px solid transparent;" onclick="this.querySelector('input').checked = true; this.style.borderColor = 'var(--primary-400)';">
                        <input type="radio" name="referAnswer" value="q001" style="margin-top: 3px;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px; font-size: 13px;">Q#001: Alternative brands for ultrasound probes</div>
                            <div style="font-size: 12px; color: var(--text-muted);">
                                "Yes, alternative brands are acceptable provided they meet or exceed all specified technical requirements."
                            </div>
                        </div>
                    </label>

                    <label style="display: flex; gap: var(--spacing-md); padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); cursor: pointer; border: 2px solid transparent;">
                        <input type="radio" name="referAnswer" value="q002" style="margin-top: 3px;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px; font-size: 13px;">Q#002/Q#003: Partial delivery / Multiple shipments</div>
                            <div style="font-size: 12px; color: var(--text-muted);">
                                "Yes, partial deliveries are acceptable. Equipment may be delivered in multiple shipments..."
                            </div>
                        </div>
                    </label>
                </div>

                <div style="margin-top: var(--spacing-lg);">
                    <label style="display: flex; gap: var(--spacing-sm); align-items: center; cursor: pointer;">
                        <input type="checkbox" id="copyAsTemplate">
                        <span style="font-size: 13px;">Copy answer as template (edit before publishing)</span>
                    </label>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeReferAnswerModal()">Cancel</button>
                <button class="btn btn-primary" onclick="applyReferredAnswer()">
                    <i class="pi pi-check"></i> Apply
                </button>
            </div>
        </div>
    </div>

    <!-- Evaluation Team Assignment Modal -->
    <div class="modal-overlay" id="evaluationTeamModal">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-users"></i>
                    <span>Manage Evaluation Team</span>
                </h2>
                <button class="modal-close" onclick="closeEvaluationTeamModal()"></button>
            </div>

            <div class="modal-body">
                <!-- Assignment Mode Toggle -->
                <div style="background: var(--primary-50); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg); border-left: 4px solid var(--primary-400); display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong style="font-size: 13px; color: var(--primary-600);">Assignment Mode:</strong>
                        <span id="currentModeDisplay" style="margin-left: var(--spacing-sm); font-size: 13px;">Split by Lot</span>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="closeEvaluationTeamModal(); openAssignmentConfigModal();">
                         Change Mode
                    </button>
                </div>

                <!-- Evaluation Team Setup -->
                <div style="margin-bottom: var(--spacing-xl);">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: var(--spacing-md); color: var(--text-primary);">
                        Evaluation Stages Assignment
                    </h3>
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
                        Assign evaluators to each evaluation stage. Eligibility and Qualification are at bid level. Technical and Financial are split based on your selected mode.
                    </p>

                    <!-- Stage 1: Eligibility (Always Bid Level) -->
                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200);">
                        <div style="font-weight: 600; margin-bottom: var(--spacing-sm); display: flex; justify-content: space-between; align-items: center;">
                            <span>Step 1: Eligibility & Formal Criteria <span style="font-size: 10px; color: var(--text-muted); font-weight: 400;">(Bid Level)</span></span>
                            <span style="font-size: 11px; color: var(--success-500);"> 2 Assigned</span>
                        </div>
                        <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                            <div class="eval-team-badge">John Smith <button onclick="removeFromStage(1, 'john')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;"></button></div>
                            <div class="eval-team-badge">Sarah Johnson <button onclick="removeFromStage(1, 'sarah')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;"></button></div>
                            <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToStage(1)"><i class="pi pi-plus"></i> Add</button>
                        </div>
                    </div>

                    <!-- Stage 2: Qualification (Always Bid Level) -->
                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200);">
                        <div style="font-weight: 600; margin-bottom: var(--spacing-sm); display: flex; justify-content: space-between; align-items: center;">
                            <span>Step 2: Qualification Criteria <span style="font-size: 10px; color: var(--text-muted); font-weight: 400;">(Bid Level)</span></span>
                            <span style="font-size: 11px; color: var(--success-500);"> 2 Assigned</span>
                        </div>
                        <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                            <div class="eval-team-badge">John Smith <button onclick="removeFromStage(2, 'john')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;"></button></div>
                            <div class="eval-team-badge">Sarah Johnson <button onclick="removeFromStage(2, 'sarah')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;"></button></div>
                            <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToStage(2)"><i class="pi pi-plus"></i> Add</button>
                        </div>
                    </div>

                    <!-- Stage 3: Technical (Dynamic - By Lot or Supplier) -->
                    <div id="technicalAssignmentSection" style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200);">
                        <!-- Content will be rendered by JavaScript -->
                    </div>

                    <!-- Stage 4: Financial (Dynamic - By Lot or Supplier) -->
                    <div id="financialAssignmentSection" style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-md); border: 1px solid var(--surface-200);">
                        <!-- Content will be rendered by JavaScript -->
                    </div>
                </div>

                <!-- Available Evaluators Pool -->
                <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-md); border-left: 4px solid var(--info-400);">
                    <h4 style="font-size: 14px; font-weight: 600; margin-bottom: var(--spacing-sm); color: var(--info-600);">
                         Available Evaluators
                    </h4>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: var(--spacing-sm);">
                        Select evaluators from your organization's roster:
                    </div>
                    <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                        <span class="eval-team-badge" style="background: white;">John Smith</span>
                        <span class="eval-team-badge" style="background: white;">Sarah Johnson</span>
                        <span class="eval-team-badge" style="background: white;">Maria Garcia</span>
                        <span class="eval-team-badge" style="background: white;">David Lee</span>
                        <span class="eval-team-badge" style="background: white;">Anna Chen</span>
                        <span class="eval-team-badge" style="background: white;">Michael Brown</span>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeEvaluationTeamModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveEvaluationTeam()">
                    <i class="pi pi-check"></i> Save Team Assignment
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTenderId = null;
        let currentTenderTitle = null;
        let currentAmendmentStep = 1;
        let selectedCategories = [];
        let highestTier = 1;

        // View Management
        function showDashboard(menuItem) {
            // Hide all view sections - force inline style as well
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show dashboard
            const dashboard = document.getElementById('view-dashboard');
            if (dashboard) {
                dashboard.classList.add('active');
                dashboard.style.display = 'block';
            }
            
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            if (menuItem) {
                menuItem.classList.add('active');
            } else {
                document.getElementById('menu-tendering-overview')?.classList.add('active');
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ==================== TENDERS LIST FUNCTIONALITY ====================
        
        function showTendersList(menuItem) {
            // Hide all view sections - force inline style as well
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show tenders list view
            const tendersList = document.getElementById('view-tenders-list');
            if (tendersList) {
                tendersList.classList.add('active');
                tendersList.style.display = 'block';
            }
            
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            if (menuItem) {
                menuItem.classList.add('active');
            } else {
                document.getElementById('menu-tendering-tenders')?.classList.add('active');
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // ==================== ACTION MENU FUNCTIONALITY ====================
        
        function toggleActionMenu(button) {
            // Close all other open menus
            document.querySelectorAll('.action-menu-dropdown').forEach(dropdown => {
                if (dropdown !== button.nextElementSibling) {
                    dropdown.style.display = 'none';
                }
            });
            
            // Toggle the clicked menu
            const dropdown = button.nextElementSibling;
            if (dropdown.style.display === 'none' || dropdown.style.display === '') {
                dropdown.style.display = 'block';
            } else {
                dropdown.style.display = 'none';
            }
        }
        
        // Close action menus when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.action-menu-container')) {
                document.querySelectorAll('.action-menu-dropdown').forEach(dropdown => {
                    dropdown.style.display = 'none';
                });
            }
        });
        
        // Helper functions for menu actions
        function viewTenderPreview(tenderId, tenderTitle) {
            showToast(' Quick preview: ' + tenderId + ' - ' + tenderTitle);
            closeAllActionMenus();
        }
        
        function openCancelModal(tenderId, tenderTitle) {
            showToast(' Opening cancellation dialog for ' + tenderId);
            closeAllActionMenus();
        }
        
        function closeAllActionMenus() {
            document.querySelectorAll('.action-menu-dropdown').forEach(dropdown => {
                dropdown.style.display = 'none';
            });
        }
        
        function filterTendersListTable() {
            const statusFilter = document.getElementById('tenders-list-status-filter').value;
            const typeFilter = document.getElementById('tenders-list-type-filter').value;
            const searchTerm = document.getElementById('tenders-list-search').value.toLowerCase();
            
            const rows = document.querySelectorAll('#tenders-list-tbody .tender-row');
            let visibleCount = 0;
            
            rows.forEach((row, index) => {
                const status = row.getAttribute('data-status');
                const type = row.getAttribute('data-type');
                const text = row.textContent.toLowerCase();
                
                const statusMatch = statusFilter === 'all' || status === statusFilter;
                const typeMatch = typeFilter === 'all' || type === typeFilter;
                const searchMatch = searchTerm === '' || text.includes(searchTerm);
                
                if (statusMatch && typeMatch && searchMatch) {
                    row.style.display = '';
                    row.style.background = visibleCount % 2 === 0 ? '' : 'var(--surface-50)';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function sortTendersListTable() {
            const sortBy = document.getElementById('tenders-list-sort').value;
            const tbody = document.getElementById('tenders-list-tbody');
            const rows = Array.from(tbody.querySelectorAll('.tender-row'));
            
            rows.sort((a, b) => {
                switch (sortBy) {
                    case 'recent':
                        return 0; // Keep original order (most recent first)
                    case 'deadline':
                        const deadlineA = a.getAttribute('data-deadline') || '9999-99-99';
                        const deadlineB = b.getAttribute('data-deadline') || '9999-99-99';
                        return deadlineA.localeCompare(deadlineB);
                    case 'value-desc':
                        const valueDescA = parseInt(a.getAttribute('data-value')) || 0;
                        const valueDescB = parseInt(b.getAttribute('data-value')) || 0;
                        return valueDescB - valueDescA;
                    case 'value-asc':
                        const valueAscA = parseInt(a.getAttribute('data-value')) || 0;
                        const valueAscB = parseInt(b.getAttribute('data-value')) || 0;
                        return valueAscA - valueAscB;
                    case 'reference':
                        const refA = a.querySelector('td').textContent;
                        const refB = b.querySelector('td').textContent;
                        return refA.localeCompare(refB);
                    default:
                        return 0;
                }
            });
            
            // Re-append rows in sorted order
            rows.forEach((row, index) => {
                row.style.background = index % 2 === 0 ? '' : 'var(--surface-50)';
                tbody.appendChild(row);
            });
        }

        // ==================== EVALUATION REPORT FUNCTIONALITY ====================
        
        function showEvaluationReport() {
            // Hide all sections - force inline styles
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show evaluation report
            const reportView = document.getElementById('view-evaluation-report');
            if (reportView) {
                reportView.classList.add('active');
                reportView.style.display = 'block';
            }
            
            // Pre-populate data from current tender/evaluation
            populateReportData();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showToast(' Evaluation Report generated. Please review and complete all required fields.');
        }
        
        function populateReportData() {
            // This would pull data from the current tender evaluation
            // For now, using mock data that matches the evaluation
            document.getElementById('report-tender-ref').textContent = 'ITB/2024/023';
            document.getElementById('report-project-name').textContent = 'Emergency Medical Response Initiative';
            
            // Update funds value based on award amounts
            const totalAward = 362400.00;
            const contingency = totalAward * 0.07; // 7% contingency
            document.getElementById('fundsValueReportDisplay').textContent = '$' + (totalAward + contingency).toLocaleString(undefined, {minimumFractionDigits: 2}) + ' USD';
        }
        
        function showEvaluationBasic() {
            // Hide all view sections - force inline styles
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show evaluation
            const evaluation = document.getElementById('view-evaluation');
            if (evaluation) {
                evaluation.classList.add('active');
                evaluation.style.display = 'block';
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function toggleReportSection(sectionId) {
            const content = document.getElementById(sectionId);
            const icon = document.getElementById(sectionId + '-icon');
            
            if (!content || !icon) return;
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(180deg)';
            }
        }
        
        function expandAllReportSections() {
            const sectionIds = ['section-tender-summary', 'section-award', 'section-competition', 'section-evaluation', 'section-vfm', 'section-capacity', 'section-signoff', 'section-review-content'];
            sectionIds.forEach(sectionId => {
                const content = document.getElementById(sectionId);
                const icon = document.getElementById(sectionId + '-icon');
                if (content) {
                    content.style.display = 'block';
                    if (icon) icon.style.transform = 'rotate(0deg)';
                }
            });
            showToast(' All sections expanded');
        }
        
        function collapseAllReportSections() {
            const sectionIds = ['section-tender-summary', 'section-award', 'section-competition', 'section-evaluation', 'section-vfm', 'section-capacity', 'section-signoff', 'section-review-content'];
            sectionIds.forEach(sectionId => {
                const content = document.getElementById(sectionId);
                const icon = document.getElementById(sectionId + '-icon');
                if (content) {
                    content.style.display = 'none';
                    if (icon) icon.style.transform = 'rotate(180deg)';
                }
            });
            showToast(' All sections collapsed');
        }
        
        function toggleFundsCheckReport(show) {
            const block = document.getElementById('fundsCheckReportBlock');
            if (block) block.style.display = show ? 'grid' : 'none';
        }
        
        function toggleFundsStatusReport() {
            const container = document.getElementById('fundsStatusReportContainer');
            const justification = document.getElementById('fundsJustificationReportBlock');
            
            if (container.style.background.includes('success') || container.style.background === '') {
                container.style.background = 'var(--warning-50)';
                container.style.borderColor = 'var(--warning-200)';
                justification.style.display = 'block';
            } else {
                container.style.background = 'var(--success-50)';
                container.style.borderColor = 'var(--success-200)';
                justification.style.display = 'none';
            }
        }
        
        function toggleIncotermsReport() {
            const type = document.getElementById('report-requirement-type').value;
            const incotermsBlock = document.getElementById('incotermsReportBlock');
            if (incotermsBlock) {
                incotermsBlock.style.display = (type === 'goods' || type === 'goods_services') ? 'block' : 'none';
            }
        }
        
        function toggleLtaBusinessCaseReport() {
            const vehicle = document.getElementById('report-contract-vehicle').value;
            const ltaBlock = document.getElementById('ltaBusinessCaseReportBlock');
            if (ltaBlock) {
                ltaBlock.style.display = (vehicle === 'lta' || vehicle === 'lta_po_contract') ? 'block' : 'none';
            }
        }
        
        function toggleEppFieldsReport(show) {
            const fields = document.getElementById('eppFieldsReport');
            if (fields) fields.style.display = show ? 'block' : 'none';
        }
        
        function toggleRetenderLessons() {
            const checked = document.getElementById('report-retender').checked;
            const block = document.getElementById('retenderLessonsBlock');
            if (block) block.style.display = checked ? 'block' : 'none';
        }
        
        function toggleMedicalWaiverReport() {
            const checked = document.getElementById('report-medical').checked;
            const block = document.getElementById('medicalWaiverReportBlock');
            if (block) block.style.display = checked ? 'block' : 'none';
        }
        
        function toggleWaiverJiraReport() {
            const checked = document.getElementById('report-medical-waiver').checked;
            const block = document.getElementById('medicalJiraReportBlock');
            if (block) block.style.display = checked ? 'block' : 'none';
        }
        
        function toggleLeaseDetailsReport() {
            const checked = document.getElementById('report-lease').checked;
            const block = document.getElementById('leaseDetailsReport');
            if (block) block.style.display = checked ? 'block' : 'none';
        }
        
        function toggleRetenderLessons() {
            const checked = document.getElementById('report-retender').checked;
            const block = document.getElementById('retenderLessonsBlock');
            if (block) block.style.display = checked ? 'block' : 'none';
        }
        
        function toggleLgApprovalReport() {
            const incoterm = document.getElementById('report-incoterms').value;
            const block = document.getElementById('lgApprovalReportBlock');
            if (block) block.style.display = (incoterm === 'dap' || incoterm === 'ddp') ? 'block' : 'none';
        }
        
        function toggleAdvancedChecks() {
            const checked = document.getElementById('advancedChecksRequired').checked;
            const content = document.getElementById('advancedChecksContent');
            if (content) content.style.display = checked ? 'block' : 'none';
        }
        
        function signAffidavitReport(checkbox) {
            const card = checkbox.closest('.panel-member-card');
            const signBtn = card.querySelector('.btn-sign-report');
            const affidavitTs = card.querySelector('.affidavit-ts');
            const now = new Date();
            const timeString = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
            
            if (checkbox.checked) {
                affidavitTs.textContent = ' Signed: ' + timeString;
                affidavitTs.style.display = 'block';
                affidavitTs.style.color = 'var(--success-600)';
                
                signBtn.disabled = false;
                signBtn.style.background = 'var(--primary-500)';
                signBtn.style.color = 'white';
                signBtn.style.cursor = 'pointer';
            } else {
                affidavitTs.style.display = 'none';
                
                signBtn.disabled = true;
                signBtn.style.background = 'var(--surface-200)';
                signBtn.style.color = 'var(--text-muted)';
                signBtn.style.cursor = 'not-allowed';
            }
            
            checkPanelSignaturesReport();
        }
        
        function signOffReport(btn) {
            const card = btn.closest('.panel-member-card');
            const reportTs = card.querySelector('.report-ts');
            const now = new Date();
            const timeString = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
            
            card.dataset.signed = 'true';
            card.style.background = 'var(--success-50)';
            card.style.borderColor = 'var(--success-200)';
            
            btn.style.display = 'none';
            reportTs.textContent = ' Signed: ' + timeString;
            reportTs.style.display = 'block';
            
            checkPanelSignaturesReport();
        }
        
        function checkPanelSignaturesReport() {
            const cards = document.querySelectorAll('#panel-signatures-report .panel-member-card');
            let signedCount = 0;
            
            cards.forEach(card => {
                if (card.dataset.signed === 'true') signedCount++;
            });
            
            const remaining = cards.length - signedCount;
            const statusDiv = document.getElementById('panelStatusReport');
            const reviewSection = document.getElementById('section-review-award');
            const badge = document.getElementById('reportStatusBadge');
            
            if (remaining === 0) {
                // All signed - show review section
                reviewSection.style.display = 'block';
                statusDiv.style.background = 'var(--success-50)';
                statusDiv.style.borderColor = 'var(--success-200)';
                statusDiv.style.color = 'var(--success-700)';
                statusDiv.innerHTML = ' All ' + cards.length + ' panel members have signed. Ready for review.';
                
                badge.textContent = 'DRAFT - CPC Report';
                badge.style.background = 'rgba(255,220,100,0.3)';
                
                showToast(' All signatures collected! Review section unlocked.');
            } else {
                reviewSection.style.display = 'none';
                statusDiv.style.background = 'var(--warning-50)';
                statusDiv.style.borderColor = 'var(--warning-200)';
                statusDiv.style.color = 'var(--warning-700)';
                statusDiv.innerHTML = ' Waiting for ' + remaining + ' member(s) to complete signatures.';
                
                badge.textContent = 'DRAFT - Evaluation Report';
            }
        }
        
        function updateReportRecommendation() {
            const isCpc = document.getElementById('reportReviewBody').value === 'cpc';
            const submittingOfficerBlock = document.getElementById('submittingOfficerReportBlock');
            
            if (submittingOfficerBlock) {
                submittingOfficerBlock.style.display = isCpc ? 'block' : 'none';
            }
            
            const badge = document.getElementById('reportStatusBadge');
            if (badge) {
                badge.textContent = isCpc ? 'DRAFT - CPC Report' : 'Under Review';
            }
        }
        
        function saveReportDraft() {
            showToast(' Report draft saved successfully!');
        }
        
        function exportReportPDF() {
            showToast(' Generating PDF report...');
            setTimeout(() => {
                showToast(' PDF exported successfully!');
            }, 1500);
        }
        
        function submitFinalRecommendation() {
            const status = document.getElementById('reportRecStatus').value;
            const reviewBody = document.getElementById('reportReviewBody').value;
            
            let message = '';
            if (status === 'approve') {
                message = ' Recommendation submitted for ' + (reviewBody === 'cpc' ? 'CPC' : 'Reviewer') + ' approval!';
            } else if (status === 'comment') {
                message = ' Case returned with comments for revision.';
            } else {
                message = ' Recommendation rejected. Case returned.';
            }
            
            showToast(message);
            
            // Update badge
            const badge = document.getElementById('reportStatusBadge');
            if (badge) {
                badge.textContent = 'Submitted for Review';
                badge.style.background = 'rgba(100,200,100,0.3)';
            }
        }
        
        function searchCPCCases() {
            showToast(' Opening CPC case search...');
        }
        
        // ==================== CPC DASHBOARD FUNCTIONALITY ====================
        
        function showCPCDashboard(menuItem) {
            // Hide all view sections - force inline style
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show CPC dashboard
            const cpcDashboard = document.getElementById('view-cpc-dashboard');
            if (cpcDashboard) {
                cpcDashboard.classList.add('active');
                cpcDashboard.style.display = 'block';
            }
            
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            if (menuItem) {
                menuItem.classList.add('active');
            } else {
                const menuOverview = document.getElementById('menu-cpc-overview');
                if (menuOverview) menuOverview.classList.add('active');
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function showCPCCases(menuItem) {
            // Hide all view sections - force inline styles
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show CPC dashboard
            const cpcDashboard = document.getElementById('view-cpc-dashboard');
            if (cpcDashboard) {
                cpcDashboard.classList.add('active');
                cpcDashboard.style.display = 'block';
            }
            
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            if (menuItem) menuItem.classList.add('active');
            
            showToast(' Cases view - showing all cases');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function showCPCMeetings(menuItem) {
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            if (menuItem) menuItem.classList.add('active');
            showToast(' Meetings management coming soon...');
        }
        
        function showCPCPoolManagement(menuItem) {
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            if (menuItem) menuItem.classList.add('active');
            showToast(' Pool management coming soon...');
        }
        
        function showCPCQA(menuItem) {
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            if (menuItem) menuItem.classList.add('active');
            showToast(' Q&A / Clarifications view coming soon...');
        }
        
        function filterCPCCases(filter) {
            showToast(' Filtering cases by: ' + filter);
            // In production, this would filter the cases grid
        }
        
        function viewCPCCasePreview(caseId) {
            showToast(' Quick preview: ' + caseId);
        }
        
        function joinCPCDeliberation(caseId) {
            showToast(' Joining deliberation meeting for ' + caseId);
        }
        
        function downloadCPCReport(caseId) {
            showToast(' Downloading report for ' + caseId);
        }
        
        function openBidOpeningFromDashboard(tenderId) {
            showToast(' Opening bid opening for ' + tenderId);
        }
        
        function continueEvaluation(tenderId) {
            // Navigate to the evaluation view for this tender
            showEvaluation(tenderId, 'IT Infrastructure Services', 'evaluator');
            showToast(' Continuing evaluation for ' + tenderId);
        }
        
        function openCPCCase(caseId) {
            // Hide all view sections - force inline styles
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show CPC case detail
            const cpcCase = document.getElementById('view-cpc-case');
            if (cpcCase) {
                cpcCase.classList.add('active');
                cpcCase.style.display = 'block';
            }
            
            // Update case ID display
            document.getElementById('cpc-case-id').textContent = caseId;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showToast(' Opening case ' + caseId);
        }
        
        function openCPCQA(caseId) {
            openCPCCase(caseId);
            // Scroll to Q&A section
            setTimeout(() => {
                showToast(' Q&A section for case ' + caseId);
            }, 500);
        }
        
        function viewMeetingDetails(meetingId) {
            showToast(' Opening meeting ' + meetingId);
        }
        
        function viewFullEvaluationReport() {
            showToast(' Opening full evaluation report...');
        }
        
        function openCPCNewQuestion() {
            showToast(' Opening new question form...');
            // In a real implementation, this would open a modal
        }
        
        function saveCPCDraft() {
            showToast(' Draft saved successfully!');
        }
        
        function submitCPCRecommendation() {
            const recommendation = document.querySelector('input[name="cpc-recommendation"]:checked').value;
            
            let message = '';
            if (recommendation === 'approve') {
                message = ' Recommendation submitted for voting: APPROVE';
            } else if (recommendation === 'approve-conditions') {
                message = ' Recommendation submitted for voting: APPROVE WITH CONDITIONS';
            } else {
                message = ' Recommendation submitted for voting: REJECT';
            }
            
            showToast(message);
            
            // Update status badge
            const badge = document.getElementById('cpc-case-status-badge');
            if (badge) {
                badge.textContent = 'Submitted for Voting';
                badge.style.background = 'rgba(139,92,246,0.3)';
            }
        }
        
        // Update submitFinalRecommendation to create CPC case
        function submitFinalRecommendation() {
            const status = document.getElementById('reportRecStatus').value;
            const reviewBody = document.getElementById('reportReviewBody').value;
            
            // Generate a new CPC case ID
            const caseId = 'CPC-2025-00' + (42 + Math.floor(Math.random() * 10));
            
            let message = '';
            if (reviewBody === 'cpc') {
                message = ' Case ' + caseId + ' created and submitted to CPC for review!';
            } else {
                message = ' Submitted to Reviewer for approval!';
            }
            
            showToast(message);
            
            // Update badge
            const badge = document.getElementById('reportStatusBadge');
            if (badge) {
                badge.textContent = 'Submitted - ' + caseId;
                badge.style.background = 'rgba(100,200,100,0.3)';
            }
            
            // Show prompt to go to CPC dashboard
            setTimeout(() => {
                if (confirm('Case submitted successfully! Would you like to view it in the CPC Dashboard?')) {
                    showCPCDashboard();
                }
            }, 1000);
        }

        // ==================== BID OPENING FUNCTIONALITY ====================
        
        // Mock bid data for demonstration
        const bidOpeningData = {
            'ITB/2024/089': {
                tenderRef: 'ITB/2024/089',
                tenderTitle: 'Medical Supplies Procurement - Emergency Response Kit',
                tenderType: 'ITB',
                evaluationMethod: 'Lowest Priced Substantially Compliant',
                closingDate: 'Dec 1, 2024, 14:00 UTC',
                budgetEstimate: 150000,
                currency: 'USD',
                panelRequired: false,
                panelMembers: [],
                bids: [
                    {
                        id: 'BID-001',
                        rank: 1,
                        vendorName: 'HealthCare Corp.',
                        ungmNumber: '301245',
                        country: 'USA',
                        womenOwned: true,
                        jvConsortia: false,
                        totalOffer: 115200,
                        currency: 'USD',
                        submittedAt: 'Dec 1, 2024, 13:45:22 UTC',
                        sanctionStatus: 'clear',
                        comments: 'We can deliver within 30 days of contract signature. All items comply with WHO standards.',
                        discount: '5% early payment discount available'
                    },
                    {
                        id: 'BID-002',
                        rank: 2,
                        vendorName: 'MedSupply Ltd.',
                        ungmNumber: '309663',
                        country: 'Germany',
                        womenOwned: false,
                        jvConsortia: false,
                        totalOffer: 118500,
                        currency: 'USD',
                        submittedAt: 'Dec 1, 2024, 12:30:15 UTC',
                        sanctionStatus: 'clear',
                        comments: 'ISO 13485 certified manufacturer. Extended warranty available.',
                        discount: null
                    },
                    {
                        id: 'BID-003',
                        rank: 3,
                        vendorName: 'MedTech Inc.',
                        ungmNumber: '315789',
                        country: 'Japan',
                        womenOwned: false,
                        jvConsortia: false,
                        totalOffer: 125400,
                        currency: 'USD',
                        submittedAt: 'Dec 1, 2024, 11:20:33 UTC',
                        sanctionStatus: 'clear',
                        comments: 'Premium quality products with 2-year warranty included.',
                        discount: '3% volume discount for orders over $100,000'
                    },
                    {
                        id: 'BID-004',
                        rank: 4,
                        vendorName: 'Global Medical Solutions',
                        ungmNumber: '298456',
                        country: 'India',
                        womenOwned: true,
                        jvConsortia: true,
                        jvPartners: ['MediPharm India', 'HealthEquip Co.'],
                        totalOffer: 98750,
                        currency: 'USD',
                        submittedAt: 'Dec 1, 2024, 10:15:44 UTC',
                        sanctionStatus: 'clear',
                        comments: 'Joint venture bid. Combined manufacturing capacity ensures timely delivery.',
                        discount: null
                    },
                    {
                        id: 'BID-005',
                        rank: 5,
                        vendorName: 'EuroMed Supplies',
                        ungmNumber: '312890',
                        country: 'Netherlands',
                        womenOwned: false,
                        jvConsortia: false,
                        totalOffer: 132800,
                        currency: 'EUR',
                        totalOfferUSD: 142200,
                        submittedAt: 'Nov 30, 2024, 22:45:10 UTC',
                        sanctionStatus: 'clear',
                        comments: 'EU GMP certified. Can provide training for equipment use.',
                        discount: '2% discount for full prepayment'
                    },
                    {
                        id: 'BID-006',
                        rank: 6,
                        vendorName: 'MediCare International',
                        ungmNumber: '305672',
                        country: 'South Africa',
                        womenOwned: true,
                        jvConsortia: false,
                        totalOffer: 145600,
                        currency: 'USD',
                        submittedAt: 'Nov 30, 2024, 18:30:55 UTC',
                        sanctionStatus: 'under_review',
                        comments: 'Local manufacturing capability. Can provide after-sales support.',
                        discount: null
                    }
                ]
            },
            'RFP/2024/067': {
                tenderRef: 'RFP/2024/067',
                tenderTitle: 'Security Services Contract',
                tenderType: 'RFP',
                evaluationMethod: 'Cumulative Analysis',
                closingDate: 'Nov 28, 2024, 17:00 UTC',
                budgetEstimate: 500000,
                currency: 'USD',
                panelRequired: true,
                panelMembers: [
                    { name: 'John Smith', role: 'Panel Chair', email: 'john.smith@unops.org', finalized: true },
                    { name: 'Maria Garcia', role: 'Panel Member', email: 'maria.garcia@unops.org', finalized: true },
                    { name: 'Ahmed Hassan', role: 'Panel Member', email: 'ahmed.hassan@unops.org', finalized: false }
                ],
                bids: [
                    {
                        id: 'BID-101',
                        rank: 1,
                        vendorName: 'SecureGuard Global',
                        ungmNumber: '287456',
                        country: 'UK',
                        womenOwned: false,
                        jvConsortia: false,
                        totalOffer: 425000,
                        currency: 'USD',
                        submittedAt: 'Nov 28, 2024, 16:30:12 UTC',
                        sanctionStatus: 'clear',
                        comments: 'Over 20 years experience in UN security operations.',
                        discount: null
                    },
                    {
                        id: 'BID-102',
                        rank: 2,
                        vendorName: 'SafeNet Security',
                        ungmNumber: '295123',
                        country: 'USA',
                        womenOwned: false,
                        jvConsortia: false,
                        totalOffer: 468000,
                        currency: 'USD',
                        submittedAt: 'Nov 28, 2024, 15:45:33 UTC',
                        sanctionStatus: 'clear',
                        comments: 'ISO 18788 certified. Extensive regional presence.',
                        discount: '5% for multi-year contract'
                    },
                    {
                        id: 'BID-103',
                        rank: 3,
                        vendorName: 'Regional Protection Services',
                        ungmNumber: '302789',
                        country: 'Kenya',
                        womenOwned: true,
                        jvConsortia: true,
                        jvPartners: ['LocalGuard Ltd.', 'PanAfrica Security'],
                        totalOffer: 395000,
                        currency: 'USD',
                        submittedAt: 'Nov 28, 2024, 14:20:45 UTC',
                        sanctionStatus: 'clear',
                        comments: 'Local consortium with deep regional expertise and networks.',
                        discount: null
                    }
                ]
            }
        };

        let currentBidOpeningData = null;

        function showBidOpening(tenderId, tenderTitle, tenderType) {
            // Get bid opening data
            currentBidOpeningData = bidOpeningData[tenderId] || {
                tenderRef: tenderId,
                tenderTitle: tenderTitle || 'Tender',
                tenderType: tenderType || 'ITB',
                evaluationMethod: 'Lowest Priced Substantially Compliant',
                closingDate: 'Dec 1, 2024, 14:00 UTC',
                budgetEstimate: 150000,
                currency: 'USD',
                panelRequired: false,
                panelMembers: [],
                bids: bidOpeningData['ITB/2024/089'].bids // Use sample bids
            };

            // Switch to bid opening view - hide all sections first
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show bid opening view
            const bidView = document.getElementById('view-bid-opening');
            if (bidView) {
                bidView.classList.add('active');
                bidView.style.display = 'block';
            }

            // Update header info
            document.getElementById('bid-opening-tender-title').textContent = currentBidOpeningData.tenderTitle;
            document.getElementById('bid-opening-tender-ref').textContent = 'Reference: ' + currentBidOpeningData.tenderRef;
            document.getElementById('bid-opening-close-date').textContent = currentBidOpeningData.closingDate;

            // Update type badge
            const typeBadge = document.getElementById('bid-opening-type-badge');
            if (currentBidOpeningData.tenderType === 'RFP') {
                typeBadge.textContent = 'RFP - Two Reports (Tech + Financial)';
                typeBadge.style.background = 'var(--info-50)';
                typeBadge.style.color = 'var(--info-500)';
            } else {
                typeBadge.textContent = currentBidOpeningData.tenderType + ' - Single Report';
                typeBadge.style.background = 'var(--primary-50)';
                typeBadge.style.color = 'var(--primary-500)';
            }

            // Update summary cards
            document.getElementById('bid-opening-total-bids').textContent = currentBidOpeningData.bids.length;
            
            const lowestBid = currentBidOpeningData.bids.reduce((min, bid) => 
                (bid.totalOfferUSD || bid.totalOffer) < (min.totalOfferUSD || min.totalOffer) ? bid : min
            );
            document.getElementById('bid-opening-lowest-offer').textContent = formatCurrency(lowestBid.totalOffer, lowestBid.currency);
            document.getElementById('bid-opening-lowest-offer').nextElementSibling.textContent = lowestBid.vendorName;

            document.getElementById('bid-opening-budget').textContent = formatCurrency(currentBidOpeningData.budgetEstimate, currentBidOpeningData.currency);

            // Update panel status
            const panelStatusEl = document.getElementById('bid-opening-panel-status');
            const panelSection = document.getElementById('bid-opening-panel-section');
            if (currentBidOpeningData.panelRequired) {
                panelStatusEl.textContent = 'Required';
                panelStatusEl.style.color = 'var(--info-500)';
                panelSection.style.display = 'block';
                renderPanelMembers(currentBidOpeningData.panelMembers);
            } else {
                panelStatusEl.textContent = 'Not Required';
                panelStatusEl.style.color = 'var(--warning-500)';
                panelSection.style.display = 'none';
            }

            // Render bids table
            renderBidOpeningTable(currentBidOpeningData.bids);

            // Render bidder comments
            renderBidderComments(currentBidOpeningData.bids);

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function formatCurrency(amount, currency) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency || 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function renderBidOpeningTable(bids) {
            const tbody = document.getElementById('bid-opening-table-body');
            
            // Sort bids by total offer (ascending)
            const sortedBids = [...bids].sort((a, b) => 
                (a.totalOfferUSD || a.totalOffer) - (b.totalOfferUSD || b.totalOffer)
            );

            // Assign ranks (handle ties)
            let currentRank = 1;
            let previousOffer = null;
            sortedBids.forEach((bid, index) => {
                const offer = bid.totalOfferUSD || bid.totalOffer;
                if (previousOffer !== null && offer !== previousOffer) {
                    currentRank = index + 1;
                }
                bid.displayRank = currentRank;
                previousOffer = offer;
            });

            tbody.innerHTML = sortedBids.map((bid, index) => `
                <tr style="background: ${index === 0 ? 'var(--success-50)' : index % 2 === 0 ? 'white' : 'var(--surface-50)'}; ${bid.sanctionStatus !== 'clear' ? 'border-left: 3px solid var(--warning-400);' : ''}">
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--surface-100);">
                        <span style="display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; border-radius: 50%; background: ${index === 0 ? 'var(--success-500)' : 'var(--surface-200)'}; color: ${index === 0 ? 'white' : 'var(--text-primary)'}; font-weight: 700; font-size: 12px;">
                            ${bid.displayRank}
                        </span>
                    </td>
                    <td style="padding: 12px; border-bottom: 1px solid var(--surface-100);">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <a href="#" onclick="event.preventDefault(); viewBidDetails('${bid.id}')" style="color: var(--primary-500); font-weight: 600; text-decoration: none;">
                                ${bid.vendorName}
                            </a>
                            ${bid.womenOwned ? '<span title="Women-Owned Business" style="font-size: 14px;"></span>' : ''}
                        </div>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--surface-100); font-family: monospace; font-size: 11px;">
                        ${bid.ungmNumber}
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--surface-100);">
                        <span style="font-size: 11px;">${bid.country}</span>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--surface-100);">
                        ${bid.womenOwned ? 
                            '<span style="color: var(--success-500); font-weight: 600;"> Yes</span>' : 
                            '<span style="color: var(--text-muted);">No</span>'}
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--surface-100);">
                        ${bid.jvConsortia ? 
                            `<span style="display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; background: var(--info-50); color: var(--info-600); border-radius: var(--radius-xs); font-size: 10px; cursor: pointer;" onclick="showJVDetails('${bid.id}')">
                                 JV <i class="pi pi-info-circle" style="font-size: 10px;"></i>
                            </span>` : 
                            '<span style="color: var(--text-muted);"></span>'}
                    </td>
                    <td style="padding: 12px; text-align: right; border-bottom: 1px solid var(--surface-100);">
                        <div style="font-weight: 700; color: ${index === 0 ? 'var(--success-600)' : 'var(--text-primary)'}; font-size: 13px;">
                            ${formatCurrency(bid.totalOffer, bid.currency)}
                        </div>
                        ${bid.totalOfferUSD && bid.currency !== 'USD' ? 
                            `<div style="font-size: 10px; color: var(--text-muted);"> ${formatCurrency(bid.totalOfferUSD, 'USD')}</div>` : ''}
                        ${bid.discount ? 
                            `<div style="font-size: 9px; color: var(--success-500); margin-top: 2px;"> Discount available</div>` : ''}
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--surface-100);">
                        <span style="font-size: 11px; font-weight: 500;">${bid.currency}</span>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--surface-100);">
                        <div style="font-size: 10px; color: var(--text-primary);">${bid.submittedAt.split(',')[0]}</div>
                        <div style="font-size: 9px; color: var(--text-muted);">${bid.submittedAt.split(',').slice(1).join(',').trim()}</div>
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--surface-100);">
                        ${bid.sanctionStatus === 'clear' ? 
                            '<span style="padding: 2px 8px; background: var(--success-50); color: var(--success-600); border-radius: var(--radius-xs); font-size: 10px;"> Clear</span>' :
                            '<span style="padding: 2px 8px; background: var(--warning-50); color: var(--warning-600); border-radius: var(--radius-xs); font-size: 10px;"> Review</span>'}
                    </td>
                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--surface-100);">
                        <button class="btn btn-secondary btn-sm" onclick="viewBidDetails('${bid.id}')" title="View Full Bid" style="font-size: 10px; padding: 4px 8px;">
                            <i class="pi pi-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function renderBidderComments(bids) {
            const container = document.getElementById('bidder-comments-list');
            const bidsWithComments = bids.filter(bid => bid.comments);

            if (bidsWithComments.length === 0) {
                container.innerHTML = '<div style="font-size: 12px; color: var(--text-muted); padding: var(--spacing-md); text-align: center;">No comments provided by bidders.</div>';
                return;
            }

            container.innerHTML = bidsWithComments.map(bid => `
                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm); border-left: 3px solid var(--primary-300);">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px;">
                        <span style="font-weight: 600; font-size: 12px; color: var(--primary-500);">${bid.vendorName}</span>
                        <span style="font-size: 10px; color: var(--text-muted);">UNGM: ${bid.ungmNumber}</span>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary);">${bid.comments}</div>
                    ${bid.discount ? `<div style="font-size: 11px; color: var(--success-600); margin-top: 4px; padding: 4px 8px; background: var(--success-50); border-radius: var(--radius-xs); display: inline-block;"> ${bid.discount}</div>` : ''}
                </div>
            `).join('');
        }

        function renderPanelMembers(members) {
            const container = document.getElementById('panel-members-list');
            document.getElementById('panel-members-count').textContent = members.length + ' Members';

            container.innerHTML = members.map(member => `
                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm); display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: 600; font-size: 13px; color: var(--text-primary);">${member.name}</div>
                        <div style="font-size: 11px; color: var(--text-muted);">${member.role}  ${member.email}</div>
                    </div>
                    <span style="padding: 4px 10px; border-radius: var(--radius-sm); font-size: 10px; font-weight: 600; ${member.finalized ? 
                        'background: var(--success-50); color: var(--success-600);' : 
                        'background: var(--warning-50); color: var(--warning-600);'}">
                        ${member.finalized ? ' Finalized' : ' Pending'}
                    </span>
                </div>
            `).join('');
        }

        function toggleBidOpeningSection(section) {
            const content = document.getElementById(section + '-content');
            const icon = document.getElementById(section + '-icon');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function setupBidOpeningPanel() {
            const modalHtml = `
                <div id="panelSetupModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="if(event.target===this) this.remove()">
                    <div style="background: white; border-radius: var(--radius-lg); width: 500px; max-width: 95%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg);">
                        <div style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-400) 100%); color: white; padding: var(--spacing-lg); border-radius: var(--radius-lg) var(--radius-lg) 0 0;">
                            <h3 style="margin: 0; font-size: 16px;"> Setup Bid Opening Panel</h3>
                            <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">Add members to the bid opening panel</div>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <div style="margin-bottom: var(--spacing-lg);">
                                <label style="display: block; font-size: 12px; font-weight: 500; margin-bottom: var(--spacing-xs);">Search for staff member:</label>
                                <div style="display: flex; gap: var(--spacing-sm);">
                                    <input type="text" id="panel-member-search" placeholder="Enter name or email..." style="flex: 1; padding: var(--spacing-sm); border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 13px;">
                                    <button class="btn btn-primary btn-sm" onclick="addPanelMember()">
                                        <i class="pi pi-plus"></i> Add
                                    </button>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: var(--spacing-lg);">
                                <label style="display: block; font-size: 12px; font-weight: 500; margin-bottom: var(--spacing-sm);">Panel Members:</label>
                                <div id="panel-setup-members" style="border: 1px solid var(--surface-200); border-radius: var(--radius-sm); min-height: 100px;">
                                    <div style="padding: var(--spacing-md); text-align: center; color: var(--text-muted); font-size: 12px;">
                                        No panel members added yet
                                    </div>
                                </div>
                            </div>

                            <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-lg);">
                                <div style="font-size: 11px; color: var(--info-600);">
                                    <strong>Note:</strong> A bid opening panel is required for:
                                    <ul style="margin: 8px 0 0 16px; padding: 0;">
                                        <li>Public bid openings</li>
                                        <li>Offline tenders with offline bid opening</li>
                                    </ul>
                                </div>
                            </div>

                            <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end;">
                                <button class="btn btn-secondary" onclick="document.getElementById('panelSetupModal').remove()">Cancel</button>
                                <button class="btn btn-primary" onclick="savePanelSetup()">Save Panel</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function addPanelMember() {
            const searchInput = document.getElementById('panel-member-search');
            const name = searchInput.value.trim();
            if (!name) return;

            const container = document.getElementById('panel-setup-members');
            if (container.querySelector('.no-members')) {
                container.innerHTML = '';
            }

            const memberHtml = `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-sm); border-bottom: 1px solid var(--surface-100);">
                    <div>
                        <div style="font-weight: 500; font-size: 12px;">${name}</div>
                        <div style="font-size: 10px; color: var(--text-muted);">${name.toLowerCase().replace(/\s+/g, '.')}@unops.org</div>
                    </div>
                    <select style="font-size: 11px; padding: 4px 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-xs);">
                        <option>Panel Member</option>
                        <option>Panel Chair</option>
                    </select>
                    <button class="btn btn-secondary btn-sm" onclick="this.parentElement.remove()" style="padding: 4px 8px;">
                        <i class="pi pi-times"></i>
                    </button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', memberHtml);
            searchInput.value = '';
        }

        function savePanelSetup() {
            document.getElementById('panelSetupModal').remove();
            document.getElementById('bid-opening-panel-status').textContent = 'Configured';
            document.getElementById('bid-opening-panel-status').style.color = 'var(--success-500)';
            document.getElementById('bid-opening-panel-section').style.display = 'block';
            showToast(' Bid Opening Panel configured successfully');
        }

        function viewBidDetails(bidId) {
            const bid = currentBidOpeningData.bids.find(b => b.id === bidId);
            if (!bid) return;

            const modalHtml = `
                <div id="bidDetailsModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="if(event.target===this) this.remove()">
                    <div style="background: white; border-radius: var(--radius-lg); width: 600px; max-width: 95%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg);">
                        <div style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-400) 100%); color: white; padding: var(--spacing-lg); border-radius: var(--radius-lg) var(--radius-lg) 0 0; position: sticky; top: 0;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <h3 style="margin: 0; font-size: 18px;">${bid.vendorName}</h3>
                                    <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">UNGM: ${bid.ungmNumber}  ${bid.country}</div>
                                </div>
                                <span style="background: white; color: var(--primary-500); padding: 4px 12px; border-radius: var(--radius-sm); font-weight: 700; font-size: 14px;">
                                    Rank #${bid.displayRank || bid.rank}
                                </span>
                            </div>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <!-- Bid Summary -->
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm); text-align: center;">
                                    <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase;">Total Offer</div>
                                    <div style="font-size: 18px; font-weight: 700; color: var(--success-600);">${formatCurrency(bid.totalOffer, bid.currency)}</div>
                                </div>
                                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm); text-align: center;">
                                    <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase;">Women Owned</div>
                                    <div style="font-size: 16px; font-weight: 600; color: ${bid.womenOwned ? 'var(--success-500)' : 'var(--text-muted)'};">${bid.womenOwned ? ' Yes' : 'No'}</div>
                                </div>
                                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm); text-align: center;">
                                    <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase;">Sanction Status</div>
                                    <div style="font-size: 14px; font-weight: 600; color: ${bid.sanctionStatus === 'clear' ? 'var(--success-500)' : 'var(--warning-500)'};">
                                        ${bid.sanctionStatus === 'clear' ? ' Clear' : ' Under Review'}
                                    </div>
                                </div>
                            </div>

                            <!-- Details -->
                            <div style="display: grid; gap: var(--spacing-md);">
                                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                    <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;"> Submission Time</div>
                                    <div style="font-size: 13px; color: var(--text-primary);">${bid.submittedAt}</div>
                                </div>
                                
                                ${bid.jvConsortia ? `
                                    <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); border-left: 3px solid var(--info-400);">
                                        <div style="font-size: 10px; color: var(--info-600); text-transform: uppercase; margin-bottom: 4px;"> Joint Venture / Consortia</div>
                                        <div style="font-size: 13px; color: var(--text-primary);">
                                            Partners: ${bid.jvPartners ? bid.jvPartners.join(', ') : 'Details in bid documents'}
                                        </div>
                                    </div>
                                ` : ''}

                                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                    <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;"> Bidder Comments</div>
                                    <div style="font-size: 13px; color: var(--text-primary);">${bid.comments || 'No comments provided'}</div>
                                </div>

                                ${bid.discount ? `
                                    <div style="background: var(--success-50); padding: var(--spacing-md); border-radius: var(--radius-sm); border-left: 3px solid var(--success-400);">
                                        <div style="font-size: 10px; color: var(--success-600); text-transform: uppercase; margin-bottom: 4px;"> Discount Offered</div>
                                        <div style="font-size: 13px; color: var(--success-700);">${bid.discount}</div>
                                    </div>
                                ` : ''}
                            </div>

                            <!-- Actions -->
                            <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end; margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid var(--surface-200);">
                                <button class="btn btn-secondary" onclick="document.getElementById('bidDetailsModal').remove()">Close</button>
                                <button class="btn btn-primary" onclick="previewBidDocuments('${bid.id}')">
                                    <i class="pi pi-folder-open"></i> View Bid Documents
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function showJVDetails(bidId) {
            const bid = currentBidOpeningData.bids.find(b => b.id === bidId);
            if (!bid || !bid.jvConsortia) return;

            showToast(` Joint Venture Partners: ${bid.jvPartners ? bid.jvPartners.join(', ') : 'See bid documents for details'}`);
        }

        function previewBidDocuments(bidId) {
            showToast(' Opening bid documents viewer...');
            // In real implementation, this would open a document viewer
        }

        function showBidOpeningSettings() {
            toggleBidOpeningSection('confidentiality');
        }

        function downloadBidOpeningReport(format) {
            if (format === 'pdf') {
                showToast(' Generating PDF report... Download will start shortly.');
            } else if (format === 'excel') {
                showToast(' Generating Excel file... Download will start shortly.');
            }
            
            // Simulate download
            setTimeout(() => {
                const filename = `BOR_${currentBidOpeningData.tenderRef.replace(/\//g, '-')}_${new Date().toISOString().split('T')[0]}.${format === 'pdf' ? 'pdf' : 'xlsx'}`;
                showToast(` ${filename} downloaded successfully`);
            }, 1500);
        }

        function saveBidOpeningDraft() {
            showToast(' Bid Opening draft saved successfully');
        }

        function finalizeBidOpening() {
            // Check confidentiality settings
            const showFinancial = document.getElementById('show-financial-offer').checked;
            const showName = document.getElementById('show-bidder-name').checked;
            const justification = document.getElementById('confidentiality-justification').value;

            if ((!showFinancial || !showName) && !justification.trim()) {
                showToast(' Please provide justification for hidden fields', 'warning');
                toggleBidOpeningSection('confidentiality');
                document.getElementById('confidentiality-justification').focus();
                return;
            }

            // Show confirmation modal
            const modalHtml = `
                <div id="finalizeConfirmModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="if(event.target===this) this.remove()">
                    <div style="background: white; border-radius: var(--radius-lg); width: 450px; max-width: 95%; box-shadow: var(--shadow-lg);">
                        <div style="background: linear-gradient(135deg, var(--success-500) 0%, var(--success-400) 100%); color: white; padding: var(--spacing-lg); border-radius: var(--radius-lg) var(--radius-lg) 0 0;">
                            <h3 style="margin: 0; font-size: 16px;"> Finalize Bid Opening</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <div style="margin-bottom: var(--spacing-lg);">
                                <p style="margin: 0 0 var(--spacing-md) 0; font-size: 13px; color: var(--text-secondary);">
                                    You are about to finalize the bid opening for:
                                </p>
                                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                    <div style="font-weight: 600; color: var(--text-primary);">${currentBidOpeningData.tenderTitle}</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">${currentBidOpeningData.tenderRef}</div>
                                </div>
                            </div>
                            
                            <div style="background: var(--warning-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-lg);">
                                <div style="font-size: 12px; color: var(--warning-700);">
                                    <strong> This action will:</strong>
                                    <ul style="margin: 8px 0 0 16px; padding: 0;">
                                        <li>Send the Bid Opening Report to all ${currentBidOpeningData.bids.length} bidders</li>
                                        <li>Grant the evaluation team access to bid details</li>
                                        <li>Move the tender to Evaluation stage</li>
                                    </ul>
                                </div>
                            </div>

                            <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end;">
                                <button class="btn btn-secondary" onclick="document.getElementById('finalizeConfirmModal').remove()">Cancel</button>
                                <button class="btn btn-success" onclick="confirmFinalizeBidOpening()">
                                    <i class="pi pi-check-circle"></i> Confirm & Finalize
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function confirmFinalizeBidOpening() {
            document.getElementById('finalizeConfirmModal').remove();
            
            // Update status
            document.getElementById('bid-opening-status').innerHTML = ' Finalized';
            document.getElementById('bid-opening-status').style.background = 'var(--success-100)';
            document.getElementById('bid-opening-status').style.color = 'var(--success-600)';

            showToast(' Bid Opening finalized! Report sent to all bidders. Tender moved to Evaluation stage.');

            // Simulate transition to evaluation
            setTimeout(() => {
                showToast(' Bid Opening Report sent to ' + currentBidOpeningData.bids.length + ' bidders');
            }, 2000);
        }

        // ==================== END BID OPENING FUNCTIONALITY ====================

        // Store current tender data
        let currentTenderData = {};

        function showTenderDetails(tenderData) {
            // Store tender data
            if (tenderData) {
                currentTenderData = tenderData;
                currentTenderId = tenderData.id;
                currentTenderTitle = tenderData.title;
            } else if (currentTenderId && !currentTenderData.id) {
                // Fallback: if called without data but currentTenderId is set (from preview)
                currentTenderData = {
                    id: currentTenderId,
                    title: currentTenderTitle,
                    status: 'Posted',
                    statusKey: 'active'
                };
            }

            // Switch to details view - hide all sections first
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show tender details view
            const detailsView = document.getElementById('view-tender-details');
            if (detailsView) {
                detailsView.classList.add('active');
                detailsView.style.display = 'block';
            }
            
            // Update banner info
            document.getElementById('details-tender-id').textContent = 'Reference: ' + (currentTenderData.id || currentTenderId);
            document.getElementById('details-tender-title').textContent = currentTenderData.title || currentTenderTitle;
            document.getElementById('details-tender-status').textContent = currentTenderData.status || 'Posted';
            
            // Update action buttons based on status
            updateDetailsActions(currentTenderData.statusKey || 'active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateDetailsActions(statusKey) {
            const actionsContainer = document.getElementById('tender-details-actions');
            
            // Define actions for each status
            const actionsByStatus = {
                'active': `
                    <button class="btn btn-primary" onclick="openAmendModalFromDetails()">
                        <i class="pi pi-pencil"></i> Amend Tender
                    </button>
                    <button class="btn btn-danger" onclick="openCancelModalFromDetails()">
                        <i class="pi pi-times-circle"></i> Cancel Tender
                    </button>
                    <button class="btn btn-secondary" onclick="openClarificationsFromDetails()">
                        <i class="pi pi-comment"></i> Manage Clarifications (5)
                    </button>
                `,
                'draft': `
                    <button class="btn btn-primary">
                        <i class="pi pi-pencil"></i> Continue Editing
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-send"></i> Submit for Pre-Clearance
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-copy"></i> Duplicate
                    </button>
                    <button class="btn btn-danger">
                        <i class="pi pi-trash"></i> Delete Draft
                    </button>
                `,
                'pre-clearance': `
                    <button class="btn btn-secondary">
                        <i class="pi pi-history"></i> View Comments
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-download"></i> Download Package
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-pencil"></i> Edit (Return to Draft)
                    </button>
                `,
                'approval': `
                    <button class="btn btn-secondary">
                        <i class="pi pi-history"></i> View Review Comments
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-users"></i> View Reviewers
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-pencil"></i> Edit (Return to Draft)
                    </button>
                `,
                'tme-signed': `
                    <button class="btn btn-success">
                        <i class="pi pi-send"></i> Publish Tender
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-eye"></i> Preview Public Page
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-download"></i> Download Package
                    </button>
                `,
                'closed': `
                    <button class="btn btn-success" onclick="showBidOpening(currentTenderData.id, currentTenderData.title, currentTenderData.type || 'ITB')">
                        <i class="pi pi-envelope-open"></i> Start Bid Opening
                    </button>
                    <button class="btn btn-secondary" onclick="showBidOpening(currentTenderData.id, currentTenderData.title, currentTenderData.type || 'ITB')">
                        <i class="pi pi-users"></i> View Bidders
                    </button>
                    <button class="btn btn-secondary" onclick="downloadBidOpeningReport('excel')">
                        <i class="pi pi-download"></i> Download All Bids
                    </button>
                `,
                'bid-opening': `
                    <button class="btn btn-success" onclick="showBidOpening(currentTenderData.id, currentTenderData.title, currentTenderData.type || 'ITB')">
                        <i class="pi pi-folder-open"></i> Continue Opening
                    </button>
                    <button class="btn btn-secondary" onclick="downloadBidOpeningReport('pdf')">
                        <i class="pi pi-file-pdf"></i> Opening Report
                    </button>
                    <button class="btn btn-secondary" onclick="showBidOpening(currentTenderData.id, currentTenderData.title, currentTenderData.type || 'ITB')">
                        <i class="pi pi-users"></i> View Opened Bids
                    </button>
                `,
                'evaluation': `
                    <button class="btn btn-success" onclick="showEvaluation(currentTenderData.id, currentTenderData.title, 'evaluator')">
                        <i class="pi pi-chart-bar"></i> Continue Evaluation
                    </button>
                    <button class="btn btn-secondary" onclick="showEvaluation(currentTenderData.id, currentTenderData.title, 'po')">
                        <i class="pi pi-user"></i> PO View
                    </button>
                    <button class="btn btn-secondary" onclick="showEvaluation(currentTenderData.id, currentTenderData.title, 'comparison')">
                        <i class="pi pi-table"></i> Comparison View
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-users"></i> Evaluation Team
                    </button>
                `,
                'award': `
                    <button class="btn btn-success">
                        <i class="pi pi-file-edit"></i> Sign Report
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-file-pdf"></i> View Award Report
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-user"></i> Recommended Supplier
                    </button>
                `,
                'finalized': `
                    <button class="btn btn-secondary">
                        <i class="pi pi-file"></i> View Contract
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-history"></i> Tender History
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-download"></i> Download Documents
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-user"></i> View Supplier Details
                    </button>
                `,
                'cancelled': `
                    <button class="btn btn-secondary">
                        <i class="pi pi-history"></i> Cancellation Details
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-download"></i> Download Documents
                    </button>
                    <button class="btn btn-primary">
                        <i class="pi pi-copy"></i> Reopen/Clone Tender
                    </button>
                `
            };
            
            const actions = actionsByStatus[statusKey] || actionsByStatus['active'];
            actionsContainer.innerHTML = actions;
        }

        function filterTenders() {
            const filterValue = event.target.value;
            const cards = document.querySelectorAll('.tender-card');
            
            cards.forEach(card => {
                const status = card.getAttribute('data-status');
                if (filterValue === 'all' || filterValue === status) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('mainSidebar');
            sidebar.classList.toggle('collapsed');
        }

        // ==================== MENU GROUP TOGGLE ====================
        function toggleMenuGroup(header) {
            const menuGroup = header.parentElement;
            menuGroup.classList.toggle('collapsed');
        }

        // ==================== VIEW SWITCHING ====================
        function switchView(viewName) {
            // Placeholder for switching views (criteria, specifications, etc.)
            showToast(' ' + viewName.charAt(0).toUpperCase() + viewName.slice(1) + ' view coming soon...');
        }

        // ==================== HEADER ACTIONS FUNCTIONS ====================
        
        // Accessibility Panel
        function openAccessibilityPanel() {
            // Remove existing panel if any
            const existing = document.getElementById('accessibilityPanel');
            if (existing) {
                existing.remove();
                return;
            }

            const panelHtml = `
                <div id="accessibilityPanel" class="accessibility-panel open" role="dialog" aria-labelledby="a11y-title" aria-modal="true">
                    <div class="accessibility-panel-header">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="pi pi-eye" style="color: var(--primary-500);"></i>
                            <span id="a11y-title" style="font-weight: 600;">Accessibility Options</span>
                        </div>
                        <button onclick="document.getElementById('accessibilityPanel').remove()" style="background: none; border: none; cursor: pointer;" aria-label="Close accessibility panel">
                            <i class="pi pi-times"></i>
                        </button>
                    </div>
                    <div style="padding: var(--spacing-md);">
                        <div class="accessibility-option">
                            <div>
                                <div style="font-weight: 500; font-size: 13px;">High Contrast</div>
                                <div style="font-size: 11px; color: var(--text-muted);">Increase color contrast for better visibility</div>
                            </div>
                            <div class="accessibility-toggle ${document.body.classList.contains('high-contrast') ? 'active' : ''}" 
                                 onclick="toggleAccessibility('high-contrast', this)"
                                 role="switch"
                                 aria-checked="${document.body.classList.contains('high-contrast')}"
                                 tabindex="0"></div>
                        </div>
                        <div class="accessibility-option">
                            <div>
                                <div style="font-weight: 500; font-size: 13px;">Large Text</div>
                                <div style="font-size: 11px; color: var(--text-muted);">Increase text size throughout the app</div>
                            </div>
                            <div class="accessibility-toggle ${document.body.classList.contains('large-text') ? 'active' : ''}" 
                                 onclick="toggleAccessibility('large-text', this)"
                                 role="switch"
                                 aria-checked="${document.body.classList.contains('large-text')}"
                                 tabindex="0"></div>
                        </div>
                        <div class="accessibility-option">
                            <div>
                                <div style="font-weight: 500; font-size: 13px;">Reduced Motion</div>
                                <div style="font-size: 11px; color: var(--text-muted);">Minimize animations and transitions</div>
                            </div>
                            <div class="accessibility-toggle ${document.body.classList.contains('reduced-motion') ? 'active' : ''}" 
                                 onclick="toggleAccessibility('reduced-motion', this)"
                                 role="switch"
                                 aria-checked="${document.body.classList.contains('reduced-motion')}"
                                 tabindex="0"></div>
                        </div>
                        <div class="accessibility-option">
                            <div>
                                <div style="font-weight: 500; font-size: 13px;">Color Blind Mode</div>
                                <div style="font-size: 11px; color: var(--text-muted);">Add patterns to color-coded elements</div>
                            </div>
                            <div class="accessibility-toggle ${document.body.classList.contains('colorblind-mode') ? 'active' : ''}" 
                                 onclick="toggleAccessibility('colorblind-mode', this)"
                                 role="switch"
                                 aria-checked="${document.body.classList.contains('colorblind-mode')}"
                                 tabindex="0"></div>
                        </div>
                        <div style="padding: var(--spacing-md); background: var(--info-50); border-radius: var(--radius-sm); margin-top: var(--spacing-sm);">
                            <div style="font-size: 11px; color: var(--info-600);">
                                <strong>Keyboard Shortcuts:</strong><br>
                                <span style="font-family: monospace;">Alt + 1</span> - Dashboard<br>
                                <span style="font-family: monospace;">Alt + H</span> - Help<br>
                                <span style="font-family: monospace;">Esc</span> - Close panels
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', panelHtml);
        }

        function toggleAccessibility(mode, element) {
            document.body.classList.toggle(mode);
            element.classList.toggle('active');
            element.setAttribute('aria-checked', element.classList.contains('active'));
            
            // Save preference to localStorage
            localStorage.setItem('a11y-' + mode, document.body.classList.contains(mode));
            
            showToast(mode.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase()) + (document.body.classList.contains(mode) ? ' enabled' : ' disabled'));
        }

        // Load accessibility preferences on page load
        function loadAccessibilityPreferences() {
            const modes = ['high-contrast', 'large-text', 'reduced-motion', 'colorblind-mode'];
            modes.forEach(mode => {
                if (localStorage.getItem('a11y-' + mode) === 'true') {
                    document.body.classList.add(mode);
                }
            });
        }

        // Language Selector
        function openLanguageSelector() {
            const existing = document.getElementById('languagePanel');
            if (existing) {
                existing.remove();
                return;
            }

            const languages = [
                { code: 'EN', name: 'English', flag: '' },
                { code: 'FR', name: 'Franais', flag: '' },
                { code: 'ES', name: 'Espaol', flag: '' },
                { code: 'AR', name: '', flag: '', rtl: true },
                { code: 'PT', name: 'Portugus', flag: '' },
                { code: 'RU', name: '', flag: '' }
            ];

            const panelHtml = `
                <div id="languagePanel" style="position: fixed; top: 70px; right: 200px; width: 220px; background: var(--surface-0); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); z-index: 10000; border: 1px solid var(--surface-200);" role="dialog" aria-label="Language selection">
                    <div style="padding: var(--spacing-md); border-bottom: 1px solid var(--surface-200); display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600; font-size: 13px;"> Select Language</span>
                        <button onclick="document.getElementById('languagePanel').remove()" style="background: none; border: none; cursor: pointer;" aria-label="Close">
                            <i class="pi pi-times"></i>
                        </button>
                    </div>
                    <div style="padding: var(--spacing-sm);">
                        ${languages.map(lang => `
                            <div onclick="selectLanguage('${lang.code}', '${lang.name}')" 
                                 style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); border-radius: var(--radius-sm); cursor: pointer; transition: background 0.2s;"
                                 onmouseover="this.style.background='var(--primary-50)'"
                                 onmouseout="this.style.background='transparent'"
                                 role="button"
                                 tabindex="0">
                                <span style="font-size: 18px;">${lang.flag}</span>
                                <span style="font-size: 13px; ${lang.rtl ? 'direction: rtl;' : ''}">${lang.name}</span>
                                ${lang.code === 'EN' ? '<i class="pi pi-check" style="margin-left: auto; color: var(--success-500);"></i>' : ''}
                            </div>
                        `).join('')}
                    </div>
                    <div style="padding: var(--spacing-sm); background: var(--surface-50); border-top: 1px solid var(--surface-200); border-radius: 0 0 var(--radius-lg) var(--radius-lg);">
                        <div style="font-size: 10px; color: var(--text-muted); text-align: center;">
                             Auto-detect based on browser settings
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', panelHtml);
        }

        function selectLanguage(code, name) {
            document.getElementById('currentLang').textContent = code;
            document.getElementById('languagePanel').remove();
            showToast(' Language changed to ' + name);
            // In production, this would trigger actual translation
        }

        // AI Assistant
        function openAIAssistant() {
            const existing = document.getElementById('aiAssistantPanel');
            if (existing) {
                existing.remove();
                return;
            }

            const panelHtml = `
                <div id="aiAssistantPanel" style="position: fixed; top: 70px; right: 120px; width: 400px; max-height: 500px; background: var(--surface-0); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); z-index: 10000; border: 1px solid var(--surface-200); display: flex; flex-direction: column;" role="dialog" aria-labelledby="ai-title">
                    <div style="padding: var(--spacing-lg); background: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%); border-radius: var(--radius-lg) var(--radius-lg) 0 0; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                <div style="width: 36px; height: 36px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="pi pi-bolt" style="font-size: 18px;"></i>
                                </div>
                                <div>
                                    <div id="ai-title" style="font-weight: 600; font-size: 14px;">AI Procurement Assistant</div>
                                    <div style="font-size: 11px; opacity: 0.8;">Powered by UNOPS AI</div>
                                </div>
                            </div>
                            <button onclick="document.getElementById('aiAssistantPanel').remove()" style="background: rgba(255,255,255,0.2); border: none; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; color: white;" aria-label="Close AI assistant">
                                <i class="pi pi-times"></i>
                            </button>
                        </div>
                    </div>
                    <div style="flex: 1; padding: var(--spacing-md); overflow-y: auto; max-height: 300px;">
                        <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                            <div style="font-size: 12px; color: var(--text-primary);">
                                 Hello! I'm your AI assistant. I can help you with:
                            </div>
                            <ul style="margin: 8px 0 0 16px; padding: 0; font-size: 12px; color: var(--text-secondary);">
                                <li>Understanding evaluation criteria</li>
                                <li>Drafting clarification responses</li>
                                <li>Explaining procurement policies</li>
                                <li>Comparing supplier offers</li>
                            </ul>
                        </div>
                        <div style="display: grid; gap: var(--spacing-sm);">
                            <button onclick="askAI('How do I evaluate this tender?')" style="text-align: left; padding: var(--spacing-sm); background: var(--primary-50); border: 1px solid var(--primary-200); border-radius: var(--radius-sm); cursor: pointer; font-size: 12px;">
                                 How do I evaluate this tender?
                            </button>
                            <button onclick="askAI('Draft a clarification response')" style="text-align: left; padding: var(--spacing-sm); background: var(--primary-50); border: 1px solid var(--primary-200); border-radius: var(--radius-sm); cursor: pointer; font-size: 12px;">
                                 Help me draft a clarification response
                            </button>
                            <button onclick="askAI('Explain the evaluation steps')" style="text-align: left; padding: var(--spacing-sm); background: var(--primary-50); border: 1px solid var(--primary-200); border-radius: var(--radius-sm); cursor: pointer; font-size: 12px;">
                                 Explain the evaluation steps
                            </button>
                        </div>
                    </div>
                    <div style="padding: var(--spacing-md); border-top: 1px solid var(--surface-200);">
                        <div style="display: flex; gap: var(--spacing-sm);">
                            <input type="text" id="aiInput" placeholder="Ask me anything about procurement..." style="flex: 1; padding: var(--spacing-sm); border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 12px;" aria-label="Ask AI a question">
                            <button onclick="askAI(document.getElementById('aiInput').value)" style="background: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%); color: white; border: none; padding: var(--spacing-sm) var(--spacing-md); border-radius: var(--radius-sm); cursor: pointer;">
                                <i class="pi pi-send"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', panelHtml);
        }

        function askAI(question) {
            if (!question || !question.trim()) return;
            showToast(' AI is thinking... (Feature coming soon)');
            document.getElementById('aiInput').value = '';
        }

        // Help Center
        function openHelpCenter() {
            const existing = document.getElementById('helpPanel');
            if (existing) {
                existing.remove();
                return;
            }

            const panelHtml = `
                <div id="helpPanel" style="position: fixed; top: 70px; right: 80px; width: 350px; background: var(--surface-0); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); z-index: 10000; border: 1px solid var(--surface-200);" role="dialog" aria-labelledby="help-title">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--surface-200);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                <i class="pi pi-question-circle" style="font-size: 20px; color: var(--primary-500);"></i>
                                <span id="help-title" style="font-weight: 600;">Help Center</span>
                            </div>
                            <button onclick="document.getElementById('helpPanel').remove()" style="background: none; border: none; cursor: pointer;" aria-label="Close help">
                                <i class="pi pi-times"></i>
                            </button>
                        </div>
                        <input type="text" placeholder="Search help articles..." style="width: 100%; padding: var(--spacing-sm); border: 1px solid var(--surface-300); border-radius: var(--radius-sm); margin-top: var(--spacing-md); font-size: 13px;" aria-label="Search help">
                    </div>
                    <div style="padding: var(--spacing-md); max-height: 350px; overflow-y: auto;">
                        <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; margin-bottom: var(--spacing-sm);">Quick Links</div>
                        <div style="display: grid; gap: var(--spacing-sm);">
                            <a href="#" onclick="event.preventDefault(); showToast(' Opening documentation...')" style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); text-decoration: none; color: var(--text-primary); font-size: 13px;">
                                <i class="pi pi-book" style="color: var(--primary-500);"></i>
                                <span>User Guide</span>
                            </a>
                            <a href="#" onclick="event.preventDefault(); showToast(' Opening video tutorials...')" style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); text-decoration: none; color: var(--text-primary); font-size: 13px;">
                                <i class="pi pi-video" style="color: var(--success-500);"></i>
                                <span>Video Tutorials</span>
                            </a>
                            <a href="#" onclick="event.preventDefault(); showToast(' Opening FAQ...')" style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); text-decoration: none; color: var(--text-primary); font-size: 13px;">
                                <i class="pi pi-list" style="color: var(--warning-500);"></i>
                                <span>Frequently Asked Questions</span>
                            </a>
                            <a href="#" onclick="event.preventDefault(); showToast(' Contact support modal...')" style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--surface-50); border-radius: var(--radius-sm); text-decoration: none; color: var(--text-primary); font-size: 13px;">
                                <i class="pi pi-envelope" style="color: var(--info-500);"></i>
                                <span>Contact Support</span>
                            </a>
                        </div>
                        <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; margin: var(--spacing-lg) 0 var(--spacing-sm) 0;">Popular Topics</div>
                        <div style="display: flex; flex-wrap: wrap; gap: var(--spacing-xs);">
                            <span style="padding: 4px 10px; background: var(--primary-50); color: var(--primary-600); border-radius: var(--radius-sm); font-size: 11px; cursor: pointer;">Evaluation Process</span>
                            <span style="padding: 4px 10px; background: var(--primary-50); color: var(--primary-600); border-radius: var(--radius-sm); font-size: 11px; cursor: pointer;">Amendments</span>
                            <span style="padding: 4px 10px; background: var(--primary-50); color: var(--primary-600); border-radius: var(--radius-sm); font-size: 11px; cursor: pointer;">Clarifications</span>
                            <span style="padding: 4px 10px; background: var(--primary-50); color: var(--primary-600); border-radius: var(--radius-sm); font-size: 11px; cursor: pointer;">Bid Opening</span>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', panelHtml);
        }

        // Notifications Panel
        function openNotificationsPanel() {
            const existing = document.getElementById('notificationsPanel');
            if (existing) {
                existing.remove();
                return;
            }

            const notifications = [
                { type: 'urgent', icon: '', title: 'Evaluation deadline approaching', desc: 'ITB/2024/089 evaluation due in 2 hours', time: '5 min ago' },
                { type: 'info', icon: '', title: 'New clarification received', desc: 'MedSupply Ltd. asked about Form D requirements', time: '15 min ago' },
                { type: 'success', icon: '', title: 'Bid opening completed', desc: 'RFP/2024/067 bid opening has been finalized', time: '1 hour ago' },
                { type: 'warning', icon: '', title: 'Amendment requires approval', desc: 'ITB/2024/034 amendment pending TME sign-off', time: '2 hours ago' },
                { type: 'info', icon: '', title: 'New bid submission', desc: 'EuroMed Supplies submitted bid for RFQ/2024/112', time: '3 hours ago' },
                { type: 'info', icon: '', title: 'Team member added', desc: 'Ahmed Hassan joined evaluation panel', time: 'Yesterday' },
                { type: 'success', icon: '', title: 'Report signed', desc: 'Award recommendation approved by PR', time: 'Yesterday' }
            ];

            const panelHtml = `
                <div id="notificationsPanel" style="position: fixed; top: 70px; right: 20px; width: 380px; background: var(--surface-0); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); z-index: 10000; border: 1px solid var(--surface-200);" role="dialog" aria-labelledby="notif-title">
                    <div style="padding: var(--spacing-lg); border-bottom: 1px solid var(--surface-200); display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="pi pi-bell" style="font-size: 18px; color: var(--primary-500);"></i>
                            <span id="notif-title" style="font-weight: 600;">Notifications</span>
                            <span style="background: var(--danger-500); color: white; font-size: 10px; padding: 2px 8px; border-radius: 10px; font-weight: 600;">7 new</span>
                        </div>
                        <button onclick="document.getElementById('notificationsPanel').remove()" style="background: none; border: none; cursor: pointer;" aria-label="Close notifications">
                            <i class="pi pi-times"></i>
                        </button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${notifications.map((notif, i) => `
                            <div style="padding: var(--spacing-md); border-bottom: 1px solid var(--surface-100); cursor: pointer; transition: background 0.2s; ${i < 3 ? 'background: var(--primary-50);' : ''}"
                                 onmouseover="this.style.background='var(--surface-50)'"
                                 onmouseout="this.style.background='${i < 3 ? 'var(--primary-50)' : 'transparent'}'"
                                 role="button"
                                 tabindex="0">
                                <div style="display: flex; gap: var(--spacing-sm);">
                                    <span style="font-size: 18px;">${notif.icon}</span>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 13px; color: var(--text-primary);">${notif.title}</div>
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 2px;">${notif.desc}</div>
                                        <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">${notif.time}</div>
                                    </div>
                                    ${i < 3 ? '<div style="width: 8px; height: 8px; background: var(--primary-500); border-radius: 50%; flex-shrink: 0;"></div>' : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="padding: var(--spacing-md); border-top: 1px solid var(--surface-200); text-align: center;">
                        <button onclick="showToast(' Viewing all notifications...'); document.getElementById('notificationsPanel').remove();" style="background: none; border: none; color: var(--primary-500); font-size: 13px; font-weight: 600; cursor: pointer;">
                            View All Notifications
                        </button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', panelHtml);
        }

        // ==================== COLLABORATIVE WHITEBOARD FUNCTIONS ====================
        
        function toggleCollabWhiteboard() {
            const panel = document.getElementById('collabWhiteboardPanel');
            const btn = document.getElementById('collabWhiteboardBtn');
            
            panel.classList.toggle('open');
            
            if (panel.classList.contains('open')) {
                btn.style.right = '400px';
            } else {
                btn.style.right = '0';
            }
        }

        function switchCollabTab(tabId) {
            // Update tab buttons
            document.querySelectorAll('.collab-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.collab-tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('collab-' + tabId).classList.add('active');
        }

        function sendCollabMessage() {
            const input = document.getElementById('collabMessageInput');
            const message = input.value.trim();
            if (!message) return;

            const messageList = document.getElementById('collabMessageList');
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

            const messageHtml = `
                <div class="collab-message">
                    <div class="collab-message-avatar" style="background: var(--success-100); color: var(--success-600);">JD</div>
                    <div class="collab-message-content">
                        <div class="collab-message-header">
                            <span class="collab-message-author">Jane Doe</span>
                            <span class="collab-message-time">${timeStr}</span>
                        </div>
                        <div class="collab-message-text">${message}</div>
                    </div>
                </div>
            `;
            messageList.insertAdjacentHTML('beforeend', messageHtml);
            input.value = '';
            
            // Scroll to bottom
            messageList.scrollTop = messageList.scrollHeight;
            
            showToast(' Message sent to team');
        }

        function respondToQuestion(questionId) {
            const response = prompt('Enter your response:');
            if (response) {
                showToast(' Response sent to team');
                // Update the question status (in real app, this would update the server)
            }
        }

        function viewQuestionContext(questionId) {
            showToast(' Opening evaluation context...');
            // In real app, this would navigate to the relevant evaluation section
        }

        function createNewQuestion() {
            const modalHtml = `
                <div id="newQuestionModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10002; display: flex; align-items: center; justify-content: center;" onclick="if(event.target===this) this.remove()">
                    <div style="background: white; border-radius: var(--radius-lg); width: 450px; max-width: 95%; box-shadow: var(--shadow-lg);">
                        <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: var(--spacing-lg); border-radius: var(--radius-lg) var(--radius-lg) 0 0;">
                            <h3 style="margin: 0; font-size: 16px;"> Ask Team a Question</h3>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <div style="margin-bottom: var(--spacing-md);">
                                <label style="display: block; font-size: 12px; font-weight: 500; margin-bottom: 4px;">Direct to:</label>
                                <select style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);">
                                    <option>@Everyone (All Team Members)</option>
                                    <option>@Sarah Chen</option>
                                    <option>@Ahmed Hassan</option>
                                </select>
                            </div>
                            <div style="margin-bottom: var(--spacing-md);">
                                <label style="display: block; font-size: 12px; font-weight: 500; margin-bottom: 4px;">Related to:</label>
                                <select style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm);">
                                    <option>Eligibility & Formal Criteria</option>
                                    <option>Qualification Criteria</option>
                                    <option>Technical Evaluation</option>
                                    <option>Financial Evaluation</option>
                                    <option>General Question</option>
                                </select>
                            </div>
                            <div style="margin-bottom: var(--spacing-md);">
                                <label style="display: block; font-size: 12px; font-weight: 500; margin-bottom: 4px;">Your Question:</label>
                                <textarea id="newQuestionText" rows="4" placeholder="Type your question here..." style="width: 100%; padding: 8px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); resize: vertical;"></textarea>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end;">
                                <button class="btn btn-secondary" onclick="document.getElementById('newQuestionModal').remove()">Cancel</button>
                                <button class="btn btn-primary" onclick="submitNewQuestion()" style="background: #10b981;">Send Question</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function submitNewQuestion() {
            const text = document.getElementById('newQuestionText').value.trim();
            if (!text) {
                showToast(' Please enter a question');
                return;
            }
            document.getElementById('newQuestionModal').remove();
            showToast(' Question sent to team');
            
            // Update badge
            const badge = document.querySelector('#tab-questions .collab-tab-badge');
            if (badge) {
                badge.textContent = parseInt(badge.textContent) + 1;
            }
        }

        function addCollabNote() {
            const note = prompt('Enter your note:');
            if (note) {
                showToast(' Note added to shared board');
            }
        }

        function proposeDecision() {
            const decision = prompt('Propose a decision for team vote:');
            if (decision) {
                showToast(' Decision proposed - team members notified');
            }
        }

        function voteDecision(decisionId, vote) {
            showToast(vote === 'yes' ? ' You agreed with the decision' : ' You disagreed with the decision');
        }

        // Link "Ask Team" buttons to open whiteboard
        function askEvalTeamQuestion(reqId) {
            // Open the collaboration panel
            const panel = document.getElementById('collabWhiteboardPanel');
            if (!panel.classList.contains('open')) {
                toggleCollabWhiteboard();
            }
            
            // Switch to questions tab
            switchCollabTab('questions');
            
            // Open new question modal with context
            setTimeout(() => {
                createNewQuestion();
                // Pre-fill with context
                setTimeout(() => {
                    const textarea = document.getElementById('newQuestionText');
                    if (textarea) {
                        textarea.value = `Question regarding requirement ${reqId}: `;
                        textarea.focus();
                    }
                }, 100);
            }, 300);
        }

        // ==================== SUPPLIER DOCS PANEL FUNCTIONS ====================
        
        function toggleSupplierDocsPanel() {
            const panel = document.getElementById('supplierDocsPanel');
            const btn = document.getElementById('supplierDocsFloatingBtn');
            
            panel.classList.toggle('open');
            
            if (panel.classList.contains('open')) {
                btn.style.right = '380px';
                updateSupplierDocsForCurrentVendor();
            } else {
                btn.style.right = '0';
            }
        }

        function updateSupplierDocsForCurrentVendor() {
            const vendorName = document.getElementById('vendor-eval-name')?.textContent || 'MedSupply Ltd.';
            document.getElementById('supplierDocsPanelVendor').textContent = vendorName;
            
            // Sync the dropdown with current vendor
            const selector = document.getElementById('supplierDocsSelector');
            if (selector && currentVendorEval) {
                selector.value = currentVendorEval;
            }
        }

        // Supplier submission data for the panel
        const supplierSubmissionData = {
            vendor1: {
                name: 'MedSupply Ltd.',
                ungm: '309663',
                submitted: 'Dec 1, 2024, 12:30 UTC',
                status: 'Complete',
                docsCount: 12,
                forms: [
                    { name: 'Form A - Bid Submission', type: 'pdf', size: '245 KB', date: 'Dec 1, 2024' },
                    { name: 'Form B - Pricing Schedule', type: 'excel', size: '156 KB', date: 'Dec 1, 2024' },
                    { name: 'Form C - Technical Specifications', type: 'pdf', size: '1.2 MB', date: 'Dec 1, 2024' },
                    { name: 'Form D - Manufacturer Authorization', type: 'pdf', size: '89 KB', date: 'Dec 1, 2024' },
                    { name: 'Form E - Business Experience', type: 'pdf', size: '312 KB', date: 'Dec 1, 2024' }
                ],
                certificates: [
                    { name: 'ISO 13485 Certificate', type: 'pdf', size: '567 KB', date: 'Valid until 2026' },
                    { name: 'CE Marking Declaration', type: 'pdf', size: '234 KB', date: 'Dec 1, 2024' },
                    { name: 'Business Registration License', type: 'pdf', size: '178 KB', date: 'Valid until 2025' },
                    { name: 'GMP Certificate', type: 'pdf', size: '445 KB', date: 'Valid until 2025' }
                ],
                technical: [
                    { name: 'Product Catalog 2024', type: 'pdf', size: '8.5 MB', date: 'Dec 1, 2024' },
                    { name: 'Laboratory Test Reports', type: 'pdf', size: '2.3 MB', date: 'Nov 2024' },
                    { name: 'Product Specification Sheets', type: 'zip', size: '4.7 MB', date: 'Dec 1, 2024' }
                ]
            },
            vendor2: {
                name: 'HealthCare Corp.',
                ungm: '301245',
                submitted: 'Dec 1, 2024, 13:45 UTC',
                status: 'Complete',
                docsCount: 10,
                forms: [
                    { name: 'Form A - Bid Submission', type: 'pdf', size: '198 KB', date: 'Dec 1, 2024' },
                    { name: 'Form B - Pricing Schedule', type: 'excel', size: '142 KB', date: 'Dec 1, 2024' },
                    { name: 'Form C - Technical Specifications', type: 'pdf', size: '980 KB', date: 'Dec 1, 2024' },
                    { name: 'Form D - Manufacturer Authorization', type: 'pdf', size: '76 KB', date: 'Dec 1, 2024' }
                ],
                certificates: [
                    { name: 'FDA Registration', type: 'pdf', size: '345 KB', date: 'Valid until 2025' },
                    { name: 'ISO 9001 Certificate', type: 'pdf', size: '289 KB', date: 'Valid until 2026' },
                    { name: 'Business License', type: 'pdf', size: '156 KB', date: 'Valid until 2025' }
                ],
                technical: [
                    { name: 'Product Brochure', type: 'pdf', size: '5.2 MB', date: 'Dec 1, 2024' },
                    { name: 'Quality Test Reports', type: 'pdf', size: '1.8 MB', date: 'Nov 2024' },
                    { name: 'Technical Datasheets', type: 'zip', size: '3.1 MB', date: 'Dec 1, 2024' }
                ]
            },
            vendor3: {
                name: 'MedTech Inc.',
                ungm: '315789',
                submitted: 'Dec 1, 2024, 11:20 UTC',
                status: 'Complete',
                docsCount: 11,
                forms: [
                    { name: 'Form A - Bid Submission', type: 'pdf', size: '267 KB', date: 'Dec 1, 2024' },
                    { name: 'Form B - Pricing Schedule', type: 'excel', size: '178 KB', date: 'Dec 1, 2024' },
                    { name: 'Form C - Technical Specifications', type: 'pdf', size: '1.5 MB', date: 'Dec 1, 2024' },
                    { name: 'Form D - Manufacturer Authorization', type: 'pdf', size: '95 KB', date: 'Dec 1, 2024' },
                    { name: 'Form E - Business Experience', type: 'pdf', size: '445 KB', date: 'Dec 1, 2024' }
                ],
                certificates: [
                    { name: 'JIS Certificate', type: 'pdf', size: '412 KB', date: 'Valid until 2026' },
                    { name: 'ISO 13485 Certificate', type: 'pdf', size: '356 KB', date: 'Valid until 2025' },
                    { name: 'Business Registration', type: 'pdf', size: '189 KB', date: 'Valid until 2025' }
                ],
                technical: [
                    { name: 'Product Catalog', type: 'pdf', size: '12.3 MB', date: 'Dec 1, 2024' },
                    { name: 'Test Certificates', type: 'pdf', size: '2.8 MB', date: 'Nov 2024' },
                    { name: 'Specification Pack', type: 'zip', size: '6.2 MB', date: 'Dec 1, 2024' }
                ]
            },
            vendor4: {
                name: 'Global Medical Solutions',
                ungm: '298456',
                submitted: 'Dec 1, 2024, 10:15 UTC',
                status: 'Complete',
                docsCount: 14,
                forms: [
                    { name: 'Form A - Bid Submission (JV)', type: 'pdf', size: '312 KB', date: 'Dec 1, 2024' },
                    { name: 'Form B - Pricing Schedule', type: 'excel', size: '234 KB', date: 'Dec 1, 2024' },
                    { name: 'Form C - Technical Specifications', type: 'pdf', size: '2.1 MB', date: 'Dec 1, 2024' },
                    { name: 'JV Agreement', type: 'pdf', size: '567 KB', date: 'Dec 1, 2024' }
                ],
                certificates: [
                    { name: 'ISO Certificate (Lead)', type: 'pdf', size: '289 KB', date: 'Valid until 2025' },
                    { name: 'ISO Certificate (Partner 1)', type: 'pdf', size: '267 KB', date: 'Valid until 2026' },
                    { name: 'ISO Certificate (Partner 2)', type: 'pdf', size: '234 KB', date: 'Valid until 2025' },
                    { name: 'Business Licenses (All Partners)', type: 'pdf', size: '456 KB', date: 'Valid until 2025' }
                ],
                technical: [
                    { name: 'Combined Product Catalog', type: 'pdf', size: '15.6 MB', date: 'Dec 1, 2024' },
                    { name: 'Quality Reports Bundle', type: 'zip', size: '8.9 MB', date: 'Nov 2024' }
                ]
            },
            vendor5: {
                name: 'EuroMed Supplies',
                ungm: '312890',
                submitted: 'Nov 30, 2024, 22:45 UTC',
                status: 'Complete',
                docsCount: 9,
                forms: [
                    { name: 'Form A - Bid Submission', type: 'pdf', size: '223 KB', date: 'Nov 30, 2024' },
                    { name: 'Form B - Pricing Schedule (EUR)', type: 'excel', size: '167 KB', date: 'Nov 30, 2024' },
                    { name: 'Form C - Technical Specifications', type: 'pdf', size: '1.1 MB', date: 'Nov 30, 2024' }
                ],
                certificates: [
                    { name: 'EU GMP Certificate', type: 'pdf', size: '378 KB', date: 'Valid until 2026' },
                    { name: 'CE Marking', type: 'pdf', size: '212 KB', date: 'Dec 2024' },
                    { name: 'Chamber of Commerce Extract', type: 'pdf', size: '145 KB', date: '2024' }
                ],
                technical: [
                    { name: 'Product Portfolio', type: 'pdf', size: '7.8 MB', date: 'Nov 30, 2024' },
                    { name: 'Quality Certifications', type: 'pdf', size: '3.2 MB', date: 'Nov 2024' },
                    { name: 'Training Materials', type: 'zip', size: '2.4 MB', date: 'Nov 30, 2024' }
                ]
            },
            vendor6: {
                name: 'MediCare International',
                ungm: '305672',
                submitted: 'Nov 30, 2024, 18:30 UTC',
                status: 'Complete',
                docsCount: 8,
                forms: [
                    { name: 'Form A - Bid Submission', type: 'pdf', size: '189 KB', date: 'Nov 30, 2024' },
                    { name: 'Form B - Pricing Schedule', type: 'excel', size: '134 KB', date: 'Nov 30, 2024' },
                    { name: 'Form C - Technical Specifications', type: 'pdf', size: '890 KB', date: 'Nov 30, 2024' }
                ],
                certificates: [
                    { name: 'SABS Certificate', type: 'pdf', size: '298 KB', date: 'Valid until 2025' },
                    { name: 'Business Registration', type: 'pdf', size: '167 KB', date: 'Valid until 2025' }
                ],
                technical: [
                    { name: 'Product Information', type: 'pdf', size: '4.5 MB', date: 'Nov 30, 2024' },
                    { name: 'Test Reports', type: 'pdf', size: '1.9 MB', date: 'Nov 2024' },
                    { name: 'After-Sales Support Plan', type: 'pdf', size: '456 KB', date: 'Nov 30, 2024' }
                ]
            }
        };

        function switchSupplierDocs(vendorId) {
            const data = supplierSubmissionData[vendorId];
            if (!data) return;

            // Update header info
            document.getElementById('supplierDocsPanelVendor').textContent = data.name;
            document.getElementById('supplierSubmissionDate').textContent = 'Submitted: ' + data.submitted;
            document.getElementById('supplierDocsBadge').textContent = data.docsCount;

            // Update document counts
            document.getElementById('formsCount').textContent = data.forms.length;
            document.getElementById('certificatesCount').textContent = data.certificates.length;
            document.getElementById('technicalCount').textContent = data.technical.length;

            // Update forms section
            const formsContent = document.getElementById('forms-content');
            formsContent.innerHTML = data.forms.map(doc => `
                <div class="supplier-doc-item" onclick="previewDocumentOnline('${doc.name.replace(/'/g, "\\'")}')" tabindex="0" role="button">
                    <div class="doc-icon ${doc.type}"><i class="pi pi-file-${doc.type === 'excel' ? 'excel' : doc.type === 'zip' ? '' : 'pdf'}"></i></div>
                    <div class="doc-info">
                        <div class="doc-name">${doc.name}</div>
                        <div class="doc-meta">${doc.type.toUpperCase()}  ${doc.size}  ${doc.date}</div>
                    </div>
                    <button class="doc-action-btn" title="Preview" aria-label="Preview ${doc.name}"><i class="pi pi-eye"></i></button>
                </div>
            `).join('');

            // Update certificates section
            const certsContent = document.getElementById('certificates-content');
            certsContent.innerHTML = data.certificates.map(doc => `
                <div class="supplier-doc-item" onclick="previewDocumentOnline('${doc.name.replace(/'/g, "\\'")}')" tabindex="0" role="button">
                    <div class="doc-icon ${doc.type}"><i class="pi pi-file-${doc.type === 'excel' ? 'excel' : doc.type === 'zip' ? '' : 'pdf'}"></i></div>
                    <div class="doc-info">
                        <div class="doc-name">${doc.name}</div>
                        <div class="doc-meta">${doc.type.toUpperCase()}  ${doc.size}  ${doc.date}</div>
                    </div>
                    <button class="doc-action-btn" title="Preview" aria-label="Preview ${doc.name}"><i class="pi pi-eye"></i></button>
                </div>
            `).join('');

            // Update technical section
            const techContent = document.getElementById('technical-content');
            techContent.innerHTML = data.technical.map(doc => `
                <div class="supplier-doc-item" onclick="previewDocumentOnline('${doc.name.replace(/'/g, "\\'")}')" tabindex="0" role="button">
                    <div class="doc-icon ${doc.type}"><i class="pi pi-file-${doc.type === 'excel' ? 'excel' : doc.type === 'zip' ? '' : 'pdf'}"></i></div>
                    <div class="doc-info">
                        <div class="doc-name">${doc.name}</div>
                        <div class="doc-meta">${doc.type.toUpperCase()}  ${doc.size}  ${doc.date}</div>
                    </div>
                    <button class="doc-action-btn" title="${doc.type === 'zip' ? 'Download' : 'Preview'}" aria-label="${doc.type === 'zip' ? 'Download' : 'Preview'} ${doc.name}">
                        <i class="pi pi-${doc.type === 'zip' ? 'download' : 'eye'}"></i>
                    </button>
                </div>
            `).join('');

            showToast(' Loaded submission from ' + data.name);
        }

        function toggleDocsSection(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            const icon = document.getElementById(sectionId + '-icon');
            
            content.classList.toggle('collapsed');
            
            if (content.classList.contains('collapsed')) {
                icon.style.transform = 'rotate(-90deg)';
            } else {
                icon.style.transform = 'rotate(0deg)';
            }
        }

        function downloadAllSupplierDocs() {
            showToast(' Preparing download of all supplier documents...');
            setTimeout(() => {
                showToast(' All documents downloaded as ZIP file');
            }, 1500);
        }

        // ==================== KEYBOARD SHORTCUTS ====================
        document.addEventListener('keydown', function(e) {
            // Alt + 1 - Dashboard
            if (e.altKey && e.key === '1') {
                e.preventDefault();
                showDashboard();
            }
            // Alt + H - Help
            if (e.altKey && e.key === 'h') {
                e.preventDefault();
                openHelpCenter();
            }
            // Escape - Close panels
            if (e.key === 'Escape') {
                document.getElementById('accessibilityPanel')?.remove();
                document.getElementById('languagePanel')?.remove();
                document.getElementById('aiAssistantPanel')?.remove();
                document.getElementById('helpPanel')?.remove();
                document.getElementById('notificationsPanel')?.remove();
                
                const supplierPanel = document.getElementById('supplierDocsPanel');
                if (supplierPanel?.classList.contains('open')) {
                    toggleSupplierDocsPanel();
                }
            }
        });

        // Load accessibility preferences on page load
        document.addEventListener('DOMContentLoaded', loadAccessibilityPreferences);

        // ==================== END HEADER ACTIONS FUNCTIONS ====================

        // Tender Preview - with toggle functionality
        function viewTenderPreview(tenderId, tenderTitle) {
            const previewPanel = document.getElementById('tender-preview-sidebar');
            
            // If clicking the same tender and panel is open, close it (toggle)
            if (previewPanel.classList.contains('open') && 
                currentTenderId === tenderId) {
                closeTenderPreview();
                return;
            }
            
            // Otherwise, update and open
            currentTenderId = tenderId;
            currentTenderTitle = tenderTitle;
            document.getElementById('preview-tender-id').textContent = tenderId;
            document.getElementById('preview-tender-title').textContent = tenderTitle;
            previewPanel.classList.add('open');
        }

        function closeTenderPreview() {
            document.getElementById('tender-preview-sidebar').classList.remove('open');
        }

        function toggleCollapseSidebar(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.collapsible-icon');
            
            if (content.style.display === 'none' || !content.style.display) {
                content.style.display = 'block';
                icon.classList.remove('rotated');
            } else {
                content.style.display = 'none';
                icon.classList.add('rotated');
            }
        }

        function openAmendModalFromPreview() {
            openAmendModal(currentTenderId, currentTenderTitle);
        }

        function openCancelModalFromPreview() {
            openCancelModal(currentTenderId, currentTenderTitle);
        }

        function openAmendModalFromDetails() {
            openAmendModal(currentTenderId, currentTenderTitle);
        }

        function openCancelModalFromDetails() {
            openCancelModal(currentTenderId, currentTenderTitle);
        }

        function toggleItemCard(header, event) {
            // Prevent any parent click handlers
            if (event) {
                event.stopPropagation();
            }

            const content = header.nextElementSibling;
            const arrow = header.querySelector('.collapsible-arrow');

            if (!content || !arrow) {
                console.error('Could not find content or arrow element', header);
                return;
            }

            // Toggle the expanded state
            const isExpanded = content.classList.contains('expanded');

            if (isExpanded) {
                content.classList.remove('expanded');
                arrow.classList.remove('rotated');
            } else {
                content.classList.add('expanded');
                arrow.classList.add('rotated');
            }
        }

        // Clarifications Modal
        function openClarificationsModal(tenderId, tenderTitle) {
            currentTenderId = tenderId;
            currentTenderTitle = tenderTitle;
            document.getElementById('clarificationsAdvTenderTitle').textContent = tenderId + (tenderTitle ? ': ' + tenderTitle : '');
            document.getElementById('clarificationsAdvancedModal').classList.add('active');
        }

        function closeClarificationsModal() {
            document.getElementById('clarificationsModal').classList.remove('active');
        }

        function openClarificationsFromDetails() {
            openClarificationsModal(currentTenderId, currentTenderTitle);
        }

        // ===== EVALUATION FUNCTIONS =====
        let currentEvaluationRole = 'evaluator';
        let currentEvaluationStep = 1; // Start with Eligibility by default
        let currentVendorEval = 'vendor1';
        let currentEvalView = 'supplier'; // 'supplier' or 'lot'

        // Evaluation data structure
        const evaluationData = {
            step1: { // Eligibility & Formal
                name: 'Eligibility & Formal Criteria',
                requirements: [
                    {
                        id: 'EF-001',
                        criteria: 'Bidders\' nationality check',
                        criteriaDesc: 'Verification of bidder nationality against eligible countries list (if restriction set by tender author)',
                        type: 'Bid Level',
                        spFlag: false,
                        assessment: 'Germany - Eligible country ',
                        systemEval: 'pass',
                        flagDetails: null,
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Nationality verified against eligible countries list.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    },
                    {
                        id: 'EF-002',
                        criteria: 'Bid/Proposal Submission Form',
                        criteriaDesc: 'Response validation with flag for deviations on predetermined fields (bid validity, etc.)',
                        type: 'Bid Level',
                        spFlag: true,
                        assessment: 'Bid validity: 90 days (Required: 90 days) \nDelivery timeline: 60 days (Required: 60 days) ',
                        systemEval: 'pass',
                        flagDetails: ' Deviation detected: Payment terms proposed as 45 days instead of 30 days',
                        evaluations: {
                            evaluator: { status: 'clarification', comment: 'Payment terms deviation needs review.' },
                            po: { status: 'pending', comment: '' }
                        }
                    },
                    {
                        id: 'EF-003',
                        criteria: 'UNGM eligibility check',
                        criteriaDesc: 'Verification of UNGM registration for bidder & all parties in JV/consortium',
                        type: 'Bid Level',
                        spFlag: false,
                        assessment: 'Primary Bidder: MedSupply Ltd. - UNGM #309663 (Active) \nNo JV/Consortium partners declared',
                        systemEval: 'pass',
                        flagDetails: null,
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'UNGM registration active and valid.' },
                            po: { status: 'pass', comment: 'Verified.' }
                        }
                    },
                    {
                        id: 'EF-004',
                        criteria: 'Completeness of documents',
                        criteriaDesc: 'Check for all required documents including validation of dates (bid validity compliance)',
                        type: 'Bid Level',
                        spFlag: false,
                        assessment: 'Required documents: 8/8 submitted \nBid validity date: 15 Mar 2025 (Compliant) \nAll signatures present ',
                        systemEval: 'pass',
                        flagDetails: null,
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'All documents complete and compliant.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    },
                    {
                        id: 'EF-005',
                        criteria: 'Document format check',
                        criteriaDesc: 'Automatic verification that all attachments are readable, non-empty, and not corrupted',
                        type: 'Bid Level',
                        spFlag: true,
                        assessment: 'Total files: 12\nReadable: 12 \nNon-empty: 12 \nFormat valid: 11 ',
                        systemEval: 'fail',
                        flagDetails: ' File "Price_Schedule_backup.xlsx" appears to be corrupted (0 bytes)',
                        evaluations: {
                            evaluator: { status: 'clarification', comment: 'One file appears corrupted. Need to verify with supplier.' },
                            po: { status: 'pending', comment: '' }
                        }
                    },
                    {
                        id: 'EF-006',
                        criteria: 'UNOPS claims log check',
                        criteriaDesc: 'Verification against UNOPS claims log for any previous issues',
                        type: 'Bid Level',
                        spFlag: false,
                        assessment: 'No claims found in UNOPS claims log ',
                        systemEval: 'pass',
                        flagDetails: null,
                        claimsLogLink: 'https://claims.unops.org/log/309663',
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'No claims history.' },
                            po: { status: 'pass', comment: 'Clean record.' }
                        }
                    },
                    {
                        id: 'EF-007',
                        criteria: 'Acceptance of general conditions',
                        criteriaDesc: 'Verification that bidder has accepted General Conditions of Contract without material deviations',
                        type: 'Bid Level',
                        spFlag: false,
                        assessment: 'GCC Acceptance Form: Signed \nDeviations declared: None\nReservations: None',
                        systemEval: 'pass',
                        flagDetails: null,
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'GCC signed without reservations.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    },
                    {
                        id: 'EF-008',
                        criteria: 'Custom: ISO certification verification',
                        criteriaDesc: 'Custom criteria added by Tender Author: Verify ISO 13485 certification for medical device quality management',
                        type: 'Bid Level',
                        spFlag: false,
                        isCustom: true,
                        assessment: 'ISO 13485:2016 Certificate submitted\nCertification body: TV SD\nValid until: Dec 2025',
                        systemEval: 'pass',
                        flagDetails: null,
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Valid ISO 13485 certification provided.' },
                            po: { status: 'pass', comment: 'Certification verified.' }
                        }
                    }
                ]
            },
            step2: { // Qualification
                name: 'Qualification Criteria',
                requirements: [
                    {
                        id: 'QC-001',
                        criteria: 'Business Experience (Form E)',
                        criteriaDesc: 'Bidders should be in continuous business of supplying similar goods and services for the last two years, and should provide evidence of their experience or a Performance Statement.',
                        formRef: 'Form E',
                        type: 'Bid Level',
                        spFlag: false,
                        systemEval: 'pass',
                        supplierDocs: [
                            { name: 'Form_E_Performance_Statement.pdf', size: '2.8 MB', date: '2024-11-10' },
                            { name: 'Experience_Evidence.pdf', size: '3.4 MB', date: '2024-11-10' }
                        ],
                        flagDetails: null,
                        evaluations: {
                            evaluator: { status: 'pass', comment: '5+ years of continuous business documented. Performance statement provided.' },
                            po: { status: 'pass', comment: 'Verified with references.' }
                        }
                    },
                    {
                        id: 'QC-002',
                        criteria: 'Manufacturer\'s Authorization (Form D)',
                        criteriaDesc: 'If a Bidder does not manufacture or produce the goods it offers to supply, the bidder shall submit the Manufacturer\'s Authorization Form to demonstrate that it has been duly authorized by the manufacturer.',
                        formRef: 'Form D',
                        type: 'Bid Level',
                        spFlag: true,
                        systemEval: 'pass',
                        supplierDocs: [
                            { name: 'Form_D_Manufacturer_Auth.pdf', size: '1.2 MB', date: '2024-11-10' },
                            { name: 'Authorization_Letters.pdf', size: '890 KB', date: '2024-11-10' }
                        ],
                        flagDetails: ' Bidder is distributor, not manufacturer - Authorization form required and submitted',
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Valid manufacturer authorization provided for all products.' },
                            po: { status: 'pass', comment: 'Authorization verified with manufacturer.' }
                        }
                    },
                    {
                        id: 'QC-003',
                        criteria: 'Gender Mainstreaming Statement',
                        criteriaDesc: 'Bidder must provide a clear statement and supporting documentation that outlines how gender is mainstreamed internally.',
                        formRef: null,
                        type: 'Bid Level',
                        spFlag: false,
                        systemEval: 'pass',
                        supplierDocs: [
                            { name: 'Gender_Mainstreaming_Policy.pdf', size: '1.5 MB', date: '2024-11-10' },
                            { name: 'Diversity_Report_2024.pdf', size: '2.1 MB', date: '2024-11-10' }
                        ],
                        flagDetails: null,
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Comprehensive gender policy with clear implementation evidence.' },
                            po: { status: 'pass', comment: 'Satisfactory gender mainstreaming approach.' }
                        }
                    },
                    {
                        id: 'QC-004',
                        criteria: 'Company Registration',
                        criteriaDesc: 'Bidder possesses valid business registration/license for the current year.',
                        formRef: null,
                        type: 'Bid Level',
                        spFlag: false,
                        systemEval: 'pass',
                        supplierDocs: [
                            { name: 'Business_Registration_2024.pdf', size: '780 KB', date: '2024-11-10' },
                            { name: 'Trade_License.pdf', size: '650 KB', date: '2024-11-10' }
                        ],
                        flagDetails: null,
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Valid registration for 2024 provided.' },
                            po: { status: 'pass', comment: 'Registration verified.' }
                        }
                    },
                    {
                        id: 'QC-005',
                        criteria: 'Successful at this stage',
                        criteriaDesc: 'Overall determination of qualification stage pass/fail status based on all criteria above.',
                        formRef: null,
                        type: 'Bid Level',
                        spFlag: false,
                        systemEval: 'pass',
                        supplierDocs: [],
                        flagDetails: null,
                        isOverallStatus: true,
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'All qualification criteria met.' },
                            po: { status: 'pass', comment: 'Qualified to proceed.' }
                        }
                    },
                    {
                        id: 'QC-006',
                        criteria: 'Vendor Specific Remarks',
                        criteriaDesc: 'Additional remarks or observations specific to this vendor\'s qualification submission.',
                        formRef: null,
                        type: 'Bid Level',
                        spFlag: false,
                        systemEval: null,
                        supplierDocs: [],
                        flagDetails: null,
                        isRemarksField: true,
                        evaluations: {
                            evaluator: { status: 'not_evaluated', comment: 'Vendor has strong track record. Recommend for technical evaluation.' },
                            po: { status: 'not_evaluated', comment: '' }
                        }
                    }
                ]
            },
            step3: { // Technical
                name: 'Technical Criteria',
                requirements: [
                    {
                        id: 'T1',
                        description: 'Medical gloves - Latex-free, powder-free examination gloves',
                        type: 'UNSPSC: 42131701',
                        mandatory: true,
                        bidderCompliance: 'Yes',
                        bidderResponse: 'Nitrile examination gloves, powder-free, latex-free. EN455 compliant.',
                        specifications: 'Latex-free, powder-free, EN455 standard',
                        deviation: null,
                        supplierDocs: [
                            { name: 'Gloves_Technical_Spec.pdf', size: '2.1 MB', date: '2024-11-12' },
                            { name: 'EN455_Certificate.pdf', size: '890 KB', date: '2024-11-12' },
                            { name: 'Material_Safety_Sheet.pdf', size: '1.5 MB', date: '2024-11-12' }
                        ],
                        systemEval: 'pass',
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Meets all technical specifications. EN455 certified.' },
                            evaluator2: { status: 'pass', comment: 'Compliant. Good quality documentation.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    },
                    {
                        id: 'T2',
                        description: 'Surgical masks - Type IIR, fluid resistant',
                        type: 'UNSPSC: 42131603',
                        mandatory: true,
                        bidderCompliance: 'Partial',
                        bidderResponse: 'Type II masks provided. Type IIR available at additional cost (+$0.05 per unit).',
                        specifications: 'Type IIR, EN14683 compliant, BFE 98%',
                        deviation: 'Type II offered instead of Type IIR in base price',
                        supplierDocs: [
                            { name: 'Masks_Specifications.pdf', size: '1.8 MB', date: '2024-11-12' },
                            { name: 'EN14683_Test_Report.pdf', size: '2.4 MB', date: '2024-11-12' }
                        ],
                        systemEval: 'fail',
                        evaluations: {
                            evaluator: { status: 'clarification', comment: 'Clarification needed on Type IIR availability and final pricing.' },
                            evaluator2: { status: 'fail', comment: 'Does not meet mandatory Type IIR requirement.' },
                            po: { status: 'pending', comment: 'Awaiting clarification response.' }
                        }
                    },
                    {
                        id: 'T3',
                        description: 'Syringes - Sterile, single-use, luer lock, 5ml',
                        type: 'UNSPSC: 42131805',
                        mandatory: true,
                        bidderCompliance: 'Yes',
                        bidderResponse: 'Sterile single-use syringes, luer lock, 5ml. ISO 7886-1 compliant.',
                        specifications: 'Sterile, luer lock, ISO 7886-1',
                        deviation: null,
                        supplierDocs: [
                            { name: 'Syringes_Datasheet.pdf', size: '1.6 MB', date: '2024-11-12' },
                            { name: 'ISO7886_Certificate.pdf', size: '780 KB', date: '2024-11-12' },
                            { name: 'Sterility_Test_Report.pdf', size: '2.2 MB', date: '2024-11-12' }
                        ],
                        systemEval: 'pass',
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Fully compliant. ISO certification valid.' },
                            evaluator2: { status: 'pass', comment: 'Meets all specifications.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    },
                    {
                        id: 'T4',
                        description: 'Gauze bandages - Sterile, cotton, various sizes',
                        type: 'UNSPSC: 42131509',
                        mandatory: true,
                        bidderCompliance: 'Yes',
                        bidderResponse: 'Sterile cotton gauze bandages. Multiple sizes: 5cm, 7.5cm, 10cm. Individually wrapped.',
                        specifications: 'Sterile, 100% cotton, various sizes',
                        deviation: null,
                        supplierDocs: [
                            { name: 'Gauze_Specifications.pdf', size: '1.3 MB', date: '2024-11-12' },
                            { name: 'Cotton_Quality_Report.pdf', size: '990 KB', date: '2024-11-12' }
                        ],
                        systemEval: 'pass',
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Good quality cotton gauze. All sizes provided.' },
                            evaluator2: { status: 'pass', comment: 'Compliant.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    }
                ]
            },
            step3Lots: { // Technical with Lot structure
                name: 'Technical Criteria',
                lots: [
                    {
                        id: 'lot1',
                        name: 'Lot 1: Personal Protective Equipment',
                        totalValue: '$120,000',
                        items: [
                            {
                                id: 'T1-L1',
                                description: 'Medical gloves - Latex-free, powder-free examination gloves',
                                unspsc: '42131701',
                                quantity: '50,000 boxes',
                                mandatory: true,
                                bidderCompliance: 'Yes',
                                bidderResponse: 'Nitrile examination gloves, powder-free, latex-free. EN455 compliant.',
                                specifications: 'Latex-free, powder-free, EN455 standard',
                                deviation: null,
                                productDetails: {
                                    model: 'NitriGuard Pro 500',
                                    manufacturer: 'MedGlove International',
                                    manufacturerAddress: '123 Industrial Park, Munich, Germany 80331',
                                    subcontractor: null,
                                    countryOfOrigin: 'Germany'
                                },
                                supplierDocs: [
                                    { name: 'Gloves_Technical_Spec.pdf', size: '2.1 MB', date: '2024-11-12' },
                                    { name: 'EN455_Certificate.pdf', size: '890 KB', date: '2024-11-12' }
                                ],
                                systemEval: 'pass',
                                evaluations: {
                                    evaluator: { status: 'pass', comment: 'Meets all technical specifications. EN455 certified.' },
                                    evaluator2: { status: 'pass', comment: 'Compliant. Good quality documentation.' },
                                    po: { status: 'pass', comment: 'Approved.' }
                                }
                            },
                            {
                                id: 'T2-L1',
                                description: 'Surgical masks - Type IIR, fluid resistant',
                                unspsc: '42131603',
                                quantity: '100,000 units',
                                mandatory: true,
                                bidderCompliance: 'Partial',
                                bidderResponse: 'Type II masks provided. Type IIR available at additional cost (+$0.05 per unit).',
                                specifications: 'Type IIR, EN14683 compliant, BFE 98%',
                                deviation: 'Type II offered instead of Type IIR in base price',
                                productDetails: {
                                    model: 'SurgiMask Type II',
                                    manufacturer: 'SafeBreath GmbH',
                                    manufacturerAddress: '45 Pharma Strasse, Berlin, Germany 10115',
                                    subcontractor: 'FilterTech Co. (filter materials)',
                                    countryOfOrigin: 'Germany'
                                },
                                supplierDocs: [
                                    { name: 'Masks_Specifications.pdf', size: '1.8 MB', date: '2024-11-12' },
                                    { name: 'EN14683_Test_Report.pdf', size: '2.4 MB', date: '2024-11-12' }
                                ],
                                systemEval: 'fail',
                                evaluations: {
                                    evaluator: { status: 'clarification', comment: 'Clarification needed on Type IIR availability.' },
                                    evaluator2: { status: 'fail', comment: 'Does not meet mandatory Type IIR requirement.' },
                                    po: { status: 'pending', comment: 'Awaiting clarification response.' }
                                }
                            },
                            {
                                id: 'T3-L1',
                                description: 'Face shields - Full face protection, anti-fog',
                                unspsc: '42131605',
                                quantity: '10,000 units',
                                mandatory: true,
                                bidderCompliance: 'Yes',
                                bidderResponse: 'Anti-fog coated face shields with adjustable headband. CE marked.',
                                specifications: 'Full face coverage, anti-fog, adjustable, CE marked',
                                deviation: null,
                                productDetails: {
                                    model: 'ClearView Shield Pro',
                                    manufacturer: 'ProtectWear Solutions',
                                    manufacturerAddress: '78 Safety Lane, Frankfurt, Germany 60311',
                                    subcontractor: null,
                                    countryOfOrigin: 'Germany'
                                },
                                supplierDocs: [
                                    { name: 'Face_Shield_Specs.pdf', size: '1.4 MB', date: '2024-11-12' },
                                    { name: 'CE_Certificate.pdf', size: '650 KB', date: '2024-11-12' }
                                ],
                                systemEval: 'pass',
                                evaluations: {
                                    evaluator: { status: 'pass', comment: 'Fully compliant with specifications.' },
                                    evaluator2: { status: 'pass', comment: 'CE certification valid.' },
                                    po: { status: 'pass', comment: 'Approved.' }
                                }
                            }
                        ]
                    },
                    {
                        id: 'lot2',
                        name: 'Lot 2: Medical Consumables',
                        totalValue: '$180,000',
                        items: [
                            {
                                id: 'T1-L2',
                                description: 'Syringes - Sterile, single-use, luer lock, 5ml',
                                unspsc: '42131805',
                                quantity: '200,000 units',
                                mandatory: true,
                                bidderCompliance: 'Yes',
                                bidderResponse: 'Sterile single-use syringes, luer lock, 5ml. ISO 7886-1 compliant.',
                                specifications: 'Sterile, luer lock, ISO 7886-1',
                                deviation: null,
                                productDetails: {
                                    model: 'SafeInject 5ml Pro',
                                    manufacturer: 'MedInject Systems',
                                    manufacturerAddress: '234 Precision Way, Stuttgart, Germany 70173',
                                    subcontractor: null,
                                    countryOfOrigin: 'Germany'
                                },
                                supplierDocs: [
                                    { name: 'Syringes_Datasheet.pdf', size: '1.6 MB', date: '2024-11-12' },
                                    { name: 'ISO7886_Certificate.pdf', size: '780 KB', date: '2024-11-12' }
                                ],
                                systemEval: 'pass',
                                evaluations: {
                                    evaluator: { status: 'pass', comment: 'Fully compliant. ISO certification valid.' },
                                    evaluator2: { status: 'pass', comment: 'Meets all specifications.' },
                                    po: { status: 'pass', comment: 'Approved.' }
                                }
                            },
                            {
                                id: 'T2-L2',
                                description: 'Gauze bandages - Sterile, cotton, various sizes',
                                unspsc: '42131509',
                                quantity: '50,000 rolls',
                                mandatory: true,
                                bidderCompliance: 'Yes',
                                bidderResponse: 'Sterile cotton gauze bandages. Multiple sizes: 5cm, 7.5cm, 10cm.',
                                specifications: 'Sterile, 100% cotton, various sizes',
                                deviation: null,
                                productDetails: {
                                    model: 'CottonCare Gauze Multi',
                                    manufacturer: 'WoundCare Solutions',
                                    manufacturerAddress: '67 Textile Blvd, Leipzig, Germany 04109',
                                    subcontractor: null,
                                    countryOfOrigin: 'Germany'
                                },
                                supplierDocs: [
                                    { name: 'Gauze_Specifications.pdf', size: '1.3 MB', date: '2024-11-12' }
                                ],
                                systemEval: 'pass',
                                evaluations: {
                                    evaluator: { status: 'pass', comment: 'Good quality cotton gauze. All sizes provided.' },
                                    evaluator2: { status: 'pass', comment: 'Compliant.' },
                                    po: { status: 'pass', comment: 'Approved.' }
                                }
                            },
                            {
                                id: 'T3-L2',
                                description: 'IV Catheters - Sterile, sizes 18G-24G',
                                unspsc: '42131801',
                                quantity: '75,000 units',
                                mandatory: true,
                                bidderCompliance: 'Yes',
                                bidderResponse: 'Sterile IV catheters with safety mechanism. All sizes available.',
                                specifications: 'Sterile, safety mechanism, 18G-24G range',
                                deviation: null,
                                productDetails: {
                                    model: 'SafeVein IV Pro',
                                    manufacturer: 'VascularTech GmbH',
                                    manufacturerAddress: '89 Medical Park, Dsseldorf, Germany 40213',
                                    subcontractor: 'PlastiMed (catheter tubing)',
                                    countryOfOrigin: 'Germany'
                                },
                                supplierDocs: [
                                    { name: 'IV_Catheter_Specs.pdf', size: '1.9 MB', date: '2024-11-12' },
                                    { name: 'Safety_Features.pdf', size: '1.1 MB', date: '2024-11-12' }
                                ],
                                systemEval: 'pass',
                                evaluations: {
                                    evaluator: { status: 'pass', comment: 'Safety mechanism meets requirements.' },
                                    evaluator2: { status: 'pass', comment: 'All sizes compliant.' },
                                    po: { status: 'pass', comment: 'Approved.' }
                                }
                            }
                        ]
                    }
                ]
            },
            step4: { // Financial - lot-based view
                name: 'Financial Evaluation',
                requirements: [
                    {
                        id: 'F1',
                        description: 'Medical gloves (UNSPSC: 42131701)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '50,000 boxes',
                        unitPrice: '$2.25/box',
                        originalPrice: '$112,500',
                        incotermPrice: '$112,500 (CIF)',
                        corrections: '-$500',
                        negotiations: '-$2,000',
                        finalPrice: '$110,000',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Gloves.xlsx', size: '145 KB', date: '2024-11-12' },
                            { name: 'Unit_Price_Breakdown.pdf', size: '290 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Competitive unit pricing. Minor arithmetic correction applied.' }
                        }
                    },
                    {
                        id: 'F2',
                        description: 'Surgical masks (UNSPSC: 42131603)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '100,000 units',
                        unitPrice: '$0.45/unit',
                        originalPrice: '$45,000',
                        incotermPrice: '$45,000 (CIF)',
                        corrections: '$0',
                        negotiations: '-$1,000',
                        finalPrice: '$44,000',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Masks.xlsx', size: '128 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Good pricing after negotiations.' }
                        }
                    },
                    {
                        id: 'F3',
                        description: 'Face shields (UNSPSC: 42131605)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '10,000 units',
                        unitPrice: '$3.80/unit',
                        originalPrice: '$38,000',
                        incotermPrice: '$38,000 (CIF)',
                        corrections: '$0',
                        negotiations: '-$500',
                        finalPrice: '$37,500',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Shields.xlsx', size: '115 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Reasonable pricing for quality offered.' }
                        }
                    },
                    {
                        id: 'F4',
                        description: 'Syringes (UNSPSC: 42131805)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '200,000 units',
                        unitPrice: '$0.32/unit',
                        originalPrice: '$64,000',
                        incotermPrice: '$64,000 (CIF)',
                        corrections: '$0',
                        negotiations: '-$1,500',
                        finalPrice: '$62,500',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Syringes.xlsx', size: '132 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Competitive pricing. Volume discount applied.' }
                        }
                    },
                    {
                        id: 'F5',
                        description: 'Gauze bandages (UNSPSC: 42131509)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '50,000 rolls',
                        unitPrice: '$1.85/roll',
                        originalPrice: '$92,500',
                        incotermPrice: '$92,500 (CIF)',
                        corrections: '$0',
                        negotiations: '-$1,000',
                        finalPrice: '$91,500',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Gauze.xlsx', size: '118 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Good value for medical grade gauze.' }
                        }
                    },
                    {
                        id: 'F6',
                        description: 'IV Catheters (UNSPSC: 42131801)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '75,000 units',
                        unitPrice: '$0.95/unit',
                        originalPrice: '$71,250',
                        incotermPrice: '$71,250 (CIF)',
                        corrections: '$0',
                        negotiations: '-$1,250',
                        finalPrice: '$70,000',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Catheters.xlsx', size: '125 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Competitive pricing for safety IV catheters.' }
                        }
                    }
                ],
                lots: [
                    {
                        id: 'lot1',
                        name: 'Lot 1: Personal Protective Equipment',
                        totalValue: '$191,500',
                        items: [
                            {
                                id: 'F1-L1',
                                unspsc: '42131701',
                                description: 'Medical gloves - Latex-free, powder-free examination gloves',
                                quantity: '50,000 boxes',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$2.25', totalCurrency: '$112,500', totalIncoterm: '$112,500 (CIF)', corrections: '-$500', negotiations: '-$2,000', finalPrice: '$110,000', rank: '2 of 6', evalStatus: 'pass', comment: '' },
                                    vendor2: { unitPrice: '$2.15', totalCurrency: '$107,500', totalIncoterm: '$107,500 (CIF)', corrections: '$0', negotiations: '-$1,000', finalPrice: '$106,500', rank: '1 of 6', evalStatus: 'pass', comment: '' },
                                    vendor3: { unitPrice: '$2.35', totalCurrency: '$117,500', totalIncoterm: '$117,500 (CIF)', corrections: '$0', negotiations: '-$1,500', finalPrice: '$116,000', rank: '3 of 6', evalStatus: 'not_evaluated', comment: '' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Gloves_V1.xlsx', size: '145 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Gloves_V2.xlsx', size: '138 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Gloves_V3.xlsx', size: '152 KB', date: '2024-11-10' }]
                                }
                            },
                            {
                                id: 'F2-L1',
                                unspsc: '42131603',
                                description: 'Surgical masks - Type IIR, fluid resistant',
                                quantity: '100,000 units',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$0.45', totalCurrency: '$45,000', totalIncoterm: '$45,000 (CIF)', corrections: '$0', negotiations: '-$1,000', finalPrice: '$44,000', rank: '2 of 6', evalStatus: 'pass', comment: '' },
                                    vendor2: { unitPrice: '$0.42', totalCurrency: '$42,000', totalIncoterm: '$42,000 (CIF)', corrections: '$0', negotiations: '-$500', finalPrice: '$41,500', rank: '1 of 6', evalStatus: 'clarification', comment: 'Need to verify currency exchange' },
                                    vendor3: { unitPrice: '$0.48', totalCurrency: '$48,000', totalIncoterm: '$48,000 (CIF)', corrections: '$0', negotiations: '-$800', finalPrice: '$47,200', rank: '3 of 6', evalStatus: 'not_evaluated', comment: '' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Masks_V1.xlsx', size: '128 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Masks_V2.xlsx', size: '125 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Masks_V3.xlsx', size: '130 KB', date: '2024-11-10' }]
                                }
                            },
                            {
                                id: 'F3-L1',
                                unspsc: '42131605',
                                description: 'Face shields - Full face protection, anti-fog',
                                quantity: '10,000 units',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$3.80', totalCurrency: '$38,000', totalIncoterm: '$38,000 (CIF)', corrections: '$0', negotiations: '-$500', finalPrice: '$37,500', rank: '2 of 6', evalStatus: 'not_evaluated', comment: '' },
                                    vendor2: { unitPrice: '$3.65', totalCurrency: '$36,500', totalIncoterm: '$36,500 (CIF)', corrections: '$0', negotiations: '-$300', finalPrice: '$36,200', rank: '1 of 6', evalStatus: 'pass', comment: '' },
                                    vendor3: { unitPrice: '$3.95', totalCurrency: '$39,500', totalIncoterm: '$39,500 (CIF)', corrections: '$0', negotiations: '-$400', finalPrice: '$39,100', rank: '3 of 6', evalStatus: 'fail', comment: 'Price above budget limit' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Shields_V1.xlsx', size: '115 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Shields_V2.xlsx', size: '112 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Shields_V3.xlsx', size: '118 KB', date: '2024-11-10' }]
                                }
                            }
                        ]
                    },
                    {
                        id: 'lot2',
                        name: 'Lot 2: Medical Consumables',
                        totalValue: '$224,000',
                        items: [
                            {
                                id: 'F1-L2',
                                unspsc: '42131805',
                                description: 'Syringes - Sterile, single-use, luer lock, 5ml',
                                quantity: '200,000 units',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$0.32', totalCurrency: '$64,000', totalIncoterm: '$64,000 (CIF)', corrections: '$0', negotiations: '-$1,500', finalPrice: '$62,500', rank: '2 of 6', evalStatus: 'pass', comment: '' },
                                    vendor2: { unitPrice: '$0.30', totalCurrency: '$60,000', totalIncoterm: '$60,000 (CIF)', corrections: '$0', negotiations: '-$1,000', finalPrice: '$59,000', rank: '1 of 6', evalStatus: 'pass', comment: '' },
                                    vendor3: { unitPrice: '$0.34', totalCurrency: '$68,000', totalIncoterm: '$68,000 (CIF)', corrections: '$0', negotiations: '-$1,200', finalPrice: '$66,800', rank: '3 of 6', evalStatus: 'not_evaluated', comment: '' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Syringes_V1.xlsx', size: '132 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Syringes_V2.xlsx', size: '128 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Syringes_V3.xlsx', size: '135 KB', date: '2024-11-10' }]
                                }
                            },
                            {
                                id: 'F2-L2',
                                unspsc: '42131509',
                                description: 'Gauze bandages - Sterile, cotton, various sizes',
                                quantity: '50,000 rolls',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$1.85', totalCurrency: '$92,500', totalIncoterm: '$92,500 (CIF)', corrections: '$0', negotiations: '-$1,000', finalPrice: '$91,500', rank: '2 of 6', evalStatus: 'not_evaluated', comment: '' },
                                    vendor2: { unitPrice: '$1.75', totalCurrency: '$87,500', totalIncoterm: '$87,500 (CIF)', corrections: '$0', negotiations: '-$800', finalPrice: '$86,700', rank: '1 of 6', evalStatus: 'pass', comment: '' },
                                    vendor3: { unitPrice: '$1.95', totalCurrency: '$97,500', totalIncoterm: '$97,500 (CIF)', corrections: '$0', negotiations: '-$900', finalPrice: '$96,600', rank: '3 of 6', evalStatus: 'clarification', comment: 'Need manufacturer cert' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Gauze_V1.xlsx', size: '118 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Gauze_V2.xlsx', size: '115 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Gauze_V3.xlsx', size: '120 KB', date: '2024-11-10' }]
                                }
                            },
                            {
                                id: 'F3-L2',
                                unspsc: '42131801',
                                description: 'IV Catheters - Sterile, sizes 18G-24G',
                                quantity: '75,000 units',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$0.95', totalCurrency: '$71,250', totalIncoterm: '$71,250 (CIF)', corrections: '$0', negotiations: '-$1,250', finalPrice: '$70,000', rank: '2 of 6', evalStatus: 'pass', comment: '' },
                                    vendor2: { unitPrice: '$0.88', totalCurrency: '$66,000', totalIncoterm: '$66,000 (CIF)', corrections: '$0', negotiations: '-$800', finalPrice: '$65,200', rank: '1 of 6', evalStatus: 'pass', comment: '' },
                                    vendor3: { unitPrice: '$0.98', totalCurrency: '$73,500', totalIncoterm: '$73,500 (CIF)', corrections: '$0', negotiations: '-$1,000', finalPrice: '$72,500', rank: '3 of 6', evalStatus: 'not_evaluated', comment: '' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Catheters_V1.xlsx', size: '125 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Catheters_V2.xlsx', size: '122 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Catheters_V3.xlsx', size: '128 KB', date: '2024-11-10' }]
                                }
                            }
                        ]
                    }
                ]
            }
        };

        function showEvaluation(tenderId, tenderTitle, role) {
            currentTenderId = tenderId;
            currentTenderTitle = tenderTitle;
            currentEvaluationRole = role || 'evaluator';
            
            document.getElementById('eval-tender-title').textContent = tenderId + ': ' + tenderTitle;
            document.getElementById('eval-user-role').textContent = currentEvaluationRole === 'po' ? 'Procurement Official' : 'Evaluator';
            
            // Hide all view sections - force inline style
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show evaluation view
            const evalView = document.getElementById('view-evaluation');
            if (evalView) {
                evalView.classList.add('active');
                evalView.style.display = 'block';
            }
            
            // Show/hide view toggle based on current step
            const viewToggle = document.getElementById('viewToggle');
            if (viewToggle) {
                viewToggle.style.display = (currentEvaluationStep === 3 || currentEvaluationStep === 4) ? 'flex' : 'none';
            }
            
            updateRoleButtons();
            switchEvaluationStep(currentEvaluationStep); // This will render the table
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function switchEvaluationRole(role) {
            currentEvaluationRole = role;
            updateRoleButtons();
            
            // Hide/show elements based on role
            const evalTabsContainer = document.getElementById('evalTabsContainer');
            const vendorInfoBar = document.getElementById('vendor-info-bar');
            const evaluationStepsSection = document.getElementById('evaluation-steps-section');
            const viewToggle = document.getElementById('viewToggle');
            
            if (role === 'comparison') {
                // Hide vendor tabs, info bar, steps, and view toggle for Overview Dashboard
                if (evalTabsContainer) evalTabsContainer.parentElement.style.display = 'none';
                if (vendorInfoBar) vendorInfoBar.style.display = 'none';
                if (evaluationStepsSection) evaluationStepsSection.style.display = 'none';
                if (viewToggle) viewToggle.style.display = 'none';
            } else {
                // Show vendor tabs, info bar, and steps for Evaluator and PO views
                if (evalTabsContainer) evalTabsContainer.parentElement.style.display = 'flex';
                if (vendorInfoBar) vendorInfoBar.style.display = 'flex';
                if (evaluationStepsSection) evaluationStepsSection.style.display = 'block';
                // Show view toggle only for Technical (3) and Financial (4) steps
                if (viewToggle) {
                    viewToggle.style.display = (currentEvaluationStep === 3 || currentEvaluationStep === 4) ? 'flex' : 'none';
                }
            }
            
            renderEvaluationTable();
        }

        function updateRoleButtons() {
            document.querySelectorAll('#view-evaluation .btn-secondary').forEach(btn => {
                btn.style.background = 'var(--surface-200)';
                btn.style.color = 'var(--text-secondary)';
            });
            
            const roleMap = {
                'evaluator': 'role-evaluator-btn',
                'po': 'role-po-btn',
                'comparison': 'role-comparison-btn'
            };
            
            const activeBtn = document.getElementById(roleMap[currentEvaluationRole]);
            if (activeBtn) {
                activeBtn.style.background = 'var(--primary-400)';
                activeBtn.style.color = 'white';
            }
            
        }

        function switchEvaluationStep(step) {
            currentEvaluationStep = step;
            
            // Show/hide view toggle based on step (show for Technical step 3 and Financial step 4)
            const viewToggle = document.getElementById('viewToggle');
            if (viewToggle) {
                viewToggle.style.display = (step === 3 || step === 4) ? 'flex' : 'none';
            }
            
            // Show/hide view toggle based on step (show for Technical step 3 and Financial step 4)
            const evalTabsContainer = document.getElementById('evalTabsContainer');
            const vendorInfoBar = document.querySelector('#evaluation-content-area > div:first-child');
            
            // Always show vendor tabs and info bar for all steps (unless in comparison view)
            if (evalTabsContainer) evalTabsContainer.parentElement.style.display = 'flex';
            if (vendorInfoBar) vendorInfoBar.style.display = 'flex';
            
            // Reset to supplier view when changing steps
            if (step !== 3 && step !== 4) {
                currentEvalView = 'supplier';
            }
            
            // Update tabs based on current view
            if (currentEvalView === 'lot' && (step === 3 || step === 4)) {
                const tabsContainer = document.getElementById('evalTabsContainer');
                tabsContainer.innerHTML = `
                    <button class="lot-tab ${currentLotId === 'lot1' ? 'active' : ''}" onclick="switchLot('lot1')"> Lot 1: PPE</button>
                    <button class="lot-tab ${currentLotId === 'lot2' ? 'active' : ''}" onclick="switchLot('lot2')"> Lot 2: Medical Consumables</button>
                `;
            }
            
            // Update step indicators
            document.querySelectorAll('.eval-step').forEach(el => {
                el.classList.remove('active', 'completed');
            });
            
            document.querySelectorAll('.eval-step').forEach((el, index) => {
                const stepNum = parseInt(el.getAttribute('data-step'));
                if (stepNum < currentEvaluationStep) {
                    el.classList.add('completed');
                    el.querySelector('div').innerHTML = '';
                    el.querySelector('div').style.background = 'var(--success-500)';
                    el.querySelector('div').style.borderColor = 'var(--success-500)';
                    el.querySelectorAll('div')[1].style.color = 'var(--success-500)';
                } else if (stepNum === currentEvaluationStep) {
                    el.classList.add('active');
                    el.querySelector('div').innerHTML = stepNum;
                    el.querySelector('div').style.background = 'var(--primary-400)';
                    el.querySelector('div').style.borderColor = 'var(--primary-400)';
                    el.querySelectorAll('div')[1].style.color = 'var(--primary-400)';
                    el.querySelectorAll('div')[1].style.fontWeight = '600';
                } else {
                    el.querySelector('div').innerHTML = stepNum;
                    el.querySelector('div').style.background = 'var(--surface-0)';
                    el.querySelector('div').style.borderColor = 'var(--surface-200)';
                    el.querySelector('div').style.color = 'var(--text-muted)';
                    el.querySelectorAll('div')[1].style.color = 'var(--text-muted)';
                    el.querySelectorAll('div')[1].style.fontWeight = '500';
                }
            });
            
            renderEvaluationTable();
        }

        function switchVendorEval(vendorId) {
            currentVendorEval = vendorId;
            
            document.querySelectorAll('.vendor-eval-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const vendorNames = {
                'vendor1': 'MedSupply Ltd.',
                'vendor2': 'HealthCare Corp.',
                'vendor3': 'MedTech Inc.'
            };
            
            document.getElementById('vendor-eval-name').textContent = vendorNames[vendorId];
            
            // Show notification if in lot view
            if (currentEvalView === 'lot') {
                showToast(` Viewing evaluations for ${vendorNames[vendorId]}`);
            }
            
            renderEvaluationTable();
        }

        function renderEvaluationTable() {
            const container = document.getElementById('evaluation-table-container');
            
            // Determine step key based on current evaluation step and view
            let stepKey;
            if (currentEvaluationStep === 3) {
                stepKey = 'step3Lots';
            } else {
                stepKey = 'step' + currentEvaluationStep;
            }
            
            const stepData = evaluationData[stepKey];
            
            if (!stepData) {
                container.innerHTML = '<p>No evaluation data available for this step.</p>';
                return;
            }
            
            // Render based on view type
            if (currentEvalView === 'lot' && stepData.lots) {
                if (currentEvaluationStep === 4) {
                    renderFinancialLotView(container, stepData);
                } else if (currentEvaluationStep === 3) {
                    renderLotView(container, stepData);
                }
            } else if (currentEvaluationRole === 'comparison') {
                renderComparisonView(container, stepData);
            } else if (currentEvaluationRole === 'po') {
                renderPOView(container, stepData);
            } else {
                renderEvaluatorView(container, stepData);
            }
        }

        function renderEligibilityTable(stepData) {
            let html = `
                <div style="margin-bottom: var(--spacing-lg);">
                    <div style="overflow-x: auto;">
                        <table class="eval-table">
                            <thead>
                                <tr>
                                    <th style="width: 90px;">Criteria ID</th>
                                    <th style="width: 200px;">Criteria</th>
                                    <th style="width: 90px;">Type</th>
                                    <th style="width: 60px;">SP Flag</th>
                                    <th style="min-width: 250px;">Assessment</th>
                                    <th class="system-eval-column" style="width: 90px;">System</th>
                                    <th class="manual-eval-column" style="width: 120px;">Your Eval</th>
                                    <th class="manual-eval-column" style="width: 200px;">Comments</th>
                                    <th class="manual-eval-column" style="width: 100px;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            stepData.requirements.forEach(req => {
                const currentEval = req.evaluations.evaluator;
                const hasFlag = req.spFlag || req.flagDetails;
                
                html += `
                    <tr style="${hasFlag ? 'background: #fffef0;' : ''}">
                        <td>
                            <div class="req-id-badge" style="${req.isCustom ? 'background: var(--primary-100); color: var(--primary-600);' : ''}">
                                ${req.id}
                            </div>
                            ${req.isCustom ? '<div style="font-size: 9px; color: var(--primary-500); margin-top: 4px;">CUSTOM</div>' : ''}
                        </td>
                        <td>
                            <div style="font-weight: 600; font-size: 13px; margin-bottom: 4px;">${req.criteria}</div>
                            <div style="font-size: 11px; color: var(--text-muted); line-height: 1.4;">${req.criteriaDesc}</div>
                        </td>
                        <td>
                            <span style="font-size: 11px; padding: 3px 8px; background: var(--surface-100); border-radius: var(--radius-xs);">
                                ${req.type}
                            </span>
                        </td>
                        <td style="text-align: center;">
                            ${hasFlag ? '<span style="font-size: 16px;" title="Special attention required"></span>' : '<span style="color: var(--text-muted);"></span>'}
                        </td>
                        <td>
                            <div style="font-size: 12px; white-space: pre-line; line-height: 1.5;">${req.assessment}</div>
                            ${req.flagDetails ? `
                                <div style="margin-top: var(--spacing-sm); padding: var(--spacing-sm); background: var(--warning-50); border-radius: var(--radius-xs); border-left: 3px solid var(--warning-400);">
                                    <div style="font-size: 11px; color: var(--warning-600);">${req.flagDetails}</div>
                                </div>
                            ` : ''}
                            ${req.claimsLogLink ? `
                                <div style="margin-top: var(--spacing-sm);">
                                    <a href="${req.claimsLogLink}" target="_blank" style="font-size: 11px; color: var(--primary-400); text-decoration: none;">
                                         View Claims Log
                                    </a>
                                </div>
                            ` : ''}
                        </td>
                        <td class="system-eval-column">
                            <span class="eval-status-badge ${req.systemEval}">
                                ${req.systemEval === 'pass' ? ' Pass' : ' Fail'}
                            </span>
                        </td>
                        <td class="manual-eval-column">
                            <select class="eval-select ${currentEval.status}">
                                <option value="not_evaluated" ${currentEval.status === 'not_evaluated' ? 'selected' : ''}> Not Evaluated</option>
                                <option value="pass" ${currentEval.status === 'pass' ? 'selected' : ''}> Pass</option>
                                <option value="fail" ${currentEval.status === 'fail' ? 'selected' : ''}> Fail</option>
                                <option value="clarification" ${currentEval.status === 'clarification' ? 'selected' : ''}> Clarification</option>
                            </select>
                        </td>
                        <td class="manual-eval-column">
                            <textarea class="eval-comment-field" placeholder="Enter your comments..." rows="2">${currentEval.comment}</textarea>
                        </td>
                        <td class="manual-eval-column" style="text-align: center;">
                            <div style="display: flex; flex-direction: column; gap: 4px;">
                                ${currentEvaluationRole === 'evaluator' ? `
                                    <button class="btn btn-secondary btn-sm" onclick="askEvalTeamQuestion('${req.id}')" title="Ask Evaluation Team/PO" style="font-size: 10px; padding: 4px 6px;">
                                         Ask Team
                                    </button>
                                ` : ''}
                                ${currentEvaluationRole === 'po' ? `
                                    <button class="btn btn-secondary btn-sm" onclick="startPrivateClarification('${req.id}')" title="Start Private Clarification with Supplier" style="font-size: 10px; padding: 4px 6px;">
                                         Clarify
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        // askEvalTeamQuestion is defined earlier - opens collaboration panel
        
        function startPrivateClarification(criteriaId) {
            showToast(' Starting private clarification with supplier for ' + criteriaId);
            // Would open a modal to start private clarification with supplier
        }
        
        function renderQualificationTable(stepData) {
            let html = `
                <div style="margin-bottom: var(--spacing-lg);">
                    <div style="overflow-x: auto;">
                        <table class="eval-table">
                            <thead>
                                <tr>
                                    <th style="width: 90px;">Criteria ID</th>
                                    <th style="width: 250px;">Criteria</th>
                                    <th style="width: 80px;">Type</th>
                                    <th style="width: 60px;">SP Flag</th>
                                    <th class="system-eval-column" style="width: 90px;">System</th>
                                    <th class="manual-eval-column" style="width: 120px;">Your Eval</th>
                                    <th class="manual-eval-column" style="width: 250px;">Comments</th>
                                    <th class="manual-eval-column" style="width: 100px;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            stepData.requirements.forEach(req => {
                const currentEval = req.evaluations.evaluator;
                const hasFlag = req.spFlag || req.flagDetails;
                const isSpecialRow = req.isOverallStatus || req.isRemarksField;
                
                html += `
                    <tr style="${hasFlag ? 'background: #fffef0;' : ''} ${isSpecialRow ? 'background: var(--surface-50); font-style: italic;' : ''}">
                        <td>
                            <div class="req-id-badge" style="${req.isOverallStatus ? 'background: var(--success-100); color: var(--success-600);' : ''} ${req.isRemarksField ? 'background: var(--info-100); color: var(--info-600);' : ''}">
                                ${req.id}
                            </div>
                        </td>
                        <td>
                            <div style="font-weight: 600; font-size: 13px; margin-bottom: 4px;">${req.criteria}</div>
                            <div style="font-size: 11px; color: var(--text-muted); line-height: 1.4;">${req.criteriaDesc}</div>
                            ${req.formRef ? `<div style="margin-top: 4px;"><span style="font-size: 10px; padding: 2px 6px; background: var(--primary-50); color: var(--primary-500); border-radius: var(--radius-xs);"> ${req.formRef}</span></div>` : ''}
                            ${req.flagDetails ? `
                                <div style="margin-top: var(--spacing-sm); padding: var(--spacing-xs); background: var(--warning-50); border-radius: var(--radius-xs); border-left: 2px solid var(--warning-400);">
                                    <div style="font-size: 10px; color: var(--warning-600);">${req.flagDetails}</div>
                                </div>
                            ` : ''}
                        </td>
                        <td>
                            <span style="font-size: 11px; padding: 3px 8px; background: var(--surface-100); border-radius: var(--radius-xs);">
                                ${req.type}
                            </span>
                        </td>
                        <td style="text-align: center;">
                            ${hasFlag ? '<span style="font-size: 16px;" title="Special attention required"></span>' : '<span style="color: var(--text-muted);"></span>'}
                        </td>
                        <td class="system-eval-column">
                            ${req.systemEval ? `
                                <span class="eval-status-badge ${req.systemEval}">
                                    ${req.systemEval === 'pass' ? ' Pass' : ' Fail'}
                                </span>
                            ` : '<span style="color: var(--text-muted);"></span>'}
                        </td>
                        <td class="manual-eval-column">
                            <select class="eval-select ${currentEval.status}">
                                <option value="not_evaluated" ${currentEval.status === 'not_evaluated' ? 'selected' : ''}> Not Evaluated</option>
                                <option value="pass" ${currentEval.status === 'pass' ? 'selected' : ''}> Pass</option>
                                <option value="fail" ${currentEval.status === 'fail' ? 'selected' : ''}> Fail</option>
                                <option value="clarification" ${currentEval.status === 'clarification' ? 'selected' : ''}> Clarification</option>
                            </select>
                        </td>
                        <td class="manual-eval-column">
                            <textarea class="eval-comment-field" placeholder="Enter your comments..." rows="2">${currentEval.comment}</textarea>
                        </td>
                        <td class="manual-eval-column" style="text-align: center;">
                            <div style="display: flex; flex-direction: column; gap: 4px;">
                                ${currentEvaluationRole === 'evaluator' ? `
                                    <button class="btn btn-secondary btn-sm" onclick="askEvalTeamQuestion('${req.id}')" title="Ask Evaluation Team/PO" style="font-size: 10px; padding: 4px 6px;">
                                         Ask Team
                                    </button>
                                ` : ''}
                                ${currentEvaluationRole === 'po' ? `
                                    <button class="btn btn-secondary btn-sm" onclick="startPrivateClarification('${req.id}')" title="Start Private Clarification with Supplier" style="font-size: 10px; padding: 4px 6px;">
                                         Clarify
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        function renderQualificationPOTable(stepData) {
            let html = `
                <div style="margin-bottom: var(--spacing-lg);">
                    <div style="background: var(--primary-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-lg); border-left: 4px solid var(--primary-400);">
                        <strong>Procurement Official Review - Qualification Criteria</strong>
                        <p style="margin: var(--spacing-xs) 0 0 0; font-size: 12px; color: var(--text-secondary);">
                            Review evaluator assessments and provide final determination on qualification status.
                        </p>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table class="eval-table">
                            <thead>
                                <tr>
                                    <th style="width: 80px;">Criteria ID</th>
                                    <th style="width: 180px;">Criteria</th>
                                    <th style="width: 70px;">Type</th>
                                    <th style="width: 50px;">SP</th>
                                    <th style="width: 150px;">Documents</th>
                                    <th class="system-eval-column" style="width: 70px;">System</th>
                                    <th style="width: 90px;">Evaluator</th>
                                    <th style="width: 130px;">Eval Comments</th>
                                    <th class="manual-eval-column" style="width: 90px;">PO Final</th>
                                    <th class="manual-eval-column" style="width: 130px;">PO Comments</th>
                                    <th class="manual-eval-column" style="width: 80px;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            stepData.requirements.forEach(req => {
                const evalStatus = req.evaluations.evaluator;
                const poStatus = req.evaluations.po;
                const hasFlag = req.spFlag || req.flagDetails;
                const hasDiscrepancy = req.systemEval && evalStatus.status !== req.systemEval;
                const isSpecialRow = req.isOverallStatus || req.isRemarksField;
                
                html += `
                    <tr style="${hasFlag ? 'background: #fffef0;' : ''} ${hasDiscrepancy ? 'border-left: 3px solid var(--warning-400);' : ''} ${isSpecialRow ? 'background: var(--surface-50);' : ''}">
                        <td>
                            <div class="req-id-badge" style="${req.isOverallStatus ? 'background: var(--success-100); color: var(--success-600);' : ''}">${req.id}</div>
                        </td>
                        <td>
                            <div style="font-weight: 600; font-size: 12px; margin-bottom: 2px;">${req.criteria}</div>
                            ${req.formRef ? `<span style="font-size: 9px; padding: 1px 4px; background: var(--primary-50); color: var(--primary-500); border-radius: 2px;"> ${req.formRef}</span>` : ''}
                        </td>
                        <td><span style="font-size: 10px; padding: 2px 6px; background: var(--surface-100); border-radius: var(--radius-xs);">${req.type}</span></td>
                        <td style="text-align: center;">${hasFlag ? '' : ''}</td>
                        <td style="font-size: 10px;">${req.supplierDocs && req.supplierDocs.length > 0 ? `${req.supplierDocs.length} doc(s)` : ''}</td>
                        <td class="system-eval-column">
                            ${req.systemEval ? `<span class="eval-status-badge ${req.systemEval}">${req.systemEval === 'pass' ? '' : ''}</span>` : ''}
                        </td>
                        <td>
                            <span class="eval-status-badge ${evalStatus.status}" style="font-size: 10px;">${formatEvalStatus(evalStatus.status)}</span>
                            ${hasDiscrepancy ? '<div style="font-size: 9px; color: var(--warning-500); margin-top: 2px;"></div>' : ''}
                        </td>
                        <td style="font-size: 11px;">${evalStatus.comment.substring(0, 40)}${evalStatus.comment.length > 40 ? '...' : ''}</td>
                        <td class="manual-eval-column">
                            <select class="eval-select ${poStatus.status}" style="font-size: 11px; padding: 4px;">
                                <option value="pending" ${poStatus.status === 'pending' || poStatus.status === 'not_evaluated' ? 'selected' : ''}> Pending</option>
                                <option value="pass" ${poStatus.status === 'pass' ? 'selected' : ''}> Pass</option>
                                <option value="fail" ${poStatus.status === 'fail' ? 'selected' : ''}> Fail</option>
                            </select>
                        </td>
                        <td class="manual-eval-column">
                            <textarea class="eval-comment-field" rows="2" style="font-size: 11px;">${poStatus.comment}</textarea>
                        </td>
                        <td class="manual-eval-column" style="text-align: center;">
                            <div style="display: flex; flex-direction: column; gap: 3px;">
                                <button class="btn btn-secondary btn-sm" onclick="startPrivateClarification('${req.id}')" title="Clarify with Supplier" style="font-size: 9px; padding: 4px 6px;">
                                     Clarify
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="askEvalTeamQuestion('${req.id}')" title="Ask Team" style="font-size: 9px; padding: 4px 6px;">
                                     Team
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        function renderTechnicalEvaluationUI(stepData) {
            const vendorNames = {
                'vendor1': 'MedSupply Ltd.',
                'vendor2': 'HealthCare Corp.',
                'vendor3': 'MedTech Inc.'
            };
            
            // Calculate lot status based on UNSPSC items
            // Calculate UNSPSC status from requirements array
            function calculateUnspscStatusFromReqs(requirements) {
                if (!requirements || requirements.length === 0) return 'not_evaluated';
                const hasFail = requirements.some(r => r.eval && r.eval.status === 'fail');
                const hasClarification = requirements.some(r => r.eval && r.eval.status === 'clarification');
                const hasNotEvaluated = requirements.some(r => !r.eval || r.eval.status === 'not_evaluated');
                
                if (hasFail) return 'fail';
                if (hasClarification) return 'clarification';
                if (hasNotEvaluated) return 'not_evaluated';
                return 'pass';
            }
            
            // Calculate lot status from items
            function calculateLotStatusFromItems(items) {
                if (!items || items.length === 0) return 'not_evaluated';
                
                // For each item, calculate its status based on the evaluator's status
                const statuses = items.map(item => {
                    const status = item.evaluations?.evaluator?.status || 'not_evaluated';
                    return status;
                });
                
                const hasFail = statuses.includes('fail');
                const hasClarification = statuses.includes('clarification');
                const hasNotEvaluated = statuses.includes('not_evaluated');
                
                if (hasFail) return 'fail';
                if (hasClarification) return 'clarification';
                if (hasNotEvaluated) return 'not_evaluated';
                return 'pass';
            }
            
            let html = `
                <!-- Navigation Bar for Quick Access -->
                <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                    <div style="display: flex; gap: var(--spacing-lg); align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <span style="font-size: 12px; color: var(--text-muted);">Jump to Lot:</span>
                            ${stepData.lots.map((lot, i) => `
                                <button class="btn btn-secondary btn-sm" onclick="document.getElementById('tech-lot-${lot.id}').scrollIntoView({behavior: 'smooth'})" style="font-size: 11px;">
                                     ${lot.name.split(':')[0]}
                                </button>
                            `).join('')}
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <button class="btn btn-secondary btn-sm" onclick="expandAllLots()" style="font-size: 11px;">
                                 Expand All
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="collapseAllLots()" style="font-size: 11px;">
                                 Collapse All
                            </button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: var(--spacing-sm); align-items: center;">
                            <span style="font-size: 11px; color: var(--text-muted);">Progress:</span>
                            <div style="background: var(--surface-200); border-radius: 10px; height: 8px; width: 150px; overflow: hidden;">
                                <div style="background: var(--success-400); height: 100%; width: 65%;"></div>
                            </div>
                            <span style="font-size: 11px; color: var(--success-500);">65%</span>
                        </div>
                    </div>
                </div>
            `;
            
            stepData.lots.forEach((lot, lotIndex) => {
                const lotStatus = calculateLotStatusFromItems(lot.items);
                const lotStatusColor = lotStatus === 'pass' ? 'var(--success-400)' : 
                                       lotStatus === 'fail' ? 'var(--danger-400)' : 
                                       lotStatus === 'clarification' ? 'var(--warning-400)' : 'var(--surface-300)';
                const passCount = lot.items.filter(i => i.evaluations?.evaluator?.status === 'pass').length;
                const failCount = lot.items.filter(i => i.evaluations?.evaluator?.status === 'fail').length;
                const isFirstLot = lotIndex === 0;
                
                html += `
                    <div id="tech-lot-${lot.id}" class="lot-collapsible" style="margin-bottom: var(--spacing-lg); border: 1px solid var(--surface-200); border-radius: var(--radius-lg); overflow: hidden;">
                        <!-- Lot Header with Status - Clickable to toggle -->
                        <div class="lot-header" style="background: linear-gradient(135deg, var(--primary-50) 0%, var(--info-50) 100%); padding: var(--spacing-lg); cursor: pointer;" onclick="toggleLot('${lot.id}')">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                    <span id="lot-icon-${lot.id}" style="font-size: 14px; color: var(--text-muted); transition: transform 0.2s ease;">${isFirstLot ? '' : ''}</span>
                                    <div style="width: 4px; height: 45px; background: var(--primary-400); border-radius: 2px;"></div>
                                    <div>
                                        <div style="font-size: 15px; font-weight: 700; color: var(--text-primary);"> ${lot.name}</div>
                                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px;">${lot.items.length} UNSPSC Products  ${lot.totalValue}</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: var(--spacing-lg);">
                                    <!-- Pass Count Card -->
                                    <div style="text-align: center; padding: 8px 16px; background: var(--success-50); border-radius: var(--radius-md); border: 1px solid var(--success-200);">
                                        <div style="font-size: 10px; color: var(--success-600); text-transform: uppercase;">Pass</div>
                                        <div style="font-size: 18px; font-weight: 700; color: var(--success-600);">${passCount}</div>
                                    </div>
                                    <!-- Fail Count Card -->
                                    <div style="text-align: center; padding: 8px 16px; background: ${failCount > 0 ? 'var(--danger-50)' : 'var(--surface-50)'}; border-radius: var(--radius-md); border: 1px solid ${failCount > 0 ? 'var(--danger-200)' : 'var(--surface-200)'};">
                                        <div style="font-size: 10px; color: ${failCount > 0 ? 'var(--danger-600)' : 'var(--text-muted)'}; text-transform: uppercase;">Fail</div>
                                        <div style="font-size: 18px; font-weight: 700; color: ${failCount > 0 ? 'var(--danger-600)' : 'var(--text-muted)'};">${failCount}</div>
                                    </div>
                                    <!-- Lot Status Card -->
                                    <div style="text-align: center; padding: 8px 16px; background: white; border-radius: var(--radius-md); border: 1px solid ${lotStatusColor};">
                                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase;">Lot Status</div>
                                        <div style="font-size: 14px; font-weight: 600; color: ${lotStatusColor};">${formatEvalStatus(lotStatus)}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- UNSPSC Items - Collapsible Content -->
                        <div id="lot-content-${lot.id}" class="lot-content" style="border-top: 1px solid var(--surface-200); ${isFirstLot ? '' : 'display: none;'}">
                `;
                
                lot.items.forEach((item, itemIndex) => {
                    const currentEval = item.evaluations?.evaluator || { status: 'not_evaluated', comment: '' };
                    
                    // Simulate multiple requirements per UNSPSC
                    const requirements = [
                        { id: item.id, description: item.specifications, compliance: item.bidderCompliance, response: item.bidderResponse, deviation: item.deviation, eval: currentEval },
                        { id: item.id + '-A', description: 'Quality certification requirement', compliance: 'Yes', response: 'ISO certified as required', deviation: null, eval: { status: 'pass', comment: 'Certification verified' } }
                    ];
                    
                    // Calculate UNSPSC status from all requirements
                    const unspscStatus = calculateUnspscStatusFromReqs(requirements);
                    const statusColor = unspscStatus === 'pass' ? 'var(--success-400)' : 
                                       unspscStatus === 'fail' ? 'var(--danger-400)' : 
                                       unspscStatus === 'clarification' ? 'var(--warning-400)' : 'var(--surface-300)';
                    
                    html += `
                            <div class="unspsc-collapsible" style="border-bottom: 1px solid var(--surface-100);">
                                <div class="unspsc-header" onclick="toggleUnspsc('tech-eval-${item.id}')" style="padding: var(--spacing-md); background: white; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                        <span id="tech-eval-${item.id}-icon" style="font-size: 12px; color: var(--text-muted); transition: transform 0.2s ease;"></span>
                                        <div style="width: 4px; height: 40px; background: ${statusColor}; border-radius: 2px;"></div>
                                        <div>
                                            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                                <span style="font-size: 12px; padding: 3px 10px; background: var(--primary-50); color: var(--primary-500); border-radius: var(--radius-xs); font-weight: 600;">${item.unspsc}</span>
                                                <span style="font-size: 11px; color: var(--text-muted);"> Qty: ${item.quantity}</span>
                                            </div>
                                            <div style="font-weight: 500; color: var(--text-primary); margin-top: 4px; font-size: 13px;">${item.description}</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: var(--spacing-lg);">
                                        <div style="text-align: center; padding: 4px 12px; background: ${statusColor}20; border-radius: var(--radius-sm); border: 1px solid ${statusColor};">
                                            <div style="font-size: 9px; color: var(--text-muted);">UNSPSC Status</div>
                                            <span class="eval-status-badge ${unspscStatus}" style="font-size: 10px;">${formatEvalStatus(unspscStatus)}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="tech-eval-${item.id}" class="unspsc-content" style="display: none;">
                                    <div style="padding: var(--spacing-lg); background: var(--surface-50); border-top: 1px solid var(--surface-100);">
                                        <!-- Technical Evaluation Table -->
                                        <table class="eval-table" style="margin-bottom: 0;">
                                            <thead>
                                                <tr>
                                                    <th style="width: 80px;">Req ID</th>
                                                    <th style="width: 200px;">Requirement</th>
                                                    <th style="width: 100px;">Compliant?</th>
                                                    <th style="width: 220px;">Details Offered</th>
                                                    <th style="width: 100px;">Deviation</th>
                                                    <th class="manual-eval-column" style="width: 100px;">Your Eval</th>
                                                    <th class="manual-eval-column" style="width: 180px;">Comments</th>
                                                    <th class="manual-eval-column" style="width: 60px;">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${requirements.map((req, reqIdx) => `
                                                <tr>
                                                    <td><div class="req-id-badge">${req.id}</div></td>
                                                    <td style="font-size: 12px;">${req.description}</td>
                                                    <td>
                                                        <span style="padding: 3px 8px; border-radius: var(--radius-sm); font-size: 10px; font-weight: 600; background: ${req.compliance === 'Yes' ? 'var(--success-50)' : req.compliance === 'No' ? 'var(--danger-50)' : 'var(--warning-50)'}; color: ${req.compliance === 'Yes' ? 'var(--success-500)' : req.compliance === 'No' ? 'var(--danger-500)' : 'var(--warning-500)'};">
                                                            ${req.compliance === 'Yes' ? ' Yes' : req.compliance === 'No' ? ' No' : ' Partial'}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <div style="font-size: 11px; color: var(--text-primary); margin-bottom: 4px;">${req.response ? req.response.substring(0, 50) + '...' : ''}</div>
                                                        <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                                                            <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); showProductDetails('${item.id}')" style="font-size: 9px; padding: 2px 6px;">
                                                                 View
                                                            </button>
                                                            ${item.supplierDocs && item.supplierDocs.length > 0 ? `
                                                                <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); previewDocumentOnline('${item.supplierDocs[0].name}')" style="font-size: 9px; padding: 2px 6px;">
                                                                     ${item.supplierDocs.length}
                                                                </button>
                                                            ` : ''}
                                                        </div>
                                                    </td>
                                                    <td style="font-size: 10px;">
                                                        ${req.deviation ? `<span style="display: inline-block; padding: 2px 6px; background: var(--danger-50); color: var(--danger-500); border-radius: var(--radius-xs);"></span>` : '<span style="color: var(--text-muted);"></span>'}
                                                    </td>
                                                    <td class="manual-eval-column">
                                                        <select class="eval-select ${req.eval.status}" style="font-size: 10px; padding: 4px;" onchange="updateRequirementEval('${item.id}', '${req.id}', this.value)">
                                                            <option value="not_evaluated" ${req.eval.status === 'not_evaluated' ? 'selected' : ''}></option>
                                                            <option value="pass" ${req.eval.status === 'pass' ? 'selected' : ''}></option>
                                                            <option value="fail" ${req.eval.status === 'fail' ? 'selected' : ''}></option>
                                                            <option value="clarification" ${req.eval.status === 'clarification' ? 'selected' : ''}></option>
                                                        </select>
                                                    </td>
                                                    <td class="manual-eval-column">
                                                        <textarea class="eval-comment-field" placeholder="Comments..." rows="1" style="font-size: 10px;">${req.eval.comment}</textarea>
                                                    </td>
                                                    <td class="manual-eval-column" style="text-align: center;">
                                                        <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); askEvalTeamQuestion('${req.id}')" title="Ask Team" style="font-size: 9px; padding: 3px 5px;">
                                                            
                                                        </button>
                                                    </td>
                                                </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                        
                                        <!-- UNSPSC Level Summary -->
                                        <div style="margin-top: var(--spacing-md); padding: var(--spacing-sm) var(--spacing-md); background: ${statusColor}15; border-left: 3px solid ${statusColor}; border-radius: var(--radius-sm); display: flex; justify-content: space-between; align-items: center;">
                                            <div style="font-size: 11px; color: var(--text-primary);">
                                                <strong>UNSPSC ${item.unspsc} Status:</strong> 
                                                <span style="font-weight: 600;">${formatEvalStatus(unspscStatus)}</span>
                                                <span style="color: var(--text-muted); margin-left: var(--spacing-sm);">(${requirements.filter(r => r.eval.status === 'pass').length}/${requirements.length} pass)</span>
                                            </div>
                                            <div style="font-size: 10px; color: var(--text-muted);">
                                                 All requirements must pass for UNSPSC to pass
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            return html;
        }
        
        function updateRequirementEval(unspscId, reqId, status) {
            showToast(` Requirement ${reqId} updated to ${status}`);
            // In real implementation, this would update the data and recalculate UNSPSC/Lot status
        }
        
        function updateLotEvaluation(lotId, status) {
            if (status === 'system') {
                showToast(' Using system-calculated status for ' + lotId);
            } else {
                showToast(` Lot ${lotId} manually set to ${status}`);
            }
        }
        
        function toggleLot(lotId) {
            const content = document.getElementById('lot-content-' + lotId);
            const icon = document.getElementById('lot-icon-' + lotId);
            
            if (!content || !icon) return;
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '';
            } else {
                content.style.display = 'none';
                icon.textContent = '';
            }
        }
        
        function expandAllLots() {
            document.querySelectorAll('.lot-content').forEach(content => {
                content.style.display = 'block';
            });
            document.querySelectorAll('[id^="lot-icon-"]').forEach(icon => {
                icon.textContent = '';
            });
            showToast(' All lots expanded');
        }
        
        function collapseAllLots() {
            document.querySelectorAll('.lot-content').forEach(content => {
                content.style.display = 'none';
            });
            document.querySelectorAll('[id^="lot-icon-"]').forEach(icon => {
                icon.textContent = '';
            });
            showToast(' All lots collapsed');
        }

        // Financial Evaluation Lot Toggle Functions
        function toggleFinancialLot(lotId) {
            const content = document.getElementById(lotId);
            const icon = document.getElementById(lotId + '-icon');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '';
            } else {
                content.style.display = 'none';
                icon.textContent = '';
            }
        }

        function expandAllFinancialLots() {
            document.querySelectorAll('.financial-lot-content').forEach(content => {
                content.style.display = 'block';
            });
            document.querySelectorAll('[id^="financial-lot-"][id$="-icon"]').forEach(icon => {
                icon.textContent = '';
            });
            showToast(' All lots expanded');
        }

        function collapseAllFinancialLots() {
            document.querySelectorAll('.financial-lot-content').forEach(content => {
                content.style.display = 'none';
            });
            document.querySelectorAll('[id^="financial-lot-"][id$="-icon"]').forEach(icon => {
                icon.textContent = '';
            });
            showToast(' All lots collapsed');
        }
        
        // Update Financial Item Evaluation Status and recalculate lot status
        function updateFinancialItemEval(lotId, itemId, newStatus) {
            // Update the item's eval status in the data (step4.lots is at top level, not per vendor)
            if (evaluationData && evaluationData.step4 && evaluationData.step4.lots) {
                const lot = evaluationData.step4.lots.find(l => l.id === lotId);
                if (lot) {
                    const item = lot.items.find(i => i.id === itemId);
                    if (item && item.prices && item.prices[currentVendorEval]) {
                        item.prices[currentVendorEval].evalStatus = newStatus;
                    }
                    
                    // Recalculate lot status for current vendor
                    let passCount = 0, failCount = 0, clarificationCount = 0, notEvalCount = 0;
                    lot.items.forEach(i => {
                        const status = i.prices && i.prices[currentVendorEval]?.evalStatus || 'not_evaluated';
                        if (status === 'pass') passCount++;
                        else if (status === 'fail') failCount++;
                        else if (status === 'clarification') clarificationCount++;
                        else notEvalCount++;
                    });
                    
                    let newLotStatus = 'not_evaluated';
                    let newLotStatusColor = 'var(--surface-300)';
                    if (failCount > 0) {
                        newLotStatus = 'fail';
                        newLotStatusColor = 'var(--danger-400)';
                    } else if (clarificationCount > 0) {
                        newLotStatus = 'clarification';
                        newLotStatusColor = 'var(--warning-400)';
                    } else if (notEvalCount > 0) {
                        newLotStatus = 'not_evaluated';
                        newLotStatusColor = 'var(--surface-300)';
                    } else {
                        newLotStatus = 'pass';
                        newLotStatusColor = 'var(--success-400)';
                    }
                    
                    // Update the lot header UI - find the lot header and update status card
                    const lotCollapsible = document.getElementById('financial-lot-collapsible-' + lotId);
                    if (lotCollapsible) {
                        const lotStatusDiv = lotCollapsible.querySelector('.financial-lot-header > div:last-child > div:first-child');
                        if (lotStatusDiv) {
                            lotStatusDiv.style.borderColor = newLotStatusColor;
                            const statusText = lotStatusDiv.querySelector('div:last-child');
                            if (statusText) {
                                statusText.textContent = formatEvalStatus(newLotStatus);
                                statusText.style.color = newLotStatusColor;
                            }
                        }
                        // Update the left bar color
                        const leftBar = lotCollapsible.querySelector('.financial-lot-header > div:first-child > div:nth-child(2)');
                        if (leftBar) {
                            leftBar.style.background = newLotStatusColor;
                        }
                    }
                    
                    // Update progress bar
                    updateFinancialProgress();
                }
            }
            
            showToast('Evaluation updated: ' + formatEvalStatus(newStatus));
        }
        
        // Update financial evaluation progress bar
        function updateFinancialProgress() {
            if (!evaluationData || !evaluationData.step4 || !evaluationData.step4.lots) return;
            
            let totalItems = 0;
            let evaluatedItems = 0;
            
            evaluationData.step4.lots.forEach(lot => {
                lot.items.forEach(item => {
                    totalItems++;
                    const status = item.prices && item.prices[currentVendorEval]?.evalStatus;
                    if (status && status !== 'not_evaluated') {
                        evaluatedItems++;
                    }
                });
            });
            
            const progressPercent = totalItems > 0 ? Math.round((evaluatedItems / totalItems) * 100) : 0;
            
            // Update progress bar in the UI
            const progressBarFill = document.querySelector('#evaluation-modal .financial-lot-collapsible')?.closest('.evaluation-body')?.querySelector('[style*="width:"][style*="background"]');
            if (progressBarFill) {
                progressBarFill.style.width = progressPercent + '%';
            }
        }
        
        // Format evaluation status for display
        function formatEvalStatus(status) {
            const statusMap = {
                'pass': ' Pass',
                'fail': ' Fail',
                'clarification': ' Clarify',
                'not_evaluated': ' Not Eval'
            };
            return statusMap[status] || status;
        }
        
        function showProductDetails(itemId) {
            console.log('showProductDetails called with itemId:', itemId);
            
            // Remove any existing modal first
            const existingModal = document.getElementById('productDetailsModal');
            if (existingModal) existingModal.remove();
            
            // Find the item data - search in multiple locations
            let foundItem = null;
            
            // Search in step3Lots (Technical with Lot structure)
            if (evaluationData && evaluationData.step3Lots && evaluationData.step3Lots.lots) {
                for (let lot of evaluationData.step3Lots.lots) {
                    if (lot.items) {
                        for (let item of lot.items) {
                            if (item.id === itemId) {
                                foundItem = item;
                                console.log('Found item in step3Lots:', foundItem);
                                break;
                            }
                        }
                    }
                    if (foundItem) break;
                }
            }
            
            // Search in step4 (financial) lots if not found
            if (!foundItem && evaluationData && evaluationData.step4 && evaluationData.step4.lots) {
                for (let lot of evaluationData.step4.lots) {
                    if (lot.items) {
                        for (let item of lot.items) {
                            if (item.id === itemId) {
                                foundItem = item;
                                console.log('Found item in step4:', foundItem);
                                break;
                            }
                        }
                    }
                    if (foundItem) break;
                }
            }
            
            // Also search in step3 requirements if still not found
            if (!foundItem && evaluationData && evaluationData.step3 && evaluationData.step3.requirements) {
                for (let req of evaluationData.step3.requirements) {
                    if (req.id === itemId) {
                        foundItem = req;
                        console.log('Found item in step3 requirements:', foundItem);
                        break;
                    }
                }
            }
            
            // Create a fallback item with basic info based on ID
            if (!foundItem) {
                console.log('Item not found in data, creating fallback for:', itemId);
                
                // Extract UNSPSC and description based on common patterns
                let unspsc = '42131701';
                let description = 'Medical gloves - Latex-free, powder-free examination gloves';
                let response = 'Nitrile examination gloves, powder-free, latex-free. EN455 compliant.';
                
                if (itemId.includes('T2') || itemId.includes('42131603')) {
                    unspsc = '42131603';
                    description = 'Surgical masks - Type IIR, fluid resistant';
                    response = 'Type II masks provided. Type IIR available at additional cost.';
                } else if (itemId.includes('T3') || itemId.includes('42131605')) {
                    unspsc = '42131605';
                    description = 'Face shields - Full face protection, anti-fog';
                    response = 'Anti-fog coated face shields with adjustable headband.';
                } else if (itemId.includes('L2')) {
                    if (itemId.includes('T1')) {
                        unspsc = '42131805';
                        description = 'Syringes - Sterile, single-use, luer lock, 5ml';
                        response = 'Sterile single-use syringes, luer lock, 5ml. ISO 7886-1 compliant.';
                    } else if (itemId.includes('T2')) {
                        unspsc = '42131509';
                        description = 'Gauze bandages - Sterile, cotton, various sizes';
                        response = 'Sterile cotton gauze bandages. Multiple sizes available.';
                    }
                }
                
                foundItem = {
                    id: itemId,
                    unspsc: unspsc,
                    description: description,
                    bidderResponse: response,
                    productDetails: {
                        model: 'NitriGuard Pro 500',
                        manufacturer: 'MedGlove International',
                        manufacturerAddress: '123 Industrial Park, Munich, Germany 80331',
                        subcontractor: null,
                        countryOfOrigin: 'Germany'
                    },
                    supplierDocs: [
                        { name: 'Technical_Specification.pdf', size: '2.1 MB' },
                        { name: 'Certificate.pdf', size: '890 KB' }
                    ]
                };
            }
            
            // If no productDetails, create default ones from available data
            const details = foundItem.productDetails || {
                model: 'Not specified',
                manufacturer: 'Not specified',
                manufacturerAddress: 'Not specified',
                subcontractor: null,
                countryOfOrigin: 'Not specified'
            };
            
            const modalHtml = `
                <div id="productDetailsModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="if(event.target===this) this.remove()">
                    <div style="background: white; border-radius: var(--radius-lg); width: 550px; max-width: 95%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg);">
                        <div style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-400) 100%); color: white; padding: var(--spacing-lg); border-radius: var(--radius-lg) var(--radius-lg) 0 0; position: sticky; top: 0;">
                            <h3 style="margin: 0; font-size: 16px;"> Details of Goods Offered</h3>
                            <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">UNSPSC ${foundItem.unspsc} - ${foundItem.description}</div>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <!-- Bidder Response Section -->
                            <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-lg); border-left: 4px solid var(--info-400);">
                                <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;">Bidder's Response</div>
                                <div style="font-size: 13px; color: var(--text-primary);">${foundItem.bidderResponse || 'N/A'}</div>
                            </div>
                            
                            <!-- Product Details Grid -->
                            <div style="display: grid; gap: var(--spacing-md);">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;"> Model</div>
                                        <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);">${details.model || 'N/A'}</div>
                                    </div>
                                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;"> Country of Origin</div>
                                        <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);">${details.countryOfOrigin || 'N/A'}</div>
                                    </div>
                                </div>
                                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                    <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;"> Manufacturer</div>
                                    <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);">${details.manufacturer || 'N/A'}</div>
                                </div>
                                <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                    <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;"> Manufacturer Address</div>
                                    <div style="font-size: 12px; color: var(--text-primary);">${details.manufacturerAddress || 'N/A'}</div>
                                </div>
                                ${details.subcontractor ? `
                                    <div style="background: var(--warning-50); padding: var(--spacing-md); border-radius: var(--radius-sm); border-left: 3px solid var(--warning-400);">
                                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;"> Subcontractor</div>
                                        <div style="font-size: 12px; color: var(--text-primary);">${details.subcontractor}</div>
                                    </div>
                                ` : `
                                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;"> Subcontractor</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">Not applicable</div>
                                    </div>
                                `}
                            </div>
                            
                            <!-- Deviation if any -->
                            ${foundItem.deviation ? `
                                <div style="margin-top: var(--spacing-lg); background: var(--danger-50); padding: var(--spacing-md); border-radius: var(--radius-sm); border-left: 3px solid var(--danger-400);">
                                    <div style="font-size: 10px; color: var(--danger-500); text-transform: uppercase; margin-bottom: 4px;"> Deviation Declared</div>
                                    <div style="font-size: 12px; color: var(--danger-600);">${foundItem.deviation}</div>
                                </div>
                            ` : ''}
                            
                            <!-- Attached Documents -->
                            ${foundItem.supplierDocs && foundItem.supplierDocs.length > 0 ? `
                                <div style="margin-top: var(--spacing-lg); padding-top: var(--spacing-md); border-top: 1px solid var(--surface-200);">
                                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: var(--spacing-sm);"> Attached Documents (${foundItem.supplierDocs.length})</div>
                                    <div style="display: flex; flex-wrap: wrap; gap: var(--spacing-sm);">
                                        ${foundItem.supplierDocs.map(doc => `
                                            <button class="btn btn-secondary btn-sm" onclick="viewDocument('${doc.name}')" style="font-size: 10px;">
                                                 ${doc.name}
                                            </button>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        <div style="padding: var(--spacing-md) var(--spacing-lg); border-top: 1px solid var(--surface-200); display: flex; justify-content: flex-end; gap: var(--spacing-sm); position: sticky; bottom: 0; background: white;">
                            <button class="btn btn-secondary" onclick="document.getElementById('productDetailsModal').remove()">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function renderTechnicalComparisonView(stepData) {
            const vendorNames = {
                'vendor1': 'MedSupply Ltd.',
                'vendor2': 'HealthCare Corp.',
                'vendor3': 'MedTech Inc.'
            };
            
            let html = `
                <!-- Summary Dashboard -->
                <div style="background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-400) 100%); border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-xl); color: white;">
                    <h2 style="margin: 0 0 var(--spacing-lg) 0; font-size: 20px;"> Evaluation Comparison Dashboard</h2>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-lg);">
                        <div style="background: rgba(255,255,255,0.15); border-radius: var(--radius-md); padding: var(--spacing-md); text-align: center;">
                            <div style="font-size: 28px; font-weight: 700;">3</div>
                            <div style="font-size: 11px; opacity: 0.9;">Suppliers</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); border-radius: var(--radius-md); padding: var(--spacing-md); text-align: center;">
                            <div style="font-size: 28px; font-weight: 700;">2</div>
                            <div style="font-size: 11px; opacity: 0.9;">Lots</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); border-radius: var(--radius-md); padding: var(--spacing-md); text-align: center;">
                            <div style="font-size: 28px; font-weight: 700;">6</div>
                            <div style="font-size: 11px; opacity: 0.9;">UNSPSC Codes</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); border-radius: var(--radius-md); padding: var(--spacing-md); text-align: center;">
                            <div style="font-size: 28px; font-weight: 700;">75%</div>
                            <div style="font-size: 11px; opacity: 0.9;">Avg. Compliance</div>
                        </div>
                    </div>
                </div>
                
                <!-- Supplier Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
            `;
            
            Object.keys(vendorNames).forEach(vendorKey => {
                const vendorName = vendorNames[vendorKey];
                const passCount = vendorKey === 'vendor1' ? 5 : vendorKey === 'vendor2' ? 4 : 5;
                const failCount = vendorKey === 'vendor1' ? 1 : vendorKey === 'vendor2' ? 2 : 1;
                const clarCount = vendorKey === 'vendor1' ? 0 : vendorKey === 'vendor2' ? 0 : 0;
                
                html += `
                    <div style="background: white; border-radius: var(--radius-lg); border: 1px solid var(--surface-200); overflow: hidden;">
                        <div style="background: var(--surface-50); padding: var(--spacing-md); border-bottom: 1px solid var(--surface-200);">
                            <div style="font-weight: 600; font-size: 14px;">${vendorName}</div>
                            <div style="font-size: 11px; color: var(--text-muted);">${vendorKey === 'vendor1' ? 'UNGM #309663' : vendorKey === 'vendor2' ? 'UNGM #301245' : 'UNGM #315789'}</div>
                        </div>
                        <div style="padding: var(--spacing-md);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm);">
                                <span style="color: var(--success-500); font-size: 12px;"> Pass: ${passCount}</span>
                                <span style="color: var(--danger-500); font-size: 12px;"> Fail: ${failCount}</span>
                                <span style="color: var(--warning-500); font-size: 12px;"> Clarification: ${clarCount}</span>
                            </div>
                            <div style="background: var(--surface-100); border-radius: 10px; height: 8px; overflow: hidden;">
                                <div style="background: var(--success-400); height: 100%; width: ${(passCount / 6) * 100}%; display: inline-block;"></div>
                                <div style="background: var(--danger-400); height: 100%; width: ${(failCount / 6) * 100}%; display: inline-block;"></div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                
                <!-- Detailed Comparison by Lot -->
            `;
            
            stepData.lots.forEach(lot => {
                html += `
                    <div style="background: white; border-radius: var(--radius-lg); border: 1px solid var(--surface-200); margin-bottom: var(--spacing-xl); overflow: hidden;">
                        <div style="background: var(--primary-50); padding: var(--spacing-md) var(--spacing-lg); border-bottom: 1px solid var(--surface-200);">
                            <div style="font-weight: 600; font-size: 15px; color: var(--primary-600);"> ${lot.name}</div>
                        </div>
                        <div style="overflow-x: auto;">
                            <table class="eval-table" style="margin: 0;">
                                <thead>
                                    <tr>
                                        <th style="width: 200px;">UNSPSC / Product</th>
                                        <th style="width: 150px; text-align: center;">MedSupply Ltd.</th>
                                        <th style="width: 150px; text-align: center;">HealthCare Corp.</th>
                                        <th style="width: 150px; text-align: center;">MedTech Inc.</th>
                                        <th style="width: 120px; text-align: center;">Discrepancies</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                lot.items.forEach(item => {
                    const eval1 = item.evaluations.evaluator.status;
                    const eval2 = item.evaluations.evaluator2?.status || 'pass';
                    const hasDiscrepancy = eval1 !== eval2;
                    
                    html += `
                                    <tr style="${hasDiscrepancy ? 'background: var(--warning-50);' : ''}">
                                        <td>
                                            <div style="font-size: 10px; color: var(--primary-400); font-weight: 600;">${item.unspsc}</div>
                                            <div style="font-size: 12px; color: var(--text-primary);">${item.description.substring(0, 35)}...</div>
                                        </td>
                                        <td style="text-align: center;">
                                            <span class="eval-status-badge ${eval1}" style="font-size: 10px;">${formatEvalStatus(eval1)}</span>
                                        </td>
                                        <td style="text-align: center;">
                                            <span class="eval-status-badge ${eval2}" style="font-size: 10px;">${formatEvalStatus(eval2)}</span>
                                        </td>
                                        <td style="text-align: center;">
                                            <span class="eval-status-badge pass" style="font-size: 10px;"> Pass</span>
                                        </td>
                                        <td style="text-align: center;">
                                            ${hasDiscrepancy ? '<span style="color: var(--warning-500); font-size: 12px;"> Review</span>' : '<span style="color: var(--success-500); font-size: 11px;"> Aligned</span>'}
                                        </td>
                                    </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            // Stage Summary
            html += `
                <div style="background: white; border-radius: var(--radius-lg); border: 1px solid var(--surface-200); overflow: hidden;">
                    <div style="background: var(--surface-50); padding: var(--spacing-md) var(--spacing-lg); border-bottom: 1px solid var(--surface-200);">
                        <div style="font-weight: 600; font-size: 15px;"> Evaluation Stages Summary</div>
                    </div>
                    <div style="padding: var(--spacing-lg);">
                        <table class="eval-table" style="margin: 0;">
                            <thead>
                                <tr>
                                    <th>Stage</th>
                                    <th style="text-align: center;">MedSupply Ltd.</th>
                                    <th style="text-align: center;">HealthCare Corp.</th>
                                    <th style="text-align: center;">MedTech Inc.</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="font-weight: 600;">1. Eligibility & Formal</td>
                                    <td style="text-align: center;"><span class="eval-status-badge pass"> Pass</span></td>
                                    <td style="text-align: center;"><span class="eval-status-badge pass"> Pass</span></td>
                                    <td style="text-align: center;"><span class="eval-status-badge pass"> Pass</span></td>
                                </tr>
                                <tr>
                                    <td style="font-weight: 600;">2. Qualification</td>
                                    <td style="text-align: center;"><span class="eval-status-badge pass"> Pass</span></td>
                                    <td style="text-align: center;"><span class="eval-status-badge pass"> Pass</span></td>
                                    <td style="text-align: center;"><span class="eval-status-badge pass"> Pass</span></td>
                                </tr>
                                <tr>
                                    <td style="font-weight: 600;">3. Technical</td>
                                    <td style="text-align: center;"><span class="eval-status-badge pass"> 5/6</span></td>
                                    <td style="text-align: center;"><span class="eval-status-badge clarification"> 4/6</span></td>
                                    <td style="text-align: center;"><span class="eval-status-badge pass"> 5/6</span></td>
                                </tr>
                                <tr>
                                    <td style="font-weight: 600;">4. Financial</td>
                                    <td style="text-align: center;"><span style="color: var(--text-muted);">Pending</span></td>
                                    <td style="text-align: center;"><span style="color: var(--text-muted);">Pending</span></td>
                                    <td style="text-align: center;"><span style="color: var(--text-muted);">Pending</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        function renderTechnicalPOView(stepData) {
            const vendorNames = {
                'vendor1': 'MedSupply Ltd.',
                'vendor2': 'HealthCare Corp.',
                'vendor3': 'MedTech Inc.'
            };
            
            let html = `
                <!-- Navigation Bar -->
                <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                    <div style="display: flex; gap: var(--spacing-lg); align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <span style="font-size: 12px; color: var(--text-muted);">Jump to Lot:</span>
                            ${stepData.lots.map((lot, i) => `
                                <button class="btn btn-secondary btn-sm" onclick="document.getElementById('po-lot-${lot.id}').scrollIntoView({behavior: 'smooth'})" style="font-size: 11px;">
                                     ${lot.name.split(':')[0]}
                                </button>
                            `).join('')}
                        </div>
                        <div style="margin-left: auto;">
                            <button class="btn btn-primary btn-sm" onclick="showToast(' Exporting evaluation summary...')">
                                 Export Summary
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            stepData.lots.forEach((lot, lotIndex) => {
                html += `
                    <div id="po-lot-${lot.id}" style="margin-bottom: var(--spacing-xl);">
                        <div style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-400) 100%); color: white; padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-md) var(--radius-md) 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 16px; font-weight: 600;"> ${lot.name}</div>
                                <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">${lot.items.length} UNSPSC Codes</div>
                            </div>
                        </div>
                        
                        <div style="border: 1px solid var(--surface-200); border-top: none; border-radius: 0 0 var(--radius-md) var(--radius-md); overflow: hidden;">
                            <table class="eval-table" style="margin: 0;">
                                <thead>
                                    <tr>
                                        <th style="width: 100px;">UNSPSC</th>
                                        <th style="width: 200px;">Product</th>
                                        <th style="width: 100px;">Compliance</th>
                                        <th style="width: 100px;">Evaluator 1</th>
                                        <th style="width: 100px;">Evaluator 2</th>
                                        <th class="manual-eval-column" style="width: 100px;">PO Final</th>
                                        <th class="manual-eval-column" style="width: 180px;">PO Comments</th>
                                        <th class="manual-eval-column" style="width: 80px;">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                lot.items.forEach((item) => {
                    const eval1 = item.evaluations.evaluator;
                    const eval2 = item.evaluations.evaluator2 || { status: 'pass', comment: '' };
                    const po = item.evaluations.po;
                    const hasDiscrepancy = eval1.status !== eval2.status;
                    
                    html += `
                                    <tr style="${hasDiscrepancy ? 'background: var(--warning-50);' : ''}">
                                        <td>
                                            <span style="font-size: 11px; padding: 2px 6px; background: var(--primary-50); color: var(--primary-500); border-radius: var(--radius-xs); font-weight: 600;">
                                                ${item.unspsc}
                                            </span>
                                        </td>
                                        <td style="font-size: 12px;">
                                            ${item.description.substring(0, 40)}...
                                            <button class="btn btn-secondary btn-sm" onclick="showProductDetails('${item.id}')" style="font-size: 9px; padding: 2px 4px; margin-left: 4px;"></button>
                                        </td>
                                        <td>
                                            <span style="font-size: 11px; color: ${item.bidderCompliance === 'Yes' ? 'var(--success-500)' : item.bidderCompliance === 'No' ? 'var(--danger-500)' : 'var(--warning-500)'};">
                                                ${item.bidderCompliance === 'Yes' ? '' : item.bidderCompliance === 'No' ? '' : ''} ${item.bidderCompliance}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="eval-status-badge ${eval1.status}" style="font-size: 10px;">${formatEvalStatus(eval1.status)}</span>
                                        </td>
                                        <td>
                                            <span class="eval-status-badge ${eval2.status}" style="font-size: 10px;">${formatEvalStatus(eval2.status)}</span>
                                            ${hasDiscrepancy ? '<div style="font-size: 9px; color: var(--warning-500);"></div>' : ''}
                                        </td>
                                        <td class="manual-eval-column">
                                            <select class="eval-select ${po.status}" style="font-size: 11px; padding: 4px;">
                                                <option value="pending" ${po.status === 'pending' ? 'selected' : ''}> Pending</option>
                                                <option value="pass" ${po.status === 'pass' ? 'selected' : ''}> Pass</option>
                                                <option value="fail" ${po.status === 'fail' ? 'selected' : ''}> Fail</option>
                                            </select>
                                        </td>
                                        <td class="manual-eval-column">
                                            <textarea class="eval-comment-field" rows="1" style="font-size: 11px;">${po.comment}</textarea>
                                        </td>
                                        <td class="manual-eval-column" style="text-align: center;">
                                            <button class="btn btn-secondary btn-sm" onclick="startPrivateClarification('${item.id}')" title="Private Clarification" style="font-size: 9px; padding: 4px 6px;">
                                                
                                            </button>
                                        </td>
                                    </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            return html;
        }
        
        function renderEvaluatorView(container, stepData) {
            let html = '';
            
            // For Eligibility & Formal step 1, use special table format
            if (currentEvaluationStep === 1) {
                html += renderEligibilityTable(stepData);
                container.innerHTML = html;
                return;
            }
            
            // For Qualification step 2, use qualification table format
            if (currentEvaluationStep === 2) {
                html += renderQualificationTable(stepData);
                container.innerHTML = html;
                return;
            }
            
            // For technical step 3, group by UNSPSC similar to lot view
            if (currentEvaluationStep === 3 && stepData.lots) {
                html += renderTechnicalEvaluationUI(stepData);
                container.innerHTML = html;
                return;
            }
            
            // For financial step 4, use lot-based structure like technical evaluation
            if (currentEvaluationStep === 4 && stepData.lots) {
                // Calculate lot totals and status for current vendor
                const lotTotals = {};
                const lotStatuses = {};
                stepData.lots.forEach(lot => {
                    let total = 0;
                    let passCount = 0;
                    let failCount = 0;
                    let clarificationCount = 0;
                    let notEvalCount = 0;
                    
                    lot.items.forEach(item => {
                        const priceData = item.prices[currentVendorEval];
                        if (priceData && priceData.finalPrice) {
                            const price = parseFloat(priceData.finalPrice.replace(/[^0-9.-]/g, ''));
                            total += price;
                        }
                        // Count statuses
                        const status = priceData?.evalStatus || 'not_evaluated';
                        if (status === 'pass') passCount++;
                        else if (status === 'fail') failCount++;
                        else if (status === 'clarification') clarificationCount++;
                        else notEvalCount++;
                    });
                    lotTotals[lot.id] = total;
                    
                    // Determine lot status
                    if (failCount > 0) lotStatuses[lot.id] = 'fail';
                    else if (clarificationCount > 0) lotStatuses[lot.id] = 'clarification';
                    else if (notEvalCount > 0) lotStatuses[lot.id] = 'not_evaluated';
                    else lotStatuses[lot.id] = 'pass';
                });

                // Determine lot ranks
                const lotRanks = {};
                stepData.lots.forEach(lot => {
                    // Simulate ranks based on total (in real app, compare across all vendors)
                    const total = lotTotals[lot.id];
                    if (currentVendorEval === 'vendor2') lotRanks[lot.id] = '1 of 6';
                    else if (currentVendorEval === 'vendor1') lotRanks[lot.id] = '2 of 6';
                    else lotRanks[lot.id] = '3 of 6';
                });

                // Calculate overall progress
                let totalItems = 0;
                let evaluatedItems = 0;
                stepData.lots.forEach(lot => {
                    lot.items.forEach(item => {
                        totalItems++;
                        const priceData = item.prices[currentVendorEval];
                        if (priceData?.evalStatus && priceData.evalStatus !== 'not_evaluated') {
                            evaluatedItems++;
                        }
                    });
                });
                const progressPercent = totalItems > 0 ? Math.round((evaluatedItems / totalItems) * 100) : 0;

                // Lot navigation bar (like Technical)
                html += `
                    <div style="background: var(--surface-0); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg); border: 1px solid var(--surface-200);">
                        <div style="display: flex; gap: var(--spacing-lg); align-items: center; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                <span style="font-size: 12px; color: var(--text-muted);">Jump to Lot:</span>
                                ${stepData.lots.map((lot, i) => `
                                    <button class="btn btn-secondary btn-sm" onclick="document.getElementById('financial-lot-collapsible-${lot.id}').scrollIntoView({behavior: 'smooth'})" style="font-size: 11px;">
                                         ${lot.name.split(':')[0]}
                                    </button>
                                `).join('')}
                            </div>
                            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                <button class="btn btn-secondary btn-sm" onclick="expandAllFinancialLots()" style="font-size: 11px;">
                                     Expand All
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="collapseAllFinancialLots()" style="font-size: 11px;">
                                     Collapse All
                                </button>
                            </div>
                            <div style="margin-left: auto; display: flex; gap: var(--spacing-sm); align-items: center;">
                                <span style="font-size: 11px; color: var(--text-muted);">Progress:</span>
                                <div style="width: 120px; height: 8px; background: var(--surface-200); border-radius: 4px; overflow: hidden;">
                                    <div style="width: ${progressPercent}%; height: 100%; background: ${progressPercent === 100 ? 'var(--success-500)' : 'var(--primary-400)'}; transition: width 0.3s;"></div>
                                </div>
                                <span style="font-size: 11px; font-weight: 600; color: ${progressPercent === 100 ? 'var(--success-600)' : 'var(--primary-500)'};">${progressPercent}%</span>
                            </div>
                        </div>
                    </div>
                `;
                
                stepData.lots.forEach((lot, lotIndex) => {
                    const lotTotal = lotTotals[lot.id] || 0;
                    const lotRank = lotRanks[lot.id] || '-';
                    const lotStatus = lotStatuses[lot.id] || 'not_evaluated';
                    const lotStatusColor = lotStatus === 'pass' ? 'var(--success-400)' : 
                                          lotStatus === 'fail' ? 'var(--danger-400)' : 
                                          lotStatus === 'clarification' ? 'var(--warning-400)' : 'var(--surface-300)';
                    const isFirstLot = lotIndex === 0;
                    
                    html += `
                        <div id="financial-lot-collapsible-${lot.id}" class="financial-lot-collapsible" style="margin-bottom: var(--spacing-lg); border: 1px solid var(--surface-200); border-radius: var(--radius-lg); overflow: hidden;">
                            <!-- Lot Header with Summary -->
                            <div class="financial-lot-header" onclick="toggleFinancialLot('financial-lot-${lot.id}')" style="background: linear-gradient(135deg, var(--primary-50) 0%, var(--info-50) 100%); padding: var(--spacing-lg); cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                    <span id="financial-lot-${lot.id}-icon" style="font-size: 14px; color: var(--text-muted); transition: transform 0.2s ease;">${isFirstLot ? '' : ''}</span>
                                    <div style="width: 4px; height: 55px; background: ${lotStatusColor}; border-radius: 2px;"></div>
                                    <div>
                                        <div style="font-weight: 700; font-size: 15px; color: var(--text-primary);"> ${lot.name}</div>
                                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px;">${lot.items.length} UNSPSC Products</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: var(--spacing-lg); align-items: center;">
                                    <!-- Lot Status -->
                                    <div style="text-align: center; padding: 8px 16px; background: white; border-radius: var(--radius-md); border: 1px solid ${lotStatusColor};">
                                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase;">Lot Status</div>
                                        <div style="font-size: 14px; font-weight: 600; color: ${lotStatusColor};">${formatEvalStatus(lotStatus)}</div>
                                    </div>
                                    <!-- Lot Total Price -->
                                    <div style="text-align: right; padding: 8px 16px; background: white; border-radius: var(--radius-md); border: 1px solid var(--surface-200);">
                                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase;">Lot Total</div>
                                        <div style="font-size: 18px; font-weight: 700; color: var(--success-600);">$${lotTotal.toLocaleString()}</div>
                                    </div>
                                    <!-- Lot Rank -->
                                    <div style="text-align: center; padding: 8px 16px; background: ${lotRank.startsWith('1') ? 'var(--success-100)' : 'var(--surface-100)'}; border-radius: var(--radius-md); border: 1px solid ${lotRank.startsWith('1') ? 'var(--success-300)' : 'var(--surface-200)'};">
                                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase;">Rank</div>
                                        <div style="font-size: 16px; font-weight: 700; color: ${lotRank.startsWith('1') ? 'var(--success-600)' : 'var(--text-primary)'};">${lotRank}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Lot Content - Single Table for All Items -->
                            <div id="financial-lot-${lot.id}" class="financial-lot-content" style="${isFirstLot ? '' : 'display: none;'}">
                                <div style="padding: var(--spacing-lg); background: var(--surface-50);">
                                    <table class="eval-table" style="margin-bottom: 0;">
                                        <thead>
                                            <tr style="background: var(--surface-100);">
                                                <th style="min-width: 250px; text-align: left;">Product (UNSPSC / Description / Qty)</th>
                                                <th style="width: 90px;">Unit Price</th>
                                                <th style="width: 110px;">Total (Currency)</th>
                                                <th style="width: 110px;">Total (Incoterm)</th>
                                                <th style="width: 65px;">Rank</th>
                                                <th style="width: 90px;">Corrections</th>
                                                <th style="width: 90px;">Negotiations</th>
                                                <th style="width: 100px;">Final Price</th>
                                                <th style="width: 90px;">Your Eval</th>
                                                <th style="min-width: 150px;">Comments</th>
                                                <th style="width: 80px;">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                    `;
                    
                    lot.items.forEach((item, itemIndex) => {
                        const priceData = item.prices[currentVendorEval];
                        const isEvenRow = itemIndex % 2 === 0;
                        const itemStatus = priceData?.evalStatus || 'not_evaluated';
                        
                        html += `
                                            <tr style="background: ${isEvenRow ? 'white' : 'var(--surface-50)'}; border-bottom: 1px solid var(--surface-100);">
                                                <td style="padding: 12px;">
                                                    <div style="display: flex; flex-direction: column; gap: 4px;">
                                                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                                            <span style="font-size: 11px; padding: 2px 8px; background: var(--primary-100); color: var(--primary-600); border-radius: var(--radius-xs); font-weight: 600; font-family: monospace;">${item.unspsc}</span>
                                                            <span style="font-size: 10px; color: var(--text-muted); background: var(--surface-100); padding: 2px 6px; border-radius: var(--radius-xs);">Qty: ${item.quantity}</span>
                                                        </div>
                                                        <div style="font-size: 12px; font-weight: 500; color: var(--text-primary); line-height: 1.3;">${item.description}</div>
                                                    </div>
                                                </td>
                                                <td style="font-weight: 600; font-size: 11px; color: var(--text-primary); text-align: center;">${priceData.unitPrice}</td>
                                                <td style="font-weight: 600; font-size: 11px; color: var(--text-primary); text-align: center;">${priceData.totalCurrency}</td>
                                                <td style="font-size: 10px; color: var(--text-secondary); text-align: center;">${priceData.totalIncoterm}</td>
                                                <td style="text-align: center;">
                                                    <span style="padding: 2px 6px; border-radius: var(--radius-sm); font-size: 9px; font-weight: 700; background: ${priceData.rank.startsWith('1') ? 'var(--success-100)' : 'var(--surface-100)'}; color: ${priceData.rank.startsWith('1') ? 'var(--success-600)' : 'var(--text-primary)'};">
                                                        ${priceData.rank}
                                                    </span>
                                                </td>
                                                <td>
                                                    <input type="text" value="${priceData.corrections}" style="width: 100%; padding: 4px 5px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 10px; color: var(--danger-500); font-weight: 600; text-align: center;" placeholder="$0">
                                                </td>
                                                <td>
                                                    <input type="text" value="${priceData.negotiations}" style="width: 100%; padding: 4px 5px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 10px; color: var(--success-600); font-weight: 600; text-align: center;" placeholder="$0">
                                                </td>
                                                <td>
                                                    <input type="text" value="${priceData.finalPrice}" style="width: 100%; padding: 4px 5px; border: 1px solid var(--primary-300); border-radius: var(--radius-sm); font-size: 11px; font-weight: 700; color: var(--primary-600); background: var(--primary-50); text-align: center;">
                                                </td>
                                                <td style="text-align: center;">
                                                    <select class="eval-select ${itemStatus}" style="font-size: 10px; padding: 4px;" onchange="updateFinancialItemEval('${lot.id}', '${item.id}', this.value)">
                                                        <option value="not_evaluated" ${itemStatus === 'not_evaluated' ? 'selected' : ''}> Not Eval</option>
                                                        <option value="pass" ${itemStatus === 'pass' ? 'selected' : ''}> Pass</option>
                                                        <option value="fail" ${itemStatus === 'fail' ? 'selected' : ''}> Fail</option>
                                                        <option value="clarification" ${itemStatus === 'clarification' ? 'selected' : ''}> Clarify</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <textarea class="eval-comment-field" placeholder="Comments..." rows="2" style="font-size: 9px; padding: 4px;">${priceData.comment || ''}</textarea>
                                                </td>
                                                <td style="text-align: center;">
                                                    <div style="display: flex; flex-direction: column; gap: 2px;">
                                                        <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); startPrivateClarification('${item.id}')" title="Clarify with Supplier" style="font-size: 8px; padding: 2px 4px;">
                                                             Supplier
                                                        </button>
                                                        <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); askEvalTeamQuestion('${item.id}')" title="Ask Team" style="font-size: 8px; padding: 2px 4px;">
                                                             Team
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                        `;
                    });
                    
                    html += `
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                // Add overall evaluation remarks
                html += `
                    <div style="margin-top: var(--spacing-xl); padding: var(--spacing-lg); background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-md);">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--text-primary); font-size: 16px;"> Overall Evaluation Stage Remarks</h3>
                        <div style="display: grid; gap: var(--spacing-lg);">
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Justification of Reasonableness of Price</label>
                                <textarea class="eval-comment-field" rows="3" placeholder="Provide justification for price reasonableness..."></textarea>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Negotiations Summary</label>
                                <textarea class="eval-comment-field" rows="3" placeholder="Document negotiations details..."></textarea>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Complaints and Representations</label>
                                <textarea class="eval-comment-field" rows="2" placeholder="Record any complaints or representations..."></textarea>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Indications of Proscribed Practices</label>
                                <textarea class="eval-comment-field" rows="2" placeholder="Note any proscribed practices observed..."></textarea>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Background Checks</label>
                                <textarea class="eval-comment-field" rows="2" placeholder="Summary of background check results..."></textarea>
                            </div>
                        </div>
                    </div>
                `;
                
                container.innerHTML = html;
                return;
            }
            
            // For other steps, use the traditional table format
            let headers = `
                <th style="width: 80px;">Req ID</th>
                <th>Requirement</th>
                <th style="width: 120px;">Type</th>
            `;
            
            headers += `<th>Bidder Response</th>`;
            
            headers += `
                <th style="width: 180px;">Supplier Documents</th>
                <th class="system-eval-column" style="width: 100px;">System</th>
                <th class="manual-eval-column" style="width: 120px;">Your Eval</th>
                <th class="manual-eval-column" style="width: 250px;">Comments</th>
                <th class="manual-eval-column" style="width: 80px;">Action</th>
            `;
            
            let rows = '';
            stepData.requirements.forEach(req => {
                const currentEval = req.evaluations.evaluator || req.evaluations.po;
                
                let row = `
                    <tr>
                        <td><div class="req-id-badge">${req.id}</div></td>
                        <td>
                            ${req.description}
                            <div class="${req.mandatory ? 'mandatory-flag' : 'optional-flag'}">
                                ${req.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                            </div>
                        </td>
                        <td style="font-size: 12px;">${req.type}</td>
                        <td>
                            ${req.bidderResponse}
                            ${req.deviation ? `<div class="deviation-badge"><strong> Deviation:</strong> ${req.deviation}</div>` : ''}
                        </td>
                    <td>${renderSupplierDocs(req.supplierDocs || [])}</td>
                    <td class="system-eval-column">
                        ${req.systemEval ? `<span class="eval-status-badge ${req.systemEval}">${req.systemEval === 'pass' ? ' Pass' : ' Fail'}</span>` : '-'}
                    </td>
                    <td class="manual-eval-column">
                        <select class="eval-select ${currentEval.status}">
                            <option value="not_evaluated" ${currentEval.status === 'not_evaluated' ? 'selected' : ''}> Not Evaluated</option>
                            <option value="pass" ${currentEval.status === 'pass' ? 'selected' : ''}> Pass</option>
                            <option value="fail" ${currentEval.status === 'fail' ? 'selected' : ''}> Fail</option>
                            <option value="clarification" ${currentEval.status === 'clarification' ? 'selected' : ''}> Clarification</option>
                        </select>
                    </td>
                    <td class="manual-eval-column">
                        <textarea class="eval-comment-field" placeholder="Enter your comments...">${currentEval.comment}</textarea>
                    </td>
                    <td class="manual-eval-column" style="text-align: center;">
                        <button class="btn btn-secondary" onclick="requestEvalClarification('${req.id}')" title="Request Clarification">
                            
                        </button>
                    </td>
                </tr>
                `;
                
                rows += row;
            });
            
            html += `
                <table class="eval-table">
                    <thead>
                        <tr>${headers}</tr>
                    </thead>
                    <tbody>${rows}</tbody>
                </table>
            `;
            
            container.innerHTML = html;
        }

        function renderFinancialLotView(container, stepData) {
            let html = '';
            
            // Get all vendor data for comparison
            const vendorData = {
                'vendor1': { name: 'MedSupply Ltd.', ungm: '309663', country: 'Germany' },
                'vendor2': { name: 'HealthCare Corp.', ungm: '301245', country: 'USA' },
                'vendor3': { name: 'MedTech Inc.', ungm: '315789', country: 'Japan' }
            };
            
            // Find the selected lot
            const selectedLot = stepData.lots.find(lot => lot.id === currentLotId);
            
            if (!selectedLot) {
                container.innerHTML = '<p>Lot not found.</p>';
                return;
            }
            
            // Navigation bar with expand/collapse
            html += `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); border: 1px solid var(--surface-200);">
                    <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                        <button class="btn btn-secondary btn-sm" onclick="expandAllFinancialLotViewUnspsc()" style="font-size: 11px;">
                             Expand All
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="collapseAllFinancialLotViewUnspsc()" style="font-size: 11px;">
                             Collapse All
                        </button>
                        <span style="color: var(--text-muted); font-size: 12px;">${selectedLot.items.length} UNSPSC Products</span>
                    </div>
                </div>
            `;
            
            // Group by UNSPSC code and render collapsible table for each
            selectedLot.items.forEach((item, itemIndex) => {
                const isFirstItem = itemIndex === 0;
                
                html += `
                    <div class="unspsc-collapsible financial-lot-view-unspsc" style="margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); border-radius: var(--radius-md); overflow: hidden;">
                        <div class="unspsc-header" onclick="toggleUnspsc('financial-lotview-unspsc-${item.id}')" style="padding: var(--spacing-md); background: var(--surface-50); cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                <span id="financial-lotview-unspsc-${item.id}-icon" style="font-size: 12px; color: var(--text-muted);">${isFirstItem ? '' : ''}</span>
                                <div>
                                    <span style="font-size: 11px; padding: 2px 8px; background: var(--primary-100); color: var(--primary-600); border-radius: var(--radius-xs); font-weight: 600; font-family: monospace;">${item.unspsc}</span>
                                    <span style="font-weight: 600; color: var(--text-primary); margin-left: var(--spacing-sm); font-size: 13px;">${item.description}</span>
                                    <span style="font-size: 11px; color: var(--text-muted); margin-left: var(--spacing-sm);">Qty: ${item.quantity}</span>
                                </div>
                            </div>
                        </div>
                        <div id="financial-lotview-unspsc-${item.id}" class="unspsc-content" style="${isFirstItem ? '' : 'display: none;'}">
                            <div style="padding: var(--spacing-md); background: white;">
                                <table class="eval-table" style="margin-bottom: 0; font-size: 12px;">
                                    <thead>
                                        <tr style="background: var(--surface-100);">
                                            <th style="width: 120px;">Supplier</th>
                                            <th style="width: 80px;">Unit Price</th>
                                            <th style="width: 100px;">Total (Currency)</th>
                                            <th style="width: 100px;">Total (Incoterm)</th>
                                            <th style="width: 60px;">Rank</th>
                                            <th style="width: 80px;">Corrections</th>
                                            <th style="width: 80px;">Negotiations</th>
                                            <th style="width: 90px;">Final Price</th>
                                            <th style="width: 80px;">Your Eval</th>
                                            <th style="min-width: 130px;">Comments</th>
                                            <th style="width: 70px;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${renderFinancialLotViewSupplierRows(item, vendorData)}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // Add overall evaluation remarks
            html += `
                <div style="margin-top: var(--spacing-xl); padding: var(--spacing-lg); background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-md);">
                    <h3 style="margin-bottom: var(--spacing-lg); color: var(--text-primary); font-size: 16px;">Overall Evaluation Stage Remarks</h3>
                    <div style="display: grid; gap: var(--spacing-lg);">
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Justification of Reasonableness of Price</label>
                            <textarea class="eval-comment-field" rows="3" placeholder="Provide justification for price reasonableness..."></textarea>
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Negotiations</label>
                            <textarea class="eval-comment-field" rows="3" placeholder="Document negotiations details..."></textarea>
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Complaints and Representations</label>
                            <textarea class="eval-comment-field" rows="2" placeholder="Record any complaints or representations..."></textarea>
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Indications of Proscribed Practices</label>
                            <textarea class="eval-comment-field" rows="2" placeholder="Note any proscribed practices observed..."></textarea>
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Background Checks</label>
                            <textarea class="eval-comment-field" rows="2" placeholder="Summary of background check results..."></textarea>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // Render supplier rows for Financial Lot View table
        function renderFinancialLotViewSupplierRows(item, vendorData) {
            const vendors = ['vendor1', 'vendor2', 'vendor3'];
            let html = '';
            
            vendors.forEach((vendorId, idx) => {
                const vendor = vendorData[vendorId];
                const priceData = item.prices[vendorId] || {};
                const evalStatus = priceData.evalStatus || 'not_evaluated';
                const evalComment = priceData.comment || '';
                const isEvenRow = idx % 2 === 0;
                const isCurrentVendor = vendorId === currentVendorEval;
                
                html += `
                    <tr style="background: ${isCurrentVendor ? 'var(--primary-50)' : isEvenRow ? 'white' : 'var(--surface-50)'}; border-bottom: 1px solid var(--surface-100); ${isCurrentVendor ? 'border-left: 3px solid var(--primary-400);' : ''}">
                        <td style="padding: 10px;">
                            <div style="font-weight: 600; font-size: 11px; color: var(--text-primary);">${vendor.name}</div>
                            <div style="font-size: 9px; color: var(--text-muted);">UNGM: ${vendor.ungm}</div>
                        </td>
                        <td style="font-weight: 600; font-size: 11px; text-align: center;">${priceData.unitPrice || '-'}</td>
                        <td style="font-weight: 600; font-size: 11px; text-align: center;">${priceData.totalCurrency || '-'}</td>
                        <td style="font-size: 10px; text-align: center;">${priceData.totalIncoterm || '-'}</td>
                        <td style="text-align: center;">
                            <span style="padding: 2px 6px; border-radius: var(--radius-sm); font-size: 9px; font-weight: 700; background: ${priceData.rank && priceData.rank.startsWith('1') ? 'var(--success-100)' : 'var(--surface-100)'}; color: ${priceData.rank && priceData.rank.startsWith('1') ? 'var(--success-600)' : 'var(--text-primary)'};">
                                ${priceData.rank || '-'}
                            </span>
                        </td>
                        <td>
                            <input type="text" value="${priceData.corrections || '$0'}" style="width: 100%; padding: 4px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 10px; color: var(--danger-500); font-weight: 600; text-align: center;">
                        </td>
                        <td>
                            <input type="text" value="${priceData.negotiations || '$0'}" style="width: 100%; padding: 4px; border: 1px solid var(--surface-300); border-radius: var(--radius-sm); font-size: 10px; color: var(--success-600); font-weight: 600; text-align: center;">
                        </td>
                        <td>
                            <input type="text" value="${priceData.finalPrice || '-'}" style="width: 100%; padding: 4px; border: 1px solid var(--primary-300); border-radius: var(--radius-sm); font-size: 11px; font-weight: 700; color: var(--primary-600); background: var(--primary-50); text-align: center;">
                        </td>
                        <td style="text-align: center;">
                            <select class="eval-select ${evalStatus}" style="font-size: 10px; padding: 3px;" onchange="updateFinancialLotViewEval('${item.id}', '${vendorId}', this.value)">
                                <option value="not_evaluated" ${evalStatus === 'not_evaluated' ? 'selected' : ''}> Not Eval</option>
                                <option value="pass" ${evalStatus === 'pass' ? 'selected' : ''}> Pass</option>
                                <option value="fail" ${evalStatus === 'fail' ? 'selected' : ''}> Fail</option>
                                <option value="clarification" ${evalStatus === 'clarification' ? 'selected' : ''}> Clarify</option>
                            </select>
                        </td>
                        <td>
                            <textarea class="eval-comment-field" placeholder="Comments..." rows="2" style="font-size: 9px; padding: 4px; width: 100%;">${evalComment}</textarea>
                        </td>
                        <td style="text-align: center;">
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); startPrivateClarification('${item.id}-${vendorId}')" title="Clarify with Supplier" style="font-size: 8px; padding: 2px 4px;">
                                    
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); askEvalTeamQuestion('${item.id}')" title="Ask Team" style="font-size: 8px; padding: 2px 4px;">
                                    
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            return html;
        }
        
        // Expand/Collapse all UNSPSC items in Financial Lot View
        function expandAllFinancialLotViewUnspsc() {
            document.querySelectorAll('.financial-lot-view-unspsc .unspsc-content').forEach(content => {
                content.style.display = 'block';
            });
            document.querySelectorAll('.financial-lot-view-unspsc [id$="-icon"]').forEach(icon => {
                icon.textContent = '';
            });
            showToast(' All products expanded');
        }
        
        function collapseAllFinancialLotViewUnspsc() {
            document.querySelectorAll('.financial-lot-view-unspsc .unspsc-content').forEach(content => {
                content.style.display = 'none';
            });
            document.querySelectorAll('.financial-lot-view-unspsc [id$="-icon"]').forEach(icon => {
                icon.textContent = '';
            });
            showToast(' All products collapsed');
        }
        
        // Update evaluation for Financial Lot View
        function updateFinancialLotViewEval(itemId, vendorId, newStatus) {
            showToast('Evaluation updated: ' + formatEvalStatus(newStatus));
        }
        
        function renderFinancialUnspscComparison(item, vendorData) {
            let html = `
                <div style="margin-top: var(--spacing-md);">
                    <div style="background: var(--info-50); padding: var(--spacing-sm); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm); font-size: 12px;">
                        <strong>Required Quantity:</strong> ${item.quantity}
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="eval-table" style="margin-bottom: 0;">
                            <thead>
                                <tr>
                                    <th style="width: 150px;">Supplier</th>
                                    <th style="width: 100px;">Unit Price</th>
                                    <th style="width: 120px;">Total (Currency)</th>
                                    <th style="width: 120px;">Total (Incoterm)</th>
                                    <th style="width: 100px;">Corrections</th>
                                    <th style="width: 100px;">Negotiations</th>
                                    <th style="width: 120px;">Final Price</th>
                                    <th style="width: 80px;">Rank</th>
                                    <th style="width: 180px;">Documents</th>
                                    <th class="manual-eval-column" style="width: 250px;">Comments</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            Object.keys(vendorData).forEach((vendorKey, index) => {
                const vendor = vendorData[vendorKey];
                const priceData = item.prices[vendorKey];
                const docs = item.supplierDocs[vendorKey];
                
                html += `
                    <tr>
                        <td>
                            <div style="font-weight: 700; color: var(--primary-600); font-size: 13px; margin-bottom: 2px;">
                                ${vendor.name}
                            </div>
                            <div style="font-size: 11px; color: var(--text-muted);">
                                UNGM: ${vendor.ungm}
                            </div>
                            <div style="font-size: 11px; color: var(--text-muted);">
                                ${vendor.country}
                            </div>
                        </td>
                        <td style="font-weight: 600; font-size: 13px;">${priceData.unitPrice}</td>
                        <td style="font-weight: 600; font-size: 13px;">${priceData.totalCurrency}</td>
                        <td style="font-weight: 600;">${priceData.totalIncoterm}</td>
                        <td style="color: var(--danger-500); font-weight: 600;">${priceData.corrections}</td>
                        <td style="color: var(--success-500); font-weight: 600;">${priceData.negotiations}</td>
                        <td style="font-weight: 700; font-size: 14px; color: var(--primary-600);">${priceData.finalPrice}</td>
                        <td><span class="eval-status-badge ${priceData.rank.includes('1') ? 'pass' : 'pending'}">${priceData.rank}</span></td>
                        <td>${renderSupplierDocs(docs)}</td>
                        <td class="manual-eval-column">
                            <textarea class="eval-comment-field" placeholder="Enter your comments..." rows="2"></textarea>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        function renderLotView(container, stepData) {
            let html = '';
            
            // Get all vendor data for comparison
            const vendorData = {
                'vendor1': { name: 'MedSupply Ltd.', ungm: '309663', country: 'Germany' },
                'vendor2': { name: 'HealthCare Corp.', ungm: '301245', country: 'USA' },
                'vendor3': { name: 'MedTech Inc.', ungm: '315789', country: 'Japan' }
            };
            
            // Find the selected lot
            const selectedLot = stepData.lots.find(lot => lot.id === currentLotId);
            
            if (!selectedLot) {
                container.innerHTML = '<p>Lot not found.</p>';
                return;
            }
            
            // Navigation bar with expand/collapse
            html += `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); border: 1px solid var(--surface-200);">
                    <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                        <button class="btn btn-secondary btn-sm" onclick="expandAllLotViewUnspsc()" style="font-size: 11px;">
                             Expand All
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="collapseAllLotViewUnspsc()" style="font-size: 11px;">
                             Collapse All
                        </button>
                        <span style="color: var(--text-muted); font-size: 12px;">${selectedLot.items.length} UNSPSC Products</span>
                    </div>
                </div>
            `;
            
            // Group by UNSPSC code and render collapsible table for each
            selectedLot.items.forEach((item, itemIndex) => {
                const isFirstItem = itemIndex === 0;
                
                html += `
                    <div class="unspsc-collapsible lot-view-unspsc" style="margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); border-radius: var(--radius-md); overflow: hidden;">
                        <div class="unspsc-header" onclick="toggleUnspsc('lotview-unspsc-${item.id}')" style="padding: var(--spacing-md); background: var(--surface-50); cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                <span id="lotview-unspsc-${item.id}-icon" style="font-size: 12px; color: var(--text-muted);">${isFirstItem ? '' : ''}</span>
                                <div>
                                    <span style="font-size: 11px; padding: 2px 8px; background: var(--primary-100); color: var(--primary-600); border-radius: var(--radius-xs); font-weight: 600; font-family: monospace;">${item.unspsc}</span>
                                    <span style="font-weight: 600; color: var(--text-primary); margin-left: var(--spacing-sm); font-size: 13px;">${item.description}</span>
                                    <span style="font-size: 11px; color: var(--text-muted); margin-left: var(--spacing-sm);">Qty: ${item.quantity}</span>
                                </div>
                            </div>
                        </div>
                        <div id="lotview-unspsc-${item.id}" class="unspsc-content" style="${isFirstItem ? '' : 'display: none;'}">
                            <div style="padding: var(--spacing-md); background: white;">
                                <table class="eval-table" style="margin-bottom: 0; font-size: 12px;">
                                    <thead>
                                        <tr style="background: var(--surface-100);">
                                            <th style="width: 130px;">Supplier</th>
                                            <th style="width: 80px;">Compliant?</th>
                                            <th style="min-width: 200px;">Details Offered</th>
                                            <th style="width: 150px;">Deviation</th>
                                            <th style="width: 90px;">Your Eval</th>
                                            <th style="min-width: 150px;">Comments</th>
                                            <th style="width: 80px;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${renderLotViewSupplierRows(item, vendorData)}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Render supplier rows for Lot View table
        function renderLotViewSupplierRows(item, vendorData) {
            const vendors = ['vendor1', 'vendor2', 'vendor3'];
            let html = '';
            
            vendors.forEach((vendorId, idx) => {
                const vendor = vendorData[vendorId];
                const response = item.bidderResponse || item.response || {};
                const vendorResponse = Array.isArray(response) ? response[idx] : response;
                const compliance = item.compliance || 'Yes';
                const deviation = item.deviation || 'None';
                const evalStatus = item.evaluations?.[vendorId]?.status || item.evaluations?.evaluator?.status || 'not_evaluated';
                const evalComment = item.evaluations?.[vendorId]?.comment || item.evaluations?.evaluator?.comment || '';
                const isEvenRow = idx % 2 === 0;
                const isCurrentVendor = vendorId === currentVendorEval;
                
                html += `
                    <tr style="background: ${isCurrentVendor ? 'var(--primary-50)' : isEvenRow ? 'white' : 'var(--surface-50)'}; border-bottom: 1px solid var(--surface-100); ${isCurrentVendor ? 'border-left: 3px solid var(--primary-400);' : ''}">
                        <td style="padding: 10px;">
                            <div style="font-weight: 600; font-size: 11px; color: var(--text-primary);">${vendor.name}</div>
                            <div style="font-size: 9px; color: var(--text-muted);">UNGM: ${vendor.ungm}</div>
                        </td>
                        <td style="text-align: center;">
                            <span style="padding: 3px 8px; border-radius: var(--radius-sm); font-size: 10px; font-weight: 600; background: ${compliance === 'Yes' || compliance === 'Full' ? 'var(--success-100)' : compliance === 'Partial' ? 'var(--warning-100)' : 'var(--danger-100)'}; color: ${compliance === 'Yes' || compliance === 'Full' ? 'var(--success-600)' : compliance === 'Partial' ? 'var(--warning-600)' : 'var(--danger-600)'};">
                                ${compliance === 'Yes' || compliance === 'Full' ? ' Yes' : compliance === 'Partial' ? ' Partial' : ' No'}
                            </span>
                        </td>
                        <td style="padding: 10px;">
                            <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.4;">
                                ${typeof vendorResponse === 'string' ? vendorResponse.substring(0, 80) + (vendorResponse.length > 80 ? '...' : '') : 'Specifications provided'}
                            </div>
                            <div style="margin-top: 4px; display: flex; gap: 4px;">
                                <button class="btn btn-secondary btn-sm" onclick="showProductDetails('${item.id}')" style="font-size: 9px; padding: 2px 6px;"> View</button>
                                <button class="btn btn-secondary btn-sm" onclick="previewDocumentOnline('specs_${vendorId}.pdf')" style="font-size: 9px; padding: 2px 6px;"> 2</button>
                            </div>
                        </td>
                        <td style="padding: 10px; font-size: 11px; color: ${deviation === 'None' || deviation === 'No deviation' ? 'var(--success-600)' : 'var(--warning-600)'};">
                            ${deviation}
                        </td>
                        <td style="text-align: center;">
                            <select class="eval-select ${evalStatus}" style="font-size: 10px; padding: 3px;" onchange="updateLotViewEval('${item.id}', '${vendorId}', this.value)">
                                <option value="not_evaluated" ${evalStatus === 'not_evaluated' ? 'selected' : ''}> Not Eval</option>
                                <option value="pass" ${evalStatus === 'pass' ? 'selected' : ''}> Pass</option>
                                <option value="fail" ${evalStatus === 'fail' ? 'selected' : ''}> Fail</option>
                                <option value="clarification" ${evalStatus === 'clarification' ? 'selected' : ''}> Clarify</option>
                            </select>
                        </td>
                        <td>
                            <textarea class="eval-comment-field" placeholder="Comments..." rows="2" style="font-size: 10px; padding: 4px; width: 100%;">${evalComment}</textarea>
                        </td>
                        <td style="text-align: center;">
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); startPrivateClarification('${item.id}-${vendorId}')" title="Clarify with Supplier" style="font-size: 8px; padding: 2px 4px;">
                                    
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="event.stopPropagation(); askEvalTeamQuestion('${item.id}')" title="Ask Team" style="font-size: 8px; padding: 2px 4px;">
                                    
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            return html;
        }
        
        // Expand/Collapse all UNSPSC items in Lot View
        function expandAllLotViewUnspsc() {
            document.querySelectorAll('.lot-view-unspsc .unspsc-content').forEach(content => {
                content.style.display = 'block';
            });
            document.querySelectorAll('.lot-view-unspsc [id$="-icon"]').forEach(icon => {
                icon.textContent = '';
            });
            showToast(' All products expanded');
        }
        
        function collapseAllLotViewUnspsc() {
            document.querySelectorAll('.lot-view-unspsc .unspsc-content').forEach(content => {
                content.style.display = 'none';
            });
            document.querySelectorAll('.lot-view-unspsc [id$="-icon"]').forEach(icon => {
                icon.textContent = '';
            });
            showToast(' All products collapsed');
        }
        
        // Update evaluation for Lot View
        function updateLotViewEval(itemId, vendorId, newStatus) {
            // Update evaluation status in data
            showToast('Evaluation updated: ' + formatEvalStatus(newStatus));
        }
        
        function toggleUnspsc(id) {
            const content = document.getElementById(id);
            const icon = document.getElementById(id + '-icon');
            
            if (!content || !icon) return;
            
            // Handle both class-based and inline style toggling
            const isHidden = content.classList.contains('collapsed') || content.style.display === 'none';
            
            if (isHidden) {
                content.classList.remove('collapsed');
                content.style.display = 'block';
                icon.style.transform = 'rotate(90deg)';
                icon.textContent = '';
            } else {
                content.classList.add('collapsed');
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = '';
            }
        }
        
        function renderUnspscComparison(item, vendorData, showHeader = true) {
            let html = '';
            
            if (showHeader) {
                html += `
                    <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                        <div style="background: var(--surface-50); padding: var(--spacing-md); margin: calc(-1 * var(--spacing-lg)) calc(-1 * var(--spacing-lg)) var(--spacing-lg); border-radius: var(--radius-md) var(--radius-md) 0 0; border-bottom: 2px solid var(--surface-200);">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-sm);">
                                <div>
                                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 4px;">UNSPSC Code</div>
                                    <div style="font-size: 16px; font-weight: 700; color: var(--primary-400);">${item.unspsc}</div>
                                </div>
                                <div class="${item.mandatory ? 'mandatory-flag' : 'optional-flag'}" style="margin: 0;">
                                    ${item.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                                </div>
                            </div>
                            <div style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin-top: var(--spacing-sm);">${item.description}</div>
                            <div style="display: flex; gap: var(--spacing-xl); margin-top: var(--spacing-sm); font-size: 12px; color: var(--text-secondary);">
                                <span><strong>Required Qty:</strong> ${item.quantity}</span>
                                <span><strong>Specifications:</strong> ${item.specifications}</span>
                            </div>
                        </div>
                        
                        <!-- Supplier Comparison Table -->
                        <div style="overflow-x: auto;">
                `;
            } else {
                html += `
                    <div style="margin-top: var(--spacing-md);">
                        <div style="background: var(--info-50); padding: var(--spacing-sm); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm); font-size: 12px;">
                            <strong>Required Qty:</strong> ${item.quantity} | <strong>Specifications:</strong> ${item.specifications}
                        </div>
                        <div style="overflow-x: auto;">
                `;
            }
            
            html += `
                            <table class="eval-table" style="margin-bottom: 0;">
                                <thead>
                                    <tr>
                                        <th style="width: 150px;">Supplier</th>
                                        <th style="width: 100px;">Compliance</th>
                                        <th>Response / Specifications</th>
                                        <th style="width: 150px;">Deviation</th>
                                        <th style="width: 200px;">Documents</th>
                                        <th class="system-eval-column" style="width: 100px;">System</th>
                                        <th class="manual-eval-column" style="width: 130px;">Your Eval</th>
                                        <th class="manual-eval-column" style="width: 250px;">Comments</th>
                                        <th class="manual-eval-column" style="width: 80px;">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${renderSupplierComparisons(item, vendorData)}
                                </tbody>
                            </table>
                        </div>
            `;
            
            if (showHeader) {
                html += `</div>`;
            }
            html += `</div>`;
            
            return html;
        }
        
        function renderEligibilityPOTable(stepData) {
            let html = `
                <div style="margin-bottom: var(--spacing-lg);">
                    <div style="background: var(--primary-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-lg); border-left: 4px solid var(--primary-400);">
                        <strong>Procurement Official Review - Eligibility & Formal Criteria</strong>
                        <p style="margin: var(--spacing-xs) 0 0 0; font-size: 12px; color: var(--text-secondary);">
                            Review evaluator assessments and provide final determination. You can start private clarifications with suppliers from here.
                        </p>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table class="eval-table">
                            <thead>
                                <tr>
                                    <th style="width: 90px;">Criteria ID</th>
                                    <th style="width: 180px;">Criteria</th>
                                    <th style="width: 80px;">Type</th>
                                    <th style="width: 50px;">SP</th>
                                    <th style="min-width: 200px;">Assessment</th>
                                    <th class="system-eval-column" style="width: 80px;">System</th>
                                    <th style="width: 100px;">Evaluator</th>
                                    <th style="width: 150px;">Eval Comments</th>
                                    <th class="manual-eval-column" style="width: 100px;">PO Final</th>
                                    <th class="manual-eval-column" style="width: 150px;">PO Comments</th>
                                    <th class="manual-eval-column" style="width: 90px;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            stepData.requirements.forEach(req => {
                const evalStatus = req.evaluations.evaluator;
                const poStatus = req.evaluations.po;
                const hasFlag = req.spFlag || req.flagDetails;
                const hasDiscrepancy = evalStatus.status !== req.systemEval;
                
                html += `
                    <tr style="${hasFlag ? 'background: #fffef0;' : ''} ${hasDiscrepancy ? 'border-left: 3px solid var(--warning-400);' : ''}">
                        <td>
                            <div class="req-id-badge" style="${req.isCustom ? 'background: var(--primary-100); color: var(--primary-600);' : ''}">${req.id}</div>
                            ${req.isCustom ? '<div style="font-size: 8px; color: var(--primary-500); margin-top: 2px;">CUSTOM</div>' : ''}
                        </td>
                        <td>
                            <div style="font-weight: 600; font-size: 12px; margin-bottom: 2px;">${req.criteria}</div>
                        </td>
                        <td><span style="font-size: 10px; padding: 2px 6px; background: var(--surface-100); border-radius: var(--radius-xs);">${req.type}</span></td>
                        <td style="text-align: center;">${hasFlag ? '' : ''}</td>
                        <td style="font-size: 11px;">
                            ${req.assessment.substring(0, 100)}${req.assessment.length > 100 ? '...' : ''}
                            ${req.flagDetails ? `<div style="color: var(--warning-500); font-size: 10px; margin-top: 4px;"> Flag</div>` : ''}
                        </td>
                        <td class="system-eval-column">
                            <span class="eval-status-badge ${req.systemEval}">${req.systemEval === 'pass' ? '' : ''}</span>
                        </td>
                        <td>
                            <span class="eval-status-badge ${evalStatus.status}" style="font-size: 10px;">${formatEvalStatus(evalStatus.status)}</span>
                            ${hasDiscrepancy ? '<div style="font-size: 9px; color: var(--warning-500); margin-top: 2px;"> Differs</div>' : ''}
                        </td>
                        <td style="font-size: 11px;">${evalStatus.comment.substring(0, 50)}${evalStatus.comment.length > 50 ? '...' : ''}</td>
                        <td class="manual-eval-column">
                            <select class="eval-select ${poStatus.status}" style="font-size: 11px; padding: 4px;">
                                <option value="pending" ${poStatus.status === 'pending' ? 'selected' : ''}> Pending</option>
                                <option value="pass" ${poStatus.status === 'pass' ? 'selected' : ''}> Pass</option>
                                <option value="fail" ${poStatus.status === 'fail' ? 'selected' : ''}> Fail</option>
                            </select>
                        </td>
                        <td class="manual-eval-column">
                            <textarea class="eval-comment-field" rows="2" style="font-size: 11px;">${poStatus.comment}</textarea>
                        </td>
                        <td class="manual-eval-column" style="text-align: center;">
                            <div style="display: flex; flex-direction: column; gap: 3px;">
                                <button class="btn btn-secondary btn-sm" onclick="startPrivateClarification('${req.id}')" title="Clarify with Supplier" style="font-size: 9px; padding: 4px 6px;">
                                     Clarify
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="askEvalTeamQuestion('${req.id}')" title="Ask Team" style="font-size: 9px; padding: 4px 6px;">
                                     Team
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        function renderPOView(container, stepData) {
            // For Eligibility & Formal step 1, use special PO table format
            if (currentEvaluationStep === 1) {
                container.innerHTML = renderEligibilityPOTable(stepData);
                return;
            }
            
            // For Qualification step 2, use qualification PO table format
            if (currentEvaluationStep === 2) {
                container.innerHTML = renderQualificationPOTable(stepData);
                return;
            }
            
            // For Technical step 3 - replicate Evaluator View with PO additions
            if (currentEvaluationStep === 3 && stepData.lots) {
                // Check view mode - lot or supplier
                if (currentEvalView === 'lot') {
                    renderPOLotView(container, stepData);
                } else {
                    renderPOTechnicalSupplierView(container, stepData);
                }
                return;
            }
            
            // For Financial step 4 - replicate Evaluator View with PO additions
            if (currentEvaluationStep === 4 && stepData.lots) {
                // Check view mode - lot or supplier
                if (currentEvalView === 'lot') {
                    renderPOFinancialLotView(container, stepData);
                } else {
                    renderPOFinancialSupplierView(container, stepData);
                }
                return;
            }
            
            // Default fallback
            let headers = `
                <th style="width: 80px;">Req ID</th>
                <th>Requirement</th>
                <th class="system-eval-column" style="width: 100px;">System</th>
                <th style="width: 100px;">Evaluator</th>
                <th style="width: 180px;">Eval Comments</th>
                <th class="manual-eval-column" style="width: 100px;">PO Final</th>
                <th class="manual-eval-column" style="width: 180px;">PO Comments</th>
                <th class="manual-eval-column" style="width: 80px;">Action</th>
            `;
            
            let rows = '';
            stepData.requirements.forEach(req => {
                const e1 = req.evaluations.evaluator || req.evaluations.po;
                const po = req.evaluations.po;
                
                rows += `
                    <tr>
                        <td><div class="req-id-badge">${req.id}</div></td>
                        <td>${req.description}</td>
                        <td class="system-eval-column">
                            ${req.systemEval ? `<span class="eval-status-badge ${req.systemEval}">${req.systemEval === 'pass' ? '' : ''}</span>` : '-'}
                        </td>
                        <td><span class="eval-status-badge ${e1.status}">${formatEvalStatus(e1.status)}</span></td>
                        <td style="font-size: 11px; color: var(--text-muted);">${e1.comment}</td>
                        <td class="manual-eval-column">
                            <select class="eval-select ${po.status}" style="font-size: 10px;">
                                <option value="pending" ${po.status === 'pending' ? 'selected' : ''}> Pending</option>
                                <option value="pass" ${po.status === 'pass' ? 'selected' : ''}> Pass</option>
                                <option value="fail" ${po.status === 'fail' ? 'selected' : ''}> Fail</option>
                            </select>
                        </td>
                        <td class="manual-eval-column">
                            <textarea class="eval-comment-field" rows="2" style="font-size: 10px;">${po.comment}</textarea>
                        </td>
                        <td class="manual-eval-column" style="text-align: center;">
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <button class="btn btn-secondary btn-sm" onclick="startPrivateClarification('${req.id}')" title="Clarify with Supplier" style="font-size: 8px; padding: 2px 4px;"></button>
                                <button class="btn btn-secondary btn-sm" onclick="askEvalTeamQuestion('${req.id}')" title="Ask Team" style="font-size: 8px; padding: 2px 4px;"></button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            container.innerHTML = `
                <table class="eval-table">
                    <thead><tr>${headers}</tr></thead>
                    <tbody>${rows}</tbody>
                </table>
            `;
        }
        
        // PO Technical Supplier View - replicates Evaluator structure with PO additions
        function renderPOTechnicalSupplierView(container, stepData) {
            const vendorNames = {
                'vendor1': 'MedSupply Ltd.',
                'vendor2': 'HealthCare Corp.',
                'vendor3': 'MedTech Inc.'
            };
            
            // Calculate lot status
            function calculateLotStatusFromItems(items) {
                if (!items || items.length === 0) return 'not_evaluated';
                const statuses = items.map(item => item.evaluations?.evaluator?.status || 'not_evaluated');
                if (statuses.includes('fail')) return 'fail';
                if (statuses.includes('clarification')) return 'clarification';
                if (statuses.includes('not_evaluated')) return 'not_evaluated';
                return 'pass';
            }
            
            let html = `
                <!-- Navigation Bar -->
                <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                    <div style="display: flex; gap: var(--spacing-lg); align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <span style="font-size: 12px; color: var(--text-muted);">Jump to Lot:</span>
                            ${stepData.lots.map((lot, i) => `
                                <button class="btn btn-secondary btn-sm" onclick="document.getElementById('po-tech-lot-${lot.id}').scrollIntoView({behavior: 'smooth'})" style="font-size: 11px;">
                                     ${lot.name.split(':')[0]}
                                </button>
                            `).join('')}
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <button class="btn btn-secondary btn-sm" onclick="expandAllPOLots()" style="font-size: 11px;"> Expand All</button>
                            <button class="btn btn-secondary btn-sm" onclick="collapseAllPOLots()" style="font-size: 11px;"> Collapse All</button>
                        </div>
                        <div style="margin-left: auto; display: flex; gap: var(--spacing-sm); align-items: center;">
                            <span style="font-size: 11px; color: var(--text-muted);">Progress:</span>
                            <div style="background: var(--surface-200); border-radius: 10px; height: 8px; width: 150px; overflow: hidden;">
                                <div style="background: var(--success-400); height: 100%; width: 65%;"></div>
                            </div>
                            <span style="font-size: 11px; color: var(--success-500);">65%</span>
                        </div>
                    </div>
                </div>
            `;
            
            stepData.lots.forEach((lot, lotIndex) => {
                const lotStatus = calculateLotStatusFromItems(lot.items);
                const lotStatusColor = lotStatus === 'pass' ? 'var(--success-400)' : 
                                       lotStatus === 'fail' ? 'var(--danger-400)' : 
                                       lotStatus === 'clarification' ? 'var(--warning-400)' : 'var(--surface-300)';
                const isFirstLot = lotIndex === 0;
                
                html += `
                    <div id="po-tech-lot-${lot.id}" class="po-lot-collapsible" style="margin-bottom: var(--spacing-lg); border: 1px solid var(--surface-200); border-radius: var(--radius-lg); overflow: hidden;">
                        <div class="lot-header" style="background: linear-gradient(135deg, var(--primary-50) 0%, var(--info-50) 100%); padding: var(--spacing-lg); cursor: pointer;" onclick="togglePOLot('${lot.id}')">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                    <span id="po-lot-icon-${lot.id}" style="font-size: 14px; color: var(--text-muted);">${isFirstLot ? '' : ''}</span>
                                    <div style="width: 4px; height: 45px; background: ${lotStatusColor}; border-radius: 2px;"></div>
                                    <div>
                                        <div style="font-size: 15px; font-weight: 700; color: var(--text-primary);"> ${lot.name}</div>
                                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px;">${lot.items.length} UNSPSC Products</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="po-lot-content-${lot.id}" class="po-lot-content" style="${isFirstLot ? '' : 'display: none;'}">
                `;
                
                lot.items.forEach((item, itemIndex) => {
                    const evalStatus = item.evaluations?.evaluator?.status || 'not_evaluated';
                    const evalComment = item.evaluations?.evaluator?.comment || '';
                    const poStatus = item.evaluations?.po?.status || 'pending';
                    const poComment = item.evaluations?.po?.comment || '';
                    const isFirstItem = itemIndex === 0;
                    
                    html += `
                            <div class="po-unspsc-collapsible" style="border-bottom: 1px solid var(--surface-100);">
                                <div class="unspsc-header" onclick="togglePOUnspsc('po-unspsc-${item.id}')" style="padding: var(--spacing-md); background: white; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                        <span id="po-unspsc-${item.id}-icon" style="font-size: 12px; color: var(--text-muted);">${isFirstItem ? '' : ''}</span>
                                        <div>
                                            <span style="font-size: 11px; padding: 2px 8px; background: var(--primary-100); color: var(--primary-600); border-radius: var(--radius-xs); font-weight: 600; font-family: monospace;">${item.unspsc}</span>
                                            <span style="font-weight: 600; color: var(--text-primary); margin-left: var(--spacing-sm); font-size: 13px;">${item.description}</span>
                                            <span style="font-size: 11px; color: var(--text-muted); margin-left: var(--spacing-sm);">Qty: ${item.quantity}</span>
                                        </div>
                                    </div>
                                </div>
                                <div id="po-unspsc-${item.id}" class="unspsc-content" style="${isFirstItem ? '' : 'display: none;'}">
                                    <div style="padding: var(--spacing-md); background: var(--surface-50);">
                                        <table class="eval-table" style="margin-bottom: 0; font-size: 12px;">
                                            <thead>
                                                <tr style="background: var(--surface-100);">
                                                    <th style="width: 80px;">Compliant?</th>
                                                    <th style="min-width: 180px;">Details Offered</th>
                                                    <th style="width: 120px;">Deviation</th>
                                                    <th style="width: 90px;">Evaluator</th>
                                                    <th style="width: 150px;">Eval Comments</th>
                                                    <th style="width: 90px;">PO Final</th>
                                                    <th style="min-width: 130px;">PO Comments</th>
                                                    <th style="width: 70px;">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td style="text-align: center;">
                                                        <span style="padding: 3px 8px; border-radius: var(--radius-sm); font-size: 10px; font-weight: 600; background: ${item.bidderCompliance === 'Yes' ? 'var(--success-100)' : 'var(--warning-100)'}; color: ${item.bidderCompliance === 'Yes' ? 'var(--success-600)' : 'var(--warning-600)'};">
                                                            ${item.bidderCompliance === 'Yes' ? ' Yes' : ' ' + item.bidderCompliance}
                                                        </span>
                                                    </td>
                                                    <td style="padding: 10px;">
                                                        <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.4;">
                                                            ${item.bidderResponse ? item.bidderResponse.substring(0, 80) + '...' : 'Specifications provided'}
                                                        </div>
                                                        <div style="margin-top: 4px;">
                                                            <button class="btn btn-secondary btn-sm" onclick="showProductDetails('${item.id}')" style="font-size: 9px; padding: 2px 6px;"> View</button>
                                                            <button class="btn btn-secondary btn-sm" onclick="previewDocumentOnline('specs.pdf')" style="font-size: 9px; padding: 2px 6px;"> 2</button>
                                                        </div>
                                                    </td>
                                                    <td style="padding: 10px; font-size: 11px; color: ${item.deviation === 'None' ? 'var(--success-600)' : 'var(--warning-600)'};">
                                                        ${item.deviation || 'None'}
                                                    </td>
                                                    <td style="text-align: center;">
                                                        <span class="eval-status-badge ${evalStatus}" style="font-size: 10px;">${formatEvalStatus(evalStatus)}</span>
                                                    </td>
                                                    <td style="font-size: 10px; color: var(--text-muted); padding: 8px;">${evalComment || '-'}</td>
                                                    <td style="text-align: center;">
                                                        <select class="eval-select ${poStatus}" style="font-size: 10px; padding: 3px;">
                                                            <option value="pending" ${poStatus === 'pending' ? 'selected' : ''}> Pending</option>
                                                            <option value="pass" ${poStatus === 'pass' ? 'selected' : ''}> Pass</option>
                                                            <option value="fail" ${poStatus === 'fail' ? 'selected' : ''}> Fail</option>
                                                            <option value="clarification" ${poStatus === 'clarification' ? 'selected' : ''}> Clarify</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <textarea class="eval-comment-field" placeholder="PO Comments..." rows="2" style="font-size: 10px; padding: 4px; width: 100%;">${poComment}</textarea>
                                                    </td>
                                                    <td style="text-align: center;">
                                                        <div style="display: flex; flex-direction: column; gap: 2px;">
                                                            <button class="btn btn-secondary btn-sm" onclick="startPrivateClarification('${item.id}')" title="Clarify with Supplier" style="font-size: 8px; padding: 2px 4px;"></button>
                                                            <button class="btn btn-secondary btn-sm" onclick="askEvalTeamQuestion('${item.id}')" title="Ask Team" style="font-size: 8px; padding: 2px 4px;"></button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // PO Technical Lot View - shows all suppliers per UNSPSC
        function renderPOLotView(container, stepData) {
            const vendorData = {
                'vendor1': { name: 'MedSupply Ltd.', ungm: '309663', country: 'Germany' },
                'vendor2': { name: 'HealthCare Corp.', ungm: '301245', country: 'USA' },
                'vendor3': { name: 'MedTech Inc.', ungm: '315789', country: 'Japan' }
            };
            
            const selectedLot = stepData.lots.find(lot => lot.id === currentLotId);
            if (!selectedLot) {
                container.innerHTML = '<p>Lot not found.</p>';
                return;
            }
            
            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); border: 1px solid var(--surface-200);">
                    <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                        <button class="btn btn-secondary btn-sm" onclick="expandAllPOLotViewUnspsc()" style="font-size: 11px;"> Expand All</button>
                        <button class="btn btn-secondary btn-sm" onclick="collapseAllPOLotViewUnspsc()" style="font-size: 11px;"> Collapse All</button>
                        <span style="color: var(--text-muted); font-size: 12px;">${selectedLot.items.length} UNSPSC Products</span>
                    </div>
                </div>
            `;
            
            selectedLot.items.forEach((item, itemIndex) => {
                const isFirstItem = itemIndex === 0;
                
                html += `
                    <div class="po-lot-view-unspsc" style="margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); border-radius: var(--radius-md); overflow: hidden;">
                        <div class="unspsc-header" onclick="togglePOUnspsc('po-lotview-unspsc-${item.id}')" style="padding: var(--spacing-md); background: var(--surface-50); cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                <span id="po-lotview-unspsc-${item.id}-icon" style="font-size: 12px; color: var(--text-muted);">${isFirstItem ? '' : ''}</span>
                                <div>
                                    <span style="font-size: 11px; padding: 2px 8px; background: var(--primary-100); color: var(--primary-600); border-radius: var(--radius-xs); font-weight: 600; font-family: monospace;">${item.unspsc}</span>
                                    <span style="font-weight: 600; color: var(--text-primary); margin-left: var(--spacing-sm); font-size: 13px;">${item.description}</span>
                                    <span style="font-size: 11px; color: var(--text-muted); margin-left: var(--spacing-sm);">Qty: ${item.quantity}</span>
                                </div>
                            </div>
                        </div>
                        <div id="po-lotview-unspsc-${item.id}" class="unspsc-content" style="${isFirstItem ? '' : 'display: none;'}">
                            <div style="padding: var(--spacing-md); background: white;">
                                <table class="eval-table" style="margin-bottom: 0; font-size: 12px;">
                                    <thead>
                                        <tr style="background: var(--surface-100);">
                                            <th style="width: 120px;">Supplier</th>
                                            <th style="width: 80px;">Compliant?</th>
                                            <th style="min-width: 150px;">Details Offered</th>
                                            <th style="width: 100px;">Deviation</th>
                                            <th style="width: 80px;">Evaluator</th>
                                            <th style="width: 120px;">Eval Comments</th>
                                            <th style="width: 80px;">PO Final</th>
                                            <th style="min-width: 110px;">PO Comments</th>
                                            <th style="width: 70px;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${renderPOLotViewSupplierRows(item, vendorData)}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Render supplier rows for PO Lot View
        function renderPOLotViewSupplierRows(item, vendorData) {
            const vendors = ['vendor1', 'vendor2', 'vendor3'];
            let html = '';
            
            vendors.forEach((vendorId, idx) => {
                const vendor = vendorData[vendorId];
                const evalStatus = item.evaluations?.[vendorId]?.status || item.evaluations?.evaluator?.status || 'not_evaluated';
                const evalComment = item.evaluations?.[vendorId]?.comment || item.evaluations?.evaluator?.comment || '';
                const poStatus = item.evaluations?.po?.[vendorId]?.status || 'pending';
                const poComment = item.evaluations?.po?.[vendorId]?.comment || '';
                const isEvenRow = idx % 2 === 0;
                
                html += `
                    <tr style="background: ${isEvenRow ? 'white' : 'var(--surface-50)'}; border-bottom: 1px solid var(--surface-100);">
                        <td style="padding: 10px;">
                            <div style="font-weight: 600; font-size: 11px;">${vendor.name}</div>
                            <div style="font-size: 9px; color: var(--text-muted);">UNGM: ${vendor.ungm}</div>
                        </td>
                        <td style="text-align: center;">
                            <span style="padding: 3px 6px; border-radius: var(--radius-sm); font-size: 9px; font-weight: 600; background: var(--success-100); color: var(--success-600);"> Yes</span>
                        </td>
                        <td style="padding: 8px;">
                            <div style="font-size: 10px; color: var(--text-secondary);">Specs provided</div>
                            <button class="btn btn-secondary btn-sm" onclick="showProductDetails('${item.id}')" style="font-size: 8px; padding: 2px 4px; margin-top: 2px;"> View</button>
                        </td>
                        <td style="font-size: 10px; color: var(--success-600);">None</td>
                        <td style="text-align: center;">
                            <span class="eval-status-badge ${evalStatus}" style="font-size: 9px;">${formatEvalStatus(evalStatus)}</span>
                        </td>
                        <td style="font-size: 9px; color: var(--text-muted); padding: 6px;">${evalComment || '-'}</td>
                        <td style="text-align: center;">
                            <select class="eval-select ${poStatus}" style="font-size: 9px; padding: 2px;">
                                <option value="pending" ${poStatus === 'pending' ? 'selected' : ''}></option>
                                <option value="pass" ${poStatus === 'pass' ? 'selected' : ''}></option>
                                <option value="fail" ${poStatus === 'fail' ? 'selected' : ''}></option>
                                <option value="clarification" ${poStatus === 'clarification' ? 'selected' : ''}></option>
                            </select>
                        </td>
                        <td>
                            <textarea class="eval-comment-field" placeholder="PO..." rows="2" style="font-size: 9px; padding: 3px; width: 100%;">${poComment}</textarea>
                        </td>
                        <td style="text-align: center;">
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <button class="btn btn-secondary btn-sm" onclick="startPrivateClarification('${item.id}-${vendorId}')" style="font-size: 7px; padding: 2px 3px;"></button>
                                <button class="btn btn-secondary btn-sm" onclick="askEvalTeamQuestion('${item.id}')" style="font-size: 7px; padding: 2px 3px;"></button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            return html;
        }
        
        // PO Financial Supplier View
        function renderPOFinancialSupplierView(container, stepData) {
            // Similar structure to Evaluator's Financial view but with PO additions
            const lotTotals = {};
            const lotStatuses = {};
            
            stepData.lots.forEach(lot => {
                let total = 0;
                lot.items.forEach(item => {
                    const priceData = item.prices[currentVendorEval];
                    if (priceData && priceData.finalPrice) {
                        const price = parseFloat(priceData.finalPrice.replace(/[^0-9.-]/g, ''));
                        total += price;
                    }
                });
                lotTotals[lot.id] = total;
                lotStatuses[lot.id] = 'not_evaluated';
            });
            
            let html = `
                <div style="background: var(--surface-0); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg); border: 1px solid var(--surface-200);">
                    <div style="display: flex; gap: var(--spacing-lg); align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <span style="font-size: 12px; color: var(--text-muted);">Jump to Lot:</span>
                            ${stepData.lots.map((lot, i) => `
                                <button class="btn btn-secondary btn-sm" onclick="document.getElementById('po-financial-lot-${lot.id}').scrollIntoView({behavior: 'smooth'})" style="font-size: 11px;">
                                     ${lot.name.split(':')[0]}
                                </button>
                            `).join('')}
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <button class="btn btn-secondary btn-sm" onclick="expandAllPOFinancialLots()" style="font-size: 11px;"> Expand All</button>
                            <button class="btn btn-secondary btn-sm" onclick="collapseAllPOFinancialLots()" style="font-size: 11px;"> Collapse All</button>
                        </div>
                    </div>
                </div>
            `;
            
            stepData.lots.forEach((lot, lotIndex) => {
                const lotTotal = lotTotals[lot.id] || 0;
                const isFirstLot = lotIndex === 0;
                
                html += `
                    <div id="po-financial-lot-${lot.id}" class="po-financial-lot-collapsible" style="margin-bottom: var(--spacing-lg); border: 1px solid var(--surface-200); border-radius: var(--radius-lg); overflow: hidden;">
                        <div class="financial-lot-header" onclick="togglePOFinancialLot('po-financial-lot-content-${lot.id}')" style="background: linear-gradient(135deg, var(--primary-50) 0%, var(--info-50) 100%); padding: var(--spacing-lg); cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                <span id="po-financial-lot-${lot.id}-icon" style="font-size: 14px; color: var(--text-muted);">${isFirstLot ? '' : ''}</span>
                                <div style="width: 4px; height: 45px; background: var(--primary-400); border-radius: 2px;"></div>
                                <div>
                                    <div style="font-weight: 700; font-size: 15px; color: var(--text-primary);"> ${lot.name}</div>
                                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px;">${lot.items.length} UNSPSC Products</div>
                                </div>
                            </div>
                            <div style="display: flex; gap: var(--spacing-lg); align-items: center;">
                                <div style="text-align: right; padding: 8px 16px; background: white; border-radius: var(--radius-md); border: 1px solid var(--surface-200);">
                                    <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase;">Lot Total</div>
                                    <div style="font-size: 18px; font-weight: 700; color: var(--success-600);">$${lotTotal.toLocaleString()}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="po-financial-lot-content-${lot.id}" class="po-financial-lot-content" style="${isFirstLot ? '' : 'display: none;'}">
                            <div style="padding: var(--spacing-lg); background: var(--surface-50);">
                                <table class="eval-table" style="margin-bottom: 0;">
                                    <thead>
                                        <tr style="background: var(--surface-100);">
                                            <th style="min-width: 200px;">Product (UNSPSC)</th>
                                            <th style="width: 80px;">Unit Price</th>
                                            <th style="width: 100px;">Total</th>
                                            <th style="width: 60px;">Rank</th>
                                            <th style="width: 80px;">Evaluator</th>
                                            <th style="width: 100px;">Eval Comments</th>
                                            <th style="width: 80px;">PO Final</th>
                                            <th style="min-width: 100px;">PO Comments</th>
                                            <th style="width: 70px;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                `;
                
                lot.items.forEach((item, itemIndex) => {
                    const priceData = item.prices[currentVendorEval];
                    const evalStatus = priceData?.evalStatus || 'not_evaluated';
                    const evalComment = priceData?.comment || '';
                    const poStatus = priceData?.poStatus || 'pending';
                    const poComment = priceData?.poComment || '';
                    const isEvenRow = itemIndex % 2 === 0;
                    
                    html += `
                                        <tr style="background: ${isEvenRow ? 'white' : 'var(--surface-50)'}; border-bottom: 1px solid var(--surface-100);">
                                            <td style="padding: 10px;">
                                                <div style="display: flex; flex-direction: column; gap: 2px;">
                                                    <span style="font-size: 10px; padding: 2px 6px; background: var(--primary-100); color: var(--primary-600); border-radius: var(--radius-xs); font-weight: 600; font-family: monospace; width: fit-content;">${item.unspsc}</span>
                                                    <div style="font-size: 11px; font-weight: 500; color: var(--text-primary);">${item.description}</div>
                                                    <span style="font-size: 9px; color: var(--text-muted);">Qty: ${item.quantity}</span>
                                                </div>
                                            </td>
                                            <td style="font-weight: 600; font-size: 11px; text-align: center;">${priceData?.unitPrice || '-'}</td>
                                            <td style="font-weight: 600; font-size: 11px; text-align: center;">${priceData?.finalPrice || '-'}</td>
                                            <td style="text-align: center;">
                                                <span style="padding: 2px 6px; border-radius: var(--radius-sm); font-size: 9px; font-weight: 700; background: ${priceData?.rank?.startsWith('1') ? 'var(--success-100)' : 'var(--surface-100)'}; color: ${priceData?.rank?.startsWith('1') ? 'var(--success-600)' : 'var(--text-primary)'};">
                                                    ${priceData?.rank || '-'}
                                                </span>
                                            </td>
                                            <td style="text-align: center;">
                                                <span class="eval-status-badge ${evalStatus}" style="font-size: 9px;">${formatEvalStatus(evalStatus)}</span>
                                            </td>
                                            <td style="font-size: 9px; color: var(--text-muted); padding: 6px;">${evalComment || '-'}</td>
                                            <td style="text-align: center;">
                                                <select class="eval-select ${poStatus}" style="font-size: 9px; padding: 2px;">
                                                    <option value="pending" ${poStatus === 'pending' ? 'selected' : ''}></option>
                                                    <option value="pass" ${poStatus === 'pass' ? 'selected' : ''}></option>
                                                    <option value="fail" ${poStatus === 'fail' ? 'selected' : ''}></option>
                                                </select>
                                            </td>
                                            <td>
                                                <textarea class="eval-comment-field" placeholder="PO..." rows="2" style="font-size: 9px; padding: 3px; width: 100%;">${poComment}</textarea>
                                            </td>
                                            <td style="text-align: center;">
                                                <div style="display: flex; flex-direction: column; gap: 2px;">
                                                    <button class="btn btn-secondary btn-sm" onclick="startPrivateClarification('${item.id}')" style="font-size: 7px; padding: 2px 3px;"></button>
                                                    <button class="btn btn-secondary btn-sm" onclick="askEvalTeamQuestion('${item.id}')" style="font-size: 7px; padding: 2px 3px;"></button>
                                                </div>
                                            </td>
                                        </tr>
                    `;
                });
                
                html += `
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // PO Financial Lot View - shows all suppliers per UNSPSC
        function renderPOFinancialLotView(container, stepData) {
            const vendorData = {
                'vendor1': { name: 'MedSupply Ltd.', ungm: '309663', country: 'Germany' },
                'vendor2': { name: 'HealthCare Corp.', ungm: '301245', country: 'USA' },
                'vendor3': { name: 'MedTech Inc.', ungm: '315789', country: 'Japan' }
            };
            
            const selectedLot = stepData.lots.find(lot => lot.id === currentLotId);
            if (!selectedLot) {
                container.innerHTML = '<p>Lot not found.</p>';
                return;
            }
            
            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); border: 1px solid var(--surface-200);">
                    <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                        <button class="btn btn-secondary btn-sm" onclick="expandAllPOFinancialLotViewUnspsc()" style="font-size: 11px;"> Expand All</button>
                        <button class="btn btn-secondary btn-sm" onclick="collapseAllPOFinancialLotViewUnspsc()" style="font-size: 11px;"> Collapse All</button>
                        <span style="color: var(--text-muted); font-size: 12px;">${selectedLot.items.length} UNSPSC Products</span>
                    </div>
                </div>
            `;
            
            selectedLot.items.forEach((item, itemIndex) => {
                const isFirstItem = itemIndex === 0;
                
                html += `
                    <div class="po-financial-lot-view-unspsc" style="margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200); border-radius: var(--radius-md); overflow: hidden;">
                        <div class="unspsc-header" onclick="togglePOUnspsc('po-fin-lotview-unspsc-${item.id}')" style="padding: var(--spacing-md); background: var(--surface-50); cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                <span id="po-fin-lotview-unspsc-${item.id}-icon" style="font-size: 12px; color: var(--text-muted);">${isFirstItem ? '' : ''}</span>
                                <div>
                                    <span style="font-size: 11px; padding: 2px 8px; background: var(--primary-100); color: var(--primary-600); border-radius: var(--radius-xs); font-weight: 600; font-family: monospace;">${item.unspsc}</span>
                                    <span style="font-weight: 600; color: var(--text-primary); margin-left: var(--spacing-sm); font-size: 13px;">${item.description}</span>
                                    <span style="font-size: 11px; color: var(--text-muted); margin-left: var(--spacing-sm);">Qty: ${item.quantity}</span>
                                </div>
                            </div>
                        </div>
                        <div id="po-fin-lotview-unspsc-${item.id}" class="unspsc-content" style="${isFirstItem ? '' : 'display: none;'}">
                            <div style="padding: var(--spacing-md); background: white;">
                                <table class="eval-table" style="margin-bottom: 0; font-size: 12px;">
                                    <thead>
                                        <tr style="background: var(--surface-100);">
                                            <th style="width: 110px;">Supplier</th>
                                            <th style="width: 70px;">Unit Price</th>
                                            <th style="width: 90px;">Total</th>
                                            <th style="width: 55px;">Rank</th>
                                            <th style="width: 75px;">Evaluator</th>
                                            <th style="width: 100px;">Eval Comments</th>
                                            <th style="width: 75px;">PO Final</th>
                                            <th style="min-width: 100px;">PO Comments</th>
                                            <th style="width: 65px;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${renderPOFinancialLotViewSupplierRows(item, vendorData)}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Render supplier rows for PO Financial Lot View
        function renderPOFinancialLotViewSupplierRows(item, vendorData) {
            const vendors = ['vendor1', 'vendor2', 'vendor3'];
            let html = '';
            
            vendors.forEach((vendorId, idx) => {
                const vendor = vendorData[vendorId];
                const priceData = item.prices?.[vendorId] || {};
                const evalStatus = priceData.evalStatus || 'not_evaluated';
                const evalComment = priceData.comment || '';
                const poStatus = priceData.poStatus || 'pending';
                const poComment = priceData.poComment || '';
                const isEvenRow = idx % 2 === 0;
                
                html += `
                    <tr style="background: ${isEvenRow ? 'white' : 'var(--surface-50)'}; border-bottom: 1px solid var(--surface-100);">
                        <td style="padding: 8px;">
                            <div style="font-weight: 600; font-size: 10px;">${vendor.name}</div>
                            <div style="font-size: 8px; color: var(--text-muted);">UNGM: ${vendor.ungm}</div>
                        </td>
                        <td style="font-weight: 600; font-size: 10px; text-align: center;">${priceData.unitPrice || '-'}</td>
                        <td style="font-weight: 600; font-size: 10px; text-align: center;">${priceData.finalPrice || '-'}</td>
                        <td style="text-align: center;">
                            <span style="padding: 2px 5px; border-radius: var(--radius-sm); font-size: 8px; font-weight: 700; background: ${priceData.rank?.startsWith('1') ? 'var(--success-100)' : 'var(--surface-100)'}; color: ${priceData.rank?.startsWith('1') ? 'var(--success-600)' : 'var(--text-primary)'};">
                                ${priceData.rank || '-'}
                            </span>
                        </td>
                        <td style="text-align: center;">
                            <span class="eval-status-badge ${evalStatus}" style="font-size: 8px;">${formatEvalStatus(evalStatus)}</span>
                        </td>
                        <td style="font-size: 8px; color: var(--text-muted); padding: 5px;">${evalComment || '-'}</td>
                        <td style="text-align: center;">
                            <select class="eval-select ${poStatus}" style="font-size: 8px; padding: 2px;">
                                <option value="pending" ${poStatus === 'pending' ? 'selected' : ''}></option>
                                <option value="pass" ${poStatus === 'pass' ? 'selected' : ''}></option>
                                <option value="fail" ${poStatus === 'fail' ? 'selected' : ''}></option>
                            </select>
                        </td>
                        <td>
                            <textarea class="eval-comment-field" placeholder="PO..." rows="2" style="font-size: 8px; padding: 2px; width: 100%;">${poComment}</textarea>
                        </td>
                        <td style="text-align: center;">
                            <div style="display: flex; flex-direction: column; gap: 1px;">
                                <button class="btn btn-secondary btn-sm" onclick="startPrivateClarification('${item.id}-${vendorId}')" style="font-size: 7px; padding: 1px 2px;"></button>
                                <button class="btn btn-secondary btn-sm" onclick="askEvalTeamQuestion('${item.id}')" style="font-size: 7px; padding: 1px 2px;"></button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            return html;
        }
        
        // PO View toggle functions
        function togglePOLot(lotId) {
            const content = document.getElementById('po-lot-content-' + lotId);
            const icon = document.getElementById('po-lot-icon-' + lotId);
            if (!content || !icon) return;
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '';
            } else {
                content.style.display = 'none';
                icon.textContent = '';
            }
        }
        
        function togglePOUnspsc(id) {
            const content = document.getElementById(id);
            const icon = document.getElementById(id + '-icon');
            if (!content || !icon) return;
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '';
            } else {
                content.style.display = 'none';
                icon.textContent = '';
            }
        }
        
        function togglePOFinancialLot(contentId) {
            const content = document.getElementById(contentId);
            const lotId = contentId.replace('po-financial-lot-content-', '');
            const icon = document.getElementById('po-financial-lot-' + lotId + '-icon');
            if (!content || !icon) return;
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '';
            } else {
                content.style.display = 'none';
                icon.textContent = '';
            }
        }
        
        function expandAllPOLots() {
            document.querySelectorAll('.po-lot-content').forEach(c => c.style.display = 'block');
            document.querySelectorAll('[id^="po-lot-icon-"]').forEach(i => i.textContent = '');
            showToast(' All lots expanded');
        }
        
        function collapseAllPOLots() {
            document.querySelectorAll('.po-lot-content').forEach(c => c.style.display = 'none');
            document.querySelectorAll('[id^="po-lot-icon-"]').forEach(i => i.textContent = '');
            showToast(' All lots collapsed');
        }
        
        function expandAllPOLotViewUnspsc() {
            document.querySelectorAll('.po-lot-view-unspsc .unspsc-content').forEach(c => c.style.display = 'block');
            document.querySelectorAll('.po-lot-view-unspsc [id$="-icon"]').forEach(i => i.textContent = '');
            showToast(' All products expanded');
        }
        
        function collapseAllPOLotViewUnspsc() {
            document.querySelectorAll('.po-lot-view-unspsc .unspsc-content').forEach(c => c.style.display = 'none');
            document.querySelectorAll('.po-lot-view-unspsc [id$="-icon"]').forEach(i => i.textContent = '');
            showToast(' All products collapsed');
        }
        
        function expandAllPOFinancialLots() {
            document.querySelectorAll('.po-financial-lot-content').forEach(c => c.style.display = 'block');
            document.querySelectorAll('[id^="po-financial-lot-"][id$="-icon"]').forEach(i => i.textContent = '');
            showToast(' All lots expanded');
        }
        
        function collapseAllPOFinancialLots() {
            document.querySelectorAll('.po-financial-lot-content').forEach(c => c.style.display = 'none');
            document.querySelectorAll('[id^="po-financial-lot-"][id$="-icon"]').forEach(i => i.textContent = '');
            showToast(' All lots collapsed');
        }
        
        function expandAllPOFinancialLotViewUnspsc() {
            document.querySelectorAll('.po-financial-lot-view-unspsc .unspsc-content').forEach(c => c.style.display = 'block');
            document.querySelectorAll('.po-financial-lot-view-unspsc [id$="-icon"]').forEach(i => i.textContent = '');
            showToast(' All products expanded');
        }
        
        function collapseAllPOFinancialLotViewUnspsc() {
            document.querySelectorAll('.po-financial-lot-view-unspsc .unspsc-content').forEach(c => c.style.display = 'none');
            document.querySelectorAll('.po-financial-lot-view-unspsc [id$="-icon"]').forEach(i => i.textContent = '');
            showToast(' All products collapsed');
        }
        
        function renderSupplierComparisons(item, vendorData) {
            // Simulate data for each vendor for this UNSPSC code
            const vendorResponses = {
                'vendor1': {
                    compliance: item.bidderCompliance,
                    response: item.bidderResponse,
                    deviation: item.deviation,
                    docs: item.supplierDocs,
                    systemEval: item.systemEval,
                    evaluation: item.evaluations.evaluator
                },
                'vendor2': {
                    compliance: 'Yes',
                    response: generateVendorResponse(item.description, 'vendor2'),
                    deviation: null,
                    docs: [
                        { name: item.supplierDocs[0]?.name.replace('.pdf', '_V2.pdf') || 'Technical_Spec_V2.pdf', size: '1.8 MB', date: '2024-11-11' },
                        { name: 'ISO_Certificate_V2.pdf', size: '720 KB', date: '2024-11-11' }
                    ],
                    systemEval: 'pass',
                    evaluation: { status: 'pass', comment: 'Compliant with all requirements. Good documentation.' }
                },
                'vendor3': {
                    compliance: item.deviation ? 'Partial' : 'Yes',
                    response: generateVendorResponse(item.description, 'vendor3'),
                    deviation: item.deviation ? 'Alternative product offered' : null,
                    docs: [
                        { name: item.supplierDocs[0]?.name.replace('.pdf', '_V3.pdf') || 'Technical_Spec_V3.pdf', size: '2.2 MB', date: '2024-11-10' },
                        { name: 'Alternative_Product_Spec.pdf', size: '1.4 MB', date: '2024-11-10' }
                    ],
                    systemEval: item.deviation ? 'fail' : 'pass',
                    evaluation: { status: item.deviation ? 'clarification' : 'pass', comment: item.deviation ? 'Need clarification on alternative product compliance.' : 'Meets technical requirements adequately.' }
                }
            };
            
            let rows = '';
            Object.keys(vendorData).forEach((vendorKey, index) => {
                const vendor = vendorData[vendorKey];
                const response = vendorResponses[vendorKey];
                const isCurrentVendor = vendorKey === currentVendorEval;
                
                rows += `
                    <tr style="${isCurrentVendor ? 'background: #fffef0; border-left: 4px solid var(--primary-400);' : ''}">
                        <td>
                            <div style="font-weight: 700; color: var(--primary-600); font-size: 13px; margin-bottom: 2px;">
                                ${isCurrentVendor ? ' ' : ''}${vendor.name}
                            </div>
                            <div style="font-size: 11px; color: var(--text-muted);">
                                UNGM: ${vendor.ungm}
                            </div>
                            <div style="font-size: 11px; color: var(--text-muted);">
                                ${vendor.country}
                            </div>
                        </td>
                        <td>
                            ${response.compliance === 'Yes' ? ' Yes' : response.compliance === 'No' ? ' No' : ' Partial'}
                        </td>
                        <td style="font-size: 13px;">
                            ${response.response}
                            ${response.deviation ? `<div class="deviation-badge" style="margin-top: var(--spacing-sm);"><strong> Deviation:</strong> ${response.deviation}</div>` : ''}
                        </td>
                        <td style="color: ${response.deviation ? 'var(--danger-500)' : 'var(--text-muted)'}; font-size: 12px;">
                            ${response.deviation || '-'}
                        </td>
                        <td>${renderSupplierDocs(response.docs)}</td>
                        <td class="system-eval-column">
                            <span class="eval-status-badge ${response.systemEval}">
                                ${response.systemEval === 'pass' ? ' Pass' : ' Fail'}
                            </span>
                        </td>
                        <td class="manual-eval-column">
                            <select class="eval-select ${response.evaluation.status}" ${!isCurrentVendor ? 'disabled' : ''}>
                                <option value="not_evaluated" ${response.evaluation.status === 'not_evaluated' ? 'selected' : ''}> Not Evaluated</option>
                                <option value="pass" ${response.evaluation.status === 'pass' ? 'selected' : ''}> Pass</option>
                                <option value="fail" ${response.evaluation.status === 'fail' ? 'selected' : ''}> Fail</option>
                                <option value="clarification" ${response.evaluation.status === 'clarification' ? 'selected' : ''}> Clarification</option>
                            </select>
                            ${!isCurrentVendor ? '<div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">View only</div>' : ''}
                        </td>
                        <td class="manual-eval-column">
                            <textarea class="eval-comment-field" placeholder="Enter your comments..." ${!isCurrentVendor ? 'disabled' : ''}>${response.evaluation.comment}</textarea>
                        </td>
                        <td class="manual-eval-column" style="text-align: center;">
                            <button class="btn btn-secondary" onclick="requestEvalClarification('${item.id}-${vendorKey}')" title="Request Clarification" ${!isCurrentVendor ? 'disabled' : ''}>
                                
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            return rows;
        }
        
        function generateVendorResponse(description, vendorKey) {
            // Generate realistic variations of responses for different vendors
            const responses = {
                'gloves': [
                    'Nitrile examination gloves, powder-free, latex-free. EN455 compliant.',
                    'Latex-free nitrile gloves, powder-free. Meets EN455 standard. Available in sizes S-XL.',
                    'Premium nitrile gloves, powder-free, latex-free. EN455 certified. Textured fingertips for better grip.'
                ],
                'mask': [
                    'Type II masks provided. Type IIR available at additional cost (+$0.05 per unit).',
                    'Type IIR surgical masks, fluid resistant. EN14683 compliant. BFE >98%.',
                    'Type IIR masks with adjustable nose bridge. EN14683 certified. Individually wrapped.'
                ],
                'face shield': [
                    'Anti-fog coated face shields with adjustable headband. CE marked.',
                    'Full face protection shield with anti-fog coating. Comfortable foam padding. CE certified.',
                    'Clear polycarbonate face shield, anti-fog treated. Adjustable elastic band. CE marked.'
                ],
                'syringe': [
                    'Sterile single-use syringes, luer lock, 5ml. ISO 7886-1 compliant.',
                    '5ml luer lock syringes, sterile, single-use. ISO 7886-1 certified. Clear barrel with graduation marks.',
                    'Precision 5ml syringes with luer lock. Sterile, pyrogen-free. ISO 7886-1 compliant.'
                ],
                'gauze': [
                    'Sterile cotton gauze bandages. Multiple sizes: 5cm, 7.5cm, 10cm.',
                    '100% cotton gauze bandages, sterile. Sizes: 5cm, 7.5cm, 10cm, 15cm. Individually wrapped.',
                    'Medical grade cotton gauze, sterile. Available sizes: 5cm, 7.5cm, 10cm. High absorbency.'
                ],
                'catheter': [
                    'Sterile IV catheters with safety mechanism. All sizes available.',
                    'Safety IV catheters 18G-24G. Sterile, with integrated safety shield. Color-coded.',
                    'Premium IV catheters with passive safety mechanism. Sizes 18G-24G. Latex-free.'
                ]
            };
            
            // Determine response type based on description keywords
            let responseArray = responses['gloves']; // default
            if (description.toLowerCase().includes('mask')) responseArray = responses['mask'];
            else if (description.toLowerCase().includes('shield')) responseArray = responses['face shield'];
            else if (description.toLowerCase().includes('syringe')) responseArray = responses['syringe'];
            else if (description.toLowerCase().includes('gauze')) responseArray = responses['gauze'];
            else if (description.toLowerCase().includes('catheter')) responseArray = responses['catheter'];
            
            const vendorIndex = vendorKey === 'vendor2' ? 1 : 2;
            return responseArray[vendorIndex] || responseArray[0];
        }

        // Render comprehensive Evaluation Overview (Step 0)
        function renderEvaluationOverview(container) {
            const suppliers = [
                { id: 'vendor1', name: 'MedSupply Ltd.', ungm: '309663', country: 'Germany', totalBid: '$234,500' },
                { id: 'vendor2', name: 'HealthCare Corp.', ungm: '301245', country: 'USA', totalBid: '$228,900' },
                { id: 'vendor3', name: 'MedTech Inc.', ungm: '315789', country: 'Japan', totalBid: '$241,200' }
            ];
            
            const evaluators = [
                { id: 'eval1', name: 'Jane Doe', role: 'Lead Evaluator', email: 'jane.doe@unops.org' },
                { id: 'eval2', name: 'John Smith', role: 'Technical Expert', email: 'john.smith@unops.org' },
                { id: 'eval3', name: 'Sarah Johnson', role: 'Procurement Officer', email: 'sarah.j@unops.org' }
            ];
            
            const stages = [
                { id: 1, name: 'Eligibility & Formal', status: 'completed', progress: 100 },
                { id: 2, name: 'Qualification', status: 'completed', progress: 100 },
                { id: 3, name: 'Technical', status: 'in_progress', progress: 65 },
                { id: 4, name: 'Financial', status: 'pending', progress: 0 }
            ];
            
            const lots = [
                { id: 'lot1', name: 'Lot 1: Personal Protective Equipment', itemCount: 3 },
                { id: 'lot2', name: 'Lot 2: Medical Consumables', itemCount: 3 }
            ];
            
            // Simulated evaluation matrix data
            const evalMatrix = {
                vendor1: {
                    step1: { status: 'pass', evaluator: 'Jane Doe', comment: 'All eligibility criteria met', date: '2024-12-01' },
                    step2: { status: 'pass', evaluator: 'John Smith', comment: 'Qualified supplier', date: '2024-12-02' },
                    step3: { status: 'in_progress', evaluator: 'Jane Doe', comment: 'Technical review ongoing', date: '2024-12-05', progress: 70 },
                    step4: { status: 'pending', evaluator: '-', comment: '-', date: '-' },
                    lot1: { status: 'pass', evaluator: 'Jane Doe', comment: 'PPE meets specs' },
                    lot2: { status: 'in_progress', evaluator: 'John Smith', comment: 'Reviewing consumables' }
                },
                vendor2: {
                    step1: { status: 'pass', evaluator: 'Jane Doe', comment: 'Eligibility verified', date: '2024-12-01' },
                    step2: { status: 'pass', evaluator: 'John Smith', comment: 'Good qualifications', date: '2024-12-02' },
                    step3: { status: 'in_progress', evaluator: 'Sarah Johnson', comment: 'Technical specs being reviewed', date: '2024-12-05', progress: 55 },
                    step4: { status: 'pending', evaluator: '-', comment: '-', date: '-' },
                    lot1: { status: 'clarification', evaluator: 'Sarah Johnson', comment: 'Need cert clarification' },
                    lot2: { status: 'pass', evaluator: 'Jane Doe', comment: 'Consumables verified' }
                },
                vendor3: {
                    step1: { status: 'pass', evaluator: 'Jane Doe', comment: 'Eligible bidder', date: '2024-12-01' },
                    step2: { status: 'clarification', evaluator: 'John Smith', comment: 'Missing Form D', date: '2024-12-03' },
                    step3: { status: 'not_started', evaluator: '-', comment: 'Pending qualification', date: '-', progress: 0 },
                    step4: { status: 'pending', evaluator: '-', comment: '-', date: '-' },
                    lot1: { status: 'not_started', evaluator: '-', comment: '-' },
                    lot2: { status: 'not_started', evaluator: '-', comment: '-' }
                }
            };
            
            const getStatusBadge = (status) => {
                const badges = {
                    'pass': '<span style="padding: 3px 8px; border-radius: var(--radius-sm); font-size: 10px; font-weight: 600; background: var(--success-100); color: var(--success-600);"> Pass</span>',
                    'fail': '<span style="padding: 3px 8px; border-radius: var(--radius-sm); font-size: 10px; font-weight: 600; background: var(--danger-100); color: var(--danger-600);"> Fail</span>',
                    'clarification': '<span style="padding: 3px 8px; border-radius: var(--radius-sm); font-size: 10px; font-weight: 600; background: var(--warning-100); color: var(--warning-600);"> Clarify</span>',
                    'in_progress': '<span style="padding: 3px 8px; border-radius: var(--radius-sm); font-size: 10px; font-weight: 600; background: var(--primary-100); color: var(--primary-600);"> In Progress</span>',
                    'pending': '<span style="padding: 3px 8px; border-radius: var(--radius-sm); font-size: 10px; font-weight: 600; background: var(--surface-100); color: var(--text-muted);"> Pending</span>',
                    'not_started': '<span style="padding: 3px 8px; border-radius: var(--radius-sm); font-size: 10px; font-weight: 600; background: var(--surface-100); color: var(--text-muted);"> Not Started</span>',
                    'completed': '<span style="padding: 3px 8px; border-radius: var(--radius-sm); font-size: 10px; font-weight: 600; background: var(--success-100); color: var(--success-600);"> Complete</span>'
                };
                return badges[status] || badges['pending'];
            };
            
            let html = `
                <!-- Overview Header -->
                <div style="margin-bottom: var(--spacing-xl);">
                    <h2 style="font-size: 20px; font-weight: 700; color: var(--text-primary); margin-bottom: var(--spacing-sm);"> Evaluation Overview</h2>
                    <p style="color: var(--text-muted); font-size: 13px;">Comprehensive view of all evaluation stages, suppliers, lots, and evaluator progress.</p>
                </div>
                
                <!-- Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-xl);">
                    <div style="background: linear-gradient(135deg, var(--primary-50) 0%, var(--info-50) 100%); padding: var(--spacing-lg); border-radius: var(--radius-md); border: 1px solid var(--primary-200);">
                        <div style="font-size: 28px; font-weight: 700; color: var(--primary-600);">${suppliers.length}</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Suppliers Under Evaluation</div>
                    </div>
                    <div style="background: linear-gradient(135deg, var(--success-50) 0%, var(--teal-50) 100%); padding: var(--spacing-lg); border-radius: var(--radius-md); border: 1px solid var(--success-200);">
                        <div style="font-size: 28px; font-weight: 700; color: var(--success-600);">2 / 4</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Stages Completed</div>
                    </div>
                    <div style="background: linear-gradient(135deg, var(--warning-50) 0%, var(--orange-50) 100%); padding: var(--spacing-lg); border-radius: var(--radius-md); border: 1px solid var(--warning-200);">
                        <div style="font-size: 28px; font-weight: 700; color: var(--warning-600);">${lots.length}</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Lots Being Evaluated</div>
                    </div>
                    <div style="background: linear-gradient(135deg, var(--info-50) 0%, var(--primary-50) 100%); padding: var(--spacing-lg); border-radius: var(--radius-md); border: 1px solid var(--info-200);">
                        <div style="font-size: 28px; font-weight: 700; color: var(--info-600);">${evaluators.length}</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Active Evaluators</div>
                    </div>
                </div>
                
                <!-- Stage Progress Overview -->
                <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                    <h3 style="font-size: 15px; font-weight: 600; margin-bottom: var(--spacing-lg); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <span style="color: var(--primary-500);"></span> Stage Progress
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-md);">
                        ${stages.map(stage => `
                            <div style="text-align: center; padding: var(--spacing-md); background: ${stage.status === 'completed' ? 'var(--success-50)' : stage.status === 'in_progress' ? 'var(--primary-50)' : 'var(--surface-50)'}; border-radius: var(--radius-md); border: 1px solid ${stage.status === 'completed' ? 'var(--success-200)' : stage.status === 'in_progress' ? 'var(--primary-200)' : 'var(--surface-200)'};">
                                <div style="font-weight: 600; font-size: 13px; margin-bottom: var(--spacing-sm); color: ${stage.status === 'completed' ? 'var(--success-600)' : stage.status === 'in_progress' ? 'var(--primary-600)' : 'var(--text-muted)'};">
                                    ${stage.status === 'completed' ? '' : stage.id}. ${stage.name}
                                </div>
                                <div style="width: 100%; height: 6px; background: var(--surface-200); border-radius: 3px; overflow: hidden; margin-bottom: var(--spacing-xs);">
                                    <div style="width: ${stage.progress}%; height: 100%; background: ${stage.status === 'completed' ? 'var(--success-500)' : 'var(--primary-400)'}; transition: width 0.3s;"></div>
                                </div>
                                <div style="font-size: 11px; color: var(--text-muted);">${stage.progress}% Complete</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Supplier x Stage Matrix -->
                <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                    <h3 style="font-size: 15px; font-weight: 600; margin-bottom: var(--spacing-lg); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <span style="color: var(--primary-500);"></span> Supplier Evaluation Status by Stage
                    </h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: var(--surface-50);">
                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--surface-200); font-weight: 600;">Supplier</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--surface-200); font-weight: 600;">1. Eligibility</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--surface-200); font-weight: 600;">2. Qualification</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--surface-200); font-weight: 600;">3. Technical</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--surface-200); font-weight: 600;">4. Financial</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--surface-200); font-weight: 600;">Overall</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${suppliers.map((supplier, idx) => {
                                    const matrix = evalMatrix[supplier.id];
                                    const passCount = [matrix.step1, matrix.step2, matrix.step3, matrix.step4].filter(s => s.status === 'pass').length;
                                    return `
                                        <tr style="background: ${idx % 2 === 0 ? 'white' : 'var(--surface-50)'}; border-bottom: 1px solid var(--surface-100);">
                                            <td style="padding: 12px;">
                                                <div style="font-weight: 600; color: var(--text-primary);">${supplier.name}</div>
                                                <div style="font-size: 10px; color: var(--text-muted);">UNGM: ${supplier.ungm} | ${supplier.country}</div>
                                            </td>
                                            <td style="padding: 12px; text-align: center;">${getStatusBadge(matrix.step1.status)}</td>
                                            <td style="padding: 12px; text-align: center;">${getStatusBadge(matrix.step2.status)}</td>
                                            <td style="padding: 12px; text-align: center;">
                                                ${getStatusBadge(matrix.step3.status)}
                                                ${matrix.step3.progress ? `<div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">${matrix.step3.progress}%</div>` : ''}
                                            </td>
                                            <td style="padding: 12px; text-align: center;">${getStatusBadge(matrix.step4.status)}</td>
                                            <td style="padding: 12px; text-align: center;">
                                                <span style="font-size: 11px; font-weight: 600; color: var(--primary-600);">${passCount}/4 Stages</span>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Detailed Evaluation by Supplier, Lot & Evaluator -->
                <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                    <h3 style="font-size: 15px; font-weight: 600; margin-bottom: var(--spacing-lg); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <span style="color: var(--primary-500);"></span> Detailed Evaluator Progress
                    </h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: var(--surface-50);">
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--surface-200);">Supplier</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--surface-200);">Stage</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--surface-200);">Lot</th>
                                    <th style="padding: 10px; text-align: center; border-bottom: 2px solid var(--surface-200);">Status</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--surface-200);">Evaluator</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--surface-200);">Comment</th>
                                    <th style="padding: 10px; text-align: center; border-bottom: 2px solid var(--surface-200);">Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${suppliers.map(supplier => {
                                    const matrix = evalMatrix[supplier.id];
                                    let rows = '';
                                    
                                    // Technical evaluation by lot
                                    lots.forEach((lot, lotIdx) => {
                                        const lotData = matrix[lot.id];
                                        rows += `
                                            <tr style="background: ${lotIdx % 2 === 0 ? 'white' : 'var(--surface-50)'}; border-bottom: 1px solid var(--surface-100);">
                                                ${lotIdx === 0 ? `<td rowspan="${lots.length}" style="padding: 10px; border-right: 1px solid var(--surface-100); vertical-align: top;">
                                                    <div style="font-weight: 600;">${supplier.name}</div>
                                                    <div style="font-size: 10px; color: var(--text-muted);">${supplier.totalBid}</div>
                                                </td>` : ''}
                                                <td style="padding: 10px; font-size: 11px;">3. Technical</td>
                                                <td style="padding: 10px;">
                                                    <div style="font-size: 11px; font-weight: 500;">${lot.name.split(':')[0]}</div>
                                                    <div style="font-size: 10px; color: var(--text-muted);">${lot.itemCount} items</div>
                                                </td>
                                                <td style="padding: 10px; text-align: center;">${getStatusBadge(lotData.status)}</td>
                                                <td style="padding: 10px;">
                                                    <div style="font-size: 11px; font-weight: 500;">${lotData.evaluator}</div>
                                                </td>
                                                <td style="padding: 10px; font-size: 11px; color: var(--text-secondary); max-width: 200px;">
                                                    ${lotData.comment !== '-' ? `"${lotData.comment}"` : '<span style="color: var(--text-muted);">-</span>'}
                                                </td>
                                                <td style="padding: 10px; text-align: center; font-size: 10px; color: var(--text-muted);">
                                                    ${matrix.step3.date !== '-' ? matrix.step3.date : '-'}
                                                </td>
                                            </tr>
                                        `;
                                    });
                                    return rows;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Evaluator Workload Summary -->
                <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                    <h3 style="font-size: 15px; font-weight: 600; margin-bottom: var(--spacing-lg); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <span style="color: var(--primary-500);"></span> Evaluator Workload & Activity
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--spacing-md);">
                        ${evaluators.map(evaluator => `
                            <div style="border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-md);">
                                <div style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-md);">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary-100); display: flex; align-items: center; justify-content: center; font-weight: 600; color: var(--primary-600);">
                                        ${evaluator.name.split(' ').map(n => n[0]).join('')}
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; font-size: 13px;">${evaluator.name}</div>
                                        <div style="font-size: 11px; color: var(--text-muted);">${evaluator.role}</div>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-xs); text-align: center;">
                                    <div style="padding: var(--spacing-xs); background: var(--success-50); border-radius: var(--radius-xs);">
                                        <div style="font-size: 16px; font-weight: 700; color: var(--success-600);">${evaluator.id === 'eval1' ? 5 : evaluator.id === 'eval2' ? 3 : 4}</div>
                                        <div style="font-size: 9px; color: var(--text-muted);">Completed</div>
                                    </div>
                                    <div style="padding: var(--spacing-xs); background: var(--primary-50); border-radius: var(--radius-xs);">
                                        <div style="font-size: 16px; font-weight: 700; color: var(--primary-600);">${evaluator.id === 'eval1' ? 2 : evaluator.id === 'eval2' ? 3 : 1}</div>
                                        <div style="font-size: 9px; color: var(--text-muted);">In Progress</div>
                                    </div>
                                    <div style="padding: var(--spacing-xs); background: var(--warning-50); border-radius: var(--radius-xs);">
                                        <div style="font-size: 16px; font-weight: 700; color: var(--warning-600);">${evaluator.id === 'eval1' ? 0 : evaluator.id === 'eval2' ? 1 : 0}</div>
                                        <div style="font-size: 9px; color: var(--text-muted);">Pending Clarify</div>
                                    </div>
                                </div>
                                <div style="margin-top: var(--spacing-sm); font-size: 10px; color: var(--text-muted);">
                                    Last activity: ${evaluator.id === 'eval1' ? '2 hours ago' : evaluator.id === 'eval2' ? '4 hours ago' : '1 hour ago'}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Pending Actions & Alerts -->
                <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-lg); padding: var(--spacing-lg);">
                    <h3 style="font-size: 15px; font-weight: 600; margin-bottom: var(--spacing-lg); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <span style="color: var(--warning-500);"></span> Pending Actions & Alerts
                    </h3>
                    <div style="display: grid; gap: var(--spacing-sm);">
                        <div style="display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md); background: var(--warning-50); border-left: 4px solid var(--warning-400); border-radius: var(--radius-sm);">
                            <span style="font-size: 18px;"></span>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 12px; color: var(--text-primary);">Clarification Required - MedTech Inc.</div>
                                <div style="font-size: 11px; color: var(--text-muted);">Stage 2: Qualification - Missing Manufacturer's Authorization (Form D)</div>
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="switchEvaluationStep(2); switchVendorEval('vendor3');">View</button>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md); background: var(--warning-50); border-left: 4px solid var(--warning-400); border-radius: var(--radius-sm);">
                            <span style="font-size: 18px;"></span>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 12px; color: var(--text-primary);">Clarification Required - HealthCare Corp.</div>
                                <div style="font-size: 11px; color: var(--text-muted);">Stage 3: Technical - Lot 1 - Certificate verification needed</div>
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="switchEvaluationStep(3); switchVendorEval('vendor2');">View</button>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md); background: var(--info-50); border-left: 4px solid var(--info-400); border-radius: var(--radius-sm);">
                            <span style="font-size: 18px;"></span>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 12px; color: var(--text-primary);">Technical Evaluation In Progress</div>
                                <div style="font-size: 11px; color: var(--text-muted);">3 suppliers, 2 lots - 65% overall progress</div>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="switchEvaluationStep(3);">Continue</button>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md); background: var(--surface-50); border-left: 4px solid var(--surface-300); border-radius: var(--radius-sm);">
                            <span style="font-size: 18px;"></span>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 12px; color: var(--text-primary);">Financial Evaluation Pending</div>
                                <div style="font-size: 11px; color: var(--text-muted);">Waiting for Technical evaluation completion</div>
                            </div>
                            <span style="font-size: 11px; color: var(--text-muted);">Blocked</span>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function renderComparisonView(container, stepData) {
            // Show the comprehensive evaluation overview dashboard
            renderEvaluationOverview(container);
            return;
        }
        
        // Old comparison view kept for reference but not used
        function renderOldComparisonView(container, stepData) {
            // For technical evaluation, use the comprehensive comparison dashboard
            if (currentEvaluationStep === 3 && stepData.lots) {
                container.innerHTML = renderTechnicalComparisonView(stepData);
                return;
            }
            
            let html = `
                <h3 style="margin-bottom: var(--spacing-lg); color: var(--primary-400);"> Multi-Evaluator Comparison - ${stepData.name}</h3>
                <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-md); overflow: hidden;">
                    <div style="display: grid; grid-template-columns: 180px repeat(4, 1fr); background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-400) 100%); color: white; font-weight: bold; font-size: 13px;">
                        <div style="padding: 15px; border-right: 1px solid rgba(255,255,255,0.2);">Requirement</div>
                        <div style="padding: 15px; border-right: 1px solid rgba(255,255,255,0.2);">System</div>
                        <div style="padding: 15px; border-right: 1px solid rgba(255,255,255,0.2);">Evaluator 1<br><span style="font-size: 11px; font-weight: normal;">Jane Doe</span></div>
            `;
            
            if (currentEvaluationStep >= 3) {
                html += `<div style="padding: 15px; border-right: 1px solid rgba(255,255,255,0.2);">Evaluator 2<br><span style="font-size: 11px; font-weight: normal;">Dr. Smith</span></div>`;
            } else {
                html += `<div style="padding: 15px; border-right: 1px solid rgba(255,255,255,0.2);">-</div>`;
            }
            
            html += `
                        <div style="padding: 15px;">PO Final<br><span style="font-size: 11px; font-weight: normal;">Sarah Chen</span></div>
                    </div>
            `;
            
            stepData.requirements.forEach(req => {
                const e1 = req.evaluations.evaluator;
                const e2 = req.evaluations.evaluator2;
                const po = req.evaluations.po;
                const hasDiscrepancy = e2 && e1.status !== e2.status;
                const bgColor = hasDiscrepancy ? 'var(--warning-50)' : 'white';
                
                html += `
                    <div style="display: grid; grid-template-columns: 180px repeat(4, 1fr); border-bottom: 1px solid var(--surface-200); background: ${bgColor};">
                        <div style="padding: 15px; border-right: 1px solid var(--surface-200);">
                            <strong style="color: var(--primary-400);">${req.id}</strong>
                            ${hasDiscrepancy ? '<div style="color: var(--warning-500); font-size: 11px; margin-top: 5px; font-weight: bold;"> DISCREPANCY</div>' : ''}
                            <div style="font-size: 12px; margin-top: 8px; color: var(--text-secondary); line-height: 1.3;">${req.description.substring(0, 80)}...</div>
                            <div class="${req.mandatory ? 'mandatory-flag' : 'optional-flag'}" style="margin-top: 8px;">
                                ${req.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                            </div>
                        </div>
                        <div style="padding: 15px; border-right: 1px solid var(--surface-200); text-align: center;">
                            <span class="eval-status-badge ${req.systemEval}">${req.systemEval === 'pass' ? ' Pass' : ' Fail'}</span>
                        </div>
                        <div style="padding: 15px; border-right: 1px solid var(--surface-200);">
                            <span class="eval-status-badge ${e1.status}">${formatEvalStatus(e1.status)}</span>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px; line-height: 1.4;">${e1.comment}</div>
                        </div>
                `;
                
                if (e2) {
                    html += `
                        <div style="padding: 15px; border-right: 1px solid var(--surface-200);">
                            <span class="eval-status-badge ${e2.status}">${formatEvalStatus(e2.status)}</span>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px; line-height: 1.4;">${e2.comment}</div>
                        </div>
                    `;
                } else {
                    html += `<div style="padding: 15px; border-right: 1px solid var(--surface-200); text-align: center; color: var(--text-muted);">-</div>`;
                }
                
                html += `
                        <div style="padding: 15px; background: var(--surface-50);">
                            <span class="eval-status-badge ${po.status}">${formatEvalStatus(po.status)}</span>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px; line-height: 1.4;">${po.comment}</div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                <div style="margin-top: var(--spacing-lg); padding: var(--spacing-md); background: var(--info-50); border-left: 4px solid var(--info-400); border-radius: var(--radius-sm);">
                    <strong> Key Insights:</strong>
                    <ul style="margin-top: var(--spacing-sm); margin-left: 20px; line-height: 1.8; font-size: 14px;">
                        <li>Requirements with discrepancies are highlighted in orange</li>
                        <li>PO Final column shows the procurement official's final decision</li>
                        <li>Review discrepancies before finalizing evaluation</li>
                    </ul>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function renderSupplierDocs(docs) {
            if (!docs || docs.length === 0) {
                return '<span style="color: var(--text-muted); font-style: italic; font-size: 12px;">No documents</span>';
            }
            
            return `
                <div class="doc-badge"> ${docs.length} Doc${docs.length > 1 ? 's' : ''}</div>
                <div class="doc-list">
                    ${docs.map(doc => `
                        <div class="doc-item" onclick="viewSupplierDoc('${doc.name}')">
                            <div class="doc-name"> ${doc.name}</div>
                            <div class="doc-meta"> ${doc.size} |  ${doc.date}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function formatEvalStatus(status) {
            const map = {
                'pass': ' Pass',
                'fail': ' Fail',
                'clarification': ' Clarification',
                'pending': ' Pending',
                'not_evaluated': ' Not Evaluated'
            };
            return map[status] || status;
        }

        let currentLotId = 'lot1';
        
        function switchEvalView(view) {
            currentEvalView = view;
            
            // Update toggle buttons
            document.querySelectorAll('.view-toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Hide/show vendor info bar based on view
            const vendorInfoBar = document.getElementById('vendor-info-bar');
            if (vendorInfoBar) {
                vendorInfoBar.style.display = (view === 'lot') ? 'none' : 'flex';
            }
            
            // Update tabs container
            const tabsContainer = document.getElementById('evalTabsContainer');
            if (view === 'lot') {
                // Show lot tabs
                tabsContainer.innerHTML = `
                    <button class="lot-tab active" onclick="switchLot('lot1')"> Lot 1: PPE</button>
                    <button class="lot-tab" onclick="switchLot('lot2')"> Lot 2: Medical Consumables</button>
                `;
                currentLotId = 'lot1';
            } else {
                // Show vendor tabs
                tabsContainer.innerHTML = `
                    <button class="vendor-eval-tab active" onclick="switchVendorEval('vendor1')">Supplier 1 - MedSupply Ltd.</button>
                    <button class="vendor-eval-tab" onclick="switchVendorEval('vendor2')">Supplier 2 - HealthCare Corp.</button>
                    <button class="vendor-eval-tab" onclick="switchVendorEval('vendor3')">Supplier 3 - MedTech Inc.</button>
                `;
            }
            
            // Re-render table
            renderEvaluationTable();
        }
        
        function switchLot(lotId) {
            currentLotId = lotId;
            
            document.querySelectorAll('.lot-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderEvaluationTable();
        }

        function viewSupplierDoc(docName) {
            document.getElementById('docViewerTitle').textContent = docName;
            document.getElementById('docViewerMeta').textContent = 'PDF Document  Click to zoom';
            document.getElementById('documentViewerModal').classList.add('active');
        }

        function closeDocumentViewer() {
            document.getElementById('documentViewerModal').classList.remove('active');
        }

        function downloadDocument() {
            showToast(' Document download started');
        }

        function printDocument() {
            showToast(' Opening print dialog');
        }
        
        function previewDocumentOnline(docName) {
            // Remove any existing preview modal
            const existingModal = document.getElementById('onlineDocPreviewModal');
            if (existingModal) existingModal.remove();
            
            const modalHtml = `
                <div id="onlineDocPreviewModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="if(event.target===this) this.remove()">
                    <div style="background: white; border-radius: var(--radius-lg); width: 90%; max-width: 1000px; height: 85vh; display: flex; flex-direction: column; box-shadow: var(--shadow-lg);">
                        <div style="background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-400) 100%); color: white; padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-lg) var(--radius-lg) 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="margin: 0; font-size: 16px;"> Document Preview</h3>
                                <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">${docName}</div>
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm);">
                                <button class="btn btn-secondary btn-sm" onclick="downloadDocument()" style="background: rgba(255,255,255,0.2); border: none; color: white;">
                                     Download
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="printDocument()" style="background: rgba(255,255,255,0.2); border: none; color: white;">
                                     Print
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="document.getElementById('onlineDocPreviewModal').remove()" style="background: rgba(255,255,255,0.2); border: none; color: white;">
                                     Close
                                </button>
                            </div>
                        </div>
                        <div style="flex: 1; padding: var(--spacing-lg); overflow: auto; background: var(--surface-100);">
                            <div style="background: white; border-radius: var(--radius-md); height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: var(--shadow-sm);">
                                <!-- Simulated document preview -->
                                <div style="padding: 40px; text-align: center; max-width: 800px;">
                                    <div style="font-size: 48px; margin-bottom: var(--spacing-lg);"></div>
                                    <h2 style="color: var(--text-primary); margin-bottom: var(--spacing-md);">${docName}</h2>
                                    <div style="color: var(--text-muted); margin-bottom: var(--spacing-xl);">Document preview simulation</div>
                                    
                                    <!-- Sample document content -->
                                    <div style="text-align: left; padding: var(--spacing-lg); background: var(--surface-50); border-radius: var(--radius-md); border: 1px solid var(--surface-200);">
                                        <div style="font-weight: 600; margin-bottom: var(--spacing-md); color: var(--primary-500);">Document Information</div>
                                        <div style="display: grid; grid-template-columns: 150px 1fr; gap: var(--spacing-sm); font-size: 13px;">
                                            <div style="color: var(--text-muted);">File Name:</div>
                                            <div>${docName}</div>
                                            <div style="color: var(--text-muted);">File Type:</div>
                                            <div>${docName.split('.').pop().toUpperCase()}</div>
                                            <div style="color: var(--text-muted);">Upload Date:</div>
                                            <div>November 12, 2024</div>
                                            <div style="color: var(--text-muted);">Status:</div>
                                            <div><span style="color: var(--success-500);"> Verified</span></div>
                                        </div>
                                    </div>
                                    
                                    <div style="margin-top: var(--spacing-lg); padding: var(--spacing-md); background: var(--info-50); border-radius: var(--radius-sm); border-left: 4px solid var(--info-400);">
                                        <div style="font-size: 12px; color: var(--info-600);">
                                             In production, the full document content would be displayed here using an embedded PDF viewer or document renderer.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function downloadEvaluationExcel(lotId, step) {
            const stepNames = {
                'step1': 'Eligibility_and_Formal',
                'step2': 'Qualification',
                'step3': 'Technical',
                'step4': 'Financial'
            };
            
            const lotNames = {
                'lot1': 'PPE',
                'lot2': 'Medical_Consumables'
            };
            
            const filename = `Evaluation_${stepNames[step]}_${lotNames[lotId]}_${currentTenderId}.xlsx`;
            
            showToast(` Downloading: ${filename}`);
            
            // In production, this would generate and download an actual Excel file
            // with all evaluation criteria, supplier submissions, and editable fields
            setTimeout(() => {
                showToast(' Excel file ready for offline evaluation. Upload results when complete.');
            }, 1500);
        }

        // ===== EVALUATION TEAM ASSIGNMENT FUNCTIONS =====
        function openEvaluationTeamModal() {
            // Update mode display
            document.getElementById('currentModeDisplay').textContent = currentAssignmentMode === 'lot' ? 'Split by Lot' : 'Split by Supplier';
            
            // Render dynamic sections based on mode
            renderTechnicalAssignmentSection();
            renderFinancialAssignmentSection();
            
            document.getElementById('evaluationTeamModal').classList.add('active');
        }
        
        function renderTechnicalAssignmentSection() {
            const container = document.getElementById('technicalAssignmentSection');
            
            if (currentAssignmentMode === 'lot') {
                container.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: var(--spacing-sm); display: flex; justify-content: space-between; align-items: center;">
                        <span>Step 3: Technical Criteria <span style="font-size: 10px; color: var(--primary-400); font-weight: 400;"> By Lot</span></span>
                        <span style="font-size: 11px; color: var(--primary-400);"> In Progress</span>
                    </div>
                    <div style="margin-left: var(--spacing-md); margin-top: var(--spacing-md);">
                        <div style="margin-bottom: var(--spacing-md);">
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);"> Lot 1: Personal Protective Equipment</div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <div class="eval-team-badge">John Smith <button onclick="removeFromLot(3, 'lot1', 'john')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;"></button></div>
                                <div class="eval-team-badge">Maria Garcia <button onclick="removeFromLot(3, 'lot1', 'maria')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;"></button></div>
                                <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToLot(3, 'lot1')"><i class="pi pi-plus"></i> Add</button>
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);"> Lot 2: Medical Consumables</div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <div class="eval-team-badge">Sarah Johnson <button onclick="removeFromLot(3, 'lot2', 'sarah')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;"></button></div>
                                <div class="eval-team-badge">David Lee <button onclick="removeFromLot(3, 'lot2', 'david')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;"></button></div>
                                <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToLot(3, 'lot2')"><i class="pi pi-plus"></i> Add</button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // By Supplier mode
                container.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: var(--spacing-sm); display: flex; justify-content: space-between; align-items: center;">
                        <span>Step 3: Technical Criteria <span style="font-size: 10px; color: var(--info-400); font-weight: 400;"> By Supplier</span></span>
                        <span style="font-size: 11px; color: var(--primary-400);"> In Progress</span>
                    </div>
                    <div style="margin-left: var(--spacing-md); margin-top: var(--spacing-md);">
                        <div style="margin-bottom: var(--spacing-md);">
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);"> Supplier 1: MedSupply Ltd.</div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <div class="eval-team-badge">John Smith <button onclick="removeFromSupplier(3, 'vendor1', 'john')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;"></button></div>
                                <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToSupplier(3, 'vendor1')"><i class="pi pi-plus"></i> Add</button>
                            </div>
                        </div>
                        <div style="margin-bottom: var(--spacing-md);">
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);"> Supplier 2: HealthCare Corp.</div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <div class="eval-team-badge">Sarah Johnson <button onclick="removeFromSupplier(3, 'vendor2', 'sarah')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;"></button></div>
                                <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToSupplier(3, 'vendor2')"><i class="pi pi-plus"></i> Add</button>
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);"> Supplier 3: MedTech Inc.</div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <div class="eval-team-badge">Maria Garcia <button onclick="removeFromSupplier(3, 'vendor3', 'maria')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;"></button></div>
                                <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToSupplier(3, 'vendor3')"><i class="pi pi-plus"></i> Add</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        function renderFinancialAssignmentSection() {
            const container = document.getElementById('financialAssignmentSection');
            
            if (currentAssignmentMode === 'lot') {
                container.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: var(--spacing-sm); display: flex; justify-content: space-between; align-items: center;">
                        <span>Step 4: Financial Evaluation <span style="font-size: 10px; color: var(--primary-400); font-weight: 400;"> By Lot</span></span>
                        <span style="font-size: 11px; color: var(--warning-500);"> Not Assigned</span>
                    </div>
                    <div style="margin-left: var(--spacing-md); margin-top: var(--spacing-md);">
                        <div style="margin-bottom: var(--spacing-md);">
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);"> Lot 1: Personal Protective Equipment</div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToLot(4, 'lot1')"><i class="pi pi-plus"></i> Add Evaluator</button>
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);"> Lot 2: Medical Consumables</div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToLot(4, 'lot2')"><i class="pi pi-plus"></i> Add Evaluator</button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // By Supplier mode
                container.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: var(--spacing-sm); display: flex; justify-content: space-between; align-items: center;">
                        <span>Step 4: Financial Evaluation <span style="font-size: 10px; color: var(--info-400); font-weight: 400;"> By Supplier</span></span>
                        <span style="font-size: 11px; color: var(--warning-500);"> Not Assigned</span>
                    </div>
                    <div style="margin-left: var(--spacing-md); margin-top: var(--spacing-md);">
                        <div style="margin-bottom: var(--spacing-md);">
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);"> Supplier 1: MedSupply Ltd.</div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToSupplier(4, 'vendor1')"><i class="pi pi-plus"></i> Add Evaluator</button>
                            </div>
                        </div>
                        <div style="margin-bottom: var(--spacing-md);">
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);"> Supplier 2: HealthCare Corp.</div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToSupplier(4, 'vendor2')"><i class="pi pi-plus"></i> Add Evaluator</button>
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);"> Supplier 3: MedTech Inc.</div>
                            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToSupplier(4, 'vendor3')"><i class="pi pi-plus"></i> Add Evaluator</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        function addEvaluatorToSupplier(stage, supplierId) {
            const supplierNames = {
                'vendor1': 'MedSupply Ltd.',
                'vendor2': 'HealthCare Corp.',
                'vendor3': 'MedTech Inc.'
            };
            showToast(` Opening evaluator selection for ${supplierNames[supplierId]} - Stage ${stage}`);
        }
        
        function removeFromSupplier(stage, supplierId, evaluatorId) {
            showToast(` Evaluator removed from supplier assignment`);
        }

        function closeEvaluationTeamModal() {
            document.getElementById('evaluationTeamModal').classList.remove('active');
        }

        function addEvaluatorToStage(stage) {
            showToast(` Opening evaluator selection for Stage ${stage}`);
            // In production, this would open a dropdown or search to select an evaluator
        }

        function removeFromStage(stage, evaluatorId) {
            showToast(` Evaluator removed from Stage ${stage}`);
        }

        function addEvaluatorToLot(stage, lotId) {
            const lotNames = {
                'lot1': 'Lot 1: PPE',
                'lot2': 'Lot 2: Medical Consumables'
            };
            showToast(` Opening evaluator selection for ${lotNames[lotId]} - Stage ${stage}`);
            // In production, this would open a dropdown or search to select an evaluator
        }

        function removeFromLot(stage, lotId, evaluatorId) {
            showToast(` Evaluator removed from lot assignment`);
        }

        function saveEvaluationTeam() {
            showToast(' Evaluation team assignments saved successfully');
            closeEvaluationTeamModal();
        }

        // ===== COLLAPSIBLE OVERVIEW SECTIONS =====
        function toggleOverviewSection(header) {
            const body = header.nextElementSibling;
            const icon = header.querySelector('.section-toggle-icon');
            
            if (body.classList.contains('collapsed')) {
                body.classList.remove('collapsed');
                icon.classList.remove('collapsed');
                icon.textContent = '';
            } else {
                body.classList.add('collapsed');
                icon.classList.add('collapsed');
                icon.textContent = '';
            }
        }

        // ===== ASSIGNMENT CONFIGURATION =====
        let currentAssignmentMode = 'lot'; // 'lot' or 'supplier'
        
        function openAssignmentConfigModal() {
            document.getElementById('assignmentConfigModal').classList.add('active');
        }

        function closeAssignmentConfigModal() {
            document.getElementById('assignmentConfigModal').classList.remove('active');
        }

        function saveAssignmentConfig() {
            const mode = document.querySelector('input[name="assignmentMode"]:checked').value;
            currentAssignmentMode = mode;
            showToast(` Assignment mode set to: Split by ${mode === 'lot' ? 'Lot' : 'Supplier'}`);
            
            // Update UI indicators
            updateAssignmentModeIndicators();
            closeAssignmentConfigModal();
        }
        
        function updateAssignmentModeIndicators() {
            // Update all mode indicators in the UI
            const modeIndicators = document.querySelectorAll('.assignment-mode-indicator');
            modeIndicators.forEach(indicator => {
                indicator.textContent = currentAssignmentMode === 'lot' ? 'Split by Lot' : 'Split by Supplier';
            });
        }

        // ===== ADVANCED CLARIFICATIONS =====
        function openClarificationsModalAdvanced() {
            document.getElementById('clarificationsAdvTenderTitle').textContent = currentTenderId + (currentTenderTitle ? ': ' + currentTenderTitle : '');
            document.getElementById('clarificationsAdvancedModal').classList.add('active');
        }

        function closeClarificationsAdvancedModal() {
            document.getElementById('clarificationsAdvancedModal').classList.remove('active');
        }

        function groupSelectedQuestions() {
            const selected = document.querySelectorAll('.question-checkbox:checked');
            if (selected.length < 2) {
                showToast(' Select at least 2 questions to group');
                return;
            }
            showToast(` ${selected.length} questions grouped successfully`);
        }

        function referToPreviousAnswer(questionId) {
            document.getElementById('referAnswerModal').classList.add('active');
        }

        function closeReferAnswerModal() {
            document.getElementById('referAnswerModal').classList.remove('active');
        }

        function applyReferredAnswer() {
            showToast(' Question linked to previous answer');
            closeReferAnswerModal();
        }

        function setQuestionVisibility(questionId, visibility) {
            showToast(` Question visibility set to: ${visibility}`);
        }

        function publishAnswer(questionId) {
            showToast(' Answer published successfully');
        }

        function saveDraftAnswer(questionId) {
            showToast(' Draft saved');
        }

        function requestEvalClarification(reqId) {
            showToast(' Clarification request initiated for ' + reqId);
        }

        function saveEvaluationDraft() {
            showToast(' Evaluation draft saved successfully');
        }

        function submitEvaluation() {
            showToast(' Evaluation submitted for review');
        }

        function showToast(message) {
            // Create toast element if it doesn't exist
            let toast = document.getElementById('evalToast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'evalToast';
                toast.style.cssText = `
                    position: fixed;
                    bottom: 30px;
                    right: 30px;
                    background: var(--success-500);
                    color: white;
                    padding: 15px 25px;
                    border-radius: var(--radius-md);
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    z-index: 10000;
                    font-size: 14px;
                    font-weight: 500;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                    max-width: 400px;
                `;
                document.body.appendChild(toast);
            }
            
            toast.textContent = message;
            toast.style.opacity = '1';
            
            setTimeout(() => {
                toast.style.opacity = '0';
            }, 3000);
        }

        // Amendment Modal
        function openAmendModal(tenderId, tenderTitle) {
            currentTenderId = tenderId;
            currentTenderTitle = tenderTitle;
            document.getElementById('amendTenderTitle').textContent = tenderId;
            document.getElementById('amendModal').classList.add('active');
            currentAmendmentStep = 1;
            updateAmendmentStepDisplay();
        }

        function closeAmendModal() {
            document.getElementById('amendModal').classList.remove('active');
            resetAmendmentForm();
        }

        function resetAmendmentForm() {
            currentAmendmentStep = 1;
            selectedCategories = [];
            highestTier = 1;
            
            document.querySelectorAll('.category-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('amendment-description').value = '';
            document.getElementById('amendment-justification').value = '';
            document.getElementById('impacts-mandatory').checked = false;
            document.getElementById('mandatory-impact-notice').style.display = 'none';
            
            updateAmendmentStepDisplay();
        }

        function updateAmendmentWorkflow() {
            selectedCategories = [];
            highestTier = 0;

            // Tier 1
            if (document.getElementById('cat-deadline-extension').checked) {
                selectedCategories.push({ name: 'Deadline Extension', tier: 1 });
                highestTier = Math.max(highestTier, 1);
            }
            if (document.getElementById('cat-clarification-extension').checked) {
                selectedCategories.push({ name: 'Clarification Extension', tier: 1 });
                highestTier = Math.max(highestTier, 1);
            }
            if (document.getElementById('cat-award-date').checked) {
                selectedCategories.push({ name: 'Expected Award Date', tier: 1 });
                highestTier = Math.max(highestTier, 1);
            }

            // Tier 2
            const tier2Cats = [
                { id: 'cat-deadline-shortened', name: 'Deadline Shortened' },
                { id: 'cat-prebid-minutes', name: 'Pre-bid Minutes' },
                { id: 'cat-document-revision', name: 'Document Revision' },
                { id: 'cat-scope-change', name: 'Scope/Quantity Change' },
                { id: 'cat-terms-conditions', name: 'Terms & Criteria' },
                { id: 'cat-price-adjustment', name: 'Price Adjustment' },
                { id: 'cat-error-correction', name: 'Error Correction' },
                { id: 'cat-other', name: 'Other' }
            ];

            tier2Cats.forEach(cat => {
                if (document.getElementById(cat.id).checked) {
                    selectedCategories.push({ name: cat.name, tier: 2 });
                    highestTier = Math.max(highestTier, 2);
                }
            });

            if (selectedCategories.length > 0) {
                document.getElementById('workflow-preview').style.display = 'block';
                displayWorkflow('workflow-display');
            } else {
                document.getElementById('workflow-preview').style.display = 'none';
            }
        }

        function displayWorkflow(containerId) {
            const container = document.getElementById(containerId);
            
            if (highestTier === 1) {
                container.innerHTML = `
                    <div class="workflow-steps">
                        <div class="workflow-step">
                            <div class="workflow-step-icon"></div>
                            <div class="workflow-step-label">Author Creates</div>
                        </div>
                        <div class="workflow-arrow"></div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon"></div>
                            <div class="workflow-step-label">Auto Posted</div>
                        </div>
                        <div class="workflow-arrow"></div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon"></div>
                            <div class="workflow-step-label">Suppliers Notified</div>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="workflow-steps">
                        <div class="workflow-step">
                            <div class="workflow-step-icon"></div>
                            <div class="workflow-step-label">Author Creates</div>
                        </div>
                        <div class="workflow-arrow"></div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon"></div>
                            <div class="workflow-step-label">TME Review</div>
                        </div>
                        <div class="workflow-arrow"></div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon"></div>
                            <div class="workflow-step-label">PR Approval</div>
                        </div>
                        <div class="workflow-arrow"></div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon"></div>
                            <div class="workflow-step-label">Posted</div>
                        </div>
                        <div class="workflow-arrow"></div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon"></div>
                            <div class="workflow-step-label">Notified</div>
                        </div>
                    </div>
                `;
            }
        }

        function nextAmendmentStep() {
            if (currentAmendmentStep === 1) {
                if (selectedCategories.length === 0) {
                    alert('Please select at least one amendment category');
                    return;
                }
            } else if (currentAmendmentStep === 2) {
                if (!document.getElementById('amendment-description').value.trim()) {
                    alert('Please provide an amendment description');
                    return;
                }
            }

            if (currentAmendmentStep < 3) {
                currentAmendmentStep++;
                
                if (currentAmendmentStep === 3) {
                    populateReviewStep();
                }
                
                updateAmendmentStepDisplay();
            } else {
                submitAmendment();
            }
        }

        function previousAmendmentStep() {
            if (currentAmendmentStep > 1) {
                currentAmendmentStep--;
                updateAmendmentStepDisplay();
            }
        }

        function updateAmendmentStepDisplay() {
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`amendment-step-${i}`).style.display = 'none';
                document.getElementById(`step${i}-number`).classList.remove('active', 'completed');
                document.getElementById(`step${i}-label`).classList.remove('active');
            }

            document.getElementById(`amendment-step-${currentAmendmentStep}`).style.display = 'block';
            document.getElementById(`step${currentAmendmentStep}-number`).classList.add('active');
            document.getElementById(`step${currentAmendmentStep}-label`).classList.add('active');

            for (let i = 1; i < currentAmendmentStep; i++) {
                document.getElementById(`step${i}-number`).classList.add('completed');
            }

            document.getElementById('amendment-back-btn').style.display = currentAmendmentStep > 1 ? 'inline-flex' : 'none';
            const nextBtn = document.getElementById('amendment-next-btn');
            nextBtn.innerHTML = currentAmendmentStep === 3 
                ? '<i class="pi pi-check"></i> Submit Amendment' 
                : 'Next <i class="pi pi-arrow-right"></i>';
        }

        function populateReviewStep() {
            const categoriesHtml = selectedCategories.map(cat => 
                `<span class="tier-badge tier-${cat.tier}" style="margin-right: 8px;">${cat.name}</span>`
            ).join('');
            document.getElementById('review-categories').innerHTML = categoriesHtml;

            const tierHtml = highestTier === 1 
                ? '<span class="tier-badge tier-1">Tier 1 - Author posts directly</span>'
                : '<span class="tier-badge tier-2">Tier 2 - Requires TME & PR review</span>';
            document.getElementById('review-tier').innerHTML = tierHtml;

            document.getElementById('review-description').textContent = 
                document.getElementById('amendment-description').value;

            const impactsMandatory = document.getElementById('impacts-mandatory').checked;
            document.getElementById('review-mandatory').innerHTML = impactsMandatory
                ? '<span style="color: var(--danger-500); font-weight: 600;"> Yes - Will invalidate existing bids</span>'
                : '<span style="color: var(--success-500);"> No - Existing bids remain valid</span>';

            displayWorkflow('final-workflow-display');
        }

        function submitAmendment() {
            alert(`Amendment submitted successfully for ${currentTenderId}!\n\n` +
                  `The amendment will follow the ${highestTier === 1 ? 'Tier 1 workflow (direct posting)' : 'Tier 2 workflow (TME & PR review)'}.`);
            closeAmendModal();
        }

        function toggleMandatoryImpact() {
            const checked = document.getElementById('impacts-mandatory').checked;
            document.getElementById('mandatory-impact-notice').style.display = checked ? 'block' : 'none';
        }

        // Cancel Modal
        function openCancelModal(tenderId, tenderTitle) {
            currentTenderId = tenderId;
            currentTenderTitle = tenderTitle;
            document.getElementById('cancelTenderTitle').textContent = tenderId;
            document.getElementById('cancelModal').classList.add('active');
        }

        function closeCancelModal() {
            document.getElementById('cancelModal').classList.remove('active');
            resetCancelForm();
        }

        function resetCancelForm() {
            document.getElementById('cancel-reason').value = '';
            document.getElementById('cancel-internal-explanation').value = '';
            document.getElementById('cancel-public-justification').value = '';
            document.getElementById('confirm-cancellation').checked = false;
            document.getElementById('confirm-cancel-btn').disabled = true;
        }

        function submitCancellation() {
            const reason = document.getElementById('cancel-reason').value;
            const internalExp = document.getElementById('cancel-internal-explanation').value;
            const publicJust = document.getElementById('cancel-public-justification').value;

            if (!reason || !internalExp || !publicJust) {
                alert('Please fill in all required fields');
                return;
            }

            alert(`Tender ${currentTenderId} has been cancelled.\n\n` +
                  `- All suppliers have been notified\n` +
                  `- Bids have been archived\n` +
                  `- Requisition lines released in ERP\n` +
                  `- Cancellation logged in audit trail`);
            
            closeCancelModal();
        }

        // Enable cancel button
        document.getElementById('confirm-cancellation').addEventListener('change', function() {
            const reason = document.getElementById('cancel-reason').value;
            const internalExp = document.getElementById('cancel-internal-explanation').value;
            const publicJust = document.getElementById('cancel-public-justification').value;
            
            document.getElementById('confirm-cancel-btn').disabled = 
                !(this.checked && reason && internalExp && publicJust);
        });

        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // Close sidebar on overlay click
        document.getElementById('tender-preview-sidebar').addEventListener('click', function(e) {
            if (e.target === this) {
                closeTenderPreview();
            }
        });
    </script>
</body>
</html>


