<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNOPS Procurement - Tender Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/primeicons@6.0.1/primeicons.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* UNOPS Preset Primary Colors */
            --primary-50: #e6f7ff;
            --primary-100: #bae7ff;
            --primary-200: #7dd3fc;
            --primary-300: #38bdf8;
            --primary-400: #0ea5e9;
            --primary-500: #0092D1;
            --primary-600: #0284c7;
            --primary-700: #0369a1;
            --surface-0: #ffffff;
            --surface-50: #f5f8fb;
            --surface-100: #ebf1f8;
            --surface-200: #dde8f2;
            --surface-300: #cfdfec;
            --surface-600: #95a7ba;
            --surface-800: #596170;
            --surface-900: #3b3e4a;
            --success-500: #4c9f38;
            --success-50: #d2e7cd;
            --info-400: #0092d1;
            --info-50: #bfe4f4;
            --warning-500: #e85c0e;
            --warning-50: #f9d6c3;
            --danger-500: #da291c;
            --danger-50: #f6cac6;
            --text-primary: var(--surface-900);
            --text-secondary: var(--surface-800);
            --text-muted: var(--surface-600);
            --spacing-xs: 6px;
            --spacing-sm: 12px;
            --spacing-md: 20px;
            --spacing-lg: 28px;
            --spacing-xl: 36px;
            --spacing-2xl: 48px;
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Lato', 'Noto Sans', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--surface-50);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--surface-0);
            border-bottom: 1px solid var(--surface-200);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md) var(--spacing-xl);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .logo {
            font-weight: 700;
            font-size: 20px;
            letter-spacing: 0.12em;
            color: var(--primary-400);
        }

        .portal-badge {
            background: var(--primary-400);
            color: white;
            font-size: 12px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .user-info {
            text-align: right;
        }

        .user-company {
            font-size: 12px;
            color: var(--text-muted);
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary-100);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--primary-600);
            cursor: pointer;
        }

        /* Layout */
        .app-container {
            display: flex;
            min-height: calc(100vh - 65px);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: #0192D1;
            color: white;
            display: flex;
            flex-direction: column;
            border-right: none;
            transition: width 0.3s ease;
            position: relative;
        }

        .sidebar.collapsed {
            width: 60px;
        }

        .sidebar-toggle {
            position: absolute;
            top: 10px;
            right: -15px;
            width: 30px;
            height: 30px;
            background: var(--primary-400);
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            color: white;
            font-size: 14px;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed .sidebar-toggle {
            transform: rotate(180deg);
        }

        .sidebar.collapsed .menu-section-title,
        .sidebar.collapsed .menu-item span:not(.menu-icon) {
            display: none;
        }

        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
        }

        .menu-section {
            margin-bottom: var(--spacing-lg);
        }

        .menu-section-title {
            padding: 0 20px 15px 20px;
            font-size: 20px;
            font-weight: bold;
            text-transform: none;
            letter-spacing: 0;
            color: white;
            font-family: 'Lato', sans-serif;
            margin-bottom: var(--spacing-sm);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            font-size: 16px;
            font-weight: normal;
            font-family: 'Lato', sans-serif;
            transition: background-color 0.2s ease;
            border-left: none;
            cursor: pointer;
            margin: 0 10px;
            border-radius: 5px;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .menu-item.active {
            background-color: #006599;
            color: white;
        }

        .menu-icon {
            font-size: 18px;
            width: 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .menu-badge {
            margin-left: auto;
            padding: 2px 8px;
            background: var(--danger-500);
            color: white;
            font-size: 11px;
            font-weight: 600;
            border-radius: 999px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: var(--spacing-xl);
            overflow-y: auto;
        }

        .page-header {
            margin-bottom: var(--spacing-xl);
        }

        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Pending Tasks Section */
        .pending-tasks-section {
            margin-bottom: var(--spacing-xl);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .section-title i {
            color: var(--primary-500);
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }

        .task-item {
            background: var(--surface-0);
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-md);
            padding: var(--spacing-md) var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .task-item:hover {
            border-color: var(--primary-400);
            box-shadow: var(--shadow-sm);
            transform: translateY(-2px);
        }

        .task-badge {
            background: var(--primary-500);
            color: white;
            font-size: 16px;
            font-weight: 700;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .task-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            flex: 1;
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .task-icon-inline {
            font-size: 16px;
            color: var(--primary-500);
        }

        /* Filter Bar */
        .filter-bar {
            background: white;
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--surface-200);
            margin-bottom: 24px;
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: var(--shadow-card);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-muted);
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-sm);
            font-size: 13px;
            background: white;
            cursor: pointer;
            min-width: 150px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-400);
        }

        /* Tender Cards */
        .tender-grid {
            display: grid;
            gap: 20px;
        }

        .tender-card {
            background: white;
            border-radius: var(--radius-lg);
            border: 1px solid var(--surface-200);
            padding: 24px;
            transition: all 0.2s;
            cursor: pointer;
            box-shadow: var(--shadow-card);
        }

        .tender-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-400);
        }

        .tender-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .tender-title-section {
            flex: 1;
        }

        .tender-id {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
            margin-bottom: 4px;
        }

        .tender-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.active {
            background: var(--info-50);
            color: var(--info-400);
        }

        .status-badge.draft {
            background: var(--surface-200);
            color: var(--text-secondary);
        }

        .status-badge.review {
            background: var(--warning-50);
            color: var(--warning-500);
        }

        .status-badge.closed {
            background: var(--success-50);
            color: var(--success-500);
        }

        .tender-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--surface-200);
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .meta-label {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .meta-value {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .tender-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Buttons */
        .btn {
            border-radius: var(--radius-sm);
            border: 1px solid transparent;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-400);
            color: #fff;
            border-color: var(--primary-400);
        }

        .btn-primary:hover {
            background: var(--primary-500);
            border-color: var(--primary-500);
        }

        .btn-secondary {
            background: transparent;
            border-color: var(--primary-400);
            color: var(--primary-400);
        }

        .btn-secondary:hover {
            background: var(--primary-50);
        }

        .btn-ghost {
            background: transparent;
            border-color: var(--surface-200);
            color: var(--text-secondary);
        }

        .btn-ghost:hover {
            background: var(--surface-100);
            border-color: var(--surface-300);
        }

        .btn-danger {
            background: var(--danger-500);
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-success {
            background: var(--success-500);
            color: white;
        }

        .btn-success:hover {
            background: #3d7f2e;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
        }

        /* Sidebar Panel */
        .sidebar-panel {
            position: fixed;
            right: 0;
            top: 0;
            width: 600px;
            height: 100vh;
            background: var(--surface-0);
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 110;
            overflow-y: auto;
        }

        .sidebar-panel.open {
            transform: translateX(0);
        }

        .sidebar-panel-header {
            padding: var(--spacing-lg);
            background: var(--primary-600);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .sidebar-panel-title {
            font-size: 18px;
            font-weight: 600;
        }

        .sidebar-panel-body {
            padding: var(--spacing-xl);
        }

        .collapsible-section-compact {
            border-bottom: 1px solid var(--surface-200);
            margin-bottom: var(--spacing-sm);
        }

        .collapsible-header-compact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
        }

        .collapsible-header-compact:hover {
            background: var(--surface-50);
        }

        .collapsible-content-compact {
            padding: 0 var(--spacing-md) var(--spacing-md);
            display: none;
        }

        .collapsible-icon {
            transition: transform 0.3s;
            font-size: 12px;
        }

        .collapsible-icon.rotated {
            transform: rotate(-90deg);
        }

        .info-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: var(--spacing-md);
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--surface-100);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .info-value {
            color: var(--text-primary);
            font-size: 14px;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--surface-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-muted);
            padding: 4px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .modal-close:hover {
            background: var(--surface-100);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--surface-200);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 32px;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--surface-300);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .step-number.active {
            background: var(--primary-400);
        }

        .step-number.completed {
            background: var(--success-500);
        }

        .step-label {
            font-size: 14px;
            color: var(--text-muted);
        }

        .step-label.active {
            color: var(--text-primary);
            font-weight: 600;
        }

        .step-connector {
            width: 40px;
            height: 2px;
            background: var(--surface-300);
        }

        /* Amendment Steps */
        .amendment-step {
            display: none;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-label.required::after {
            content: ' *';
            color: var(--danger-500);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-400);
            box-shadow: 0 0 0 3px var(--primary-50);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .help-text {
            display: block;
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Alert */
        .alert {
            padding: 16px;
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            align-items: start;
        }

        .alert-info {
            background: var(--info-50);
            border-left: 4px solid var(--info-400);
            color: var(--text-secondary);
        }

        .alert-warning {
            background: var(--warning-50);
            border-left: 4px solid var(--warning-500);
            color: #92400e;
        }

        .alert-danger {
            background: var(--danger-50);
            border-left: 4px solid var(--danger-500);
            color: #991b1b;
        }

        .alert-success {
            background: var(--success-50);
            border-left: 4px solid var(--success-500);
            color: #166534;
        }

        /* Category Grid */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .category-option {
            position: relative;
        }

        .category-checkbox {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .category-label {
            display: flex;
            flex-direction: column;
            padding: 12px;
            border: 2px solid var(--surface-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .category-checkbox:checked + .category-label {
            border-color: var(--primary-400);
            background: var(--primary-50);
        }

        .category-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tier-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .tier-badge.tier-1 {
            background: var(--success-50);
            color: #15803d;
        }

        .tier-badge.tier-2 {
            background: var(--warning-50);
            color: #92400e;
        }

        .category-description {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Workflow Preview */
        .workflow-preview {
            background: var(--surface-50);
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 20px;
        }

        .workflow-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .workflow-steps {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .workflow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .workflow-step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-400);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .workflow-step-label {
            font-size: 11px;
            color: var(--text-muted);
            text-align: center;
            max-width: 100px;
        }

        .workflow-arrow {
            font-size: 20px;
            color: var(--text-muted);
        }

        /* Deadline Review */
        .deadline-review {
            background: var(--warning-50);
            border: 2px solid var(--warning-500);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 20px;
        }

        .deadline-review-title {
            font-size: 16px;
            font-weight: 600;
            color: #92400e;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .deadline-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .info-box {
            padding: var(--spacing-md);
            background: var(--info-50);
            border-left: 4px solid var(--info-400);
            border-radius: var(--radius-sm);
            margin-bottom: var(--spacing-lg);
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Tender Details View */
        .view-section {
            display: none;
        }

        .view-section.active {
            display: block;
        }

        .tender-info-banner {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-400) 100%);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            color: white;
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-card);
        }

        .tender-banner-ref {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: var(--spacing-sm);
        }

        .tender-banner-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: var(--spacing-md);
        }

        .tender-banner-meta {
            display: flex;
            gap: var(--spacing-xl);
            flex-wrap: wrap;
        }

        .banner-meta-item {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .banner-meta-label {
            font-size: 12px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .banner-meta-value {
            font-size: 16px;
            font-weight: 600;
        }

        .overview-section {
            background: var(--surface-0);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-card);
            border: 1px solid var(--surface-200);
            margin-bottom: var(--spacing-lg);
        }

        .overview-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .overview-section-icon {
            font-size: 24px;
        }

        .collapsible-item-card {
            background: var(--surface-50);
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            overflow: hidden;
            transition: all 0.3s;
        }

        .collapsible-item-card:hover {
            box-shadow: var(--shadow-sm);
        }

        .collapsible-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            cursor: pointer;
            background: var(--surface-50);
            transition: all 0.2s;
            user-select: none;
        }

        .collapsible-item-header:hover {
            background: var(--surface-100);
            transform: translateX(2px);
        }

        .collapsible-arrow {
            font-size: 14px;
            color: var(--primary-400);
            transition: transform 0.3s ease;
            margin-left: var(--spacing-md);
            font-weight: bold;
            display: inline-block;
        }

        .collapsible-arrow.rotated {
            transform: rotate(180deg);
            color: var(--primary-600);
        }

        .collapsible-item-content {
            max-height: 0;
            overflow: hidden;
            padding: 0 var(--spacing-lg);
            background: var(--surface-0);
            transition: max-height 0.4s ease, padding 0.4s ease;
        }

        .collapsible-item-content.expanded {
            max-height: 1000px;
            padding: 0 var(--spacing-lg) var(--spacing-lg);
        }

        .spec-detail-row {
            display: flex;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--surface-100);
        }

        .spec-detail-row:last-child {
            border-bottom: none;
        }

        .spec-detail-label {
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 140px;
            font-size: 13px;
        }

        .spec-detail-value {
            color: var(--text-primary);
            flex: 1;
            font-size: 13px;
            line-height: 1.5;
        }

        .deadline-warning {
            background: var(--warning-50);
            border-left: 4px solid var(--warning-500);
            border-radius: var(--radius-sm);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .deadline-icon {
            font-size: 24px;
        }

        .deadline-text {
            flex: 1;
        }

        .tender-overview-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .overview-main {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .overview-sidebar-section {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .timeline {
            position: relative;
            padding-left: var(--spacing-xl);
        }

        .timeline-item {
            position: relative;
            padding-bottom: var(--spacing-lg);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-400);
            border: 3px solid var(--surface-0);
            box-shadow: 0 0 0 2px var(--primary-400);
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: -19px;
            top: 20px;
            width: 2px;
            height: calc(100% - 8px);
            background: var(--surface-200);
        }

        .timeline-item:last-child::after {
            display: none;
        }

        .timeline-date {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .timeline-content {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Evaluation Styles */
        .vendor-eval-tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-muted);
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .vendor-eval-tab.active {
            color: var(--primary-400);
            border-bottom-color: var(--primary-400);
        }

        .vendor-eval-tab:hover {
            color: var(--primary-400);
            background: var(--surface-50);
        }

        .eval-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid var(--surface-200);
            background: white;
        }

        .eval-table th {
            background: var(--surface-100);
            color: var(--text-primary);
            padding: 14px 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-right: 1px solid var(--surface-200);
            border-bottom: 2px solid var(--surface-300);
        }

        .eval-table td {
            padding: 14px 12px;
            border-bottom: 1px solid var(--surface-100);
            border-right: 1px solid var(--surface-100);
            vertical-align: top;
            font-size: 13px;
            background: white;
        }

        .eval-table tbody tr:hover {
            background: var(--surface-50);
        }

        .system-eval-column {
            background: #f0f9ff !important;
        }

        .manual-eval-column {
            background: #fefce8 !important;
        }

        .view-toggle {
            display: flex;
            gap: 0;
            background: var(--surface-100);
            border-radius: var(--radius-md);
            padding: 4px;
            width: fit-content;
        }

        .view-toggle-btn {
            padding: 8px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
        }

        .view-toggle-btn.active {
            background: white;
            color: var(--primary-400);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .lot-section-header {
            background: var(--primary-50);
            padding: var(--spacing-md);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--primary-400);
            font-weight: 600;
            color: var(--primary-600);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .lot-section-header:hover {
            background: var(--primary-100);
        }

        .lot-info {
            display: flex;
            gap: var(--spacing-xl);
            font-size: 13px;
        }

        .lot-tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-muted);
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .lot-tab.active {
            color: var(--primary-400);
            border-bottom-color: var(--primary-400);
        }

        .lot-tab:hover {
            color: var(--primary-400);
            background: var(--surface-50);
        }

        .lot-summary-card {
            background: white;
            border: 1px solid var(--surface-200);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .lot-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-md);
        }

        .lot-summary-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .lot-summary-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .lot-summary-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .unspsc-collapsible {
            margin-bottom: var(--spacing-md);
        }

        .unspsc-header {
            background: var(--surface-50);
            padding: var(--spacing-md);
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--surface-200);
            transition: all 0.2s ease;
        }

        .unspsc-header:hover {
            background: var(--surface-100);
        }

        .unspsc-content {
            margin-top: var(--spacing-sm);
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .unspsc-content.collapsed {
            display: none;
        }

        .eval-team-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            background: var(--primary-50);
            color: var(--primary-600);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            border: 1px solid var(--primary-200);
        }

        .req-id-badge {
            font-weight: 700;
            color: var(--primary-400);
            font-size: 14px;
        }

        .eval-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
        }

        .eval-status-badge.pass {
            background: var(--success-50);
            color: var(--success-500);
        }

        .eval-status-badge.fail {
            background: var(--danger-50);
            color: var(--danger-500);
        }

        .eval-status-badge.clarification {
            background: var(--warning-50);
            color: var(--warning-500);
        }

        .eval-status-badge.pending {
            background: var(--info-50);
            color: var(--info-400);
        }

        .eval-status-badge.not_evaluated {
            background: var(--surface-200);
            color: var(--text-muted);
        }

        .eval-select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--surface-200);
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 600;
            font-family: inherit;
        }

        .eval-select.pass {
            border-color: var(--success-500);
            color: var(--success-500);
        }

        .eval-select.fail {
            border-color: var(--danger-500);
            color: var(--danger-500);
        }

        .eval-select.clarification {
            border-color: var(--warning-500);
            color: var(--warning-500);
        }

        .eval-comment-field {
            width: 100%;
            padding: 8px;
            border: 2px solid var(--surface-200);
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }

        .eval-comment-field:focus {
            outline: none;
            border-color: var(--primary-400);
        }

        .doc-badge {
            display: inline-block;
            background: var(--primary-400);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .doc-list {
            max-height: 150px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .doc-item {
            margin-bottom: 6px;
            padding: 8px;
            background: var(--surface-50);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--primary-400);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
        }

        .doc-item:hover {
            background: var(--info-50);
            border-left-color: var(--primary-600);
            transform: translateX(2px);
        }

        .doc-name {
            font-weight: 600;
            color: var(--primary-400);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .doc-meta {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .deviation-badge {
            background: var(--warning-50);
            border-left: 3px solid var(--warning-500);
            padding: 6px 10px;
            margin-top: 8px;
            border-radius: var(--radius-sm);
            font-size: 12px;
        }

        .mandatory-flag {
            display: inline-block;
            background: var(--danger-500);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 5px;
        }

        .optional-flag {
            display: inline-block;
            background: var(--info-400);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 5px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .tender-overview-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 60px;
            }
            .menu-section-title {
                display: none;
            }
            .menu-item span:not(.menu-icon) {
                display: none;
            }
            .sidebar:hover {
                width: 280px;
            }
            .sidebar:hover .menu-section-title,
            .sidebar:hover .menu-item span:not(.menu-icon) {
                display: block;
            }
            .sidebar-panel {
                width: 100%;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .category-grid {
                grid-template-columns: 1fr;
            }
            .tender-banner-meta {
                flex-direction: column;
                gap: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="logo-container">
                <div class="logo">UNOPS</div>
                <span class="portal-badge">Procurement</span>
            </div>
            <div class="user-menu">
                <div class="user-info">
                    <div class="user-company">UNOPS Internal</div>
                    <div class="user-name">Jane Doe</div>
                </div>
                <div class="user-avatar">JD</div>
            </div>
        </div>
    </header>

    <!-- App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="mainSidebar">
            <div class="sidebar-toggle" onclick="toggleSidebar()">
                <i class="pi pi-chevron-left"></i>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-section-title">Main</div>
                    <a class="menu-item active" onclick="showDashboard()">
                        <span class="menu-icon">üìä</span>
                        <span>Dashboard</span>
                    </a>
                    <a class="menu-item">
                        <span class="menu-icon">üìã</span>
                        <span>My Tenders</span>
                        <span class="menu-badge">8</span>
                    </a>
                    <a class="menu-item">
                        <span class="menu-icon">üîç</span>
                        <span>Create Tender</span>
                    </a>
                </div>

                <div class="menu-section">
                    <div class="menu-section-title">Management</div>
                    <a class="menu-item">
                        <span class="menu-icon">üìÅ</span>
                        <span>Reports</span>
                    </a>
                    <a class="menu-item">
                        <span class="menu-icon">üìà</span>
                        <span>Analytics</span>
                    </a>
                    <a class="menu-item">
                        <span class="menu-icon">‚öôÔ∏è</span>
                        <span>Settings</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard View -->
            <div class="view-section active" id="view-dashboard">
                <!-- Page Header -->
                <div class="page-header">
                    <h1 class="page-title">Tender Dashboard</h1>
                    <p class="page-subtitle">Manage and monitor all your procurement tenders</p>
                </div>

            <!-- My Pending Tasks -->
            <div class="pending-tasks-section">
                <h2 class="section-title">
                    <i class="pi pi-list-check"></i> My Pending Tasks
                </h2>
                <div class="tasks-grid">
                    <div class="task-item" onclick="filterTenders('pre-clearance')">
                        <div class="task-badge">2</div>
                        <div class="task-content">
                            <i class="pi pi-eye task-icon-inline"></i>
                            <span>Pre-clearance Review</span>
                        </div>
                    </div>
                    <div class="task-item" onclick="filterTenders('approval')">
                        <div class="task-badge">3</div>
                        <div class="task-content">
                            <i class="pi pi-check-circle task-icon-inline"></i>
                            <span>Pending Approval</span>
                        </div>
                    </div>
                    <div class="task-item" onclick="filterTenders('clarifications')">
                        <div class="task-badge">8</div>
                        <div class="task-content">
                            <i class="pi pi-comment task-icon-inline"></i>
                            <span>Clarifications to Answer</span>
                        </div>
                    </div>
                    <div class="task-item" onclick="filterTenders('evaluation')">
                        <div class="task-badge">2</div>
                        <div class="task-content">
                            <i class="pi pi-chart-bar task-icon-inline"></i>
                            <span>Evaluations in Progress</span>
                        </div>
                    </div>
                    <div class="task-item" onclick="filterTenders('bid-opening')">
                        <div class="task-badge">1</div>
                        <div class="task-content">
                            <i class="pi pi-envelope-open task-icon-inline"></i>
                            <span>Bid Opening Required</span>
                        </div>
                    </div>
                    <div class="task-item" onclick="filterTenders('signing')">
                        <div class="task-badge">1</div>
                        <div class="task-content">
                            <i class="pi pi-file-edit task-icon-inline"></i>
                            <span>Reports to Sign</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="filter-group">
                    <span class="filter-label">Status:</span>
                    <select class="filter-select" onchange="filterTenders()">
                        <option value="all">All Statuses</option>
                        <option value="draft">Draft</option>
                        <option value="pre-clearance">Pre-Clearance</option>
                        <option value="approval">Pending Approval</option>
                        <option value="tme-signed">TME Signed</option>
                        <option value="active">Posted/Active</option>
                        <option value="closed">Closed</option>
                        <option value="bid-opening">Bid Opening</option>
                        <option value="evaluation">Evaluation</option>
                        <option value="award">Award Recommendation</option>
                        <option value="finalized">Finalized</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="filter-group">
                    <span class="filter-label">Sort by:</span>
                    <select class="filter-select">
                        <option value="recent">Most Recent</option>
                        <option value="deadline">Deadline</option>
                        <option value="value">Value</option>
                    </select>
                </div>
                <div style="flex: 1;"></div>
                <button class="btn btn-primary">
                    <i class="pi pi-plus"></i>
                    Create New Tender
                </button>
            </div>

            <!-- Tender Grid -->
            <div class="tender-grid" id="tenderGrid">
                <!-- Tender Card 1 -->
                <div class="tender-card" data-status="active">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">RFQ/2024/001</div>
                            <div class="tender-title">Supply of Medical Equipment</div>
                        </div>
                        <span class="status-badge active">Active</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Posted Date</span>
                            <span class="meta-value">15 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Deadline</span>
                            <span class="meta-value">15 Dec 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Est. Value</span>
                            <span class="meta-value">$250,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Bids Received</span>
                            <span class="meta-value">3 / 12 interested</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'RFQ/2024/001', title: 'Supply of Medical Equipment', status: 'Posted', statusKey: 'active'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="viewTenderPreview('RFQ/2024/001', 'Supply of Medical Equipment')">
                            <i class="pi pi-file-o"></i> Quick Preview
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="openAmendModal('RFQ/2024/001', 'Supply of Medical Equipment')">
                            <i class="pi pi-pencil"></i> Amend
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="openCancelModal('RFQ/2024/001', 'Supply of Medical Equipment')">
                            <i class="pi pi-times-circle"></i> Cancel
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="openClarificationsModal('RFQ/2024/001', 'Supply of Medical Equipment')">
                            <i class="pi pi-comment"></i> Clarifications (5)
                        </button>
                    </div>
                </div>

                <!-- Tender Card 2 -->
                <div class="tender-card" data-status="active">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">ITB/2024/045</div>
                            <div class="tender-title">Construction of Office Building</div>
                        </div>
                        <span class="status-badge active">Active</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Posted Date</span>
                            <span class="meta-value">10 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Deadline</span>
                            <span class="meta-value">10 Jan 2025</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Est. Value</span>
                            <span class="meta-value">$1,500,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Bids Received</span>
                            <span class="meta-value">7 / 25 interested</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'ITB/2024/045', title: 'Construction of Office Building', status: 'Posted', statusKey: 'active'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="viewTenderPreview('ITB/2024/045', 'Construction of Office Building')">
                            <i class="pi pi-file-o"></i> Quick Preview
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="openAmendModal('ITB/2024/045', 'Construction of Office Building')">
                            <i class="pi pi-pencil"></i> Amend
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="openCancelModal('ITB/2024/045', 'Construction of Office Building')">
                            <i class="pi pi-times-circle"></i> Cancel
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="openClarificationsModal('ITB/2024/045', 'Construction of Office Building')">
                            <i class="pi pi-comment"></i> Clarifications (12)
                        </button>
                    </div>
                </div>

                <!-- Tender Card 3 -->
                <div class="tender-card" data-status="approval">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">RFP/2024/078</div>
                            <div class="tender-title">IT Infrastructure Services</div>
                        </div>
                        <span class="status-badge review">Pending Approval</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Submitted</span>
                            <span class="meta-value">28 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Reviewer</span>
                            <span class="meta-value">PR Team</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Est. Value</span>
                            <span class="meta-value">$500,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Status</span>
                            <span class="meta-value">Pending Approval</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'RFP/2024/078', title: 'IT Infrastructure Services', status: 'Pending Approval', statusKey: 'approval'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="viewTenderPreview('RFP/2024/078', 'IT Infrastructure Services')">
                            <i class="pi pi-file-o"></i> Quick Preview
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="pi pi-pencil"></i> Edit Draft
                        </button>
                    </div>
                </div>

                <!-- Tender Card 4 -->
                <div class="tender-card" data-status="active">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">RFQ/2024/102</div>
                            <div class="tender-title">Vehicle Fleet Procurement</div>
                        </div>
                        <span class="status-badge active">Active</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Posted Date</span>
                            <span class="meta-value">20 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Deadline</span>
                            <span class="meta-value">20 Dec 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Est. Value</span>
                            <span class="meta-value">$850,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Bids Received</span>
                            <span class="meta-value">1 / 8 interested</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'RFQ/2024/102', title: 'Vehicle Fleet Procurement', status: 'Posted', statusKey: 'active'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="viewTenderPreview('RFQ/2024/102', 'Vehicle Fleet Procurement')">
                            <i class="pi pi-file-o"></i> Quick Preview
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="openAmendModal('RFQ/2024/102', 'Vehicle Fleet Procurement')">
                            <i class="pi pi-pencil"></i> Amend
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="openCancelModal('RFQ/2024/102', 'Vehicle Fleet Procurement')">
                            <i class="pi pi-times-circle"></i> Cancel
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="openClarificationsModal('RFQ/2024/102', 'Vehicle Fleet Procurement')">
                            <i class="pi pi-comment"></i> Clarifications (2)
                        </button>
                    </div>
                </div>

                <!-- Tender Card 5 -->
                <div class="tender-card" data-status="draft">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">DRAFT-2024-156</div>
                            <div class="tender-title">Consulting Services - HR Management</div>
                        </div>
                        <span class="status-badge draft">Draft</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Created</span>
                            <span class="meta-value">25 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Last Modified</span>
                            <span class="meta-value">28 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Est. Value</span>
                            <span class="meta-value">$120,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Completion</span>
                            <span class="meta-value">75%</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm">
                            <i class="pi pi-pencil"></i> Continue Editing
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="pi pi-copy"></i> Duplicate
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="pi pi-trash"></i> Delete
                        </button>
                    </div>
                </div>

                <!-- Tender Card 6 - Pre-Clearance -->
                <div class="tender-card" data-status="pre-clearance">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">ITB/2024/089</div>
                            <div class="tender-title">Laboratory Equipment Procurement</div>
                        </div>
                        <span class="status-badge" style="background: var(--info-50); color: var(--info-400);">Pre-Clearance</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Submitted</span>
                            <span class="meta-value">29 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Reviewer</span>
                            <span class="meta-value">TME Team</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Est. Value</span>
                            <span class="meta-value">$350,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Status</span>
                            <span class="meta-value">Awaiting Pre-Clearance</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'ITB/2024/089', title: 'Laboratory Equipment Procurement', status: 'Pre-Clearance', statusKey: 'pre-clearance'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="viewTenderPreview('ITB/2024/089', 'Laboratory Equipment Procurement')">
                            <i class="pi pi-file-o"></i> Quick Preview
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="pi pi-history"></i> View Comments
                        </button>
                    </div>
                </div>

                <!-- Tender Card 7 - TME Signed -->
                <div class="tender-card" data-status="tme-signed">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">RFQ/2024/115</div>
                            <div class="tender-title">Furniture and Office Supplies</div>
                        </div>
                        <span class="status-badge" style="background: var(--success-50); color: var(--success-500);">TME Signed</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">TME Signed</span>
                            <span class="meta-value">27 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Expected Publish</span>
                            <span class="meta-value">2 Dec 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Est. Value</span>
                            <span class="meta-value">$180,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Status</span>
                            <span class="meta-value">Ready to Publish</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'RFQ/2024/115', title: 'Furniture and Office Supplies', status: 'TME Signed', statusKey: 'tme-signed'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-success btn-sm">
                            <i class="pi pi-send"></i> Publish Tender
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="viewTenderPreview('RFQ/2024/115', 'Furniture and Office Supplies')">
                            <i class="pi pi-file-o"></i> Preview
                        </button>
                    </div>
                </div>

                <!-- Tender Card 8 - Closed -->
                <div class="tender-card" data-status="closed">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">ITB/2024/034</div>
                            <div class="tender-title">Water Infrastructure Development</div>
                        </div>
                        <span class="status-badge closed">Closed</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Closed Date</span>
                            <span class="meta-value">25 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Deadline Was</span>
                            <span class="meta-value">25 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Est. Value</span>
                            <span class="meta-value">$2,500,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Bids Received</span>
                            <span class="meta-value">9 bids</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'ITB/2024/034', title: 'Water Infrastructure Development', status: 'Closed', statusKey: 'closed'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-success btn-sm">
                            <i class="pi pi-envelope-open"></i> Start Bid Opening
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="pi pi-users"></i> View Bidders (9)
                        </button>
                    </div>
                </div>

                <!-- Tender Card 9 - Bid Opening -->
                <div class="tender-card" data-status="bid-opening">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">RFP/2024/067</div>
                            <div class="tender-title">Security Services Contract</div>
                        </div>
                        <span class="status-badge" style="background: #fff3cd; color: #856404;">Bid Opening</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Closed Date</span>
                            <span class="meta-value">20 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Opening Started</span>
                            <span class="meta-value">22 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Est. Value</span>
                            <span class="meta-value">$650,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Status</span>
                            <span class="meta-value">Technical Opening</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'RFP/2024/067', title: 'Security Services Contract', status: 'Bid Opening', statusKey: 'bid-opening'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-success btn-sm">
                            <i class="pi pi-folder-open"></i> Continue Opening
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="pi pi-file-pdf"></i> Opening Report
                        </button>
                    </div>
                </div>

                <!-- Tender Card 10 - Evaluation -->
                <div class="tender-card" data-status="evaluation">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">ITB/2024/023</div>
                            <div class="tender-title">Medical Supplies - Emergency Response</div>
                        </div>
                        <span class="status-badge" style="background: #e3f2fd; color: #1565c0;">Evaluation</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Bids Opened</span>
                            <span class="meta-value">15 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Evaluation Stage</span>
                            <span class="meta-value">In Progress (Step 1 of 4)</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Est. Value</span>
                            <span class="meta-value">$420,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Your Role</span>
                            <span class="meta-value">Evaluator | 3 of 6 evaluated</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-success btn-sm" onclick="showEvaluation('ITB/2024/023', 'Medical Supplies - Emergency Response', 'evaluator')">
                            <i class="pi pi-chart-bar"></i> Continue Evaluation
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'ITB/2024/023', title: 'Medical Supplies - Emergency Response', status: 'Evaluation', statusKey: 'evaluation'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="showEvaluation('ITB/2024/023', 'Medical Supplies - Emergency Response', 'comparison')">
                            <i class="pi pi-table"></i> Comparison View
                        </button>
                    </div>
                </div>

                <!-- Tender Card 11 - Award Recommendation -->
                <div class="tender-card" data-status="award">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">RFQ/2024/055</div>
                            <div class="tender-title">IT Equipment and Software Licenses</div>
                        </div>
                        <span class="status-badge" style="background: #f3e5f5; color: #6a1b9a;">Award Recommendation</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Evaluation Complete</span>
                            <span class="meta-value">18 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Recommended Supplier</span>
                            <span class="meta-value">TechCorp Ltd.</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Award Value</span>
                            <span class="meta-value">$285,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Status</span>
                            <span class="meta-value">Pending Signature</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'RFQ/2024/055', title: 'IT Equipment and Software Licenses', status: 'Award Recommendation', statusKey: 'award'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-success btn-sm">
                            <i class="pi pi-file-edit"></i> Sign Report
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="pi pi-file-pdf"></i> Award Report
                        </button>
                    </div>
                </div>

                <!-- Tender Card 12 - Finalized -->
                <div class="tender-card" data-status="finalized">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">ITB/2024/012</div>
                            <div class="tender-title">Construction - School Building</div>
                        </div>
                        <span class="status-badge" style="background: #c8e6c9; color: #2e7d32;">Finalized</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Finalized Date</span>
                            <span class="meta-value">10 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Awarded To</span>
                            <span class="meta-value">BuildCo International</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Award Value</span>
                            <span class="meta-value">$3,200,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Contract Status</span>
                            <span class="meta-value">Active</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'ITB/2024/012', title: 'Construction - School Building', status: 'Finalized', statusKey: 'finalized'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="pi pi-file"></i> View Contract
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="pi pi-history"></i> Tender History
                        </button>
                    </div>
                </div>

                <!-- Tender Card 13 - Cancelled -->
                <div class="tender-card" data-status="cancelled">
                    <div class="tender-header">
                        <div class="tender-title-section">
                            <div class="tender-id">RFP/2024/091</div>
                            <div class="tender-title">Training Services - Capacity Building</div>
                        </div>
                        <span class="status-badge" style="background: var(--danger-50); color: var(--danger-500);">Cancelled</span>
                    </div>
                    <div class="tender-meta">
                        <div class="meta-item">
                            <span class="meta-label">Cancelled Date</span>
                            <span class="meta-value">5 Nov 2024</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Reason</span>
                            <span class="meta-value">Budget Constraints</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Est. Value</span>
                            <span class="meta-value">$95,000</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Interested Suppliers</span>
                            <span class="meta-value">14</span>
                        </div>
                    </div>
                    <div class="tender-actions">
                        <button class="btn btn-primary btn-sm" onclick="showTenderDetails({id: 'RFP/2024/091', title: 'Training Services - Capacity Building', status: 'Cancelled', statusKey: 'cancelled'})">
                            <i class="pi pi-eye"></i> View Full Details
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="pi pi-history"></i> Cancellation Details
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="pi pi-copy"></i> Reopen/Clone
                        </button>
                    </div>
                </div>
            </div>
            </div>
            <!-- End Dashboard View -->

            <!-- Tender Details View -->
            <div class="view-section" id="view-tender-details">
                <!-- Tender Info Banner -->
                <div class="tender-info-banner">
                    <div class="tender-banner-ref" id="details-tender-id">Reference: RFQ/2024/001</div>
                    <h2 class="tender-banner-title" id="details-tender-title">Supply and Delivery of Medical Equipment and Supplies</h2>
                    <div class="tender-banner-meta">
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Type</span>
                            <span class="banner-meta-value">ITB</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Category</span>
                            <span class="banner-meta-value">Goods</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Value</span>
                            <span class="banner-meta-value">$250,000 USD</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Deadline</span>
                            <span class="banner-meta-value">15 Jan 2025</span>
                        </div>
                        <div class="banner-meta-item">
                            <span class="banner-meta-label">Status</span>
                            <span class="banner-meta-value" id="details-tender-status">Open</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-xl); flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="showDashboard()">
                        <i class="pi pi-arrow-left"></i> Back to Dashboard
                    </button>
                    <div style="flex: 1;"></div>
                    <div id="tender-details-actions" style="display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="openAmendModalFromDetails()">
                            <i class="pi pi-pencil"></i> Amend Tender
                        </button>
                        <button class="btn btn-danger" onclick="openCancelModalFromDetails()">
                            <i class="pi pi-times-circle"></i> Cancel Tender
                        </button>
                        <button class="btn btn-secondary" onclick="openClarificationsFromDetails()">
                            <i class="pi pi-comment"></i> Manage Clarifications (5)
                        </button>
                    </div>
                </div>

                <div class="deadline-warning">
                    <div class="deadline-icon">‚è∞</div>
                    <div class="deadline-text">
                        <strong>5 days, 14 hours remaining</strong> until bid submission deadline.
                    </div>
                </div>

                <div class="tender-overview-grid">
                    <div class="overview-main">
                        <!-- General Information -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon">üìã</span>
                                General Information
                            </h3>
                            <div class="info-row">
                                <div class="info-label">Method</div>
                                <div class="info-value">ITB - Invitation to Bid</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Category</div>
                                <div class="info-value">Goods</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Countries</div>
                                <div class="info-value">Afghanistan, Bangladesh, Ethiopia</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Bid Validity</div>
                                <div class="info-value">90 days</div>
                            </div>
                        </div>

                        <!-- Scope & Objectives -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon">üéØ</span>
                                Scope & Objectives
                            </h3>
                            <p style="line-height: 1.6; color: var(--text-secondary);">
                                UNOPS requires the supply and delivery of medical equipment for healthcare facilities. Equipment must meet international standards and include installation and training services.
                            </p>
                        </div>

                        <!-- Items & Specifications -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon">üì¶</span>
                                Items & Specifications
                            </h3>
                            <p style="line-height: 1.6; color: var(--text-muted); margin-bottom: var(--spacing-md); font-size: 14px;">
                                The following items are being procured. Click on each item to view detailed specifications.
                            </p>

                            <!-- Item 1: Ultrasound Machines -->
                            <div class="collapsible-item-card">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">Ultrasound Machines</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">UNSPSC: 42182104 ‚Ä¢ Quantity: 5 Units</div>
                                    </div>
                                    <span class="collapsible-arrow">‚ñº</span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Type:</span>
                                        <span class="spec-detail-value">Portable Ultrasound System</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Display:</span>
                                        <span class="spec-detail-value">Color Doppler with minimum 15" LED monitor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Probes:</span>
                                        <span class="spec-detail-value">Minimum 3 probes (Convex, Linear, Phased Array)</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Features:</span>
                                        <span class="spec-detail-value">3D/4D imaging capability, DICOM compatible, battery backup</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Warranty:</span>
                                        <span class="spec-detail-value">Minimum 2 years parts and labor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Delivery:</span>
                                        <span class="spec-detail-value">Within 90 days of contract signing</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Item 2: Patient Monitors -->
                            <div class="collapsible-item-card">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">Patient Monitors</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">UNSPSC: 42182108 ‚Ä¢ Quantity: 20 Units</div>
                                    </div>
                                    <span class="collapsible-arrow">‚ñº</span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Type:</span>
                                        <span class="spec-detail-value">Multi-Parameter Patient Monitor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Display:</span>
                                        <span class="spec-detail-value">Minimum 12" TFT color LCD touchscreen</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Parameters:</span>
                                        <span class="spec-detail-value">ECG (3/5/12 lead), SpO2, NIBP, Temperature, Respiration Rate, IBP (optional)</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Battery:</span>
                                        <span class="spec-detail-value">Built-in rechargeable, minimum 4 hours runtime</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Alarms:</span>
                                        <span class="spec-detail-value">Visual and audible with adjustable limits</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Warranty:</span>
                                        <span class="spec-detail-value">Minimum 2 years parts and labor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Delivery:</span>
                                        <span class="spec-detail-value">Within 60 days of contract signing</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Item 3: Surgical Lights -->
                            <div class="collapsible-item-card">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">Surgical Lights</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">UNSPSC: 42192201 ‚Ä¢ Quantity: 8 Units</div>
                                    </div>
                                    <span class="collapsible-arrow">‚ñº</span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Type:</span>
                                        <span class="spec-detail-value">LED Surgical Operating Light, Mobile</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Illumination:</span>
                                        <span class="spec-detail-value">Minimum 120,000 lux at 1m distance</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Color Temperature:</span>
                                        <span class="spec-detail-value">4000-5000K, adjustable</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">LED Lifespan:</span>
                                        <span class="spec-detail-value">Minimum 50,000 hours</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Mobility:</span>
                                        <span class="spec-detail-value">Floor mounted with wheels, brake system, 360¬∞ rotation</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Warranty:</span>
                                        <span class="spec-detail-value">Minimum 3 years parts and labor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Delivery:</span>
                                        <span class="spec-detail-value">Within 75 days of contract signing</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Item 4: Anesthesia Machines -->
                            <div class="collapsible-item-card">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">Anesthesia Machines</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">UNSPSC: 42182101 ‚Ä¢ Quantity: 3 Units</div>
                                    </div>
                                    <span class="collapsible-arrow">‚ñº</span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Type:</span>
                                        <span class="spec-detail-value">Advanced Anesthesia Workstation</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Ventilator:</span>
                                        <span class="spec-detail-value">Integrated with volume and pressure control modes</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Vaporizers:</span>
                                        <span class="spec-detail-value">Minimum 2 agent-specific vaporizers (Sevoflurane, Isoflurane)</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Monitoring:</span>
                                        <span class="spec-detail-value">Integrated patient monitoring (O2, CO2, agent concentration, pressure, flow)</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Display:</span>
                                        <span class="spec-detail-value">15" color touchscreen with waveform display</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Standards:</span>
                                        <span class="spec-detail-value">ISO 80601-2-13 compliant</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Warranty:</span>
                                        <span class="spec-detail-value">Minimum 2 years parts and labor</span>
                                    </div>
                                    <div class="spec-detail-row">
                                        <span class="spec-detail-label">Delivery:</span>
                                        <span class="spec-detail-value">Within 120 days of contract signing</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tender Particulars -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon">‚öôÔ∏è</span>
                                Tender Particulars
                            </h3>
                            <div class="info-row">
                                <div class="info-label">Bid Security</div>
                                <div class="info-value">Required - $5,000 USD</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Performance Security</div>
                                <div class="info-value">10% of contract value</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Advance Payment</div>
                                <div class="info-value">Allowed - Up to 20%</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Advance Payment Security</div>
                                <div class="info-value">Required - Bank guarantee for full amount</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Liquidated Damages</div>
                                <div class="info-value">0.5% per week of delay, maximum 10%</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Alternative Offers</div>
                                <div class="info-value">Allowed</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Site Visit</div>
                                <div class="info-value">Not required</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Pre-Bid Meeting</div>
                                <div class="info-value">Optional - 20 December 2024, 10:00 AM UTC (Virtual)</div>
                            </div>
                        </div>

                        <!-- Evaluation Criteria -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon">üìä</span>
                                Evaluation Criteria
                            </h3>
                            <div class="info-box">
                                <strong>Method:</strong> Lowest Evaluated Substantially Responsive Bid
                            </div>
                            <p style="margin-top: var(--spacing-md); line-height: 1.6; color: var(--text-secondary);">
                                Technical evaluation (pass/fail) followed by financial comparison of compliant bids.
                            </p>
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div class="overview-sidebar-section">
                        <!-- Key Dates -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon">üìÖ</span>
                                Key Dates
                            </h3>
                            <div class="timeline">
                                <div class="timeline-item">
                                    <div class="timeline-date">5 Dec 2024</div>
                                    <div class="timeline-content">Published</div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-date">10 Jan 2025</div>
                                    <div class="timeline-content">Clarification Deadline</div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-date">15 Jan 2025</div>
                                    <div class="timeline-content">Submission Deadline</div>
                                </div>
                            </div>
                        </div>

                        <!-- Statistics -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon">üìà</span>
                                Tender Statistics
                            </h3>
                            <div class="info-row">
                                <div class="info-label">Suppliers Interested</div>
                                <div class="info-value">12</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Bids Submitted</div>
                                <div class="info-value">3</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Clarifications</div>
                                <div class="info-value">5 questions</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Documents</div>
                                <div class="info-value">8 files</div>
                            </div>
                        </div>

                        <!-- Team -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon">üë•</span>
                                Team
                            </h3>
                            
                            <!-- Team Member 1: Tender Author -->
                            <div class="collapsible-item-card" style="margin-bottom: var(--spacing-sm);">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)" style="padding: var(--spacing-md);">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 2px;">Jane Doe</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">Tender Author</div>
                                    </div>
                                    <span class="collapsible-arrow">‚ñº</span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Email:</strong> jane.doe@unops.org</div>
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Role:</strong> Procurement Officer</div>
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Unit:</strong> Procurement Services</div>
                                        <div><strong>Status:</strong> <span style="color: var(--success-500);">‚óè Active</span></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Team Member 2: TME -->
                            <div class="collapsible-item-card" style="margin-bottom: var(--spacing-sm);">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)" style="padding: var(--spacing-md);">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 2px;">Michael Chen</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">Technical & Management Expert (TME)</div>
                                    </div>
                                    <span class="collapsible-arrow">‚ñº</span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Email:</strong> michael.chen@unops.org</div>
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Role:</strong> Senior Technical Advisor</div>
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Unit:</strong> Technical Advisory</div>
                                        <div><strong>Status:</strong> <span style="color: var(--success-500);">‚óè Active</span></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Team Member 3: PR -->
                            <div class="collapsible-item-card" style="margin-bottom: var(--spacing-sm);">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)" style="padding: var(--spacing-md);">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 2px;">Sarah Williams</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">Procurement Reviewer (PR)</div>
                                    </div>
                                    <span class="collapsible-arrow">‚ñº</span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Email:</strong> sarah.williams@unops.org</div>
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Role:</strong> Procurement Specialist</div>
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Unit:</strong> Procurement Review</div>
                                        <div><strong>Status:</strong> <span style="color: var(--success-500);">‚óè Active</span></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Team Member 4: PA (if applicable) -->
                            <div class="collapsible-item-card" style="margin-bottom: var(--spacing-md);">
                                <div class="collapsible-item-header" onclick="toggleItemCard(this, event)" style="padding: var(--spacing-md);">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 2px;">David Martinez</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">Procurement Authority (PA)</div>
                                    </div>
                                    <span class="collapsible-arrow">‚ñº</span>
                                </div>
                                <div class="collapsible-item-content">
                                    <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Email:</strong> david.martinez@unops.org</div>
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Role:</strong> Director of Procurement</div>
                                        <div style="margin-bottom: var(--spacing-xs);"><strong>Unit:</strong> Procurement Authority</div>
                                        <div><strong>Status:</strong> <span style="color: var(--success-500);">‚óè Active</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Evaluation Team Assignment -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon">üéØ</span>
                                Evaluation Team Assignment
                                <button class="btn btn-primary btn-sm" onclick="openEvaluationTeamModal()" style="margin-left: auto; font-size: 11px; padding: 6px 12px;">
                                    <i class="pi pi-plus"></i> Manage
                                </button>
                            </h3>
                            
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: var(--spacing-md); line-height: 1.6;">
                                Assign evaluators to specific evaluation stages and lots/products.
                            </div>

                            <!-- Evaluation Stage Assignments -->
                            <div style="margin-bottom: var(--spacing-md);">
                                <div style="font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--spacing-sm);">
                                    Stage Assignments
                                </div>
                                
                                <div style="background: var(--surface-50); padding: var(--spacing-sm); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm); border-left: 3px solid var(--success-500);">
                                    <div style="font-weight: 600; font-size: 13px; margin-bottom: 4px;">‚úÖ Eligibility & Formal</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">John Smith, Sarah Johnson</div>
                                </div>
                                
                                <div style="background: var(--surface-50); padding: var(--spacing-sm); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm); border-left: 3px solid var(--success-500);">
                                    <div style="font-weight: 600; font-size: 13px; margin-bottom: 4px;">‚úÖ Qualification</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">John Smith, Sarah Johnson</div>
                                </div>
                                
                                <div style="background: var(--surface-50); padding: var(--spacing-sm); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm); border-left: 3px solid var(--primary-400);">
                                    <div style="font-weight: 600; font-size: 13px; margin-bottom: 4px;">‚è≥ Technical</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">John Smith (Lot 1), Sarah Johnson (Lot 2)</div>
                                </div>
                                
                                <div style="background: var(--surface-50); padding: var(--spacing-sm); border-radius: var(--radius-sm); border-left: 3px solid var(--surface-300);">
                                    <div style="font-weight: 600; font-size: 13px; margin-bottom: 4px;">‚äò Financial</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">Not yet assigned</div>
                                </div>
                            </div>

                            <!-- Lot-Specific Assignments -->
                            <div style="margin-bottom: var(--spacing-md);">
                                <div style="font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--spacing-sm);">
                                    Lot Assignments (Technical & Financial)
                                </div>
                                
                                <div class="collapsible-item-card" style="margin-bottom: var(--spacing-xs);">
                                    <div class="collapsible-item-header" onclick="toggleItemCard(this, event)" style="padding: var(--spacing-sm);">
                                        <div style="flex: 1;">
                                            <div style="font-weight: 600; font-size: 12px; margin-bottom: 2px;">üì¶ Lot 1: Personal Protective Equipment</div>
                                            <div style="font-size: 10px; color: var(--text-muted);">3 products ‚Ä¢ 2 evaluators assigned</div>
                                        </div>
                                        <span class="collapsible-arrow">‚ñº</span>
                                    </div>
                                    <div class="collapsible-item-content">
                                        <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.6; padding: var(--spacing-xs);">
                                            <div style="margin-bottom: var(--spacing-xs);"><strong>Technical:</strong> John Smith, Maria Garcia</div>
                                            <div style="margin-bottom: var(--spacing-xs);"><strong>Financial:</strong> John Smith</div>
                                            <div style="padding: var(--spacing-xs); background: var(--info-50); border-radius: var(--radius-xs); margin-top: var(--spacing-xs);">
                                                <strong>Products:</strong> Medical gloves, Surgical masks, Face shields
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="collapsible-item-card">
                                    <div class="collapsible-item-header" onclick="toggleItemCard(this, event)" style="padding: var(--spacing-sm);">
                                        <div style="flex: 1;">
                                            <div style="font-weight: 600; font-size: 12px; margin-bottom: 2px;">üì¶ Lot 2: Medical Consumables</div>
                                            <div style="font-size: 10px; color: var(--text-muted);">3 products ‚Ä¢ 2 evaluators assigned</div>
                                        </div>
                                        <span class="collapsible-arrow">‚ñº</span>
                                    </div>
                                    <div class="collapsible-item-content">
                                        <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.6; padding: var(--spacing-xs);">
                                            <div style="margin-bottom: var(--spacing-xs);"><strong>Technical:</strong> Sarah Johnson, David Lee</div>
                                            <div style="margin-bottom: var(--spacing-xs);"><strong>Financial:</strong> Sarah Johnson</div>
                                            <div style="padding: var(--spacing-xs); background: var(--info-50); border-radius: var(--radius-xs); margin-top: var(--spacing-xs);">
                                                <strong>Products:</strong> Syringes, Gauze bandages, IV Catheters
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="overview-section">
                            <h3 class="overview-section-title">
                                <span class="overview-section-icon">‚ö°</span>
                                Quick Actions
                            </h3>
                            <button class="btn btn-secondary" style="width: 100%; margin-bottom: var(--spacing-sm);">
                                <i class="pi pi-download"></i> Download Package
                            </button>
                            <button class="btn btn-secondary" style="width: 100%; margin-bottom: var(--spacing-sm);">
                                <i class="pi pi-users"></i> View Participants
                            </button>
                            <button class="btn btn-secondary" style="width: 100%;">
                                <i class="pi pi-history"></i> View History
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Tender Details View -->

            <!-- Evaluation View -->
            <div class="view-section" id="view-evaluation">
                <!-- Evaluation Header -->
                <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-xl); box-shadow: var(--shadow-card); border: 1px solid var(--surface-200); margin-bottom: var(--spacing-xl);">
                    <button class="btn btn-secondary" onclick="showDashboard()" style="margin-bottom: var(--spacing-md);">
                        <i class="pi pi-arrow-left"></i> Back to Dashboard
                    </button>
                    <h1 style="font-size: 24px; font-weight: 600; color: var(--primary-400); margin-bottom: var(--spacing-sm);" id="eval-tender-title">
                        ITB/2024/023: Medical Supplies - Emergency Response
                    </h1>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-lg); margin-top: var(--spacing-lg);">
                        <div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-xs);">Evaluation Stage</div>
                            <div style="font-weight: 600; color: var(--text-primary);">Technical Evaluation</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-xs);">Bids Received</div>
                            <div style="font-weight: 600; color: var(--text-primary);">6 Bidders</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-xs);">Your Role</div>
                            <div style="font-weight: 600; color: var(--text-primary);" id="eval-user-role">Evaluator</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: var(--spacing-xs);">Progress</div>
                            <div style="font-weight: 600; color: var(--text-primary);">3 of 6 evaluated</div>
                        </div>
                    </div>
                </div>

                <!-- Role Selector for Demo -->
                <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-lg); box-shadow: var(--shadow-card); border: 1px solid var(--surface-200); margin-bottom: var(--spacing-xl);">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: var(--spacing-md);">üë§ Demo: Switch Role</h3>
                    <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                        <button class="btn btn-secondary" id="role-evaluator-btn" onclick="switchEvaluationRole('evaluator')">
                            üë®‚Äçüíº Evaluator - Jane Doe
                        </button>
                        <button class="btn btn-secondary" id="role-po-btn" onclick="switchEvaluationRole('po')">
                            üëî Procurement Official - Sarah Chen
                        </button>
                        <button class="btn btn-secondary" id="role-comparison-btn" onclick="switchEvaluationRole('comparison')">
                            üìä Comparison View
                        </button>
                    </div>
                </div>

                <!-- Evaluation Steps Progress -->
                <div style="background: var(--surface-0); border-radius: var(--radius-lg); padding: var(--spacing-xl); box-shadow: var(--shadow-card); border: 1px solid var(--surface-200); margin-bottom: var(--spacing-xl);">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: var(--spacing-lg);">Evaluation Steps</h3>
                    <div style="display: flex; justify-content: space-between; position: relative;">
                        <div style="position: absolute; top: 15px; left: 0; right: 0; height: 2px; background: var(--surface-200); z-index: 0;"></div>
                        
                        <div class="eval-step completed" data-step="1" onclick="switchEvaluationStep(1)">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--success-500); border: 2px solid var(--success-500); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; z-index: 1; position: relative; margin: 0 auto; cursor: pointer;">‚úì</div>
                            <div style="font-size: 12px; text-align: center; margin-top: var(--spacing-sm); font-weight: 500; color: var(--success-500);">Eligibility & Formal</div>
                        </div>
                        
                        <div class="eval-step completed" data-step="2" onclick="switchEvaluationStep(2)">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--success-500); border: 2px solid var(--success-500); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; z-index: 1; position: relative; margin: 0 auto; cursor: pointer;">‚úì</div>
                            <div style="font-size: 12px; text-align: center; margin-top: var(--spacing-sm); font-weight: 500; color: var(--success-500);">Qualification</div>
                        </div>
                        
                        <div class="eval-step active" data-step="3" onclick="switchEvaluationStep(3)">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary-400); border: 2px solid var(--primary-400); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; z-index: 1; position: relative; margin: 0 auto; cursor: pointer;">3</div>
                            <div style="font-size: 12px; text-align: center; margin-top: var(--spacing-sm); font-weight: 600; color: var(--primary-400);">Technical</div>
                        </div>
                        
                        <div class="eval-step" data-step="4" onclick="switchEvaluationStep(4)">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--surface-0); border: 2px solid var(--surface-200); color: var(--text-muted); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; z-index: 1; position: relative; margin: 0 auto; cursor: pointer;">4</div>
                            <div style="font-size: 12px; text-align: center; margin-top: var(--spacing-sm); font-weight: 500; color: var(--text-muted);">Financial</div>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div style="background: var(--surface-50); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-xl); display: flex; gap: var(--spacing-xl); flex-wrap: wrap; align-items: center;">
                    <strong style="font-size: 14px;">Legend:</strong>
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); font-size: 13px;">
                        <div style="width: 20px; height: 20px; background: var(--success-50); border-radius: 4px;"></div>
                        <span>System Generated</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); font-size: 13px;">
                        <div style="width: 20px; height: 20px; background: var(--warning-50); border-radius: 4px;"></div>
                        <span>Manual Input</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); font-size: 13px;">
                        <div style="width: 20px; height: 20px; background: var(--success-50); border: 2px solid var(--success-500); border-radius: 4px;"></div>
                        <span>Pass</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); font-size: 13px;">
                        <div style="width: 20px; height: 20px; background: var(--danger-50); border: 2px solid var(--danger-500); border-radius: 4px;"></div>
                        <span>Fail</span>
                    </div>
                </div>

                <!-- View Toggle and Vendor/Lot Tabs -->
                <div style="background: var(--surface-0); padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-lg) var(--radius-lg) 0 0; box-shadow: var(--shadow-card); border: 1px solid var(--surface-200); border-bottom: none; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-md);">
                    <div style="display: flex; gap: var(--spacing-sm); flex: 1;" id="evalTabsContainer">
                        <button class="vendor-eval-tab active" onclick="switchVendorEval('vendor1')">Supplier 1 - MedSupply Ltd.</button>
                        <button class="vendor-eval-tab" onclick="switchVendorEval('vendor2')">Supplier 2 - HealthCare Corp.</button>
                        <button class="vendor-eval-tab" onclick="switchVendorEval('vendor3')">Supplier 3 - MedTech Inc.</button>
                    </div>
                    <div class="view-toggle" id="viewToggle" style="display: none;">
                        <button class="view-toggle-btn active" onclick="switchEvalView('supplier')">
                            üë§ Supplier View
                        </button>
                        <button class="view-toggle-btn" onclick="switchEvalView('lot')">
                            üì¶ Lot View
                        </button>
                    </div>
                </div>

                <!-- Evaluation Content -->
                <div style="background: var(--surface-0); padding: var(--spacing-xl); border-radius: 0 0 var(--radius-lg) var(--radius-lg); box-shadow: var(--shadow-card); border: 1px solid var(--surface-200);" id="evaluation-content-area">
                    <!-- Vendor Info Bar -->
                    <div style="background: linear-gradient(135deg, var(--info-50) 0%, var(--primary-50) 100%); padding: var(--spacing-lg); border-radius: var(--radius-md); margin-bottom: var(--spacing-xl); display: flex; gap: var(--spacing-xl); flex-wrap: wrap;">
                        <div>
                            <div style="font-size: 12px; font-weight: 600; color: var(--primary-400); margin-bottom: 2px;">Company Name</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--primary-600);" id="vendor-eval-name">MedSupply Ltd.</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; font-weight: 600; color: var(--primary-400); margin-bottom: 2px;">UNGM Number</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--primary-600);">309663</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; font-weight: 600; color: var(--primary-400); margin-bottom: 2px;">Country</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--primary-600);">Germany</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; font-weight: 600; color: var(--primary-400); margin-bottom: 2px;">Total Bid Price</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--primary-600);">$234,500 USD</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; font-weight: 600; color: var(--primary-400); margin-bottom: 2px;">Price Rank</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--primary-600);">2 of 6</div>
                        </div>
                    </div>

                    <!-- Role Note -->
                    <div id="eval-role-note" style="background: var(--info-50); border-left: 4px solid var(--info-400); padding: var(--spacing-md); margin-bottom: var(--spacing-xl); border-radius: var(--radius-sm);">
                        <strong>üë®‚Äçüíº Evaluator View:</strong> Review system-generated evaluation and provide your independent assessment.
                    </div>

                    <!-- Evaluation Table -->
                    <div style="overflow-x: auto;" id="evaluation-table-container">
                        <!-- Table will be rendered by JavaScript -->
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-xl); padding-top: var(--spacing-lg); border-top: 2px solid var(--surface-200); justify-content: flex-end;">
                        <button class="btn btn-secondary" onclick="saveEvaluationDraft()">
                            <i class="pi pi-save"></i> Save Draft
                        </button>
                        <button class="btn btn-primary" onclick="submitEvaluation()">
                            <i class="pi pi-check"></i> Submit Evaluation
                        </button>
                    </div>
                </div>
            </div>
            <!-- End Evaluation View -->
        </main>
    </div>

    <!-- Tender Preview Sidebar -->
    <div class="sidebar-panel" id="tender-preview-sidebar">
        <div class="sidebar-panel-header">
            <div>
                <div class="sidebar-panel-title">Tender Details</div>
                <div style="font-size: 13px; opacity: 0.9;" id="preview-tender-id">RFQ/2024/001</div>
            </div>
            <button class="modal-close" style="color: white;" onclick="closeTenderPreview()">√ó</button>
        </div>
        <div class="sidebar-panel-body">
            <!-- Title -->
            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: var(--spacing-lg); color: var(--text-primary);" id="preview-tender-title">
                Supply of Medical Equipment
            </h3>

            <!-- Quick Actions -->
            <div style="display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-md);">
                <button class="btn btn-primary btn-sm" style="flex: 1;" onclick="closeTenderPreview(); openAmendModalFromPreview()">
                    <i class="pi pi-pencil"></i> Amend
                </button>
                <button class="btn btn-danger btn-sm" style="flex: 1;" onclick="closeTenderPreview(); openCancelModalFromPreview()">
                    <i class="pi pi-times-circle"></i> Cancel
                </button>
            </div>

            <button class="btn btn-secondary btn-sm" style="width: 100%; margin-bottom: var(--spacing-xl);" onclick="closeTenderPreview(); openClarificationsModal(currentTenderId, currentTenderTitle)">
                <i class="pi pi-comment"></i> Manage Clarifications (5)
            </button>

            <!-- General Information -->
            <div class="collapsible-section-compact">
                <div class="collapsible-header-compact" onclick="toggleCollapseSidebar(this)">
                    <span><strong>üìã General Information</strong></span>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content-compact" style="display: block;">
                    <div class="info-row">
                        <div class="info-label">Method</div>
                        <div class="info-value">ITB - Invitation to Bid</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Category</div>
                        <div class="info-value">Goods</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Value</div>
                        <div class="info-value">$250,000 USD</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Deadline</div>
                        <div class="info-value">15 Jan 2025, 23:59 UTC</div>
                    </div>
                </div>
            </div>

            <!-- Scope -->
            <div class="collapsible-section-compact">
                <div class="collapsible-header-compact" onclick="toggleCollapseSidebar(this)">
                    <span><strong>üìù Scope & Description</strong></span>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content-compact" style="display: block;">
                    <p style="font-size: 13px; line-height: 1.6; color: var(--text-secondary);">
                        Supply and delivery of medical equipment and supplies for healthcare facilities in multiple locations. Equipment must meet international standards and include installation and training services.
                    </p>
                </div>
            </div>

            <!-- Key Dates -->
            <div class="collapsible-section-compact">
                <div class="collapsible-header-compact" onclick="toggleCollapseSidebar(this)">
                    <span><strong>üìÖ Key Dates</strong></span>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content-compact">
                    <div class="info-row">
                        <div class="info-label">Published</div>
                        <div class="info-value">5 Dec 2024</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Clarification Deadline</div>
                        <div class="info-value">10 Jan 2025</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Submission Deadline</div>
                        <div class="info-value">15 Jan 2025, 23:59 UTC</div>
                    </div>
                </div>
            </div>

            <!-- Particulars -->
            <div class="collapsible-section-compact">
                <div class="collapsible-header-compact" onclick="toggleCollapseSidebar(this)">
                    <span><strong>‚öôÔ∏è Tender Particulars</strong></span>
                    <span class="collapsible-icon">‚ñº</span>
                </div>
                <div class="collapsible-content-compact">
                    <div class="info-row">
                        <div class="info-label">Bid Security</div>
                        <div class="info-value">Required - $5,000</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Performance Security</div>
                        <div class="info-value">10% of contract value</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Alternative Offers</div>
                        <div class="info-value">Allowed</div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" style="width: 100%; margin-top: var(--spacing-lg);" onclick="closeTenderPreview(); showTenderDetails()">
                <i class="pi pi-external-link"></i> View Full Tender Details
            </button>
        </div>
    </div>

    <!-- Amendment Modal -->
    <div class="modal-overlay" id="amendModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-pencil"></i>
                    <span>Amend Tender: <span id="amendTenderTitle"></span></span>
                </h2>
                <button class="modal-close" onclick="closeAmendModal()">√ó</button>
            </div>

            <div class="modal-body">
                <!-- Progress Steps -->
                <div class="progress-steps">
                    <div class="progress-step">
                        <span class="step-number active" id="step1-number">1</span>
                        <span class="step-label active" id="step1-label">Category</span>
                    </div>
                    <div class="step-connector"></div>
                    <div class="progress-step">
                        <span class="step-number" id="step2-number">2</span>
                        <span class="step-label" id="step2-label">Details</span>
                    </div>
                    <div class="step-connector"></div>
                    <div class="progress-step">
                        <span class="step-number" id="step3-number">3</span>
                        <span class="step-label" id="step3-label">Review</span>
                    </div>
                </div>

                <!-- Step 1: Category Selection -->
                <div id="amendment-step-1" class="amendment-step" style="display: block;">
                    <div class="alert alert-info">
                        <i class="pi pi-info-circle" style="font-size: 20px;"></i>
                        <div>
                            <strong>Select Amendment Category</strong>
                            <p style="margin-top: 4px; font-size: 13px;">
                                Choose categories that describe your amendment. Multiple selections allowed - the highest tier determines the approval workflow.
                            </p>
                        </div>
                    </div>

                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px; color: #15803d;">
                        Tier 1 Amendments - Author Posts Directly
                    </h3>
                    <div class="category-grid">
                        <div class="category-option">
                            <input type="checkbox" id="cat-deadline-extension" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-deadline-extension" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-1">Tier 1</span>
                                    Deadline Extension
                                </span>
                                <span class="category-description">Extend submission deadline</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-clarification-extension" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-clarification-extension" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-1">Tier 1</span>
                                    Clarification Extension
                                </span>
                                <span class="category-description">Extend clarifications deadline</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-award-date" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-award-date" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-1">Tier 1</span>
                                    Expected Award Date
                                </span>
                                <span class="category-description">Update expected contract award date</span>
                            </label>
                        </div>
                    </div>

                    <h3 style="font-size: 16px; font-weight: 600; margin: 24px 0 12px 0; color: #92400e;">
                        Tier 2 Amendments - Requires TME & PR Review
                    </h3>
                    <div class="category-grid">
                        <div class="category-option">
                            <input type="checkbox" id="cat-deadline-shortened" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-deadline-shortened" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Deadline Shortened
                                </span>
                                <span class="category-description">Shorten submission deadline</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-prebid-minutes" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-prebid-minutes" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Pre-bid Minutes
                                </span>
                                <span class="category-description">Upload pre-bid meeting documentation</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-document-revision" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-document-revision" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Document Revision
                                </span>
                                <span class="category-description">Add or revise tender documents</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-scope-change" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-scope-change" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Scope/Quantity Change
                                </span>
                                <span class="category-description">Modify tender scope or quantities</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-terms-conditions" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-terms-conditions" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Terms & Criteria
                                </span>
                                <span class="category-description">Update terms or evaluation criteria</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-price-adjustment" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-price-adjustment" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Price Adjustment
                                </span>
                                <span class="category-description">Modify pricing or financial terms</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-error-correction" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-error-correction" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Error Correction
                                </span>
                                <span class="category-description">Correct errors in documentation</span>
                            </label>
                        </div>

                        <div class="category-option">
                            <input type="checkbox" id="cat-other" class="category-checkbox" onchange="updateAmendmentWorkflow()">
                            <label for="cat-other" class="category-label">
                                <span class="category-name">
                                    <span class="tier-badge tier-2">Tier 2</span>
                                    Other
                                </span>
                                <span class="category-description">Other amendments requiring review</span>
                            </label>
                        </div>
                    </div>

                    <!-- Workflow Preview -->
                    <div class="workflow-preview" id="workflow-preview" style="display: none;">
                        <div class="workflow-title">
                            <i class="pi pi-sitemap"></i> Amendment Workflow
                        </div>
                        <div id="workflow-display"></div>
                    </div>
                </div>

                <!-- Step 2: Amendment Details -->
                <div id="amendment-step-2" class="amendment-step">
                    <div class="alert alert-warning">
                        <i class="pi pi-exclamation-triangle" style="font-size: 20px;"></i>
                        <div>
                            <strong>Review & Confirm Deadlines</strong>
                            <p style="margin-top: 4px; font-size: 13px;">
                                System requires deadline review for all amendments. Update dates if changes warrant an extension.
                            </p>
                        </div>
                    </div>

                    <!-- Deadline Review -->
                    <div class="deadline-review">
                        <div class="deadline-review-title">
                            <i class="pi pi-calendar"></i> Review Tender Deadlines
                        </div>
                        <div class="deadline-fields">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Submission Deadline</label>
                                <input type="datetime-local" class="form-input" value="2024-12-15T23:59" id="submission-deadline">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Clarifications Deadline</label>
                                <input type="datetime-local" class="form-input" value="2024-12-08T23:59" id="clarification-deadline">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Expected Award Date</label>
                                <input type="date" class="form-input" value="2025-01-15" id="award-date">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Amendment Description</label>
                        <textarea class="form-textarea" id="amendment-description" placeholder="Provide a clear description of the changes being made..."></textarea>
                        <span class="help-text">This will be published to all suppliers</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Justification/Instructions to Bidders</label>
                        <textarea class="form-textarea" id="amendment-justification" placeholder="Explain the rationale for this amendment..."></textarea>
                        <span class="help-text">Provide context for suppliers about why this amendment is being made</span>
                    </div>

                    <div class="alert alert-danger">
                        <i class="pi pi-exclamation-triangle" style="font-size: 20px;"></i>
                        <div>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 0;">
                                <input type="checkbox" id="impacts-mandatory" onchange="toggleMandatoryImpact()">
                                <strong>This amendment impacts mandatory requirements</strong>
                            </label>
                            <p style="margin-top: 8px; font-size: 13px;">
                                All existing bid submissions will be invalidated and suppliers must resubmit
                            </p>
                        </div>
                    </div>

                    <div id="mandatory-impact-notice" style="display: none;">
                        <div class="alert alert-warning">
                            <i class="pi pi-info-circle" style="font-size: 20px;"></i>
                            <div>
                                <strong>Bid Invalidation Notice</strong>
                                <p style="margin-top: 4px; font-size: 13px;">
                                    All submitted bids will be invalidated. Suppliers will receive high-priority notification requiring bid review and resubmission.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Review & Submit -->
                <div id="amendment-step-3" class="amendment-step">
                    <div class="alert alert-success">
                        <i class="pi pi-check-circle" style="font-size: 20px;"></i>
                        <div>
                            <strong>Review Amendment Details</strong>
                            <p style="margin-top: 4px; font-size: 13px;">
                                Review all details before submitting. Amendment will follow the workflow displayed below.
                            </p>
                        </div>
                    </div>

                    <!-- Summary -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: 20px; margin-bottom: 20px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Amendment Summary</h3>
                        
                        <div style="display: grid; gap: 16px;">
                            <div>
                                <strong style="font-size: 13px; color: var(--text-muted);">Categories Selected:</strong>
                                <div id="review-categories" style="margin-top: 8px;"></div>
                            </div>
                            
                            <div>
                                <strong style="font-size: 13px; color: var(--text-muted);">Workflow Tier:</strong>
                                <div id="review-tier" style="margin-top: 8px;"></div>
                            </div>

                            <div>
                                <strong style="font-size: 13px; color: var(--text-muted);">Description:</strong>
                                <div id="review-description" style="margin-top: 8px; font-size: 14px;"></div>
                            </div>

                            <div>
                                <strong style="font-size: 13px; color: var(--text-muted);">Mandatory Requirements Impact:</strong>
                                <div id="review-mandatory" style="margin-top: 8px;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Final Workflow -->
                    <div class="workflow-preview">
                        <div class="workflow-title">
                            <i class="pi pi-sitemap"></i> Amendment Approval Workflow
                        </div>
                        <div id="final-workflow-display"></div>
                    </div>

                    <div class="alert alert-info">
                        <i class="pi pi-megaphone" style="font-size: 20px;"></i>
                        <div>
                            <strong>Upon Approval & Publication:</strong>
                            <ul style="margin: 8px 0 0 20px; font-size: 13px;">
                                <li>Amendment published to Agora and UNGM</li>
                                <li>All interested suppliers receive high-priority notifications</li>
                                <li>Summary of changes generated automatically</li>
                                <li>All changes logged in audit trail</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeAmendModal()">Cancel</button>
                <button class="btn btn-secondary" id="amendment-back-btn" onclick="previousAmendmentStep()" style="display: none;">
                    <i class="pi pi-arrow-left"></i> Back
                </button>
                <button class="btn btn-primary" id="amendment-next-btn" onclick="nextAmendmentStep()">
                    Next <i class="pi pi-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Clarifications Modal -->
    <div class="modal-overlay" id="clarificationsModal">
        <div class="modal" style="max-width: 1000px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-comment"></i>
                    <span>Manage Clarifications: <span id="clarificationsTenderTitle"></span></span>
                </h2>
                <button class="modal-close" onclick="closeClarificationsModal()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="pi pi-info-circle" style="font-size: 20px;"></i>
                    <div>
                        <strong>Clarification Management</strong>
                        <p style="margin-top: 4px; font-size: 13px;">
                            View all supplier questions and provide responses. Questions are anonymized and responses are visible to all suppliers.
                        </p>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                    <select class="filter-select" style="flex: 1;">
                        <option value="all">All Questions</option>
                        <option value="pending">Pending Response</option>
                        <option value="answered">Answered</option>
                    </select>
                    <select class="filter-select" style="flex: 1;">
                        <option value="all">All Sections</option>
                        <option value="general">General Information</option>
                        <option value="technical">Technical Specifications</option>
                        <option value="pricing">Pricing</option>
                    </select>
                </div>

                <!-- Clarifications List -->
                <div style="max-height: 500px; overflow-y: auto;">
                    <!-- Question 1 - Answered -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
                            <div>
                                <span style="font-weight: 600; color: var(--primary-400);">Question #001</span>
                                <span style="margin-left: var(--spacing-md); font-size: 12px; color: var(--text-muted);">5 Dec 2024 ‚Ä¢ General Information</span>
                            </div>
                            <span class="status-badge" style="background: var(--success-50); color: var(--success-500);">Answered</span>
                        </div>
                        
                        <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">QUESTION</div>
                            <p style="font-size: 14px; color: var(--text-primary);">What are the warranty requirements for the medical equipment?</p>
                        </div>
                        
                        <div style="background: var(--success-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">YOUR ANSWER</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Minimum 2 years parts and labor for all equipment. Warranty must be provided by the manufacturer or authorized distributor.</p>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: var(--spacing-sm);">Answered by: Jane Doe ‚Ä¢ 6 Dec 2024</div>
                        </div>
                    </div>

                    <!-- Question 2 - Pending -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
                            <div>
                                <span style="font-weight: 600; color: var(--primary-400);">Question #002</span>
                                <span style="margin-left: var(--spacing-md); font-size: 12px; color: var(--text-muted);">8 Dec 2024 ‚Ä¢ Technical Specifications</span>
                            </div>
                            <span class="status-badge" style="background: var(--warning-50); color: var(--warning-500);">Pending</span>
                        </div>
                        
                        <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">QUESTION</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Can we propose alternative UNSPSC codes if our products meet the specifications but have different classification?</p>
                        </div>
                        
                        <div style="background: var(--surface-100); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                            <textarea class="form-textarea" placeholder="Type your response here..." style="min-height: 100px;"></textarea>
                            <div style="display: flex; justify-content: flex-end; gap: var(--spacing-sm); margin-top: var(--spacing-sm);">
                                <button class="btn btn-secondary btn-sm">Save Draft</button>
                                <button class="btn btn-primary btn-sm">
                                    <i class="pi pi-send"></i> Publish Response
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Question 3 - Answered -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
                            <div>
                                <span style="font-weight: 600; color: var(--primary-400);">Question #003</span>
                                <span style="margin-left: var(--spacing-md); font-size: 12px; color: var(--text-muted);">9 Dec 2024 ‚Ä¢ Technical Specifications</span>
                            </div>
                            <span class="status-badge" style="background: var(--success-50); color: var(--success-500);">Answered</span>
                        </div>
                        
                        <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">QUESTION</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Can ultrasound machines be from different manufacturers?</p>
                        </div>
                        
                        <div style="background: var(--success-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">YOUR ANSWER</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Yes, machines can be from different manufacturers as long as they meet the minimum specifications outlined in the tender documents and ISO standards.</p>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: var(--spacing-sm);">Answered by: Jane Doe ‚Ä¢ 10 Dec 2024</div>
                        </div>
                    </div>

                    <!-- Question 4 - Pending -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-md);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
                            <div>
                                <span style="font-weight: 600; color: var(--primary-400);">Question #004</span>
                                <span style="margin-left: var(--spacing-md); font-size: 12px; color: var(--text-muted);">10 Dec 2024 ‚Ä¢ Pricing</span>
                            </div>
                            <span class="status-badge" style="background: var(--warning-50); color: var(--warning-500);">Pending</span>
                        </div>
                        
                        <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">QUESTION</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Are shipping costs to be included in the unit price or quoted separately?</p>
                        </div>
                        
                        <div style="background: var(--surface-100); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                            <textarea class="form-textarea" placeholder="Type your response here..." style="min-height: 100px;"></textarea>
                            <div style="display: flex; justify-content: flex-end; gap: var(--spacing-sm); margin-top: var(--spacing-sm);">
                                <button class="btn btn-secondary btn-sm">Save Draft</button>
                                <button class="btn btn-primary btn-sm">
                                    <i class="pi pi-send"></i> Publish Response
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Question 5 - Answered -->
                    <div style="background: var(--surface-50); border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
                            <div>
                                <span style="font-weight: 600; color: var(--primary-400);">Question #005</span>
                                <span style="margin-left: var(--spacing-md); font-size: 12px; color: var(--text-muted);">11 Dec 2024 ‚Ä¢ General Information</span>
                            </div>
                            <span class="status-badge" style="background: var(--success-50); color: var(--success-500);">Answered</span>
                        </div>
                        
                        <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">QUESTION</div>
                            <p style="font-size: 14px; color: var(--text-primary);">Is the pre-bid meeting mandatory for all bidders?</p>
                        </div>
                        
                        <div style="background: var(--success-50); padding: var(--spacing-md); border-radius: var(--radius-sm);">
                            <div style="font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: var(--spacing-xs);">YOUR ANSWER</div>
                            <p style="font-size: 14px; color: var(--text-primary);">No, the pre-bid meeting is optional. However, attendance is recommended to better understand the requirements. Minutes will be shared with all bidders after the meeting.</p>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: var(--spacing-sm);">Answered by: Jane Doe ‚Ä¢ 11 Dec 2024</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeClarificationsModal()">Close</button>
                <button class="btn btn-secondary">
                    <i class="pi pi-download"></i> Export All Clarifications
                </button>
            </div>
        </div>
    </div>

    <!-- Cancel Modal -->
    <div class="modal-overlay" id="cancelModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-times-circle"></i>
                    <span>Cancel Tender: <span id="cancelTenderTitle"></span></span>
                </h2>
                <button class="modal-close" onclick="closeCancelModal()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="alert alert-danger">
                    <i class="pi pi-exclamation-triangle" style="font-size: 20px;"></i>
                    <div>
                        <strong>Warning: This action cannot be undone</strong>
                        <p style="margin-top: 4px; font-size: 13px;">
                            All participating suppliers will be notified and requisition lines will be released in ERP.
                        </p>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label required">Cancellation Reason (Internal)</label>
                    <select class="form-select" id="cancel-reason">
                        <option value="">Select a reason...</option>
                        <option value="lack-funds">Lack of Funds</option>
                        <option value="budget-reallocation">Budget Reallocation</option>
                        <option value="non-viable-pricing">Non-viable Pricing</option>
                        <option value="priority-change">Change in Organization Priority</option>
                        <option value="scope-modification">Project Scope Modification</option>
                        <option value="project-cancellation">Project Cancellation</option>
                        <option value="requirements-revision">Material Revision of Requirements</option>
                        <option value="restrictive-specs">Restrictive Specifications</option>
                        <option value="lack-compliant">Lack of Compliant Bids</option>
                        <option value="insufficient-competition">Insufficient Competition</option>
                        <option value="proscribed-practices">Suspicion/Evidence of Proscribed Practices</option>
                        <option value="poor-quality">Poor Quality of Bids</option>
                        <option value="procedural-issues">Procedural Irregularities</option>
                        <option value="conflict-interest">Conflict of Interest</option>
                        <option value="legal-changes">Legal or Regulatory Changes</option>
                    </select>
                    <span class="help-text">For internal analysis and audit purposes</span>
                </div>

                <div class="form-group">
                    <label class="form-label required">Internal Explanation</label>
                    <textarea class="form-textarea" id="cancel-internal-explanation" placeholder="Detailed explanation for internal records..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label required">Public Justification</label>
                    <textarea class="form-textarea" id="cancel-public-justification" placeholder="Justification to be shared with suppliers..."></textarea>
                    <span class="help-text">This will be published to all participating suppliers</span>
                </div>

                <div class="alert alert-info">
                    <i class="pi pi-info-circle" style="font-size: 20px;"></i>
                    <div>
                        <strong>After Cancellation:</strong>
                        <ul style="margin: 8px 0 0 20px; font-size: 13px;">
                            <li>All interested suppliers notified immediately</li>
                            <li>Submitted bids archived</li>
                            <li>Requisition lines released in ERP</li>
                            <li>Tender marked as "Cancelled" on Agora and UNGM</li>
                            <li>All details logged in audit trail</li>
                        </ul>
                    </div>
                </div>

                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-top: 20px;">
                    <input type="checkbox" id="confirm-cancellation">
                    <strong>I confirm that I want to cancel this tender</strong>
                </label>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeCancelModal()">Close</button>
                <button class="btn btn-danger" id="confirm-cancel-btn" onclick="submitCancellation()" disabled>
                    <i class="pi pi-times-circle"></i> Confirm Cancellation
                </button>
            </div>
        </div>
    </div>

    <!-- Document Viewer Modal -->
    <div class="modal-overlay" id="documentViewerModal">
        <div class="modal" style="max-width: 1200px; max-height: 90vh;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-file"></i>
                    <span id="docViewerTitle">Document Viewer</span>
                </h2>
                <button class="modal-close" onclick="closeDocumentViewer()">√ó</button>
            </div>

            <div class="modal-body" style="padding: 0; max-height: calc(90vh - 200px); overflow: hidden;">
                <div style="background: var(--surface-50); padding: var(--spacing-md); border-bottom: 1px solid var(--surface-200); display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: var(--spacing-md); align-items: center;">
                        <span style="font-size: 14px; color: var(--text-secondary);" id="docViewerMeta">PDF Document</span>
                    </div>
                    <div style="display: flex; gap: var(--spacing-sm);">
                        <button class="btn btn-secondary btn-sm" onclick="downloadDocument()">
                            <i class="pi pi-download"></i> Download
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="printDocument()">
                            <i class="pi pi-print"></i> Print
                        </button>
                    </div>
                </div>
                <div style="height: calc(90vh - 250px); background: var(--surface-100); display: flex; align-items: center; justify-content: center; overflow: auto;">
                    <div style="background: white; padding: var(--spacing-2xl); box-shadow: 0 4px 12px rgba(0,0,0,0.1); min-height: 600px; width: 100%; max-width: 850px;">
                        <div style="text-align: center; color: var(--text-muted); padding: var(--spacing-2xl);" id="docViewerContent">
                            <i class="pi pi-file-pdf" style="font-size: 64px; color: var(--primary-400); margin-bottom: var(--spacing-lg);"></i>
                            <h3 style="margin-bottom: var(--spacing-md); color: var(--text-primary);">Document Preview</h3>
                            <p style="margin-bottom: var(--spacing-lg);">This is a simulated document viewer.</p>
                            <div style="text-align: left; max-width: 700px; margin: 0 auto; line-height: 1.8; color: var(--text-secondary);">
                                <p style="margin-bottom: var(--spacing-md);"><strong>Document Information:</strong></p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li style="margin-bottom: var(--spacing-sm);">üìÑ <strong>Type:</strong> Technical Specification</li>
                                    <li style="margin-bottom: var(--spacing-sm);">üì¶ <strong>Size:</strong> 2.4 MB</li>
                                    <li style="margin-bottom: var(--spacing-sm);">üìÖ <strong>Date:</strong> 2024-11-12</li>
                                    <li style="margin-bottom: var(--spacing-sm);">‚úÖ <strong>Status:</strong> Verified</li>
                                </ul>
                                <div style="margin-top: var(--spacing-xl); padding: var(--spacing-lg); background: var(--info-50); border-radius: var(--radius-sm); border-left: 4px solid var(--info-400);">
                                    <p style="font-size: 13px; color: var(--info-400);">
                                        <strong>‚ÑπÔ∏è Note:</strong> In production, this would display the actual PDF document with full viewing capabilities (zoom, pan, print, download).
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeDocumentViewer()">Close</button>
            </div>
        </div>
    </div>

    <!-- Evaluation Team Assignment Modal -->
    <div class="modal-overlay" id="evaluationTeamModal">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="pi pi-users"></i>
                    <span>Manage Evaluation Team</span>
                </h2>
                <button class="modal-close" onclick="closeEvaluationTeamModal()">√ó</button>
            </div>

            <div class="modal-body">
                <!-- Evaluation Team Setup -->
                <div style="margin-bottom: var(--spacing-xl);">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: var(--spacing-md); color: var(--text-primary);">
                        Evaluation Stages Assignment
                    </h3>
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
                        Assign evaluators to each evaluation stage. Each stage requires at least one evaluator.
                    </p>

                    <!-- Stage 1: Eligibility -->
                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200);">
                        <div style="font-weight: 600; margin-bottom: var(--spacing-sm); display: flex; justify-content: space-between; align-items: center;">
                            <span>Step 1: Eligibility & Formal Criteria</span>
                            <span style="font-size: 11px; color: var(--success-500);">‚úì 2 Assigned</span>
                        </div>
                        <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                            <div class="eval-team-badge">
                                John Smith
                                <button onclick="removeFromStage(1, 'john')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;">√ó</button>
                            </div>
                            <div class="eval-team-badge">
                                Sarah Johnson
                                <button onclick="removeFromStage(1, 'sarah')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;">√ó</button>
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToStage(1)">
                                <i class="pi pi-plus"></i> Add
                            </button>
                        </div>
                    </div>

                    <!-- Stage 2: Qualification -->
                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200);">
                        <div style="font-weight: 600; margin-bottom: var(--spacing-sm); display: flex; justify-content: space-between; align-items: center;">
                            <span>Step 2: Qualification Criteria</span>
                            <span style="font-size: 11px; color: var(--success-500);">‚úì 2 Assigned</span>
                        </div>
                        <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                            <div class="eval-team-badge">
                                John Smith
                                <button onclick="removeFromStage(2, 'john')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;">√ó</button>
                            </div>
                            <div class="eval-team-badge">
                                Sarah Johnson
                                <button onclick="removeFromStage(2, 'sarah')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;">√ó</button>
                            </div>
                            <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToStage(2)">
                                <i class="pi pi-plus"></i> Add
                            </button>
                        </div>
                    </div>

                    <!-- Stage 3: Technical -->
                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md); border: 1px solid var(--surface-200);">
                        <div style="font-weight: 600; margin-bottom: var(--spacing-sm); display: flex; justify-content: space-between; align-items: center;">
                            <span>Step 3: Technical Criteria</span>
                            <span style="font-size: 11px; color: var(--primary-400);">‚è≥ Lot-specific</span>
                        </div>
                        <div style="margin-left: var(--spacing-md); margin-top: var(--spacing-md);">
                            <div style="margin-bottom: var(--spacing-md);">
                                <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);">Lot 1: Personal Protective Equipment</div>
                                <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                    <div class="eval-team-badge">
                                        John Smith
                                        <button onclick="removeFromLot(3, 'lot1', 'john')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;">√ó</button>
                                    </div>
                                    <div class="eval-team-badge">
                                        Maria Garcia
                                        <button onclick="removeFromLot(3, 'lot1', 'maria')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;">√ó</button>
                                    </div>
                                    <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToLot(3, 'lot1')">
                                        <i class="pi pi-plus"></i> Add
                                    </button>
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);">Lot 2: Medical Consumables</div>
                                <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                    <div class="eval-team-badge">
                                        Sarah Johnson
                                        <button onclick="removeFromLot(3, 'lot2', 'sarah')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;">√ó</button>
                                    </div>
                                    <div class="eval-team-badge">
                                        David Lee
                                        <button onclick="removeFromLot(3, 'lot2', 'david')" style="background: none; border: none; cursor: pointer; color: var(--danger-500); padding: 0; margin-left: 4px;">√ó</button>
                                    </div>
                                    <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToLot(3, 'lot2')">
                                        <i class="pi pi-plus"></i> Add
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stage 4: Financial -->
                    <div style="background: var(--surface-50); padding: var(--spacing-md); border-radius: var(--radius-md); border: 1px solid var(--surface-200);">
                        <div style="font-weight: 600; margin-bottom: var(--spacing-sm); display: flex; justify-content: space-between; align-items: center;">
                            <span>Step 4: Financial Evaluation</span>
                            <span style="font-size: 11px; color: var(--warning-500);">‚ö†Ô∏è Not Assigned</span>
                        </div>
                        <div style="margin-left: var(--spacing-md); margin-top: var(--spacing-md);">
                            <div style="margin-bottom: var(--spacing-md);">
                                <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);">Lot 1: Personal Protective Equipment</div>
                                <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                    <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToLot(4, 'lot1')">
                                        <i class="pi pi-plus"></i> Add Evaluator
                                    </button>
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 13px; font-weight: 600; margin-bottom: var(--spacing-xs);">Lot 2: Medical Consumables</div>
                                <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                                    <button class="btn btn-secondary btn-sm" onclick="addEvaluatorToLot(4, 'lot2')">
                                        <i class="pi pi-plus"></i> Add Evaluator
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Available Evaluators Pool -->
                <div style="background: var(--info-50); padding: var(--spacing-md); border-radius: var(--radius-md); border-left: 4px solid var(--info-400);">
                    <h4 style="font-size: 14px; font-weight: 600; margin-bottom: var(--spacing-sm); color: var(--info-600);">
                        üí° Available Evaluators
                    </h4>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: var(--spacing-sm);">
                        Select evaluators from your organization's roster:
                    </div>
                    <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                        <span class="eval-team-badge" style="background: white;">John Smith</span>
                        <span class="eval-team-badge" style="background: white;">Sarah Johnson</span>
                        <span class="eval-team-badge" style="background: white;">Maria Garcia</span>
                        <span class="eval-team-badge" style="background: white;">David Lee</span>
                        <span class="eval-team-badge" style="background: white;">Anna Chen</span>
                        <span class="eval-team-badge" style="background: white;">Michael Brown</span>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeEvaluationTeamModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveEvaluationTeam()">
                    <i class="pi pi-check"></i> Save Team Assignment
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTenderId = null;
        let currentTenderTitle = null;
        let currentAmendmentStep = 1;
        let selectedCategories = [];
        let highestTier = 1;

        // View Management
        function showDashboard() {
            document.querySelectorAll('.view-section').forEach(section => section.classList.remove('active'));
            document.getElementById('view-dashboard').classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Store current tender data
        let currentTenderData = {};

        function showTenderDetails(tenderData) {
            // Store tender data
            if (tenderData) {
                currentTenderData = tenderData;
                currentTenderId = tenderData.id;
                currentTenderTitle = tenderData.title;
            } else if (currentTenderId && !currentTenderData.id) {
                // Fallback: if called without data but currentTenderId is set (from preview)
                currentTenderData = {
                    id: currentTenderId,
                    title: currentTenderTitle,
                    status: 'Posted',
                    statusKey: 'active'
                };
            }

            // Switch to details view
            document.querySelectorAll('.view-section').forEach(section => section.classList.remove('active'));
            document.getElementById('view-tender-details').classList.add('active');
            
            // Update banner info
            document.getElementById('details-tender-id').textContent = 'Reference: ' + (currentTenderData.id || currentTenderId);
            document.getElementById('details-tender-title').textContent = currentTenderData.title || currentTenderTitle;
            document.getElementById('details-tender-status').textContent = currentTenderData.status || 'Posted';
            
            // Update action buttons based on status
            updateDetailsActions(currentTenderData.statusKey || 'active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateDetailsActions(statusKey) {
            const actionsContainer = document.getElementById('tender-details-actions');
            
            // Define actions for each status
            const actionsByStatus = {
                'active': `
                    <button class="btn btn-primary" onclick="openAmendModalFromDetails()">
                        <i class="pi pi-pencil"></i> Amend Tender
                    </button>
                    <button class="btn btn-danger" onclick="openCancelModalFromDetails()">
                        <i class="pi pi-times-circle"></i> Cancel Tender
                    </button>
                    <button class="btn btn-secondary" onclick="openClarificationsFromDetails()">
                        <i class="pi pi-comment"></i> Manage Clarifications (5)
                    </button>
                `,
                'draft': `
                    <button class="btn btn-primary">
                        <i class="pi pi-pencil"></i> Continue Editing
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-send"></i> Submit for Pre-Clearance
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-copy"></i> Duplicate
                    </button>
                    <button class="btn btn-danger">
                        <i class="pi pi-trash"></i> Delete Draft
                    </button>
                `,
                'pre-clearance': `
                    <button class="btn btn-secondary">
                        <i class="pi pi-history"></i> View Comments
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-download"></i> Download Package
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-pencil"></i> Edit (Return to Draft)
                    </button>
                `,
                'approval': `
                    <button class="btn btn-secondary">
                        <i class="pi pi-history"></i> View Review Comments
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-users"></i> View Reviewers
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-pencil"></i> Edit (Return to Draft)
                    </button>
                `,
                'tme-signed': `
                    <button class="btn btn-success">
                        <i class="pi pi-send"></i> Publish Tender
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-eye"></i> Preview Public Page
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-download"></i> Download Package
                    </button>
                `,
                'closed': `
                    <button class="btn btn-success">
                        <i class="pi pi-envelope-open"></i> Start Bid Opening
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-users"></i> View Bidders
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-download"></i> Download All Bids
                    </button>
                `,
                'bid-opening': `
                    <button class="btn btn-success">
                        <i class="pi pi-folder-open"></i> Continue Opening
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-file-pdf"></i> Opening Report
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-users"></i> View Opened Bids
                    </button>
                `,
                'evaluation': `
                    <button class="btn btn-success" onclick="showEvaluation(currentTenderData.id, currentTenderData.title, 'evaluator')">
                        <i class="pi pi-chart-bar"></i> Continue Evaluation
                    </button>
                    <button class="btn btn-secondary" onclick="showEvaluation(currentTenderData.id, currentTenderData.title, 'po')">
                        <i class="pi pi-user"></i> PO View
                    </button>
                    <button class="btn btn-secondary" onclick="showEvaluation(currentTenderData.id, currentTenderData.title, 'comparison')">
                        <i class="pi pi-table"></i> Comparison View
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-users"></i> Evaluation Team
                    </button>
                `,
                'award': `
                    <button class="btn btn-success">
                        <i class="pi pi-file-edit"></i> Sign Report
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-file-pdf"></i> View Award Report
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-user"></i> Recommended Supplier
                    </button>
                `,
                'finalized': `
                    <button class="btn btn-secondary">
                        <i class="pi pi-file"></i> View Contract
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-history"></i> Tender History
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-download"></i> Download Documents
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-user"></i> View Supplier Details
                    </button>
                `,
                'cancelled': `
                    <button class="btn btn-secondary">
                        <i class="pi pi-history"></i> Cancellation Details
                    </button>
                    <button class="btn btn-secondary">
                        <i class="pi pi-download"></i> Download Documents
                    </button>
                    <button class="btn btn-primary">
                        <i class="pi pi-copy"></i> Reopen/Clone Tender
                    </button>
                `
            };
            
            const actions = actionsByStatus[statusKey] || actionsByStatus['active'];
            actionsContainer.innerHTML = actions;
        }

        function filterTenders() {
            const filterValue = event.target.value;
            const cards = document.querySelectorAll('.tender-card');
            
            cards.forEach(card => {
                const status = card.getAttribute('data-status');
                if (filterValue === 'all' || filterValue === status) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('mainSidebar');
            sidebar.classList.toggle('collapsed');
        }

        // Tender Preview - with toggle functionality
        function viewTenderPreview(tenderId, tenderTitle) {
            const previewPanel = document.getElementById('tender-preview-sidebar');
            
            // If clicking the same tender and panel is open, close it (toggle)
            if (previewPanel.classList.contains('open') && 
                currentTenderId === tenderId) {
                closeTenderPreview();
                return;
            }
            
            // Otherwise, update and open
            currentTenderId = tenderId;
            currentTenderTitle = tenderTitle;
            document.getElementById('preview-tender-id').textContent = tenderId;
            document.getElementById('preview-tender-title').textContent = tenderTitle;
            previewPanel.classList.add('open');
        }

        function closeTenderPreview() {
            document.getElementById('tender-preview-sidebar').classList.remove('open');
        }

        function toggleCollapseSidebar(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.collapsible-icon');
            
            if (content.style.display === 'none' || !content.style.display) {
                content.style.display = 'block';
                icon.classList.remove('rotated');
            } else {
                content.style.display = 'none';
                icon.classList.add('rotated');
            }
        }

        function openAmendModalFromPreview() {
            openAmendModal(currentTenderId, currentTenderTitle);
        }

        function openCancelModalFromPreview() {
            openCancelModal(currentTenderId, currentTenderTitle);
        }

        function openAmendModalFromDetails() {
            openAmendModal(currentTenderId, currentTenderTitle);
        }

        function openCancelModalFromDetails() {
            openCancelModal(currentTenderId, currentTenderTitle);
        }

        function toggleItemCard(header, event) {
            // Prevent any parent click handlers
            if (event) {
                event.stopPropagation();
            }

            const content = header.nextElementSibling;
            const arrow = header.querySelector('.collapsible-arrow');

            if (!content || !arrow) {
                console.error('Could not find content or arrow element', header);
                return;
            }

            // Toggle the expanded state
            const isExpanded = content.classList.contains('expanded');

            if (isExpanded) {
                content.classList.remove('expanded');
                arrow.classList.remove('rotated');
            } else {
                content.classList.add('expanded');
                arrow.classList.add('rotated');
            }
        }

        // Clarifications Modal
        function openClarificationsModal(tenderId, tenderTitle) {
            currentTenderId = tenderId;
            currentTenderTitle = tenderTitle;
            document.getElementById('clarificationsTenderTitle').textContent = tenderId;
            document.getElementById('clarificationsModal').classList.add('active');
        }

        function closeClarificationsModal() {
            document.getElementById('clarificationsModal').classList.remove('active');
        }

        function openClarificationsFromDetails() {
            openClarificationsModal(currentTenderId, currentTenderTitle);
        }

        // ===== EVALUATION FUNCTIONS =====
        let currentEvaluationRole = 'evaluator';
        let currentEvaluationStep = 1; // Start with Eligibility by default
        let currentVendorEval = 'vendor1';
        let currentEvalView = 'supplier'; // 'supplier' or 'lot'

        // Evaluation data structure
        const evaluationData = {
            step1: { // Eligibility & Formal
                name: 'Eligibility & Formal Criteria',
                requirements: [
                    {
                        id: 'E1',
                        description: 'Supplier nationality eligibility check',
                        type: 'Bid Level',
                        mandatory: true,
                        bidderResponse: 'Germany',
                        systemEval: 'pass',
                        supplierDocs: [
                            { name: 'Company_Registration.pdf', size: '1.2 MB', date: '2024-11-10' }
                        ],
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Nationality verified against eligible countries list.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    },
                    {
                        id: 'E2',
                        description: 'UNGM registration status',
                        type: 'Bid Level',
                        mandatory: true,
                        bidderResponse: 'Active - UNGM ID: 309663',
                        systemEval: 'pass',
                        supplierDocs: [
                            { name: 'UNGM_Certificate.pdf', size: '890 KB', date: '2024-11-10' }
                        ],
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'UNGM registration active and valid.' },
                            po: { status: 'pass', comment: 'Verified.' }
                        }
                    },
                    {
                        id: 'E3',
                        description: 'Acceptance of general conditions of contract',
                        type: 'Bid Level',
                        mandatory: true,
                        bidderResponse: 'Accepted without deviation',
                        systemEval: 'pass',
                        supplierDocs: [
                            { name: 'Signed_GCC.pdf', size: '2.1 MB', date: '2024-11-10' }
                        ],
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'GCC signed without reservations.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    }
                ]
            },
            step2: { // Qualification
                name: 'Qualification Criteria',
                requirements: [
                    {
                        id: 'Q1',
                        description: 'Minimum 5 years experience in medical supplies',
                        type: 'Bid Level',
                        mandatory: true,
                        bidderResponse: '8 years of experience in medical equipment supply',
                        systemEval: 'pass',
                        supplierDocs: [
                            { name: 'Experience_Statement.pdf', size: '3.4 MB', date: '2024-11-10' },
                            { name: 'Reference_Letters.pdf', size: '2.8 MB', date: '2024-11-10' }
                        ],
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Exceeds minimum requirement. Well documented experience.' },
                            po: { status: 'pass', comment: 'Verified with references.' }
                        }
                    },
                    {
                        id: 'Q2',
                        description: 'ISO 13485 certification for medical devices',
                        type: 'Bid Level',
                        mandatory: true,
                        bidderResponse: 'ISO 13485:2016 certified',
                        systemEval: 'pass',
                        supplierDocs: [
                            { name: 'ISO13485_Certificate.pdf', size: '1.1 MB', date: '2024-11-10' }
                        ],
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Valid ISO certification provided.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    },
                    {
                        id: 'Q3',
                        description: 'Financial capacity - Annual turnover min $500k',
                        type: 'Bid Level',
                        mandatory: true,
                        bidderResponse: 'Annual turnover: $2.3M (2023)',
                        systemEval: 'pass',
                        supplierDocs: [
                            { name: 'Financial_Statements_2023.pdf', size: '4.2 MB', date: '2024-11-10' },
                            { name: 'Auditors_Report.pdf', size: '1.9 MB', date: '2024-11-10' }
                        ],
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Financial statements audited and verified.' },
                            po: { status: 'pass', comment: 'Satisfactory financial capacity.' }
                        }
                    }
                ]
            },
            step3: { // Technical
                name: 'Technical Criteria',
                requirements: [
                    {
                        id: 'T1',
                        description: 'Medical gloves - Latex-free, powder-free examination gloves',
                        type: 'UNSPSC: 42131701',
                        mandatory: true,
                        bidderCompliance: 'Yes',
                        bidderResponse: 'Nitrile examination gloves, powder-free, latex-free. EN455 compliant.',
                        specifications: 'Latex-free, powder-free, EN455 standard',
                        deviation: null,
                        supplierDocs: [
                            { name: 'Gloves_Technical_Spec.pdf', size: '2.1 MB', date: '2024-11-12' },
                            { name: 'EN455_Certificate.pdf', size: '890 KB', date: '2024-11-12' },
                            { name: 'Material_Safety_Sheet.pdf', size: '1.5 MB', date: '2024-11-12' }
                        ],
                        systemEval: 'pass',
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Meets all technical specifications. EN455 certified.' },
                            evaluator2: { status: 'pass', comment: 'Compliant. Good quality documentation.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    },
                    {
                        id: 'T2',
                        description: 'Surgical masks - Type IIR, fluid resistant',
                        type: 'UNSPSC: 42131603',
                        mandatory: true,
                        bidderCompliance: 'Partial',
                        bidderResponse: 'Type II masks provided. Type IIR available at additional cost (+$0.05 per unit).',
                        specifications: 'Type IIR, EN14683 compliant, BFE ‚â•98%',
                        deviation: 'Type II offered instead of Type IIR in base price',
                        supplierDocs: [
                            { name: 'Masks_Specifications.pdf', size: '1.8 MB', date: '2024-11-12' },
                            { name: 'EN14683_Test_Report.pdf', size: '2.4 MB', date: '2024-11-12' }
                        ],
                        systemEval: 'fail',
                        evaluations: {
                            evaluator: { status: 'clarification', comment: 'Clarification needed on Type IIR availability and final pricing.' },
                            evaluator2: { status: 'fail', comment: 'Does not meet mandatory Type IIR requirement.' },
                            po: { status: 'pending', comment: 'Awaiting clarification response.' }
                        }
                    },
                    {
                        id: 'T3',
                        description: 'Syringes - Sterile, single-use, luer lock, 5ml',
                        type: 'UNSPSC: 42131805',
                        mandatory: true,
                        bidderCompliance: 'Yes',
                        bidderResponse: 'Sterile single-use syringes, luer lock, 5ml. ISO 7886-1 compliant.',
                        specifications: 'Sterile, luer lock, ISO 7886-1',
                        deviation: null,
                        supplierDocs: [
                            { name: 'Syringes_Datasheet.pdf', size: '1.6 MB', date: '2024-11-12' },
                            { name: 'ISO7886_Certificate.pdf', size: '780 KB', date: '2024-11-12' },
                            { name: 'Sterility_Test_Report.pdf', size: '2.2 MB', date: '2024-11-12' }
                        ],
                        systemEval: 'pass',
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Fully compliant. ISO certification valid.' },
                            evaluator2: { status: 'pass', comment: 'Meets all specifications.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    },
                    {
                        id: 'T4',
                        description: 'Gauze bandages - Sterile, cotton, various sizes',
                        type: 'UNSPSC: 42131509',
                        mandatory: true,
                        bidderCompliance: 'Yes',
                        bidderResponse: 'Sterile cotton gauze bandages. Multiple sizes: 5cm, 7.5cm, 10cm. Individually wrapped.',
                        specifications: 'Sterile, 100% cotton, various sizes',
                        deviation: null,
                        supplierDocs: [
                            { name: 'Gauze_Specifications.pdf', size: '1.3 MB', date: '2024-11-12' },
                            { name: 'Cotton_Quality_Report.pdf', size: '990 KB', date: '2024-11-12' }
                        ],
                        systemEval: 'pass',
                        evaluations: {
                            evaluator: { status: 'pass', comment: 'Good quality cotton gauze. All sizes provided.' },
                            evaluator2: { status: 'pass', comment: 'Compliant.' },
                            po: { status: 'pass', comment: 'Approved.' }
                        }
                    }
                ]
            },
            step3Lots: { // Technical with Lot structure
                name: 'Technical Criteria',
                lots: [
                    {
                        id: 'lot1',
                        name: 'Lot 1: Personal Protective Equipment',
                        totalValue: '$120,000',
                        items: [
                            {
                                id: 'T1-L1',
                                description: 'Medical gloves - Latex-free, powder-free examination gloves',
                                unspsc: '42131701',
                                quantity: '50,000 boxes',
                                mandatory: true,
                                bidderCompliance: 'Yes',
                                bidderResponse: 'Nitrile examination gloves, powder-free, latex-free. EN455 compliant.',
                                specifications: 'Latex-free, powder-free, EN455 standard',
                                deviation: null,
                                supplierDocs: [
                                    { name: 'Gloves_Technical_Spec.pdf', size: '2.1 MB', date: '2024-11-12' },
                                    { name: 'EN455_Certificate.pdf', size: '890 KB', date: '2024-11-12' }
                                ],
                                systemEval: 'pass',
                                evaluations: {
                                    evaluator: { status: 'pass', comment: 'Meets all technical specifications. EN455 certified.' },
                                    evaluator2: { status: 'pass', comment: 'Compliant. Good quality documentation.' },
                                    po: { status: 'pass', comment: 'Approved.' }
                                }
                            },
                            {
                                id: 'T2-L1',
                                description: 'Surgical masks - Type IIR, fluid resistant',
                                unspsc: '42131603',
                                quantity: '100,000 units',
                                mandatory: true,
                                bidderCompliance: 'Partial',
                                bidderResponse: 'Type II masks provided. Type IIR available at additional cost (+$0.05 per unit).',
                                specifications: 'Type IIR, EN14683 compliant, BFE ‚â•98%',
                                deviation: 'Type II offered instead of Type IIR in base price',
                                supplierDocs: [
                                    { name: 'Masks_Specifications.pdf', size: '1.8 MB', date: '2024-11-12' },
                                    { name: 'EN14683_Test_Report.pdf', size: '2.4 MB', date: '2024-11-12' }
                                ],
                                systemEval: 'fail',
                                evaluations: {
                                    evaluator: { status: 'clarification', comment: 'Clarification needed on Type IIR availability.' },
                                    evaluator2: { status: 'fail', comment: 'Does not meet mandatory Type IIR requirement.' },
                                    po: { status: 'pending', comment: 'Awaiting clarification response.' }
                                }
                            },
                            {
                                id: 'T3-L1',
                                description: 'Face shields - Full face protection, anti-fog',
                                unspsc: '42131605',
                                quantity: '10,000 units',
                                mandatory: true,
                                bidderCompliance: 'Yes',
                                bidderResponse: 'Anti-fog coated face shields with adjustable headband. CE marked.',
                                specifications: 'Full face coverage, anti-fog, adjustable, CE marked',
                                deviation: null,
                                supplierDocs: [
                                    { name: 'Face_Shield_Specs.pdf', size: '1.4 MB', date: '2024-11-12' },
                                    { name: 'CE_Certificate.pdf', size: '650 KB', date: '2024-11-12' }
                                ],
                                systemEval: 'pass',
                                evaluations: {
                                    evaluator: { status: 'pass', comment: 'Fully compliant with specifications.' },
                                    evaluator2: { status: 'pass', comment: 'CE certification valid.' },
                                    po: { status: 'pass', comment: 'Approved.' }
                                }
                            }
                        ]
                    },
                    {
                        id: 'lot2',
                        name: 'Lot 2: Medical Consumables',
                        totalValue: '$180,000',
                        items: [
                            {
                                id: 'T1-L2',
                                description: 'Syringes - Sterile, single-use, luer lock, 5ml',
                                unspsc: '42131805',
                                quantity: '200,000 units',
                                mandatory: true,
                                bidderCompliance: 'Yes',
                                bidderResponse: 'Sterile single-use syringes, luer lock, 5ml. ISO 7886-1 compliant.',
                                specifications: 'Sterile, luer lock, ISO 7886-1',
                                deviation: null,
                                supplierDocs: [
                                    { name: 'Syringes_Datasheet.pdf', size: '1.6 MB', date: '2024-11-12' },
                                    { name: 'ISO7886_Certificate.pdf', size: '780 KB', date: '2024-11-12' }
                                ],
                                systemEval: 'pass',
                                evaluations: {
                                    evaluator: { status: 'pass', comment: 'Fully compliant. ISO certification valid.' },
                                    evaluator2: { status: 'pass', comment: 'Meets all specifications.' },
                                    po: { status: 'pass', comment: 'Approved.' }
                                }
                            },
                            {
                                id: 'T2-L2',
                                description: 'Gauze bandages - Sterile, cotton, various sizes',
                                unspsc: '42131509',
                                quantity: '50,000 rolls',
                                mandatory: true,
                                bidderCompliance: 'Yes',
                                bidderResponse: 'Sterile cotton gauze bandages. Multiple sizes: 5cm, 7.5cm, 10cm.',
                                specifications: 'Sterile, 100% cotton, various sizes',
                                deviation: null,
                                supplierDocs: [
                                    { name: 'Gauze_Specifications.pdf', size: '1.3 MB', date: '2024-11-12' }
                                ],
                                systemEval: 'pass',
                                evaluations: {
                                    evaluator: { status: 'pass', comment: 'Good quality cotton gauze. All sizes provided.' },
                                    evaluator2: { status: 'pass', comment: 'Compliant.' },
                                    po: { status: 'pass', comment: 'Approved.' }
                                }
                            },
                            {
                                id: 'T3-L2',
                                description: 'IV Catheters - Sterile, sizes 18G-24G',
                                unspsc: '42131801',
                                quantity: '75,000 units',
                                mandatory: true,
                                bidderCompliance: 'Yes',
                                bidderResponse: 'Sterile IV catheters with safety mechanism. All sizes available.',
                                specifications: 'Sterile, safety mechanism, 18G-24G range',
                                deviation: null,
                                supplierDocs: [
                                    { name: 'IV_Catheter_Specs.pdf', size: '1.9 MB', date: '2024-11-12' },
                                    { name: 'Safety_Features.pdf', size: '1.1 MB', date: '2024-11-12' }
                                ],
                                systemEval: 'pass',
                                evaluations: {
                                    evaluator: { status: 'pass', comment: 'Safety mechanism meets requirements.' },
                                    evaluator2: { status: 'pass', comment: 'All sizes compliant.' },
                                    po: { status: 'pass', comment: 'Approved.' }
                                }
                            }
                        ]
                    }
                ]
            },
            step4: { // Financial - lot-based view
                name: 'Financial Evaluation',
                requirements: [
                    {
                        id: 'F1',
                        description: 'Medical gloves (UNSPSC: 42131701)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '50,000 boxes',
                        unitPrice: '$2.25/box',
                        originalPrice: '$112,500',
                        incotermPrice: '$112,500 (CIF)',
                        corrections: '-$500',
                        negotiations: '-$2,000',
                        finalPrice: '$110,000',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Gloves.xlsx', size: '145 KB', date: '2024-11-12' },
                            { name: 'Unit_Price_Breakdown.pdf', size: '290 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Competitive unit pricing. Minor arithmetic correction applied.' }
                        }
                    },
                    {
                        id: 'F2',
                        description: 'Surgical masks (UNSPSC: 42131603)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '100,000 units',
                        unitPrice: '$0.45/unit',
                        originalPrice: '$45,000',
                        incotermPrice: '$45,000 (CIF)',
                        corrections: '$0',
                        negotiations: '-$1,000',
                        finalPrice: '$44,000',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Masks.xlsx', size: '128 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Good pricing after negotiations.' }
                        }
                    },
                    {
                        id: 'F3',
                        description: 'Face shields (UNSPSC: 42131605)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '10,000 units',
                        unitPrice: '$3.80/unit',
                        originalPrice: '$38,000',
                        incotermPrice: '$38,000 (CIF)',
                        corrections: '$0',
                        negotiations: '-$500',
                        finalPrice: '$37,500',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Shields.xlsx', size: '115 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Reasonable pricing for quality offered.' }
                        }
                    },
                    {
                        id: 'F4',
                        description: 'Syringes (UNSPSC: 42131805)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '200,000 units',
                        unitPrice: '$0.32/unit',
                        originalPrice: '$64,000',
                        incotermPrice: '$64,000 (CIF)',
                        corrections: '$0',
                        negotiations: '-$1,500',
                        finalPrice: '$62,500',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Syringes.xlsx', size: '132 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Competitive pricing. Volume discount applied.' }
                        }
                    },
                    {
                        id: 'F5',
                        description: 'Gauze bandages (UNSPSC: 42131509)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '50,000 rolls',
                        unitPrice: '$1.85/roll',
                        originalPrice: '$92,500',
                        incotermPrice: '$92,500 (CIF)',
                        corrections: '$0',
                        negotiations: '-$1,000',
                        finalPrice: '$91,500',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Gauze.xlsx', size: '118 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Good value for medical grade gauze.' }
                        }
                    },
                    {
                        id: 'F6',
                        description: 'IV Catheters (UNSPSC: 42131801)',
                        type: 'UNSPSC Level',
                        mandatory: true,
                        quantity: '75,000 units',
                        unitPrice: '$0.95/unit',
                        originalPrice: '$71,250',
                        incotermPrice: '$71,250 (CIF)',
                        corrections: '$0',
                        negotiations: '-$1,250',
                        finalPrice: '$70,000',
                        rank: '2 of 6',
                        supplierDocs: [
                            { name: 'Price_Schedule_Catheters.xlsx', size: '125 KB', date: '2024-11-12' }
                        ],
                        evaluations: {
                            po: { status: 'pass', comment: 'Competitive pricing for safety IV catheters.' }
                        }
                    }
                ],
                lots: [
                    {
                        id: 'lot1',
                        name: 'Lot 1: Personal Protective Equipment',
                        totalValue: '$191,500',
                        items: [
                            {
                                id: 'F1-L1',
                                unspsc: '42131701',
                                description: 'Medical gloves - Latex-free, powder-free examination gloves',
                                quantity: '50,000 boxes',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$2.25', totalCurrency: '$112,500', totalIncoterm: '$112,500 (CIF)', corrections: '-$500', negotiations: '-$2,000', finalPrice: '$110,000', rank: '2 of 6' },
                                    vendor2: { unitPrice: '$2.15', totalCurrency: '$107,500', totalIncoterm: '$107,500 (CIF)', corrections: '$0', negotiations: '-$1,000', finalPrice: '$106,500', rank: '1 of 6' },
                                    vendor3: { unitPrice: '$2.35', totalCurrency: '$117,500', totalIncoterm: '$117,500 (CIF)', corrections: '$0', negotiations: '-$1,500', finalPrice: '$116,000', rank: '3 of 6' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Gloves_V1.xlsx', size: '145 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Gloves_V2.xlsx', size: '138 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Gloves_V3.xlsx', size: '152 KB', date: '2024-11-10' }]
                                }
                            },
                            {
                                id: 'F2-L1',
                                unspsc: '42131603',
                                description: 'Surgical masks - Type IIR, fluid resistant',
                                quantity: '100,000 units',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$0.45', totalCurrency: '$45,000', totalIncoterm: '$45,000 (CIF)', corrections: '$0', negotiations: '-$1,000', finalPrice: '$44,000', rank: '2 of 6' },
                                    vendor2: { unitPrice: '$0.42', totalCurrency: '$42,000', totalIncoterm: '$42,000 (CIF)', corrections: '$0', negotiations: '-$500', finalPrice: '$41,500', rank: '1 of 6' },
                                    vendor3: { unitPrice: '$0.48', totalCurrency: '$48,000', totalIncoterm: '$48,000 (CIF)', corrections: '$0', negotiations: '-$800', finalPrice: '$47,200', rank: '3 of 6' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Masks_V1.xlsx', size: '128 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Masks_V2.xlsx', size: '125 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Masks_V3.xlsx', size: '130 KB', date: '2024-11-10' }]
                                }
                            },
                            {
                                id: 'F3-L1',
                                unspsc: '42131605',
                                description: 'Face shields - Full face protection, anti-fog',
                                quantity: '10,000 units',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$3.80', totalCurrency: '$38,000', totalIncoterm: '$38,000 (CIF)', corrections: '$0', negotiations: '-$500', finalPrice: '$37,500', rank: '2 of 6' },
                                    vendor2: { unitPrice: '$3.65', totalCurrency: '$36,500', totalIncoterm: '$36,500 (CIF)', corrections: '$0', negotiations: '-$300', finalPrice: '$36,200', rank: '1 of 6' },
                                    vendor3: { unitPrice: '$3.95', totalCurrency: '$39,500', totalIncoterm: '$39,500 (CIF)', corrections: '$0', negotiations: '-$400', finalPrice: '$39,100', rank: '3 of 6' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Shields_V1.xlsx', size: '115 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Shields_V2.xlsx', size: '112 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Shields_V3.xlsx', size: '118 KB', date: '2024-11-10' }]
                                }
                            }
                        ]
                    },
                    {
                        id: 'lot2',
                        name: 'Lot 2: Medical Consumables',
                        totalValue: '$224,000',
                        items: [
                            {
                                id: 'F1-L2',
                                unspsc: '42131805',
                                description: 'Syringes - Sterile, single-use, luer lock, 5ml',
                                quantity: '200,000 units',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$0.32', totalCurrency: '$64,000', totalIncoterm: '$64,000 (CIF)', corrections: '$0', negotiations: '-$1,500', finalPrice: '$62,500', rank: '2 of 6' },
                                    vendor2: { unitPrice: '$0.30', totalCurrency: '$60,000', totalIncoterm: '$60,000 (CIF)', corrections: '$0', negotiations: '-$1,000', finalPrice: '$59,000', rank: '1 of 6' },
                                    vendor3: { unitPrice: '$0.34', totalCurrency: '$68,000', totalIncoterm: '$68,000 (CIF)', corrections: '$0', negotiations: '-$1,200', finalPrice: '$66,800', rank: '3 of 6' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Syringes_V1.xlsx', size: '132 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Syringes_V2.xlsx', size: '128 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Syringes_V3.xlsx', size: '135 KB', date: '2024-11-10' }]
                                }
                            },
                            {
                                id: 'F2-L2',
                                unspsc: '42131509',
                                description: 'Gauze bandages - Sterile, cotton, various sizes',
                                quantity: '50,000 rolls',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$1.85', totalCurrency: '$92,500', totalIncoterm: '$92,500 (CIF)', corrections: '$0', negotiations: '-$1,000', finalPrice: '$91,500', rank: '2 of 6' },
                                    vendor2: { unitPrice: '$1.75', totalCurrency: '$87,500', totalIncoterm: '$87,500 (CIF)', corrections: '$0', negotiations: '-$800', finalPrice: '$86,700', rank: '1 of 6' },
                                    vendor3: { unitPrice: '$1.95', totalCurrency: '$97,500', totalIncoterm: '$97,500 (CIF)', corrections: '$0', negotiations: '-$900', finalPrice: '$96,600', rank: '3 of 6' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Gauze_V1.xlsx', size: '118 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Gauze_V2.xlsx', size: '115 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Gauze_V3.xlsx', size: '120 KB', date: '2024-11-10' }]
                                }
                            },
                            {
                                id: 'F3-L2',
                                unspsc: '42131801',
                                description: 'IV Catheters - Sterile, sizes 18G-24G',
                                quantity: '75,000 units',
                                mandatory: true,
                                prices: {
                                    vendor1: { unitPrice: '$0.95', totalCurrency: '$71,250', totalIncoterm: '$71,250 (CIF)', corrections: '$0', negotiations: '-$1,250', finalPrice: '$70,000', rank: '2 of 6' },
                                    vendor2: { unitPrice: '$0.88', totalCurrency: '$66,000', totalIncoterm: '$66,000 (CIF)', corrections: '$0', negotiations: '-$800', finalPrice: '$65,200', rank: '1 of 6' },
                                    vendor3: { unitPrice: '$0.98', totalCurrency: '$73,500', totalIncoterm: '$73,500 (CIF)', corrections: '$0', negotiations: '-$1,000', finalPrice: '$72,500', rank: '3 of 6' }
                                },
                                supplierDocs: {
                                    vendor1: [{ name: 'Price_Schedule_Catheters_V1.xlsx', size: '125 KB', date: '2024-11-12' }],
                                    vendor2: [{ name: 'Price_Schedule_Catheters_V2.xlsx', size: '122 KB', date: '2024-11-11' }],
                                    vendor3: [{ name: 'Price_Schedule_Catheters_V3.xlsx', size: '128 KB', date: '2024-11-10' }]
                                }
                            }
                        ]
                    }
                ]
            }
        };

        function showEvaluation(tenderId, tenderTitle, role) {
            currentTenderId = tenderId;
            currentTenderTitle = tenderTitle;
            currentEvaluationRole = role || 'evaluator';
            
            document.getElementById('eval-tender-title').textContent = tenderId + ': ' + tenderTitle;
            document.getElementById('eval-user-role').textContent = currentEvaluationRole === 'po' ? 'Procurement Official' : 'Evaluator';
            
            document.querySelectorAll('.view-section').forEach(section => section.classList.remove('active'));
            document.getElementById('view-evaluation').classList.add('active');
            
            // Show/hide view toggle based on current step
            const viewToggle = document.getElementById('viewToggle');
            if (viewToggle) {
                viewToggle.style.display = (currentEvaluationStep === 3 || currentEvaluationStep === 4) ? 'flex' : 'none';
            }
            
            updateRoleButtons();
            switchEvaluationStep(currentEvaluationStep); // This will render the table
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function switchEvaluationRole(role) {
            currentEvaluationRole = role;
            updateRoleButtons();
            renderEvaluationTable();
        }

        function updateRoleButtons() {
            document.querySelectorAll('#view-evaluation .btn-secondary').forEach(btn => {
                btn.style.background = 'var(--surface-200)';
                btn.style.color = 'var(--text-secondary)';
            });
            
            const roleMap = {
                'evaluator': 'role-evaluator-btn',
                'po': 'role-po-btn',
                'comparison': 'role-comparison-btn'
            };
            
            const activeBtn = document.getElementById(roleMap[currentEvaluationRole]);
            if (activeBtn) {
                activeBtn.style.background = 'var(--primary-400)';
                activeBtn.style.color = 'white';
            }
            
            const noteElement = document.getElementById('eval-role-note');
            const noteMap = {
                'evaluator': '<strong>üë®‚Äçüíº Evaluator View:</strong> Review system-generated evaluation and provide your independent assessment.',
                'po': '<strong>üëî Procurement Official View:</strong> Review all evaluator inputs and provide final ratings.',
                'comparison': '<strong>üìä Comparison View:</strong> View all evaluations side-by-side to identify discrepancies.'
            };
            noteElement.innerHTML = noteMap[currentEvaluationRole] || noteMap['evaluator'];
        }

        function switchEvaluationStep(step) {
            currentEvaluationStep = step;
            
            // Show/hide view toggle based on step (show for Technical step 3 and Financial step 4)
            const viewToggle = document.getElementById('viewToggle');
            if (viewToggle) {
                viewToggle.style.display = (step === 3 || step === 4) ? 'flex' : 'none';
            }
            
            // Reset to supplier view when changing steps
            if (step !== 3 && step !== 4) {
                currentEvalView = 'supplier';
            }
            
            // Update tabs based on current view
            if (currentEvalView === 'lot' && (step === 3 || step === 4)) {
                const tabsContainer = document.getElementById('evalTabsContainer');
                tabsContainer.innerHTML = `
                    <button class="lot-tab ${currentLotId === 'lot1' ? 'active' : ''}" onclick="switchLot('lot1')">üì¶ Lot 1: PPE</button>
                    <button class="lot-tab ${currentLotId === 'lot2' ? 'active' : ''}" onclick="switchLot('lot2')">üì¶ Lot 2: Medical Consumables</button>
                `;
            }
            
            document.querySelectorAll('.eval-step').forEach(el => {
                el.classList.remove('active', 'completed');
            });
            
            document.querySelectorAll('.eval-step').forEach((el, index) => {
                const stepNum = index + 1;
                if (stepNum < currentEvaluationStep) {
                    el.classList.add('completed');
                    el.querySelector('div').innerHTML = '‚úì';
                    el.querySelector('div').style.background = 'var(--success-500)';
                    el.querySelector('div').style.borderColor = 'var(--success-500)';
                    el.querySelectorAll('div')[1].style.color = 'var(--success-500)';
                } else if (stepNum === currentEvaluationStep) {
                    el.classList.add('active');
                    el.querySelector('div').innerHTML = stepNum;
                    el.querySelector('div').style.background = 'var(--primary-400)';
                    el.querySelector('div').style.borderColor = 'var(--primary-400)';
                    el.querySelectorAll('div')[1].style.color = 'var(--primary-400)';
                    el.querySelectorAll('div')[1].style.fontWeight = '600';
                } else {
                    el.querySelector('div').innerHTML = stepNum;
                    el.querySelector('div').style.background = 'var(--surface-0)';
                    el.querySelector('div').style.borderColor = 'var(--surface-200)';
                    el.querySelector('div').style.color = 'var(--text-muted)';
                    el.querySelectorAll('div')[1].style.color = 'var(--text-muted)';
                    el.querySelectorAll('div')[1].style.fontWeight = '500';
                }
            });
            
            renderEvaluationTable();
        }

        function switchVendorEval(vendorId) {
            currentVendorEval = vendorId;
            
            document.querySelectorAll('.vendor-eval-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const vendorNames = {
                'vendor1': 'MedSupply Ltd.',
                'vendor2': 'HealthCare Corp.',
                'vendor3': 'MedTech Inc.'
            };
            
            document.getElementById('vendor-eval-name').textContent = vendorNames[vendorId];
            
            // Show notification if in lot view
            if (currentEvalView === 'lot') {
                showToast(`üì¶ Viewing evaluations for ${vendorNames[vendorId]}`);
            }
            
            renderEvaluationTable();
        }

        function renderEvaluationTable() {
            const container = document.getElementById('evaluation-table-container');
            
            // Determine step key based on current evaluation step and view
            let stepKey;
            if (currentEvaluationStep === 3) {
                stepKey = 'step3Lots';
            } else {
                stepKey = 'step' + currentEvaluationStep;
            }
            
            const stepData = evaluationData[stepKey];
            
            if (!stepData) {
                container.innerHTML = '<p>No evaluation data available for this step.</p>';
                return;
            }
            
            // Render based on view type
            if (currentEvalView === 'lot' && stepData.lots) {
                if (currentEvaluationStep === 4) {
                    renderFinancialLotView(container, stepData);
                } else if (currentEvaluationStep === 3) {
                    renderLotView(container, stepData);
                }
            } else if (currentEvaluationRole === 'comparison') {
                renderComparisonView(container, stepData);
            } else if (currentEvaluationRole === 'po') {
                renderPOView(container, stepData);
            } else {
                renderEvaluatorView(container, stepData);
            }
        }

        function renderEvaluatorView(container, stepData) {
            let html = '';
            
            // For technical step 3, group by UNSPSC similar to lot view
            if (currentEvaluationStep === 3 && stepData.lots) {
                // Get current vendor data
                const vendorNames = {
                    'vendor1': 'MedSupply Ltd.',
                    'vendor2': 'HealthCare Corp.',
                    'vendor3': 'MedTech Inc.'
                };
                
                html += `
                    <div style="background: var(--info-50); padding: var(--spacing-md); border-left: 4px solid var(--info-400); border-radius: var(--radius-sm); margin-bottom: var(--spacing-lg);">
                        <strong>Evaluating: ${vendorNames[currentVendorEval]}</strong> - Technical specifications grouped by product (UNSPSC code)
                    </div>
                `;
                
                stepData.lots.forEach((lot, lotIndex) => {
                    html += `
                        <div style="background: var(--primary-50); padding: var(--spacing-md); margin-bottom: var(--spacing-md); border-radius: var(--radius-sm); border-left: 4px solid var(--primary-400);">
                            <strong>${lot.name}</strong>
                            <span style="margin-left: var(--spacing-md); color: var(--primary-400);">${lot.items.length} Items</span>
                        </div>
                    `;
                    
                    lot.items.forEach((item, itemIndex) => {
                        const currentEval = item.evaluations.evaluator;
                        html += `
                            <div class="unspsc-collapsible">
                                <div class="unspsc-header" onclick="toggleUnspsc('supplier-unspsc-${item.id}')">
                                    <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                        <span id="supplier-unspsc-${item.id}-icon" style="font-size: 14px; transition: transform 0.3s ease;">‚ñº</span>
                                        <div>
                                            <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">UNSPSC ${item.unspsc}</div>
                                            <div style="font-weight: 600; color: var(--text-primary); margin-top: 2px;">${item.description}</div>
                                        </div>
                                    </div>
                                    <div class="${item.mandatory ? 'mandatory-flag' : 'optional-flag'}" style="margin: 0;">
                                        ${item.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                                    </div>
                                </div>
                                <div id="supplier-unspsc-${item.id}" class="unspsc-content">
                                    <div style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-sm);">
                                        <div style="background: var(--info-50); padding: var(--spacing-sm); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md); font-size: 12px;">
                                            <strong>Required Qty:</strong> ${item.quantity} | <strong>Specifications:</strong> ${item.specifications}
                                        </div>
                                        <table class="eval-table" style="margin-bottom: 0;">
                                            <thead>
                                                <tr>
                                                    <th style="width: 100px;">Compliance</th>
                                                    <th>Bidder Response</th>
                                                    <th style="width: 150px;">Deviation</th>
                                                    <th style="width: 200px;">Documents</th>
                                                    <th class="system-eval-column" style="width: 100px;">System</th>
                                                    <th class="manual-eval-column" style="width: 130px;">Your Eval</th>
                                                    <th class="manual-eval-column" style="width: 250px;">Comments</th>
                                                    <th class="manual-eval-column" style="width: 80px;">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>${item.bidderCompliance === 'Yes' ? '‚úÖ Yes' : item.bidderCompliance === 'No' ? '‚ùå No' : '‚ö†Ô∏è Partial'}</td>
                                                    <td>
                                                        ${item.bidderResponse}
                                                        ${item.deviation ? `<div class="deviation-badge" style="margin-top: var(--spacing-sm);"><strong>‚ö†Ô∏è Deviation:</strong> ${item.deviation}</div>` : ''}
                                                    </td>
                                                    <td style="color: ${item.deviation ? 'var(--danger-500)' : 'var(--text-muted)'}; font-size: 12px;">${item.deviation || '-'}</td>
                                                    <td>${renderSupplierDocs(item.supplierDocs)}</td>
                                                    <td class="system-eval-column">
                                                        <span class="eval-status-badge ${item.systemEval}">${item.systemEval === 'pass' ? '‚úÖ Pass' : '‚ùå Fail'}</span>
                                                    </td>
                                                    <td class="manual-eval-column">
                                                        <select class="eval-select ${currentEval.status}">
                                                            <option value="not_evaluated" ${currentEval.status === 'not_evaluated' ? 'selected' : ''}>‚äò Not Evaluated</option>
                                                            <option value="pass" ${currentEval.status === 'pass' ? 'selected' : ''}>‚úÖ Pass</option>
                                                            <option value="fail" ${currentEval.status === 'fail' ? 'selected' : ''}>‚ùå Fail</option>
                                                            <option value="clarification" ${currentEval.status === 'clarification' ? 'selected' : ''}>‚ö†Ô∏è Clarification</option>
                                                        </select>
                                                    </td>
                                                    <td class="manual-eval-column">
                                                        <textarea class="eval-comment-field" placeholder="Enter your comments...">${currentEval.comment}</textarea>
                                                    </td>
                                                    <td class="manual-eval-column" style="text-align: center;">
                                                        <button class="btn btn-secondary" onclick="requestEvalClarification('${item.id}')" title="Request Clarification">
                                                            üí¨
                                                        </button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                });
                
                container.innerHTML = html;
                return;
            }
            
            // For financial step 4, use UNSPSC grouping like technical and lot view
            if (currentEvaluationStep === 4 && stepData.lots) {
                // Get current vendor data
                const vendorNames = {
                    'vendor1': 'MedSupply Ltd.',
                    'vendor2': 'HealthCare Corp.',
                    'vendor3': 'MedTech Inc.'
                };
                
                html += `
                    <div style="background: var(--info-50); padding: var(--spacing-md); border-left: 4px solid var(--info-400); border-radius: var(--radius-sm); margin-bottom: var(--spacing-lg);">
                        <strong>Financial Evaluation: ${vendorNames[currentVendorEval]}</strong> - Products grouped by UNSPSC code
                    </div>
                `;
                
                stepData.lots.forEach((lot, lotIndex) => {
                    html += `
                        <div style="background: var(--primary-50); padding: var(--spacing-md); margin-bottom: var(--spacing-md); border-radius: var(--radius-sm); border-left: 4px solid var(--primary-400);">
                            <strong>${lot.name}</strong>
                            <span style="margin-left: var(--spacing-md); color: var(--primary-400);">${lot.items.length} Items</span>
                        </div>
                    `;
                    
                    lot.items.forEach((item, itemIndex) => {
                        const priceData = item.prices[currentVendorEval];
                        const docs = item.supplierDocs[currentVendorEval];
                        
                        html += `
                            <div class="unspsc-collapsible">
                                <div class="unspsc-header" onclick="toggleUnspsc('supplier-financial-unspsc-${item.id}')">
                                    <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                        <span id="supplier-financial-unspsc-${item.id}-icon" style="font-size: 14px; transition: transform 0.3s ease;">‚ñº</span>
                                        <div>
                                            <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">UNSPSC ${item.unspsc}</div>
                                            <div style="font-weight: 600; color: var(--text-primary); margin-top: 2px;">${item.description}</div>
                                        </div>
                                    </div>
                                    <div class="${item.mandatory ? 'mandatory-flag' : 'optional-flag'}" style="margin: 0;">
                                        ${item.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                                    </div>
                                </div>
                                <div id="supplier-financial-unspsc-${item.id}" class="unspsc-content">
                                    <div style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-sm);">
                                        <div style="background: var(--info-50); padding: var(--spacing-sm); border-radius: var(--radius-sm); margin-bottom: var(--spacing-md); font-size: 12px;">
                                            <strong>Required Qty:</strong> ${item.quantity}
                                        </div>
                                        <table class="eval-table" style="margin-bottom: 0;">
                                            <thead>
                                                <tr>
                                                    <th style="width: 100px;">Unit Price</th>
                                                    <th style="width: 120px;">Total (Currency)</th>
                                                    <th style="width: 120px;">Total (Incoterm)</th>
                                                    <th style="width: 100px;">Corrections</th>
                                                    <th style="width: 100px;">Negotiations</th>
                                                    <th style="width: 120px;">Final Price</th>
                                                    <th style="width: 80px;">Rank</th>
                                                    <th style="width: 200px;">Documents</th>
                                                    <th class="manual-eval-column" style="width: 250px;">Comments</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td style="font-weight: 600; font-size: 13px;">${priceData.unitPrice}</td>
                                                    <td style="font-weight: 600; font-size: 13px;">${priceData.totalCurrency}</td>
                                                    <td style="font-weight: 600;">${priceData.totalIncoterm}</td>
                                                    <td style="color: var(--danger-500); font-weight: 600;">${priceData.corrections}</td>
                                                    <td style="color: var(--success-500); font-weight: 600;">${priceData.negotiations}</td>
                                                    <td style="font-weight: 700; font-size: 14px; color: var(--primary-600);">${priceData.finalPrice}</td>
                                                    <td><span class="eval-status-badge ${priceData.rank.includes('1') ? 'pass' : 'pending'}">${priceData.rank}</span></td>
                                                    <td>${renderSupplierDocs(docs)}</td>
                                                    <td class="manual-eval-column">
                                                        <textarea class="eval-comment-field" placeholder="Enter your comments..." rows="2"></textarea>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                });
                
                // Add overall evaluation remarks
                html += `
                    <div style="margin-top: var(--spacing-xl); padding: var(--spacing-lg); background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-md);">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--text-primary); font-size: 16px;">Overall Evaluation Stage Remarks</h3>
                        <div style="display: grid; gap: var(--spacing-lg);">
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Justification of Reasonableness of Price</label>
                                <textarea class="eval-comment-field" rows="3" placeholder="Provide justification for price reasonableness..."></textarea>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Negotiations</label>
                                <textarea class="eval-comment-field" rows="3" placeholder="Document negotiations details..."></textarea>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Complaints and Representations</label>
                                <textarea class="eval-comment-field" rows="2" placeholder="Record any complaints or representations..."></textarea>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Indications of Proscribed Practices</label>
                                <textarea class="eval-comment-field" rows="2" placeholder="Note any proscribed practices observed..."></textarea>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Background Checks</label>
                                <textarea class="eval-comment-field" rows="2" placeholder="Summary of background check results..."></textarea>
                            </div>
                        </div>
                    </div>
                `;
                
                container.innerHTML = html;
                return;
            }
            
            // For other steps, use the traditional table format
            let headers = `
                <th style="width: 80px;">Req ID</th>
                <th>Requirement</th>
                <th style="width: 120px;">Type</th>
            `;
            
            headers += `<th>Bidder Response</th>`;
            
            headers += `
                <th style="width: 180px;">Supplier Documents</th>
                <th class="system-eval-column" style="width: 100px;">System</th>
                <th class="manual-eval-column" style="width: 120px;">Your Eval</th>
                <th class="manual-eval-column" style="width: 250px;">Comments</th>
                <th class="manual-eval-column" style="width: 80px;">Action</th>
            `;
            
            let rows = '';
            stepData.requirements.forEach(req => {
                const currentEval = req.evaluations.evaluator || req.evaluations.po;
                
                let row = `
                    <tr>
                        <td><div class="req-id-badge">${req.id}</div></td>
                        <td>
                            ${req.description}
                            <div class="${req.mandatory ? 'mandatory-flag' : 'optional-flag'}">
                                ${req.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                            </div>
                        </td>
                        <td style="font-size: 12px;">${req.type}</td>
                        <td>
                            ${req.bidderResponse}
                            ${req.deviation ? `<div class="deviation-badge"><strong>‚ö†Ô∏è Deviation:</strong> ${req.deviation}</div>` : ''}
                        </td>
                    <td>${renderSupplierDocs(req.supplierDocs || [])}</td>
                    <td class="system-eval-column">
                        ${req.systemEval ? `<span class="eval-status-badge ${req.systemEval}">${req.systemEval === 'pass' ? '‚úÖ Pass' : '‚ùå Fail'}</span>` : '-'}
                    </td>
                    <td class="manual-eval-column">
                        <select class="eval-select ${currentEval.status}">
                            <option value="not_evaluated" ${currentEval.status === 'not_evaluated' ? 'selected' : ''}>‚äò Not Evaluated</option>
                            <option value="pass" ${currentEval.status === 'pass' ? 'selected' : ''}>‚úÖ Pass</option>
                            <option value="fail" ${currentEval.status === 'fail' ? 'selected' : ''}>‚ùå Fail</option>
                            <option value="clarification" ${currentEval.status === 'clarification' ? 'selected' : ''}>‚ö†Ô∏è Clarification</option>
                        </select>
                    </td>
                    <td class="manual-eval-column">
                        <textarea class="eval-comment-field" placeholder="Enter your comments...">${currentEval.comment}</textarea>
                    </td>
                    <td class="manual-eval-column" style="text-align: center;">
                        <button class="btn btn-secondary" onclick="requestEvalClarification('${req.id}')" title="Request Clarification">
                            üí¨
                        </button>
                    </td>
                </tr>
                `;
                
                rows += row;
            });
            
            html += `
                <table class="eval-table">
                    <thead>
                        <tr>${headers}</tr>
                    </thead>
                    <tbody>${rows}</tbody>
                </table>
            `;
            
            container.innerHTML = html;
        }

        function renderFinancialLotView(container, stepData) {
            let html = '';
            
            // Get all vendor data for comparison
            const vendorData = {
                'vendor1': { name: 'MedSupply Ltd.', ungm: '309663', country: 'Germany' },
                'vendor2': { name: 'HealthCare Corp.', ungm: '301245', country: 'USA' },
                'vendor3': { name: 'MedTech Inc.', ungm: '315789', country: 'Japan' }
            };
            
            // Find the selected lot
            const selectedLot = stepData.lots.find(lot => lot.id === currentLotId);
            
            if (!selectedLot) {
                container.innerHTML = '<p>Lot not found.</p>';
                return;
            }
            
            // Add download button for offline evaluation
            html += `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); border: 1px solid var(--surface-200);">
                    <div>
                        <strong>Financial Evaluation: ${selectedLot.name}</strong>
                        <span style="margin-left: var(--spacing-md); color: var(--text-muted);">${selectedLot.items.length} Products</span>
                    </div>
                    <button class="btn btn-primary" onclick="downloadEvaluationExcel('${selectedLot.id}', 'step4')">
                        <i class="pi pi-download"></i> Download Excel for Offline Evaluation
                    </button>
                </div>
            `;
            
            // Group by UNSPSC code and render collapsible comparison for each
            selectedLot.items.forEach((item, itemIndex) => {
                html += `
                    <div class="unspsc-collapsible">
                        <div class="unspsc-header" onclick="toggleUnspsc('financial-unspsc-${item.id}')">
                            <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                <span id="financial-unspsc-${item.id}-icon" style="font-size: 14px; transition: transform 0.3s ease;">‚ñº</span>
                                <div>
                                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">UNSPSC ${item.unspsc}</div>
                                    <div style="font-weight: 600; color: var(--text-primary); margin-top: 2px;">${item.description}</div>
                                </div>
                            </div>
                            <div class="${item.mandatory ? 'mandatory-flag' : 'optional-flag'}" style="margin: 0;">
                                ${item.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                            </div>
                        </div>
                        <div id="financial-unspsc-${item.id}" class="unspsc-content">
                            ${renderFinancialUnspscComparison(item, vendorData)}
                        </div>
                    </div>
                `;
            });
            
            // Add overall evaluation remarks
            html += `
                <div style="margin-top: var(--spacing-xl); padding: var(--spacing-lg); background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-md);">
                    <h3 style="margin-bottom: var(--spacing-lg); color: var(--text-primary); font-size: 16px;">Overall Evaluation Stage Remarks</h3>
                    <div style="display: grid; gap: var(--spacing-lg);">
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Justification of Reasonableness of Price</label>
                            <textarea class="eval-comment-field" rows="3" placeholder="Provide justification for price reasonableness..."></textarea>
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Negotiations</label>
                            <textarea class="eval-comment-field" rows="3" placeholder="Document negotiations details..."></textarea>
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Complaints and Representations</label>
                            <textarea class="eval-comment-field" rows="2" placeholder="Record any complaints or representations..."></textarea>
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Indications of Proscribed Practices</label>
                            <textarea class="eval-comment-field" rows="2" placeholder="Note any proscribed practices observed..."></textarea>
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-sm); font-size: 13px;">Background Checks</label>
                            <textarea class="eval-comment-field" rows="2" placeholder="Summary of background check results..."></textarea>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function renderFinancialUnspscComparison(item, vendorData) {
            let html = `
                <div style="margin-top: var(--spacing-md);">
                    <div style="background: var(--info-50); padding: var(--spacing-sm); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm); font-size: 12px;">
                        <strong>Required Quantity:</strong> ${item.quantity}
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="eval-table" style="margin-bottom: 0;">
                            <thead>
                                <tr>
                                    <th style="width: 150px;">Supplier</th>
                                    <th style="width: 100px;">Unit Price</th>
                                    <th style="width: 120px;">Total (Currency)</th>
                                    <th style="width: 120px;">Total (Incoterm)</th>
                                    <th style="width: 100px;">Corrections</th>
                                    <th style="width: 100px;">Negotiations</th>
                                    <th style="width: 120px;">Final Price</th>
                                    <th style="width: 80px;">Rank</th>
                                    <th style="width: 180px;">Documents</th>
                                    <th class="manual-eval-column" style="width: 250px;">Comments</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            Object.keys(vendorData).forEach((vendorKey, index) => {
                const vendor = vendorData[vendorKey];
                const priceData = item.prices[vendorKey];
                const docs = item.supplierDocs[vendorKey];
                
                html += `
                    <tr>
                        <td>
                            <div style="font-weight: 700; color: var(--primary-600); font-size: 13px; margin-bottom: 2px;">
                                ${vendor.name}
                            </div>
                            <div style="font-size: 11px; color: var(--text-muted);">
                                UNGM: ${vendor.ungm}
                            </div>
                            <div style="font-size: 11px; color: var(--text-muted);">
                                ${vendor.country}
                            </div>
                        </td>
                        <td style="font-weight: 600; font-size: 13px;">${priceData.unitPrice}</td>
                        <td style="font-weight: 600; font-size: 13px;">${priceData.totalCurrency}</td>
                        <td style="font-weight: 600;">${priceData.totalIncoterm}</td>
                        <td style="color: var(--danger-500); font-weight: 600;">${priceData.corrections}</td>
                        <td style="color: var(--success-500); font-weight: 600;">${priceData.negotiations}</td>
                        <td style="font-weight: 700; font-size: 14px; color: var(--primary-600);">${priceData.finalPrice}</td>
                        <td><span class="eval-status-badge ${priceData.rank.includes('1') ? 'pass' : 'pending'}">${priceData.rank}</span></td>
                        <td>${renderSupplierDocs(docs)}</td>
                        <td class="manual-eval-column">
                            <textarea class="eval-comment-field" placeholder="Enter your comments..." rows="2"></textarea>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            return html;
        }
        
        function renderLotView(container, stepData) {
            let html = '';
            
            // Get all vendor data for comparison
            const vendorData = {
                'vendor1': { name: 'MedSupply Ltd.', ungm: '309663', country: 'Germany' },
                'vendor2': { name: 'HealthCare Corp.', ungm: '301245', country: 'USA' },
                'vendor3': { name: 'MedTech Inc.', ungm: '315789', country: 'Japan' }
            };
            
            // Find the selected lot
            const selectedLot = stepData.lots.find(lot => lot.id === currentLotId);
            
            if (!selectedLot) {
                container.innerHTML = '<p>Lot not found.</p>';
                return;
            }
            
            // Add download button for offline evaluation
            html += `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--surface-50); border-radius: var(--radius-md); border: 1px solid var(--surface-200);">
                    <div>
                        <strong>Evaluating: ${selectedLot.name}</strong>
                        <span style="margin-left: var(--spacing-md); color: var(--text-muted);">${selectedLot.items.length} Products</span>
                    </div>
                    <button class="btn btn-primary" onclick="downloadEvaluationExcel('${selectedLot.id}', 'step${currentEvaluationStep}')">
                        <i class="pi pi-download"></i> Download Excel for Offline Evaluation
                    </button>
                </div>
            `;
            
            // Group by UNSPSC code and render collapsible comparison for each
            selectedLot.items.forEach((item, itemIndex) => {
                html += `
                    <div class="unspsc-collapsible">
                        <div class="unspsc-header" onclick="toggleUnspsc('unspsc-${item.id}')">
                            <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                <span id="unspsc-${item.id}-icon" style="font-size: 14px; transition: transform 0.3s ease;">‚ñº</span>
                                <div>
                                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">UNSPSC ${item.unspsc}</div>
                                    <div style="font-weight: 600; color: var(--text-primary); margin-top: 2px;">${item.description}</div>
                                </div>
                            </div>
                            <div class="${item.mandatory ? 'mandatory-flag' : 'optional-flag'}" style="margin: 0;">
                                ${item.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                            </div>
                        </div>
                        <div id="unspsc-${item.id}" class="unspsc-content">
                            ${renderUnspscComparison(item, vendorData, false)}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function toggleUnspsc(id) {
            const content = document.getElementById(id);
            const icon = document.getElementById(id + '-icon');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = '‚ñº';
            } else {
                content.classList.add('collapsed');
                icon.style.transform = 'rotate(-90deg)';
                icon.textContent = '‚ñ∂';
            }
        }
        
        function renderUnspscComparison(item, vendorData, showHeader = true) {
            let html = '';
            
            if (showHeader) {
                html += `
                    <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                        <div style="background: var(--surface-50); padding: var(--spacing-md); margin: calc(-1 * var(--spacing-lg)) calc(-1 * var(--spacing-lg)) var(--spacing-lg); border-radius: var(--radius-md) var(--radius-md) 0 0; border-bottom: 2px solid var(--surface-200);">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-sm);">
                                <div>
                                    <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 4px;">UNSPSC Code</div>
                                    <div style="font-size: 16px; font-weight: 700; color: var(--primary-400);">${item.unspsc}</div>
                                </div>
                                <div class="${item.mandatory ? 'mandatory-flag' : 'optional-flag'}" style="margin: 0;">
                                    ${item.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                                </div>
                            </div>
                            <div style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin-top: var(--spacing-sm);">${item.description}</div>
                            <div style="display: flex; gap: var(--spacing-xl); margin-top: var(--spacing-sm); font-size: 12px; color: var(--text-secondary);">
                                <span><strong>Required Qty:</strong> ${item.quantity}</span>
                                <span><strong>Specifications:</strong> ${item.specifications}</span>
                            </div>
                        </div>
                        
                        <!-- Supplier Comparison Table -->
                        <div style="overflow-x: auto;">
                `;
            } else {
                html += `
                    <div style="margin-top: var(--spacing-md);">
                        <div style="background: var(--info-50); padding: var(--spacing-sm); border-radius: var(--radius-sm); margin-bottom: var(--spacing-sm); font-size: 12px;">
                            <strong>Required Qty:</strong> ${item.quantity} | <strong>Specifications:</strong> ${item.specifications}
                        </div>
                        <div style="overflow-x: auto;">
                `;
            }
            
            html += `
                            <table class="eval-table" style="margin-bottom: 0;">
                                <thead>
                                    <tr>
                                        <th style="width: 150px;">Supplier</th>
                                        <th style="width: 100px;">Compliance</th>
                                        <th>Response / Specifications</th>
                                        <th style="width: 150px;">Deviation</th>
                                        <th style="width: 200px;">Documents</th>
                                        <th class="system-eval-column" style="width: 100px;">System</th>
                                        <th class="manual-eval-column" style="width: 130px;">Your Eval</th>
                                        <th class="manual-eval-column" style="width: 250px;">Comments</th>
                                        <th class="manual-eval-column" style="width: 80px;">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${renderSupplierComparisons(item, vendorData)}
                                </tbody>
                            </table>
                        </div>
            `;
            
            if (showHeader) {
                html += `</div>`;
            }
            html += `</div>`;
            
            return html;
        }
        
        function renderPOView(container, stepData) {
            let headers = `
                <th style="width: 80px;">Req ID</th>
                <th>Requirement</th>
            `;
            
            // Add price columns for financial step
            if (currentEvaluationStep === 4) {
                headers += `
                    <th style="width: 110px;">Original Price</th>
                    <th style="width: 100px;">Corrections</th>
                    <th style="width: 100px;">Negotiations</th>
                    <th style="width: 110px;">Final Price</th>
                    <th style="width: 80px;">Rank</th>
                `;
            } else {
                headers += `
                    <th class="system-eval-column" style="width: 100px;">System</th>
                `;
            }
            
            headers += `
                <th style="width: 120px;">Evaluator 1</th>
                <th style="width: 200px;">Eval 1 Comments</th>
            `;
            
            if (currentEvaluationStep >= 3 && stepData.requirements[0].evaluations.evaluator2) {
                headers += `
                    <th style="width: 120px;">Evaluator 2</th>
                    <th style="width: 200px;">Eval 2 Comments</th>
                `;
            }
            
            headers += `
                <th class="manual-eval-column" style="width: 120px;">PO Final</th>
                <th class="manual-eval-column" style="width: 200px;">PO Comments</th>
            `;
            
            let rows = '';
            stepData.requirements.forEach(req => {
                const e1 = req.evaluations.evaluator || req.evaluations.po;
                const e2 = req.evaluations.evaluator2;
                const po = req.evaluations.po;
                
                let row = `
                    <tr>
                        <td><div class="req-id-badge">${req.id}</div></td>
                        <td>
                            ${req.description}
                            <div class="${req.mandatory ? 'mandatory-flag' : 'optional-flag'}">
                                ${req.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                            </div>
                        </td>
                `;
                
                if (currentEvaluationStep === 4) {
                    row += `
                        <td style="font-weight: 600; font-size: 13px;">${req.originalPrice || '-'}</td>
                        <td style="color: var(--danger-500); font-weight: 600;">${req.corrections || '$0'}</td>
                        <td style="color: var(--success-500); font-weight: 600;">${req.negotiations || '$0'}</td>
                        <td style="font-weight: 700; font-size: 14px; color: var(--primary-600);">${req.finalPrice || req.originalPrice}</td>
                        <td><span class="eval-status-badge ${req.rank.includes('1') ? 'pass' : 'pending'}">${req.rank || '-'}</span></td>
                    `;
                } else {
                    row += `
                        <td class="system-eval-column">
                            ${req.systemEval ? `<span class="eval-status-badge ${req.systemEval}">${req.systemEval === 'pass' ? '‚úÖ Pass' : '‚ùå Fail'}</span>` : '-'}
                        </td>
                    `;
                }
                
                row += `
                    <td><span class="eval-status-badge ${e1.status}">${formatEvalStatus(e1.status)}</span></td>
                    <td style="font-size: 12px;">${e1.comment}</td>
                `;
                
                if (e2) {
                    row += `
                        <td><span class="eval-status-badge ${e2.status}">${formatEvalStatus(e2.status)}</span></td>
                        <td style="font-size: 12px;">${e2.comment}</td>
                    `;
                }
                
                row += `
                    <td class="manual-eval-column">
                        <select class="eval-select ${po.status}">
                            <option value="not_evaluated" ${po.status === 'not_evaluated' ? 'selected' : ''}>‚äò Not Evaluated</option>
                            <option value="pass" ${po.status === 'pass' ? 'selected' : ''}>‚úÖ Pass</option>
                            <option value="fail" ${po.status === 'fail' ? 'selected' : ''}>‚ùå Fail</option>
                            <option value="pending" ${po.status === 'pending' ? 'selected' : ''}>‚è≥ Pending</option>
                        </select>
                    </td>
                    <td class="manual-eval-column">
                        <textarea class="eval-comment-field">${po.comment}</textarea>
                    </td>
                </tr>
                `;
                
                rows += row;
            });
            
            container.innerHTML = `
                <table class="eval-table">
                    <thead>
                        <tr>${headers}</tr>
                    </thead>
                    <tbody>${rows}</tbody>
                </table>
            `;
        }
        
        function renderSupplierComparisons(item, vendorData) {
            // Simulate data for each vendor for this UNSPSC code
            const vendorResponses = {
                'vendor1': {
                    compliance: item.bidderCompliance,
                    response: item.bidderResponse,
                    deviation: item.deviation,
                    docs: item.supplierDocs,
                    systemEval: item.systemEval,
                    evaluation: item.evaluations.evaluator
                },
                'vendor2': {
                    compliance: 'Yes',
                    response: generateVendorResponse(item.description, 'vendor2'),
                    deviation: null,
                    docs: [
                        { name: item.supplierDocs[0]?.name.replace('.pdf', '_V2.pdf') || 'Technical_Spec_V2.pdf', size: '1.8 MB', date: '2024-11-11' },
                        { name: 'ISO_Certificate_V2.pdf', size: '720 KB', date: '2024-11-11' }
                    ],
                    systemEval: 'pass',
                    evaluation: { status: 'pass', comment: 'Compliant with all requirements. Good documentation.' }
                },
                'vendor3': {
                    compliance: item.deviation ? 'Partial' : 'Yes',
                    response: generateVendorResponse(item.description, 'vendor3'),
                    deviation: item.deviation ? 'Alternative product offered' : null,
                    docs: [
                        { name: item.supplierDocs[0]?.name.replace('.pdf', '_V3.pdf') || 'Technical_Spec_V3.pdf', size: '2.2 MB', date: '2024-11-10' },
                        { name: 'Alternative_Product_Spec.pdf', size: '1.4 MB', date: '2024-11-10' }
                    ],
                    systemEval: item.deviation ? 'fail' : 'pass',
                    evaluation: { status: item.deviation ? 'clarification' : 'pass', comment: item.deviation ? 'Need clarification on alternative product compliance.' : 'Meets technical requirements adequately.' }
                }
            };
            
            let rows = '';
            Object.keys(vendorData).forEach((vendorKey, index) => {
                const vendor = vendorData[vendorKey];
                const response = vendorResponses[vendorKey];
                const isCurrentVendor = vendorKey === currentVendorEval;
                
                rows += `
                    <tr style="${isCurrentVendor ? 'background: #fffef0; border-left: 4px solid var(--primary-400);' : ''}">
                        <td>
                            <div style="font-weight: 700; color: var(--primary-600); font-size: 13px; margin-bottom: 2px;">
                                ${isCurrentVendor ? 'üëâ ' : ''}${vendor.name}
                            </div>
                            <div style="font-size: 11px; color: var(--text-muted);">
                                UNGM: ${vendor.ungm}
                            </div>
                            <div style="font-size: 11px; color: var(--text-muted);">
                                ${vendor.country}
                            </div>
                        </td>
                        <td>
                            ${response.compliance === 'Yes' ? '‚úÖ Yes' : response.compliance === 'No' ? '‚ùå No' : '‚ö†Ô∏è Partial'}
                        </td>
                        <td style="font-size: 13px;">
                            ${response.response}
                            ${response.deviation ? `<div class="deviation-badge" style="margin-top: var(--spacing-sm);"><strong>‚ö†Ô∏è Deviation:</strong> ${response.deviation}</div>` : ''}
                        </td>
                        <td style="color: ${response.deviation ? 'var(--danger-500)' : 'var(--text-muted)'}; font-size: 12px;">
                            ${response.deviation || '-'}
                        </td>
                        <td>${renderSupplierDocs(response.docs)}</td>
                        <td class="system-eval-column">
                            <span class="eval-status-badge ${response.systemEval}">
                                ${response.systemEval === 'pass' ? '‚úÖ Pass' : '‚ùå Fail'}
                            </span>
                        </td>
                        <td class="manual-eval-column">
                            <select class="eval-select ${response.evaluation.status}" ${!isCurrentVendor ? 'disabled' : ''}>
                                <option value="not_evaluated" ${response.evaluation.status === 'not_evaluated' ? 'selected' : ''}>‚äò Not Evaluated</option>
                                <option value="pass" ${response.evaluation.status === 'pass' ? 'selected' : ''}>‚úÖ Pass</option>
                                <option value="fail" ${response.evaluation.status === 'fail' ? 'selected' : ''}>‚ùå Fail</option>
                                <option value="clarification" ${response.evaluation.status === 'clarification' ? 'selected' : ''}>‚ö†Ô∏è Clarification</option>
                            </select>
                            ${!isCurrentVendor ? '<div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">View only</div>' : ''}
                        </td>
                        <td class="manual-eval-column">
                            <textarea class="eval-comment-field" placeholder="Enter your comments..." ${!isCurrentVendor ? 'disabled' : ''}>${response.evaluation.comment}</textarea>
                        </td>
                        <td class="manual-eval-column" style="text-align: center;">
                            <button class="btn btn-secondary" onclick="requestEvalClarification('${item.id}-${vendorKey}')" title="Request Clarification" ${!isCurrentVendor ? 'disabled' : ''}>
                                üí¨
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            return rows;
        }
        
        function generateVendorResponse(description, vendorKey) {
            // Generate realistic variations of responses for different vendors
            const responses = {
                'gloves': [
                    'Nitrile examination gloves, powder-free, latex-free. EN455 compliant.',
                    'Latex-free nitrile gloves, powder-free. Meets EN455 standard. Available in sizes S-XL.',
                    'Premium nitrile gloves, powder-free, latex-free. EN455 certified. Textured fingertips for better grip.'
                ],
                'mask': [
                    'Type II masks provided. Type IIR available at additional cost (+$0.05 per unit).',
                    'Type IIR surgical masks, fluid resistant. EN14683 compliant. BFE >98%.',
                    'Type IIR masks with adjustable nose bridge. EN14683 certified. Individually wrapped.'
                ],
                'face shield': [
                    'Anti-fog coated face shields with adjustable headband. CE marked.',
                    'Full face protection shield with anti-fog coating. Comfortable foam padding. CE certified.',
                    'Clear polycarbonate face shield, anti-fog treated. Adjustable elastic band. CE marked.'
                ],
                'syringe': [
                    'Sterile single-use syringes, luer lock, 5ml. ISO 7886-1 compliant.',
                    '5ml luer lock syringes, sterile, single-use. ISO 7886-1 certified. Clear barrel with graduation marks.',
                    'Precision 5ml syringes with luer lock. Sterile, pyrogen-free. ISO 7886-1 compliant.'
                ],
                'gauze': [
                    'Sterile cotton gauze bandages. Multiple sizes: 5cm, 7.5cm, 10cm.',
                    '100% cotton gauze bandages, sterile. Sizes: 5cm, 7.5cm, 10cm, 15cm. Individually wrapped.',
                    'Medical grade cotton gauze, sterile. Available sizes: 5cm, 7.5cm, 10cm. High absorbency.'
                ],
                'catheter': [
                    'Sterile IV catheters with safety mechanism. All sizes available.',
                    'Safety IV catheters 18G-24G. Sterile, with integrated safety shield. Color-coded.',
                    'Premium IV catheters with passive safety mechanism. Sizes 18G-24G. Latex-free.'
                ]
            };
            
            // Determine response type based on description keywords
            let responseArray = responses['gloves']; // default
            if (description.toLowerCase().includes('mask')) responseArray = responses['mask'];
            else if (description.toLowerCase().includes('shield')) responseArray = responses['face shield'];
            else if (description.toLowerCase().includes('syringe')) responseArray = responses['syringe'];
            else if (description.toLowerCase().includes('gauze')) responseArray = responses['gauze'];
            else if (description.toLowerCase().includes('catheter')) responseArray = responses['catheter'];
            
            const vendorIndex = vendorKey === 'vendor2' ? 1 : 2;
            return responseArray[vendorIndex] || responseArray[0];
        }

        function renderPOView(container, stepData) {
            let headers = `
                <th style="width: 80px;">Req ID</th>
                <th>Requirement</th>
            `;
            
            // Add price columns for financial step
            if (currentEvaluationStep === 4) {
                headers += `
                    <th style="width: 110px;">Original Price</th>
                    <th style="width: 100px;">Corrections</th>
                    <th style="width: 100px;">Negotiations</th>
                    <th style="width: 110px;">Final Price</th>
                    <th style="width: 80px;">Rank</th>
                `;
            }
            
            headers += `
                <th class="system-eval-column" style="width: 100px;">System</th>
                <th style="width: 120px;">Evaluator 1</th>
                <th style="width: 200px;">Eval 1 Comments</th>
            `;
            
            if (currentEvaluationStep >= 3 && stepData.requirements[0].evaluations.evaluator2) {
                headers += `
                    <th style="width: 120px;">Evaluator 2</th>
                    <th style="width: 200px;">Eval 2 Comments</th>
                `;
            }
            
            headers += `
                <th class="manual-eval-column" style="width: 120px;">PO Final</th>
                <th class="manual-eval-column" style="width: 200px;">PO Comments</th>
            `;
            
            let rows = '';
            stepData.requirements.forEach(req => {
                const e1 = req.evaluations.evaluator || req.evaluations.po;
                const e2 = req.evaluations.evaluator2;
                const po = req.evaluations.po;
                
                let row = `
                    <tr>
                        <td><div class="req-id-badge">${req.id}</div></td>
                        <td>
                            ${req.description}
                            <div class="${req.mandatory ? 'mandatory-flag' : 'optional-flag'}">
                                ${req.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                            </div>
                        </td>
                `;
                
                if (currentEvaluationStep === 4) {
                    row += `
                        <td style="font-weight: 600; font-size: 13px;">${req.originalPrice || '-'}</td>
                        <td style="color: var(--danger-500); font-weight: 600;">${req.corrections || '$0'}</td>
                        <td style="color: var(--success-500); font-weight: 600;">${req.negotiations || '$0'}</td>
                        <td style="font-weight: 700; font-size: 14px; color: var(--primary-600);">${req.finalPrice || req.originalPrice}</td>
                        <td><span class="eval-status-badge ${req.rank.includes('1') ? 'pass' : 'pending'}">${req.rank || '-'}</span></td>
                    `;
                }
                
                row += `
                    <td class="system-eval-column">
                        ${req.systemEval ? `<span class="eval-status-badge ${req.systemEval}">${req.systemEval === 'pass' ? '‚úÖ Pass' : '‚ùå Fail'}</span>` : '-'}
                    </td>
                    <td><span class="eval-status-badge ${e1.status}">${formatEvalStatus(e1.status)}</span></td>
                    <td style="font-size: 12px;">${e1.comment}</td>
                `;
                
                if (e2) {
                    row += `
                        <td><span class="eval-status-badge ${e2.status}">${formatEvalStatus(e2.status)}</span></td>
                        <td style="font-size: 12px;">${e2.comment}</td>
                    `;
                }
                
                row += `
                    <td class="manual-eval-column">
                        <select class="eval-select ${po.status}">
                            <option value="not_evaluated" ${po.status === 'not_evaluated' ? 'selected' : ''}>‚äò Not Evaluated</option>
                            <option value="pass" ${po.status === 'pass' ? 'selected' : ''}>‚úÖ Pass</option>
                            <option value="fail" ${po.status === 'fail' ? 'selected' : ''}>‚ùå Fail</option>
                            <option value="pending" ${po.status === 'pending' ? 'selected' : ''}>‚è≥ Pending</option>
                        </select>
                    </td>
                    <td class="manual-eval-column">
                        <textarea class="eval-comment-field">${po.comment}</textarea>
                    </td>
                </tr>
                `;
                
                rows += row;
            });
            
            container.innerHTML = `
                <table class="eval-table">
                    <thead>
                        <tr>${headers}</tr>
                    </thead>
                    <tbody>${rows}</tbody>
                </table>
                ${currentEvaluationStep === 4 ? `
                    <div style="margin-top: var(--spacing-lg); padding: var(--spacing-md); background: var(--success-50); border-left: 4px solid var(--success-500); border-radius: var(--radius-sm);">
                        <strong style="color: var(--success-500);">‚úÖ Summary:</strong> Total evaluated price after all adjustments: <strong>$230,500 USD</strong> (Rank 2 of 6)
                    </div>
                ` : ''}
            `;
        }

        function renderComparisonView(container, stepData) {
            let html = `
                <h3 style="margin-bottom: var(--spacing-lg); color: var(--primary-400);">üìä Multi-Evaluator Comparison - ${stepData.name}</h3>
                <div style="background: white; border: 1px solid var(--surface-200); border-radius: var(--radius-md); overflow: hidden;">
                    <div style="display: grid; grid-template-columns: 180px repeat(4, 1fr); background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-400) 100%); color: white; font-weight: bold; font-size: 13px;">
                        <div style="padding: 15px; border-right: 1px solid rgba(255,255,255,0.2);">Requirement</div>
                        <div style="padding: 15px; border-right: 1px solid rgba(255,255,255,0.2);">System</div>
                        <div style="padding: 15px; border-right: 1px solid rgba(255,255,255,0.2);">Evaluator 1<br><span style="font-size: 11px; font-weight: normal;">Jane Doe</span></div>
            `;
            
            if (currentEvaluationStep >= 3) {
                html += `<div style="padding: 15px; border-right: 1px solid rgba(255,255,255,0.2);">Evaluator 2<br><span style="font-size: 11px; font-weight: normal;">Dr. Smith</span></div>`;
            } else {
                html += `<div style="padding: 15px; border-right: 1px solid rgba(255,255,255,0.2);">-</div>`;
            }
            
            html += `
                        <div style="padding: 15px;">PO Final<br><span style="font-size: 11px; font-weight: normal;">Sarah Chen</span></div>
                    </div>
            `;
            
            stepData.requirements.forEach(req => {
                const e1 = req.evaluations.evaluator;
                const e2 = req.evaluations.evaluator2;
                const po = req.evaluations.po;
                const hasDiscrepancy = e2 && e1.status !== e2.status;
                const bgColor = hasDiscrepancy ? 'var(--warning-50)' : 'white';
                
                html += `
                    <div style="display: grid; grid-template-columns: 180px repeat(4, 1fr); border-bottom: 1px solid var(--surface-200); background: ${bgColor};">
                        <div style="padding: 15px; border-right: 1px solid var(--surface-200);">
                            <strong style="color: var(--primary-400);">${req.id}</strong>
                            ${hasDiscrepancy ? '<div style="color: var(--warning-500); font-size: 11px; margin-top: 5px; font-weight: bold;">‚ö†Ô∏è DISCREPANCY</div>' : ''}
                            <div style="font-size: 12px; margin-top: 8px; color: var(--text-secondary); line-height: 1.3;">${req.description.substring(0, 80)}...</div>
                            <div class="${req.mandatory ? 'mandatory-flag' : 'optional-flag'}" style="margin-top: 8px;">
                                ${req.mandatory ? 'MANDATORY' : 'OPTIONAL'}
                            </div>
                        </div>
                        <div style="padding: 15px; border-right: 1px solid var(--surface-200); text-align: center;">
                            <span class="eval-status-badge ${req.systemEval}">${req.systemEval === 'pass' ? '‚úÖ Pass' : '‚ùå Fail'}</span>
                        </div>
                        <div style="padding: 15px; border-right: 1px solid var(--surface-200);">
                            <span class="eval-status-badge ${e1.status}">${formatEvalStatus(e1.status)}</span>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px; line-height: 1.4;">${e1.comment}</div>
                        </div>
                `;
                
                if (e2) {
                    html += `
                        <div style="padding: 15px; border-right: 1px solid var(--surface-200);">
                            <span class="eval-status-badge ${e2.status}">${formatEvalStatus(e2.status)}</span>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px; line-height: 1.4;">${e2.comment}</div>
                        </div>
                    `;
                } else {
                    html += `<div style="padding: 15px; border-right: 1px solid var(--surface-200); text-align: center; color: var(--text-muted);">-</div>`;
                }
                
                html += `
                        <div style="padding: 15px; background: var(--surface-50);">
                            <span class="eval-status-badge ${po.status}">${formatEvalStatus(po.status)}</span>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px; line-height: 1.4;">${po.comment}</div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                <div style="margin-top: var(--spacing-lg); padding: var(--spacing-md); background: var(--info-50); border-left: 4px solid var(--info-400); border-radius: var(--radius-sm);">
                    <strong>üí° Key Insights:</strong>
                    <ul style="margin-top: var(--spacing-sm); margin-left: 20px; line-height: 1.8; font-size: 14px;">
                        <li>Requirements with discrepancies are highlighted in orange</li>
                        <li>PO Final column shows the procurement official's final decision</li>
                        <li>Review discrepancies before finalizing evaluation</li>
                    </ul>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function renderSupplierDocs(docs) {
            if (!docs || docs.length === 0) {
                return '<span style="color: var(--text-muted); font-style: italic; font-size: 12px;">No documents</span>';
            }
            
            return `
                <div class="doc-badge">üìé ${docs.length} Doc${docs.length > 1 ? 's' : ''}</div>
                <div class="doc-list">
                    ${docs.map(doc => `
                        <div class="doc-item" onclick="viewSupplierDoc('${doc.name}')">
                            <div class="doc-name">üìÑ ${doc.name}</div>
                            <div class="doc-meta">üì¶ ${doc.size} | üìÖ ${doc.date}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function formatEvalStatus(status) {
            const map = {
                'pass': '‚úÖ Pass',
                'fail': '‚ùå Fail',
                'clarification': '‚ö†Ô∏è Clarification',
                'pending': '‚è≥ Pending',
                'not_evaluated': '‚äò Not Evaluated'
            };
            return map[status] || status;
        }

        let currentLotId = 'lot1';
        
        function switchEvalView(view) {
            currentEvalView = view;
            
            // Update toggle buttons
            document.querySelectorAll('.view-toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tabs container
            const tabsContainer = document.getElementById('evalTabsContainer');
            if (view === 'lot') {
                // Show lot tabs
                tabsContainer.innerHTML = `
                    <button class="lot-tab active" onclick="switchLot('lot1')">üì¶ Lot 1: PPE</button>
                    <button class="lot-tab" onclick="switchLot('lot2')">üì¶ Lot 2: Medical Consumables</button>
                `;
                currentLotId = 'lot1';
            } else {
                // Show vendor tabs
                tabsContainer.innerHTML = `
                    <button class="vendor-eval-tab active" onclick="switchVendorEval('vendor1')">Supplier 1 - MedSupply Ltd.</button>
                    <button class="vendor-eval-tab" onclick="switchVendorEval('vendor2')">Supplier 2 - HealthCare Corp.</button>
                    <button class="vendor-eval-tab" onclick="switchVendorEval('vendor3')">Supplier 3 - MedTech Inc.</button>
                `;
            }
            
            // Re-render table
            renderEvaluationTable();
        }
        
        function switchLot(lotId) {
            currentLotId = lotId;
            
            document.querySelectorAll('.lot-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderEvaluationTable();
        }

        function viewSupplierDoc(docName) {
            document.getElementById('docViewerTitle').textContent = docName;
            document.getElementById('docViewerMeta').textContent = 'PDF Document ‚Ä¢ Click to zoom';
            document.getElementById('documentViewerModal').classList.add('active');
        }

        function closeDocumentViewer() {
            document.getElementById('documentViewerModal').classList.remove('active');
        }

        function downloadDocument() {
            showToast('üì• Document download started');
        }

        function printDocument() {
            showToast('üñ®Ô∏è Opening print dialog');
        }
        
        function downloadEvaluationExcel(lotId, step) {
            const stepNames = {
                'step1': 'Eligibility_and_Formal',
                'step2': 'Qualification',
                'step3': 'Technical',
                'step4': 'Financial'
            };
            
            const lotNames = {
                'lot1': 'PPE',
                'lot2': 'Medical_Consumables'
            };
            
            const filename = `Evaluation_${stepNames[step]}_${lotNames[lotId]}_${currentTenderId}.xlsx`;
            
            showToast(`üì• Downloading: ${filename}`);
            
            // In production, this would generate and download an actual Excel file
            // with all evaluation criteria, supplier submissions, and editable fields
            setTimeout(() => {
                showToast('‚úÖ Excel file ready for offline evaluation. Upload results when complete.');
            }, 1500);
        }

        // ===== EVALUATION TEAM ASSIGNMENT FUNCTIONS =====
        function openEvaluationTeamModal() {
            document.getElementById('evaluationTeamModal').classList.add('active');
        }

        function closeEvaluationTeamModal() {
            document.getElementById('evaluationTeamModal').classList.remove('active');
        }

        function addEvaluatorToStage(stage) {
            showToast(`üìù Opening evaluator selection for Stage ${stage}`);
            // In production, this would open a dropdown or search to select an evaluator
        }

        function removeFromStage(stage, evaluatorId) {
            showToast(`üóëÔ∏è Evaluator removed from Stage ${stage}`);
        }

        function addEvaluatorToLot(stage, lotId) {
            const lotNames = {
                'lot1': 'Lot 1: PPE',
                'lot2': 'Lot 2: Medical Consumables'
            };
            showToast(`üìù Opening evaluator selection for ${lotNames[lotId]} - Stage ${stage}`);
            // In production, this would open a dropdown or search to select an evaluator
        }

        function removeFromLot(stage, lotId, evaluatorId) {
            showToast(`üóëÔ∏è Evaluator removed from lot assignment`);
        }

        function saveEvaluationTeam() {
            showToast('‚úÖ Evaluation team assignments saved successfully');
            closeEvaluationTeamModal();
        }

        function requestEvalClarification(reqId) {
            showToast('üí¨ Clarification request initiated for ' + reqId);
        }

        function saveEvaluationDraft() {
            showToast('üíæ Evaluation draft saved successfully');
        }

        function submitEvaluation() {
            showToast('‚úÖ Evaluation submitted for review');
        }

        function showToast(message) {
            // Create toast element if it doesn't exist
            let toast = document.getElementById('evalToast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'evalToast';
                toast.style.cssText = `
                    position: fixed;
                    bottom: 30px;
                    right: 30px;
                    background: var(--success-500);
                    color: white;
                    padding: 15px 25px;
                    border-radius: var(--radius-md);
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    z-index: 10000;
                    font-size: 14px;
                    font-weight: 500;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                    max-width: 400px;
                `;
                document.body.appendChild(toast);
            }
            
            toast.textContent = message;
            toast.style.opacity = '1';
            
            setTimeout(() => {
                toast.style.opacity = '0';
            }, 3000);
        }

        // Amendment Modal
        function openAmendModal(tenderId, tenderTitle) {
            currentTenderId = tenderId;
            currentTenderTitle = tenderTitle;
            document.getElementById('amendTenderTitle').textContent = tenderId;
            document.getElementById('amendModal').classList.add('active');
            currentAmendmentStep = 1;
            updateAmendmentStepDisplay();
        }

        function closeAmendModal() {
            document.getElementById('amendModal').classList.remove('active');
            resetAmendmentForm();
        }

        function resetAmendmentForm() {
            currentAmendmentStep = 1;
            selectedCategories = [];
            highestTier = 1;
            
            document.querySelectorAll('.category-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('amendment-description').value = '';
            document.getElementById('amendment-justification').value = '';
            document.getElementById('impacts-mandatory').checked = false;
            document.getElementById('mandatory-impact-notice').style.display = 'none';
            
            updateAmendmentStepDisplay();
        }

        function updateAmendmentWorkflow() {
            selectedCategories = [];
            highestTier = 0;

            // Tier 1
            if (document.getElementById('cat-deadline-extension').checked) {
                selectedCategories.push({ name: 'Deadline Extension', tier: 1 });
                highestTier = Math.max(highestTier, 1);
            }
            if (document.getElementById('cat-clarification-extension').checked) {
                selectedCategories.push({ name: 'Clarification Extension', tier: 1 });
                highestTier = Math.max(highestTier, 1);
            }
            if (document.getElementById('cat-award-date').checked) {
                selectedCategories.push({ name: 'Expected Award Date', tier: 1 });
                highestTier = Math.max(highestTier, 1);
            }

            // Tier 2
            const tier2Cats = [
                { id: 'cat-deadline-shortened', name: 'Deadline Shortened' },
                { id: 'cat-prebid-minutes', name: 'Pre-bid Minutes' },
                { id: 'cat-document-revision', name: 'Document Revision' },
                { id: 'cat-scope-change', name: 'Scope/Quantity Change' },
                { id: 'cat-terms-conditions', name: 'Terms & Criteria' },
                { id: 'cat-price-adjustment', name: 'Price Adjustment' },
                { id: 'cat-error-correction', name: 'Error Correction' },
                { id: 'cat-other', name: 'Other' }
            ];

            tier2Cats.forEach(cat => {
                if (document.getElementById(cat.id).checked) {
                    selectedCategories.push({ name: cat.name, tier: 2 });
                    highestTier = Math.max(highestTier, 2);
                }
            });

            if (selectedCategories.length > 0) {
                document.getElementById('workflow-preview').style.display = 'block';
                displayWorkflow('workflow-display');
            } else {
                document.getElementById('workflow-preview').style.display = 'none';
            }
        }

        function displayWorkflow(containerId) {
            const container = document.getElementById(containerId);
            
            if (highestTier === 1) {
                container.innerHTML = `
                    <div class="workflow-steps">
                        <div class="workflow-step">
                            <div class="workflow-step-icon">‚úçÔ∏è</div>
                            <div class="workflow-step-label">Author Creates</div>
                        </div>
                        <div class="workflow-arrow">‚Üí</div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon">üì¢</div>
                            <div class="workflow-step-label">Auto Posted</div>
                        </div>
                        <div class="workflow-arrow">‚Üí</div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon">üìß</div>
                            <div class="workflow-step-label">Suppliers Notified</div>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="workflow-steps">
                        <div class="workflow-step">
                            <div class="workflow-step-icon">‚úçÔ∏è</div>
                            <div class="workflow-step-label">Author Creates</div>
                        </div>
                        <div class="workflow-arrow">‚Üí</div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon">üë®‚Äçüî¨</div>
                            <div class="workflow-step-label">TME Review</div>
                        </div>
                        <div class="workflow-arrow">‚Üí</div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon">‚úÖ</div>
                            <div class="workflow-step-label">PR Approval</div>
                        </div>
                        <div class="workflow-arrow">‚Üí</div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon">üì¢</div>
                            <div class="workflow-step-label">Posted</div>
                        </div>
                        <div class="workflow-arrow">‚Üí</div>
                        <div class="workflow-step">
                            <div class="workflow-step-icon">üìß</div>
                            <div class="workflow-step-label">Notified</div>
                        </div>
                    </div>
                `;
            }
        }

        function nextAmendmentStep() {
            if (currentAmendmentStep === 1) {
                if (selectedCategories.length === 0) {
                    alert('Please select at least one amendment category');
                    return;
                }
            } else if (currentAmendmentStep === 2) {
                if (!document.getElementById('amendment-description').value.trim()) {
                    alert('Please provide an amendment description');
                    return;
                }
            }

            if (currentAmendmentStep < 3) {
                currentAmendmentStep++;
                
                if (currentAmendmentStep === 3) {
                    populateReviewStep();
                }
                
                updateAmendmentStepDisplay();
            } else {
                submitAmendment();
            }
        }

        function previousAmendmentStep() {
            if (currentAmendmentStep > 1) {
                currentAmendmentStep--;
                updateAmendmentStepDisplay();
            }
        }

        function updateAmendmentStepDisplay() {
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`amendment-step-${i}`).style.display = 'none';
                document.getElementById(`step${i}-number`).classList.remove('active', 'completed');
                document.getElementById(`step${i}-label`).classList.remove('active');
            }

            document.getElementById(`amendment-step-${currentAmendmentStep}`).style.display = 'block';
            document.getElementById(`step${currentAmendmentStep}-number`).classList.add('active');
            document.getElementById(`step${currentAmendmentStep}-label`).classList.add('active');

            for (let i = 1; i < currentAmendmentStep; i++) {
                document.getElementById(`step${i}-number`).classList.add('completed');
            }

            document.getElementById('amendment-back-btn').style.display = currentAmendmentStep > 1 ? 'inline-flex' : 'none';
            const nextBtn = document.getElementById('amendment-next-btn');
            nextBtn.innerHTML = currentAmendmentStep === 3 
                ? '<i class="pi pi-check"></i> Submit Amendment' 
                : 'Next <i class="pi pi-arrow-right"></i>';
        }

        function populateReviewStep() {
            const categoriesHtml = selectedCategories.map(cat => 
                `<span class="tier-badge tier-${cat.tier}" style="margin-right: 8px;">${cat.name}</span>`
            ).join('');
            document.getElementById('review-categories').innerHTML = categoriesHtml;

            const tierHtml = highestTier === 1 
                ? '<span class="tier-badge tier-1">Tier 1 - Author posts directly</span>'
                : '<span class="tier-badge tier-2">Tier 2 - Requires TME & PR review</span>';
            document.getElementById('review-tier').innerHTML = tierHtml;

            document.getElementById('review-description').textContent = 
                document.getElementById('amendment-description').value;

            const impactsMandatory = document.getElementById('impacts-mandatory').checked;
            document.getElementById('review-mandatory').innerHTML = impactsMandatory
                ? '<span style="color: var(--danger-500); font-weight: 600;">‚ö†Ô∏è Yes - Will invalidate existing bids</span>'
                : '<span style="color: var(--success-500);">‚úì No - Existing bids remain valid</span>';

            displayWorkflow('final-workflow-display');
        }

        function submitAmendment() {
            alert(`Amendment submitted successfully for ${currentTenderId}!\n\n` +
                  `The amendment will follow the ${highestTier === 1 ? 'Tier 1 workflow (direct posting)' : 'Tier 2 workflow (TME & PR review)'}.`);
            closeAmendModal();
        }

        function toggleMandatoryImpact() {
            const checked = document.getElementById('impacts-mandatory').checked;
            document.getElementById('mandatory-impact-notice').style.display = checked ? 'block' : 'none';
        }

        // Cancel Modal
        function openCancelModal(tenderId, tenderTitle) {
            currentTenderId = tenderId;
            currentTenderTitle = tenderTitle;
            document.getElementById('cancelTenderTitle').textContent = tenderId;
            document.getElementById('cancelModal').classList.add('active');
        }

        function closeCancelModal() {
            document.getElementById('cancelModal').classList.remove('active');
            resetCancelForm();
        }

        function resetCancelForm() {
            document.getElementById('cancel-reason').value = '';
            document.getElementById('cancel-internal-explanation').value = '';
            document.getElementById('cancel-public-justification').value = '';
            document.getElementById('confirm-cancellation').checked = false;
            document.getElementById('confirm-cancel-btn').disabled = true;
        }

        function submitCancellation() {
            const reason = document.getElementById('cancel-reason').value;
            const internalExp = document.getElementById('cancel-internal-explanation').value;
            const publicJust = document.getElementById('cancel-public-justification').value;

            if (!reason || !internalExp || !publicJust) {
                alert('Please fill in all required fields');
                return;
            }

            alert(`Tender ${currentTenderId} has been cancelled.\n\n` +
                  `- All suppliers have been notified\n` +
                  `- Bids have been archived\n` +
                  `- Requisition lines released in ERP\n` +
                  `- Cancellation logged in audit trail`);
            
            closeCancelModal();
        }

        // Enable cancel button
        document.getElementById('confirm-cancellation').addEventListener('change', function() {
            const reason = document.getElementById('cancel-reason').value;
            const internalExp = document.getElementById('cancel-internal-explanation').value;
            const publicJust = document.getElementById('cancel-public-justification').value;
            
            document.getElementById('confirm-cancel-btn').disabled = 
                !(this.checked && reason && internalExp && publicJust);
        });

        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // Close sidebar on overlay click
        document.getElementById('tender-preview-sidebar').addEventListener('click', function(e) {
            if (e.target === this) {
                closeTenderPreview();
            }
        });
    </script>
</body>
</html>
